var Or="0.8.2",E=Symbol(`typegpu:${Or}:$internal`),Re=Symbol(`typegpu:${Or}:$gpuValueOf`),st=Symbol(`typegpu:${Or}:$getNameForward`),Pr=Symbol(`typegpu:${Or}:$providing`),Wt=Symbol(`typegpu:${Or}:$ownSnippet`),he=Symbol(`typegpu:${Or}:$resolve`),ps=Symbol(`typegpu:${Or}:$repr`);function Ge(e){return!!e?.[E]}var at={[E]:!0,type:"void",toString(){return"void"}},gp=["bool","f32","f16","i32","u32","u16","vec2f","vec2h","vec2i","vec2u","vec2<bool>","vec3f","vec3h","vec3i","vec3u","vec3<bool>","vec4f","vec4h","vec4i","vec4u","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","struct","array","ptr","atomic","decorated","abstractInt","abstractFloat","void","texture_1d","texture_storage_1d","texture_2d","texture_storage_2d","texture_multisampled_2d","texture_depth_2d","texture_depth_multisampled_2d","texture_2d_array","texture_storage_2d_array","texture_depth_2d_array","texture_cube","texture_depth_cube","texture_cube_array","texture_depth_cube_array","texture_3d","texture_storage_3d","texture_external","sampler","sampler_comparison"];function Je(e){let t=e;return Ge(t)&&typeof t.kind=="string"&&t.kind.startsWith("vec")}function $a(e){let t=e;return Ge(t)&&typeof t.type=="string"&&t.type.startsWith("vec2")}function Ma(e){let t=e;return Ge(t)&&typeof t.type=="string"&&t.type.startsWith("vec3")}function Ml(e){let t=e;return Ge(t)&&typeof t.type=="string"&&t.type.startsWith("vec4")}function tr(e){return $a(e)||Ma(e)||Ml(e)}function Ln(e){let t=e;return Ge(t)&&typeof t.kind?.startsWith=="function"&&t.kind.startsWith("mat")}function zl(e){return Ge(e)&&e?.type==="mat2x2f"}function El(e){return Ge(e)&&e?.type==="mat3x3f"}function wp(e){return Ge(e)&&e?.type==="mat4x4f"}function Ds(e){return zl(e)||El(e)||wp(e)}function eu(e){return Je(e)&&["vec2f","vec3f","vec4f"].includes(e.kind)}function Mt(e){return Ge(e)&&gp.includes(e?.type)}function Ft(e){return Ge(e)&&e?.type==="array"}function vt(e){return Ge(e)&&e?.type==="struct"}function Ar(e){return Ge(e)&&e?.type==="ptr"}function Ii(e){return Ge(e)&&e?.type==="atomic"}function oo(e){return Ge(e)&&e?.type==="@align"}function uo(e){return Ge(e)&&e?.type==="@size"}function Sl(e){return Ge(e)&&e?.type==="@location"}function xp(e){return Ge(e)&&e?.type==="@interpolate"}function lo(e){return Ge(e)&&e?.type==="@builtin"}function Mn(e){return Ge(e)&&e?.type==="decorated"}function Pl(e){return Ge(e)&&e.type==="void"}function nr(e){let t=e?.type;return Ge(e)&&(t==="abstractInt"||t==="abstractFloat"||t==="f32"||t==="f16"||t==="i32"||t==="u32")}function co(e){let t=e?.type;return Ge(e)&&(t==="f16"||t==="vec2h"||t==="vec3h"||t==="vec4h")}Object.assign(globalThis,{__TYPEGPU_AUTONAME__:(e,t)=>(Zi(e)&&Ge(e)&&!W(e)&&e.$name(t),e)});var za=globalThis;function Ul(e){return!!e?.[st]}function W(e){return Ul(e)?W(e[st]):Hi(e)?.name}function Ne(e,t){Ul(e)&&Ne(e[st],t),vp(e,{name:t})}function Zi(e){return!!e?.$name}function Es(e){return!!Hi(e)?.ast}function Hi(e){return za.__TYPEGPU_META__.get(e)}function vp(e,t){za.__TYPEGPU_META__??=new WeakMap;let n=za.__TYPEGPU_META__;n.set(e,{...n.get(e),...t})}var Al=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],bp={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"};function dr(e){return e.type==="decorated"||e.type==="loose-decorated"?e.inner:e}var Tp=["unstruct","disarray","loose-decorated",...Al];function ds(e){return Ge(e)&&Tp.includes(e?.type)}function rr(e){return Ge(e)&&e?.type==="disarray"}function zn(e){return Ge(e)&&e?.type==="unstruct"}function En(e){return Ge(e)&&e?.type==="loose-decorated"}function Ss(e){return e.attribs?.find(oo)?.params[0]}function _p(e){return e.attribs?.find(uo)?.params[0]}function fr(e){return e.attribs?.find(Sl)?.params[0]}function Vr(e){return Mt(e)||ds(e)}var Bt={type:"unknown",toString(){return"unknown"}},tu=class{constructor(t,n,r){this.name=t,this.lhs=n,this.operator=r}},nu=class{constructor(t){this.matrix=t}},ru=class{constructor(t){this.op=t,Ne(this,"consoleLog")}[E]=!0},$p="Invariant failed";function Qn(e,t){if(!e)throw new Error($p)}var _s=class Ea extends Error{constructor(t,n){let r=n.map(s=>`- ${Es(s)?`fn*:${W(s)}`:s}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Resolution of the following tree failed:
${r.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=n,Object.setPrototypeOf(this,Ea.prototype)}appendToTrace(t){let n=[t,...this.trace];return new Ea(this.cause,n)}},su=class Sa extends Error{constructor(t,n){let r=n.map(s=>`- ${s}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Execution of the following tree failed:
${r.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=n,Object.setPrototypeOf(this,Sa.prototype)}appendToTrace(t){let n=[t,...this.trace];return new Sa(this.cause,n)}},Mp=class Il extends Error{constructor(t){super(`Missing value for '${t}'`),this.slot=t,Object.setPrototypeOf(this,Il.prototype)}},zp=class Bl extends Error{constructor(t){super(`Buffer '${W(t)??"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,Bl.prototype)}},Ep=class kl extends Error{constructor(t,n){super(`The function '${t??"<unnamed>"}' is missing links to the following external values: ${n}.`),Object.setPrototypeOf(this,kl.prototype)}},ho=class Ol extends Error{constructor(t){super(`Missing bind groups for layouts: '${[...t].map(n=>W(n)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(bindGroup).(...)`),Object.setPrototypeOf(this,Ol.prototype)}},Vl=class Gl extends Error{constructor(t){super(`Missing vertex buffers for layouts: '${[...t].map(n=>W(n)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(layout, buffer).(...)`),Object.setPrototypeOf(this,Gl.prototype)}},iu=class Dl extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Dl.prototype)}},au=class Rl extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Rl.prototype)}},mn=class Nl extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Nl.prototype)}};function Pa(e){return e?.resourceType==="slot"}function Ua(e){return e?.resourceType==="derived"}function Aa(e){return e?.[Pr]!==void 0}function Qi(e){return e?.resourceType==="accessor"}var Fl=class{constructor(t,n){this.value=t,this.dataType=n}};function po(e){return e instanceof Fl}function pi(e){return nr(e.dataType)}function B(e,t){return new Fl(e,dr(t))}var Ll=class{type="normal"},Sp=class{type="codegen"},Pp=class{constructor(e,t){this.buffers=e,this.vars=t}type="simulate"};function jl(e){return!!e?.[he]}function fo(e){return e?.[Wt]}function Up(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||jl(e)||Mt(e)||Pa(e)||Ua(e)||Aa(e)}function Ia(e){return!!e&&typeof e=="object"&&"getMappedRange"in e&&"mapAsync"in e}var _i=!1;function Ap(e){if(_i)return e();try{return _i=!0,e()}finally{_i=!1}}function Bi(){return _i}var or;function Yl(e,t){if(Qn(or===void 0||or===e),or===e)return t();or=e;try{return t()}finally{or=void 0}}function mr(){return or}var Cl=new Ll;function ki(){return or?.mode??Cl}function Bn(){return or?.mode.type==="codegen"}function S(e,...t){let n=mr();function r(i){return po(i)?n.resolve(i.value,i.dataType).value:i}let s="";for(let i=0;i<e.length;++i){s+=e[i];let p=t[i];Array.isArray(p)?s+=p.filter(y=>y!==void 0).map(r).join(", "):p&&(s+=r(p))}return s}function ls(e,t){throw new Error(`Failed to handle ${e} at ${t}`)}var mo={rank:Number.POSITIVE_INFINITY,action:"none"};function Oi(e,t){let n=dr(e),r=dr(t);if(n.type===r.type)return{rank:0,action:"none"};if(n.type==="abstractFloat"){if(r.type==="f32")return{rank:1,action:"none"};if(r.type==="f16")return{rank:2,action:"none"}}if(n.type==="abstractInt"){if(r.type==="i32")return{rank:3,action:"none"};if(r.type==="u32")return{rank:4,action:"none"};if(r.type==="abstractFloat")return{rank:5,action:"none"};if(r.type==="f32")return{rank:6,action:"none"};if(r.type==="f16")return{rank:7,action:"none"}}return tr(n)&&tr(r)?Oi(n.primitive,r.primitive):Ds(n)&&Ds(r)?{rank:0,action:"none"}:mo}function Ip(e,t){let n=dr(e),r=dr(t);if(n.type==="ptr"&&Oi(n.inner,r).rank<Number.POSITIVE_INFINITY)return{rank:0,action:"deref"};if(r.type==="ptr"&&Oi(n,r.inner).rank<Number.POSITIVE_INFINITY)return{rank:1,action:"ref"};let s={f32:0,f16:1,i32:2,u32:3,bool:4};if(n.type in s&&r.type in s){let i=n.type,p=r.type;if(i!==p){let y=s[i];return{rank:s[p]<y?10:20,action:"cast",targetType:r}}}if(n.type==="abstractFloat"){if(r.type==="u32")return{rank:2,action:"cast",targetType:r};if(r.type==="i32")return{rank:1,action:"cast",targetType:r}}return mo}function Bp(e,t,n){let r=Oi(e,t);return r.rank<Number.POSITIVE_INFINITY?r:n?Ip(e,t):mo}function ou(e,t,n){let r;for(let i of t){let p=[],y=0;for(let v of e){let _=Bp(v,i,n);if(y+=_.rank,_.rank===Number.POSITIVE_INFINITY)break;p.push(_)}y<(r?.sum??Number.POSITIVE_INFINITY)&&(r={type:i,details:p,sum:y})}if(!r)return;let s=r.details.map((i,p)=>({sourceIndex:p,action:i.action,...i.action==="cast"&&{targetType:i.targetType}}));return{targetType:r.type,actions:s,hasImplicitConversions:s.some(i=>i.action==="cast")}}function yo(e,t){if(e.length===0)return;let n=[...new Set((t||e).map(dr))],r=ou(e,n,!1);if(r)return r;let s=ou(e,n,!0);if(s)return s}function kp(e,t,n){if(t.action==="none")return B(e.value,n);switch(t.action){case"ref":return B(S`&${e}`,n);case"deref":return B(S`*${e}`,n);case"cast":return n(e);default:ls(t.action,"applyActionToSnippet")}}function ct(e,t){if(e.some(r=>r.type==="unknown"))return;let n=yo(e,t);if(n)return e.map(()=>n.targetType)}function Ps(e,t,n=!0){let r=e.map(i=>i.dataType);if(r.some(i=>i.type==="unknown"))return;let s=yo(r,t);if(s)return e.map((i,p)=>{let y=s.actions[p];return Qn(y),kp(i,y,s.targetType)})}function Ba(e,t,n=!0){if(t===e.dataType)return B(e.value,t);if(e.dataType.type==="unknown")return B(S`${B(e.value,t)}`,t);let r=Ps([e],[t],n);if(!r)throw new mn(`Cannot convert value of type '${e.dataType.type}' to type '${t.type}'`);return r[0]}function Op(e,t){return Object.keys(e.propTypes).map(n=>{let r=t[n];if(!r)throw new Error(`Missing property ${n}`);let s=e.propTypes[n];return Ps([r],[s])?.[0]??r})}function Vp(e){return typeof e!="string"&&fo(e)===void 0}function ce(e,t,n,r="keep"){let s=((...i)=>Bn()?t(...i):e(...i));return Ne(s,n),s.toString=()=>n,Object.defineProperty(s,E,{value:{jsImpl:e,gpuImpl:t,argConversionHint:r}}),s}var sn=class extends Error{constructor(t){super(t),this.name=this.constructor.name}};function G(e){let t=(...r)=>{let{argTypes:s,returnType:i}=typeof e.signature=="function"?e.signature(...r.map(y=>y.dataType)):e.signature,p=r.map((y,v)=>Ba(y,s[v],!e.ignoreImplicitCastWarning));if(p.every(y=>Vp(y.value))&&typeof e.normalImpl=="function")try{return B(e.normalImpl(...p.map(y=>y.value)),i)}catch(y){if(!(y instanceof sn))throw y}return B(e.codegenImpl(...p),i)},n=((...r)=>{if(Bn())return t(...r);if(typeof e.normalImpl=="string")throw new sn(e.normalImpl);return e.normalImpl(...r)});return Ne(n,e.name),n.toString=()=>e.name,Object.defineProperty(n,E,{value:{jsImpl:e.normalImpl,gpuImpl:t,argConversionHint:"keep"}}),n}var Xs={[E]:!0,type:"abstractInt",toString(){return"abstractInt"}},Sn={[E]:!0,type:"abstractFloat",toString(){return"abstractFloat"}},Gp=G({name:"bool",signature:e=>({argTypes:e?[e]:[],returnType:ke}),normalImpl(e){return e===void 0?!1:typeof e=="boolean"?e:!!e},codegenImpl:e=>e.dataType.type==="bool"?S`${e}`:S`bool(${e})`}),ke=Object.assign(Gp,{type:"bool"}),Dp=G({name:"u32",signature:e=>({argTypes:e?[e]:[],returnType:J}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:(e&4294967295)>>>0},codegenImpl:e=>e.dataType.type==="u32"?S`${e}`:S`u32(${e})`}),J=Object.assign(Dp,{type:"u32"}),Rp=G({name:"i32",signature:e=>({argTypes:e?[e]:[],returnType:Ue}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:e|0},codegenImpl:e=>e.dataType.type==="i32"?S`${e}`:S`i32(${e})`}),Np={[E]:!0,type:"u16"},Ue=Object.assign(Rp,{type:"i32"}),Fp=G({name:"f32",signature:e=>({argTypes:e?[e]:[],returnType:$}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Math.fround(e)},codegenImpl:e=>e.dataType.type==="f32"?S`${e}`:S`f32(${e})`}),$=Object.assign(Fp,{type:"f32"}),ql=new ArrayBuffer(4),Lp=new Float32Array(ql),jp=new Uint32Array(ql);function Yp(e){Lp[0]=e;let t=jp[0],n=t>>>31&1,r=t>>>23&255,s=t&8388607;return r===255?n<<15|31744|(s?512:0):(r=r-127+15,r<=0?r<-10?n<<15:(s=(s|8388608)>>1-r,s=s+4096>>13,n<<15|s):r>=31||(s=s+4096,s&8388608&&(s=0,++r,r>=31))?n<<15|31744:n<<15|r<<10|s>>13)}function Cp(e){let t=e&32768?-1:1,n=e>>10&31,r=e&1023;return n===0?r?t*r*2**-24:t*0:n===31?r?Number.NaN:t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t*(1+r/1024)*2**(n-15)}function qp(e){return Cp(Yp(e))}var Wp=G({name:"f16",signature:e=>({argTypes:e?[e]:[],returnType:ut}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:qp(e)},codegenImpl:e=>e.dataType.type==="f16"?S`${e}`:S`f16(${e})`}),ut=Object.assign(Wp,{type:"f16"}),Gr=class extends Array{castElement(){return this[E].elementSchema[E].jsImpl}[he](){let t=this[E].elementSchema;return this.every(n=>!n)?B(`${this.kind}()`,t):this.every(n=>this[0]===n)?B(`${this.kind}(${this[0]})`,t):B(`${this.kind}(${this.join(", ")})`,t)}toString(){return this[he]().value}get xx(){return new this._Vec2(this[0],this[0])}get xy(){return new this._Vec2(this[0],this[1])}get xz(){return new this._Vec2(this[0],this[2])}get xw(){return new this._Vec2(this[0],this[3])}get yx(){return new this._Vec2(this[1],this[0])}get yy(){return new this._Vec2(this[1],this[1])}get yz(){return new this._Vec2(this[1],this[2])}get yw(){return new this._Vec2(this[1],this[3])}get zx(){return new this._Vec2(this[2],this[0])}get zy(){return new this._Vec2(this[2],this[1])}get zz(){return new this._Vec2(this[2],this[2])}get zw(){return new this._Vec2(this[2],this[3])}get wx(){return new this._Vec2(this[3],this[0])}get wy(){return new this._Vec2(this[3],this[1])}get wz(){return new this._Vec2(this[3],this[2])}get ww(){return new this._Vec2(this[3],this[3])}get xxx(){return new this._Vec3(this[0],this[0],this[0])}get xxy(){return new this._Vec3(this[0],this[0],this[1])}get xxz(){return new this._Vec3(this[0],this[0],this[2])}get xxw(){return new this._Vec3(this[0],this[0],this[3])}get xyx(){return new this._Vec3(this[0],this[1],this[0])}get xyy(){return new this._Vec3(this[0],this[1],this[1])}get xyz(){return new this._Vec3(this[0],this[1],this[2])}get xyw(){return new this._Vec3(this[0],this[1],this[3])}get xzx(){return new this._Vec3(this[0],this[2],this[0])}get xzy(){return new this._Vec3(this[0],this[2],this[1])}get xzz(){return new this._Vec3(this[0],this[2],this[2])}get xzw(){return new this._Vec3(this[0],this[2],this[3])}get xwx(){return new this._Vec3(this[0],this[3],this[0])}get xwy(){return new this._Vec3(this[0],this[3],this[1])}get xwz(){return new this._Vec3(this[0],this[3],this[2])}get xww(){return new this._Vec3(this[0],this[3],this[3])}get yxx(){return new this._Vec3(this[1],this[0],this[0])}get yxy(){return new this._Vec3(this[1],this[0],this[1])}get yxz(){return new this._Vec3(this[1],this[0],this[2])}get yxw(){return new this._Vec3(this[1],this[0],this[3])}get yyx(){return new this._Vec3(this[1],this[1],this[0])}get yyy(){return new this._Vec3(this[1],this[1],this[1])}get yyz(){return new this._Vec3(this[1],this[1],this[2])}get yyw(){return new this._Vec3(this[1],this[1],this[3])}get yzx(){return new this._Vec3(this[1],this[2],this[0])}get yzy(){return new this._Vec3(this[1],this[2],this[1])}get yzz(){return new this._Vec3(this[1],this[2],this[2])}get yzw(){return new this._Vec3(this[1],this[2],this[3])}get ywx(){return new this._Vec3(this[1],this[3],this[0])}get ywy(){return new this._Vec3(this[1],this[3],this[1])}get ywz(){return new this._Vec3(this[1],this[3],this[2])}get yww(){return new this._Vec3(this[1],this[3],this[3])}get zxx(){return new this._Vec3(this[2],this[0],this[0])}get zxy(){return new this._Vec3(this[2],this[0],this[1])}get zxz(){return new this._Vec3(this[2],this[0],this[2])}get zxw(){return new this._Vec3(this[2],this[0],this[3])}get zyx(){return new this._Vec3(this[2],this[1],this[0])}get zyy(){return new this._Vec3(this[2],this[1],this[1])}get zyz(){return new this._Vec3(this[2],this[1],this[2])}get zyw(){return new this._Vec3(this[2],this[1],this[3])}get zzx(){return new this._Vec3(this[2],this[2],this[0])}get zzy(){return new this._Vec3(this[2],this[2],this[1])}get zzz(){return new this._Vec3(this[2],this[2],this[2])}get zzw(){return new this._Vec3(this[2],this[2],this[3])}get zwx(){return new this._Vec3(this[2],this[3],this[0])}get zwy(){return new this._Vec3(this[2],this[3],this[1])}get zwz(){return new this._Vec3(this[2],this[3],this[2])}get zww(){return new this._Vec3(this[2],this[3],this[3])}get wxx(){return new this._Vec3(this[3],this[0],this[0])}get wxy(){return new this._Vec3(this[3],this[0],this[1])}get wxz(){return new this._Vec3(this[3],this[0],this[2])}get wxw(){return new this._Vec3(this[3],this[0],this[3])}get wyx(){return new this._Vec3(this[3],this[1],this[0])}get wyy(){return new this._Vec3(this[3],this[1],this[1])}get wyz(){return new this._Vec3(this[3],this[1],this[2])}get wyw(){return new this._Vec3(this[3],this[1],this[3])}get wzx(){return new this._Vec3(this[3],this[2],this[0])}get wzy(){return new this._Vec3(this[3],this[2],this[1])}get wzz(){return new this._Vec3(this[3],this[2],this[2])}get wzw(){return new this._Vec3(this[3],this[2],this[3])}get wwx(){return new this._Vec3(this[3],this[3],this[0])}get wwy(){return new this._Vec3(this[3],this[3],this[1])}get wwz(){return new this._Vec3(this[3],this[3],this[2])}get www(){return new this._Vec3(this[3],this[3],this[3])}get xxxx(){return new this._Vec4(this[0],this[0],this[0],this[0])}get xxxy(){return new this._Vec4(this[0],this[0],this[0],this[1])}get xxxz(){return new this._Vec4(this[0],this[0],this[0],this[2])}get xxxw(){return new this._Vec4(this[0],this[0],this[0],this[3])}get xxyx(){return new this._Vec4(this[0],this[0],this[1],this[0])}get xxyy(){return new this._Vec4(this[0],this[0],this[1],this[1])}get xxyz(){return new this._Vec4(this[0],this[0],this[1],this[2])}get xxyw(){return new this._Vec4(this[0],this[0],this[1],this[3])}get xxzx(){return new this._Vec4(this[0],this[0],this[2],this[0])}get xxzy(){return new this._Vec4(this[0],this[0],this[2],this[1])}get xxzz(){return new this._Vec4(this[0],this[0],this[2],this[2])}get xxzw(){return new this._Vec4(this[0],this[0],this[2],this[3])}get xxwx(){return new this._Vec4(this[0],this[0],this[3],this[0])}get xxwy(){return new this._Vec4(this[0],this[0],this[3],this[1])}get xxwz(){return new this._Vec4(this[0],this[0],this[3],this[2])}get xxww(){return new this._Vec4(this[0],this[0],this[3],this[3])}get xyxx(){return new this._Vec4(this[0],this[1],this[0],this[0])}get xyxy(){return new this._Vec4(this[0],this[1],this[0],this[1])}get xyxz(){return new this._Vec4(this[0],this[1],this[0],this[2])}get xyxw(){return new this._Vec4(this[0],this[1],this[0],this[3])}get xyyx(){return new this._Vec4(this[0],this[1],this[1],this[0])}get xyyy(){return new this._Vec4(this[0],this[1],this[1],this[1])}get xyyz(){return new this._Vec4(this[0],this[1],this[1],this[2])}get xyyw(){return new this._Vec4(this[0],this[1],this[1],this[3])}get xyzx(){return new this._Vec4(this[0],this[1],this[2],this[0])}get xyzy(){return new this._Vec4(this[0],this[1],this[2],this[1])}get xyzz(){return new this._Vec4(this[0],this[1],this[2],this[2])}get xyzw(){return new this._Vec4(this[0],this[1],this[2],this[3])}get xywx(){return new this._Vec4(this[0],this[1],this[3],this[0])}get xywy(){return new this._Vec4(this[0],this[1],this[3],this[1])}get xywz(){return new this._Vec4(this[0],this[1],this[3],this[2])}get xyww(){return new this._Vec4(this[0],this[1],this[3],this[3])}get xzxx(){return new this._Vec4(this[0],this[2],this[0],this[0])}get xzxy(){return new this._Vec4(this[0],this[2],this[0],this[1])}get xzxz(){return new this._Vec4(this[0],this[2],this[0],this[2])}get xzxw(){return new this._Vec4(this[0],this[2],this[0],this[3])}get xzyx(){return new this._Vec4(this[0],this[2],this[1],this[0])}get xzyy(){return new this._Vec4(this[0],this[2],this[1],this[1])}get xzyz(){return new this._Vec4(this[0],this[2],this[1],this[2])}get xzyw(){return new this._Vec4(this[0],this[2],this[1],this[3])}get xzzx(){return new this._Vec4(this[0],this[2],this[2],this[0])}get xzzy(){return new this._Vec4(this[0],this[2],this[2],this[1])}get xzzz(){return new this._Vec4(this[0],this[2],this[2],this[2])}get xzzw(){return new this._Vec4(this[0],this[2],this[2],this[3])}get xzwx(){return new this._Vec4(this[0],this[2],this[3],this[0])}get xzwy(){return new this._Vec4(this[0],this[2],this[3],this[1])}get xzwz(){return new this._Vec4(this[0],this[2],this[3],this[2])}get xzww(){return new this._Vec4(this[0],this[2],this[3],this[3])}get xwxx(){return new this._Vec4(this[0],this[3],this[0],this[0])}get xwxy(){return new this._Vec4(this[0],this[3],this[0],this[1])}get xwxz(){return new this._Vec4(this[0],this[3],this[0],this[2])}get xwxw(){return new this._Vec4(this[0],this[3],this[0],this[3])}get xwyx(){return new this._Vec4(this[0],this[3],this[1],this[0])}get xwyy(){return new this._Vec4(this[0],this[3],this[1],this[1])}get xwyz(){return new this._Vec4(this[0],this[3],this[1],this[2])}get xwyw(){return new this._Vec4(this[0],this[3],this[1],this[3])}get xwzx(){return new this._Vec4(this[0],this[3],this[2],this[0])}get xwzy(){return new this._Vec4(this[0],this[3],this[2],this[1])}get xwzz(){return new this._Vec4(this[0],this[3],this[2],this[2])}get xwzw(){return new this._Vec4(this[0],this[3],this[2],this[3])}get xwwx(){return new this._Vec4(this[0],this[3],this[3],this[0])}get xwwy(){return new this._Vec4(this[0],this[3],this[3],this[1])}get xwwz(){return new this._Vec4(this[0],this[3],this[3],this[2])}get xwww(){return new this._Vec4(this[0],this[3],this[3],this[3])}get yxxx(){return new this._Vec4(this[1],this[0],this[0],this[0])}get yxxy(){return new this._Vec4(this[1],this[0],this[0],this[1])}get yxxz(){return new this._Vec4(this[1],this[0],this[0],this[2])}get yxxw(){return new this._Vec4(this[1],this[0],this[0],this[3])}get yxyx(){return new this._Vec4(this[1],this[0],this[1],this[0])}get yxyy(){return new this._Vec4(this[1],this[0],this[1],this[1])}get yxyz(){return new this._Vec4(this[1],this[0],this[1],this[2])}get yxyw(){return new this._Vec4(this[1],this[0],this[1],this[3])}get yxzx(){return new this._Vec4(this[1],this[0],this[2],this[0])}get yxzy(){return new this._Vec4(this[1],this[0],this[2],this[1])}get yxzz(){return new this._Vec4(this[1],this[0],this[2],this[2])}get yxzw(){return new this._Vec4(this[1],this[0],this[2],this[3])}get yxwx(){return new this._Vec4(this[1],this[0],this[3],this[0])}get yxwy(){return new this._Vec4(this[1],this[0],this[3],this[1])}get yxwz(){return new this._Vec4(this[1],this[0],this[3],this[2])}get yxww(){return new this._Vec4(this[1],this[0],this[3],this[3])}get yyxx(){return new this._Vec4(this[1],this[1],this[0],this[0])}get yyxy(){return new this._Vec4(this[1],this[1],this[0],this[1])}get yyxz(){return new this._Vec4(this[1],this[1],this[0],this[2])}get yyxw(){return new this._Vec4(this[1],this[1],this[0],this[3])}get yyyx(){return new this._Vec4(this[1],this[1],this[1],this[0])}get yyyy(){return new this._Vec4(this[1],this[1],this[1],this[1])}get yyyz(){return new this._Vec4(this[1],this[1],this[1],this[2])}get yyyw(){return new this._Vec4(this[1],this[1],this[1],this[3])}get yyzx(){return new this._Vec4(this[1],this[1],this[2],this[0])}get yyzy(){return new this._Vec4(this[1],this[1],this[2],this[1])}get yyzz(){return new this._Vec4(this[1],this[1],this[2],this[2])}get yyzw(){return new this._Vec4(this[1],this[1],this[2],this[3])}get yywx(){return new this._Vec4(this[1],this[1],this[3],this[0])}get yywy(){return new this._Vec4(this[1],this[1],this[3],this[1])}get yywz(){return new this._Vec4(this[1],this[1],this[3],this[2])}get yyww(){return new this._Vec4(this[1],this[1],this[3],this[3])}get yzxx(){return new this._Vec4(this[1],this[2],this[0],this[0])}get yzxy(){return new this._Vec4(this[1],this[2],this[0],this[1])}get yzxz(){return new this._Vec4(this[1],this[2],this[0],this[2])}get yzxw(){return new this._Vec4(this[1],this[2],this[0],this[3])}get yzyx(){return new this._Vec4(this[1],this[2],this[1],this[0])}get yzyy(){return new this._Vec4(this[1],this[2],this[1],this[1])}get yzyz(){return new this._Vec4(this[1],this[2],this[1],this[2])}get yzyw(){return new this._Vec4(this[1],this[2],this[1],this[3])}get yzzx(){return new this._Vec4(this[1],this[2],this[2],this[0])}get yzzy(){return new this._Vec4(this[1],this[2],this[2],this[1])}get yzzz(){return new this._Vec4(this[1],this[2],this[2],this[2])}get yzzw(){return new this._Vec4(this[1],this[2],this[2],this[3])}get yzwx(){return new this._Vec4(this[1],this[2],this[3],this[0])}get yzwy(){return new this._Vec4(this[1],this[2],this[3],this[1])}get yzwz(){return new this._Vec4(this[1],this[2],this[3],this[2])}get yzww(){return new this._Vec4(this[1],this[2],this[3],this[3])}get ywxx(){return new this._Vec4(this[1],this[3],this[0],this[0])}get ywxy(){return new this._Vec4(this[1],this[3],this[0],this[1])}get ywxz(){return new this._Vec4(this[1],this[3],this[0],this[2])}get ywxw(){return new this._Vec4(this[1],this[3],this[0],this[3])}get ywyx(){return new this._Vec4(this[1],this[3],this[1],this[0])}get ywyy(){return new this._Vec4(this[1],this[3],this[1],this[1])}get ywyz(){return new this._Vec4(this[1],this[3],this[1],this[2])}get ywyw(){return new this._Vec4(this[1],this[3],this[1],this[3])}get ywzx(){return new this._Vec4(this[1],this[3],this[2],this[0])}get ywzy(){return new this._Vec4(this[1],this[3],this[2],this[1])}get ywzz(){return new this._Vec4(this[1],this[3],this[2],this[2])}get ywzw(){return new this._Vec4(this[1],this[3],this[2],this[3])}get ywwx(){return new this._Vec4(this[1],this[3],this[3],this[0])}get ywwy(){return new this._Vec4(this[1],this[3],this[3],this[1])}get ywwz(){return new this._Vec4(this[1],this[3],this[3],this[2])}get ywww(){return new this._Vec4(this[1],this[3],this[3],this[3])}get zxxx(){return new this._Vec4(this[2],this[0],this[0],this[0])}get zxxy(){return new this._Vec4(this[2],this[0],this[0],this[1])}get zxxz(){return new this._Vec4(this[2],this[0],this[0],this[2])}get zxxw(){return new this._Vec4(this[2],this[0],this[0],this[3])}get zxyx(){return new this._Vec4(this[2],this[0],this[1],this[0])}get zxyy(){return new this._Vec4(this[2],this[0],this[1],this[1])}get zxyz(){return new this._Vec4(this[2],this[0],this[1],this[2])}get zxyw(){return new this._Vec4(this[2],this[0],this[1],this[3])}get zxzx(){return new this._Vec4(this[2],this[0],this[2],this[0])}get zxzy(){return new this._Vec4(this[2],this[0],this[2],this[1])}get zxzz(){return new this._Vec4(this[2],this[0],this[2],this[2])}get zxzw(){return new this._Vec4(this[2],this[0],this[2],this[3])}get zxwx(){return new this._Vec4(this[2],this[0],this[3],this[0])}get zxwy(){return new this._Vec4(this[2],this[0],this[3],this[1])}get zxwz(){return new this._Vec4(this[2],this[0],this[3],this[2])}get zxww(){return new this._Vec4(this[2],this[0],this[3],this[3])}get zyxx(){return new this._Vec4(this[2],this[1],this[0],this[0])}get zyxy(){return new this._Vec4(this[2],this[1],this[0],this[1])}get zyxz(){return new this._Vec4(this[2],this[1],this[0],this[2])}get zyxw(){return new this._Vec4(this[2],this[1],this[0],this[3])}get zyyx(){return new this._Vec4(this[2],this[1],this[1],this[0])}get zyyy(){return new this._Vec4(this[2],this[1],this[1],this[1])}get zyyz(){return new this._Vec4(this[2],this[1],this[1],this[2])}get zyyw(){return new this._Vec4(this[2],this[1],this[1],this[3])}get zyzx(){return new this._Vec4(this[2],this[1],this[2],this[0])}get zyzy(){return new this._Vec4(this[2],this[1],this[2],this[1])}get zyzz(){return new this._Vec4(this[2],this[1],this[2],this[2])}get zyzw(){return new this._Vec4(this[2],this[1],this[2],this[3])}get zywx(){return new this._Vec4(this[2],this[1],this[3],this[0])}get zywy(){return new this._Vec4(this[2],this[1],this[3],this[1])}get zywz(){return new this._Vec4(this[2],this[1],this[3],this[2])}get zyww(){return new this._Vec4(this[2],this[1],this[3],this[3])}get zzxx(){return new this._Vec4(this[2],this[2],this[0],this[0])}get zzxy(){return new this._Vec4(this[2],this[2],this[0],this[1])}get zzxz(){return new this._Vec4(this[2],this[2],this[0],this[2])}get zzxw(){return new this._Vec4(this[2],this[2],this[0],this[3])}get zzyx(){return new this._Vec4(this[2],this[2],this[1],this[0])}get zzyy(){return new this._Vec4(this[2],this[2],this[1],this[1])}get zzyz(){return new this._Vec4(this[2],this[2],this[1],this[2])}get zzyw(){return new this._Vec4(this[2],this[2],this[1],this[3])}get zzzx(){return new this._Vec4(this[2],this[2],this[2],this[0])}get zzzy(){return new this._Vec4(this[2],this[2],this[2],this[1])}get zzzz(){return new this._Vec4(this[2],this[2],this[2],this[2])}get zzzw(){return new this._Vec4(this[2],this[2],this[2],this[3])}get zzwx(){return new this._Vec4(this[2],this[2],this[3],this[0])}get zzwy(){return new this._Vec4(this[2],this[2],this[3],this[1])}get zzwz(){return new this._Vec4(this[2],this[2],this[3],this[2])}get zzww(){return new this._Vec4(this[2],this[2],this[3],this[3])}get zwxx(){return new this._Vec4(this[2],this[3],this[0],this[0])}get zwxy(){return new this._Vec4(this[2],this[3],this[0],this[1])}get zwxz(){return new this._Vec4(this[2],this[3],this[0],this[2])}get zwxw(){return new this._Vec4(this[2],this[3],this[0],this[3])}get zwyx(){return new this._Vec4(this[2],this[3],this[1],this[0])}get zwyy(){return new this._Vec4(this[2],this[3],this[1],this[1])}get zwyz(){return new this._Vec4(this[2],this[3],this[1],this[2])}get zwyw(){return new this._Vec4(this[2],this[3],this[1],this[3])}get zwzx(){return new this._Vec4(this[2],this[3],this[2],this[0])}get zwzy(){return new this._Vec4(this[2],this[3],this[2],this[1])}get zwzz(){return new this._Vec4(this[2],this[3],this[2],this[2])}get zwzw(){return new this._Vec4(this[2],this[3],this[2],this[3])}get zwwx(){return new this._Vec4(this[2],this[3],this[3],this[0])}get zwwy(){return new this._Vec4(this[2],this[3],this[3],this[1])}get zwwz(){return new this._Vec4(this[2],this[3],this[3],this[2])}get zwww(){return new this._Vec4(this[2],this[3],this[3],this[3])}get wxxx(){return new this._Vec4(this[3],this[0],this[0],this[0])}get wxxy(){return new this._Vec4(this[3],this[0],this[0],this[1])}get wxxz(){return new this._Vec4(this[3],this[0],this[0],this[2])}get wxxw(){return new this._Vec4(this[3],this[0],this[0],this[3])}get wxyx(){return new this._Vec4(this[3],this[0],this[1],this[0])}get wxyy(){return new this._Vec4(this[3],this[0],this[1],this[1])}get wxyz(){return new this._Vec4(this[3],this[0],this[1],this[2])}get wxyw(){return new this._Vec4(this[3],this[0],this[1],this[3])}get wxzx(){return new this._Vec4(this[3],this[0],this[2],this[0])}get wxzy(){return new this._Vec4(this[3],this[0],this[2],this[1])}get wxzz(){return new this._Vec4(this[3],this[0],this[2],this[2])}get wxzw(){return new this._Vec4(this[3],this[0],this[2],this[3])}get wxwx(){return new this._Vec4(this[3],this[0],this[3],this[0])}get wxwy(){return new this._Vec4(this[3],this[0],this[3],this[1])}get wxwz(){return new this._Vec4(this[3],this[0],this[3],this[2])}get wxww(){return new this._Vec4(this[3],this[0],this[3],this[3])}get wyxx(){return new this._Vec4(this[3],this[1],this[0],this[0])}get wyxy(){return new this._Vec4(this[3],this[1],this[0],this[1])}get wyxz(){return new this._Vec4(this[3],this[1],this[0],this[2])}get wyxw(){return new this._Vec4(this[3],this[1],this[0],this[3])}get wyyx(){return new this._Vec4(this[3],this[1],this[1],this[0])}get wyyy(){return new this._Vec4(this[3],this[1],this[1],this[1])}get wyyz(){return new this._Vec4(this[3],this[1],this[1],this[2])}get wyyw(){return new this._Vec4(this[3],this[1],this[1],this[3])}get wyzx(){return new this._Vec4(this[3],this[1],this[2],this[0])}get wyzy(){return new this._Vec4(this[3],this[1],this[2],this[1])}get wyzz(){return new this._Vec4(this[3],this[1],this[2],this[2])}get wyzw(){return new this._Vec4(this[3],this[1],this[2],this[3])}get wywx(){return new this._Vec4(this[3],this[1],this[3],this[0])}get wywy(){return new this._Vec4(this[3],this[1],this[3],this[1])}get wywz(){return new this._Vec4(this[3],this[1],this[3],this[2])}get wyww(){return new this._Vec4(this[3],this[1],this[3],this[3])}get wzxx(){return new this._Vec4(this[3],this[2],this[0],this[0])}get wzxy(){return new this._Vec4(this[3],this[2],this[0],this[1])}get wzxz(){return new this._Vec4(this[3],this[2],this[0],this[2])}get wzxw(){return new this._Vec4(this[3],this[2],this[0],this[3])}get wzyx(){return new this._Vec4(this[3],this[2],this[1],this[0])}get wzyy(){return new this._Vec4(this[3],this[2],this[1],this[1])}get wzyz(){return new this._Vec4(this[3],this[2],this[1],this[2])}get wzyw(){return new this._Vec4(this[3],this[2],this[1],this[3])}get wzzx(){return new this._Vec4(this[3],this[2],this[2],this[0])}get wzzy(){return new this._Vec4(this[3],this[2],this[2],this[1])}get wzzz(){return new this._Vec4(this[3],this[2],this[2],this[2])}get wzzw(){return new this._Vec4(this[3],this[2],this[2],this[3])}get wzwx(){return new this._Vec4(this[3],this[2],this[3],this[0])}get wzwy(){return new this._Vec4(this[3],this[2],this[3],this[1])}get wzwz(){return new this._Vec4(this[3],this[2],this[3],this[2])}get wzww(){return new this._Vec4(this[3],this[2],this[3],this[3])}get wwxx(){return new this._Vec4(this[3],this[3],this[0],this[0])}get wwxy(){return new this._Vec4(this[3],this[3],this[0],this[1])}get wwxz(){return new this._Vec4(this[3],this[3],this[0],this[2])}get wwxw(){return new this._Vec4(this[3],this[3],this[0],this[3])}get wwyx(){return new this._Vec4(this[3],this[3],this[1],this[0])}get wwyy(){return new this._Vec4(this[3],this[3],this[1],this[1])}get wwyz(){return new this._Vec4(this[3],this[3],this[1],this[2])}get wwyw(){return new this._Vec4(this[3],this[3],this[1],this[3])}get wwzx(){return new this._Vec4(this[3],this[3],this[2],this[0])}get wwzy(){return new this._Vec4(this[3],this[3],this[2],this[1])}get wwzz(){return new this._Vec4(this[3],this[3],this[2],this[2])}get wwzw(){return new this._Vec4(this[3],this[3],this[2],this[3])}get wwwx(){return new this._Vec4(this[3],this[3],this[3],this[0])}get wwwy(){return new this._Vec4(this[3],this[3],this[3],this[1])}get wwwz(){return new this._Vec4(this[3],this[3],this[3],this[2])}get wwww(){return new this._Vec4(this[3],this[3],this[3],this[3])}},Js=class extends Gr{e0;e1;constructor(t,n){super(2),this.e0=this.castElement()(t),this.e1=this.castElement()(n??t)}get 0(){return this.e0}get 1(){return this.e1}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}},Zs=class extends Gr{e0;e1;e2;constructor(t,n,r){super(3),this.e0=this.castElement()(t),this.e1=this.castElement()(n??t),this.e2=this.castElement()(r??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}set z(t){this[2]=this.castElement()(t)}},Hs=class extends Gr{e0;e1;e2;e3;constructor(t,n,r,s){super(4),this.e0=this.castElement()(t),this.e1=this.castElement()(n??t),this.e2=this.castElement()(r??t),this.e3=this.castElement()(s??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}get 3(){return this.e3}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}set 3(t){this.e3=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}},go=class Wl extends Js{get[E](){return{elementSchema:$}}get kind(){return"vec2f"}get _Vec2(){return Wl}get _Vec3(){return To}get _Vec4(){return Eo}},wo=class Xl extends Js{get[E](){return{elementSchema:ut}}get kind(){return"vec2h"}get _Vec2(){return Xl}get _Vec3(){return _o}get _Vec4(){return So}},xo=class Jl extends Js{get[E](){return{elementSchema:Ue}}get kind(){return"vec2i"}get _Vec2(){return Jl}get _Vec3(){return $o}get _Vec4(){return Po}},vo=class Zl extends Js{get[E](){return{elementSchema:J}}get kind(){return"vec2u"}get _Vec2(){return Zl}get _Vec3(){return Mo}get _Vec4(){return Uo}},bo=class Hl extends Js{get[E](){return{elementSchema:ke}}get kind(){return"vec2<bool>"}get _Vec2(){return Hl}get _Vec3(){return zo}get _Vec4(){return Ao}},To=class Ql extends Zs{get[E](){return{elementSchema:$}}get kind(){return"vec3f"}get _Vec2(){return go}get _Vec3(){return Ql}get _Vec4(){return Eo}},_o=class Kl extends Zs{get[E](){return{elementSchema:ut}}get kind(){return"vec3h"}get _Vec2(){return wo}get _Vec3(){return Kl}get _Vec4(){return So}},$o=class ec extends Zs{get[E](){return{elementSchema:Ue}}get kind(){return"vec3i"}get _Vec2(){return xo}get _Vec3(){return ec}get _Vec4(){return Po}},Mo=class tc extends Zs{get[E](){return{elementSchema:J}}get kind(){return"vec3u"}get _Vec2(){return vo}get _Vec3(){return tc}get _Vec4(){return Uo}},zo=class nc extends Zs{get[E](){return{elementSchema:ke}}get kind(){return"vec3<bool>"}get _Vec2(){return bo}get _Vec3(){return nc}get _Vec4(){return Ao}},Eo=class rc extends Hs{get[E](){return{elementSchema:$}}get kind(){return"vec4f"}get _Vec2(){return go}get _Vec3(){return To}get _Vec4(){return rc}},So=class sc extends Hs{get[E](){return{elementSchema:ut}}get kind(){return"vec4h"}get _Vec2(){return wo}get _Vec3(){return _o}get _Vec4(){return sc}},Po=class ic extends Hs{get[E](){return{elementSchema:Ue}}get kind(){return"vec4i"}get _Vec2(){return xo}get _Vec3(){return $o}get _Vec4(){return ic}},Uo=class ac extends Hs{get[E](){return{elementSchema:J}}get kind(){return"vec4u"}get _Vec2(){return vo}get _Vec3(){return Mo}get _Vec4(){return ac}},Ao=class oc extends Hs{get[E](){return{elementSchema:ke}}get kind(){return"vec4<bool>"}get _Vec2(){return bo}get _Vec3(){return zo}get _Vec4(){return oc}},F=jt(go,$),Pn=jt(wo,ut),Be=jt(xo,Ue),xt=jt(vo,J),xr=jt(bo,ke),O=jt(To,$),Un=jt(_o,ut),kt=jt($o,Ue),rt=jt(Mo,J),vr=jt(zo,ke),k=jt(Eo,$),An=jt(So,ut),Fe=jt(Po,Ue),Ye=jt(Uo,J),br=jt(Ao,ke),Vi={vec2f:F,vec2h:Pn,vec2i:Be,vec2u:xt,"vec2<bool>":xr,vec3f:O,vec3h:Un,vec3i:kt,vec3u:rt,"vec3<bool>":vr,vec4f:k,vec4h:An,vec4i:Fe,vec4u:Ye,"vec4<bool>":br};function jt(e,t){let{kind:n,length:r}=new e,s=G({name:n,signature:(...p)=>({argTypes:p.map(y=>{let v=dr(y);return tr(v)?v:t}),returnType:i}),normalImpl:(...p)=>{let y=new Array(p.length),v=0;for(let _ of p)if(typeof _=="number"||typeof _=="boolean")y[v++]=_;else for(let P=0;P<_.length;++P)y[v++]=_[P];if(y.length<=1||y.length===r)return new e(...y);throw new Error(`'${n}' constructor called with invalid number of arguments.`)},ignoreImplicitCastWarning:!0,codegenImpl:(...p)=>S`${n}(${p})`}),i=Object.assign(s,{type:n,primitive:t,[ps]:void 0});return i}var pe=class{constructor(t){this.type=t}[E]=!0},sr={uint8:J,uint8x2:xt,uint8x4:Ye,sint8:Ue,sint8x2:Be,sint8x4:Fe,unorm8:$,unorm8x2:F,unorm8x4:k,snorm8:$,snorm8x2:F,snorm8x4:k,uint16:J,uint16x2:xt,uint16x4:Ye,sint16:Ue,sint16x2:Be,sint16x4:Fe,unorm16:$,unorm16x2:F,unorm16x4:k,snorm16:$,snorm16x2:F,snorm16x4:k,float16:$,float16x2:F,float16x4:k,float32:$,float32x2:F,float32x3:O,float32x4:k,uint32:J,uint32x2:xt,uint32x3:rt,uint32x4:Ye,sint32:Ue,sint32x2:Be,sint32x3:kt,sint32x4:Fe,"unorm10-10-10-2":k,"unorm8x4-bgra":k},Io=new Set(Object.keys(sr)),Xp=new pe("uint8"),Jp=new pe("uint8x2"),Zp=new pe("uint8x4"),Hp=new pe("sint8"),Qp=new pe("sint8x2"),Kp=new pe("sint8x4"),ed=new pe("unorm8"),td=new pe("unorm8x2"),nd=new pe("unorm8x4"),rd=new pe("snorm8"),sd=new pe("snorm8x2"),id=new pe("snorm8x4"),ad=new pe("uint16"),od=new pe("uint16x2"),ud=new pe("uint16x4"),ld=new pe("sint16"),cd=new pe("sint16x2"),hd=new pe("sint16x4"),pd=new pe("unorm16"),dd=new pe("unorm16x2"),fd=new pe("unorm16x4"),md=new pe("snorm16"),yd=new pe("snorm16x2"),gd=new pe("snorm16x4"),wd=new pe("float16"),xd=new pe("float16x2"),vd=new pe("float16x4"),bd=new pe("float32"),Td=new pe("float32x2"),_d=new pe("float32x3"),$d=new pe("float32x4"),Md=new pe("uint32"),zd=new pe("uint32x2"),Ed=new pe("uint32x3"),Sd=new pe("uint32x4"),Pd=new pe("sint32"),Ud=new pe("sint32x2"),Ad=new pe("sint32x3"),Id=new pe("sint32x4"),Bd=new pe("unorm10-10-10-2"),kd=new pe("unorm8x4-bgra");function uc(e){return Ge(e)&&Io.has(e?.type)}function Xt(e){let t=String(e);if(t!=="[object Object]")return t;try{return JSON.stringify(e)}catch(n){return console.error("Error parsing JSON:",n),"<invalid json>"}}function ka(e){return Je(e)||Ln(e)?e.toString():Array.isArray(e)?`[${e.map(ka).join(", ")}]`:e&&typeof e=="object"?`{ ${Object.entries(e).map(([t,n])=>`${t}: ${ka(n)}`).join(", ")} }`:String(e)}var Od={f32:4,f16:2,i32:4,u32:4,bool:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec2b:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec3b:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,vec4b:16,mat2x2f:8,mat3x3f:16,mat4x4f:16,atomic:4};function Vd(e){let t=e?.type,n=Od[t];if(n!==void 0)return n;if(vt(e))return Object.values(e.propTypes).map(tt).reduce((r,s)=>r>s?r:s);if(Ft(e))return tt(e.elementType);if(zn(e)){let r=Object.values(e.propTypes)[0];return r?Ss(r)??1:1}if(rr(e))return Ss(e.elementType)??1;if(Mn(e)||En(e))return Ss(e)??tt(e.inner);if(Io.has(t))return 1;throw new Error(`Cannot determine alignment of data: ${Xt(e)}`)}function Gd(e){if(zn(e)){let t=Object.values(e.propTypes)[0];return t?gn(t):1}return rr(e)?gn(e.elementType):En(e)?Ss(e)??gn(e.inner):Ss(e)??1}var uu=new WeakMap,lu=new WeakMap;function tt(e){let t=uu.get(e);return t===void 0&&(t=Vd(e),uu.set(e,t)),t}function gn(e){let t=lu.get(e);return t===void 0&&(t=Gd(e),lu.set(e,t)),t}function Dd(e){return tt(e)}var nn=(e,t)=>{let n=t-1,r=~n;return(e&n)===0?e:(e&r)+t},Rd={bool:4,f32:4,f16:2,i32:4,u32:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,"vec2<bool>":8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,"vec3<bool>":12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,"vec4<bool>":16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4,atomic:4};function Nd(e){let t=0,n=e.propTypes;for(let r of Object.values(n)){if(Number.isNaN(t))throw new Error("Only the last property of a struct can be unbounded");if(t=nn(t,tt(r)),t+=_e(r),Number.isNaN(t)&&r.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return nn(t,tt(e))}function Fd(e){let t=0,n=e.propTypes;for(let r of Object.values(n)){let s=gn(r);t=nn(t,s),t+=_e(r)}return t}function Ld(e){let t=Rd[e?.type];if(t!==void 0)return t;if(vt(e))return Nd(e);if(zn(e))return Fd(e);if(Ft(e)){if(e.elementCount===0)return Number.NaN;let n=tt(e.elementType);return nn(_e(e.elementType),n)*e.elementCount}if(rr(e)){let n=gn(e.elementType);return nn(_e(e.elementType),n)*e.elementCount}if(Mn(e)||En(e))return _p(e)??_e(e.inner);throw new Error(`Cannot determine size of data: ${e}`)}var cu=new WeakMap;function _e(e){let t=cu.get(e);return t===void 0&&(t=Ld(e),cu.set(e,t)),t}function jd(e){return _e(e)}function fs(e,t){return Mn(e)?new hu(e.inner,[t,...e.attribs]):En(e)?new pu(e.inner,[t,...e.attribs]):ds(e)?new pu(e,[t]):new hu(e,[t])}function Yd(e,t){return fs(t,{[E]:!0,type:"@align",params:[e]})}function Cd(e,t){return fs(t,{[E]:!0,type:"@size",params:[e]})}function Gi(e,t){return fs(t,{[E]:!0,type:"@location",params:[e]})}function qd(e,t){return fs(t,{[E]:!0,type:"@interpolate",params:[e]})}function Wd(e){if(!Dr(e))throw new Error("The @invariant attribute must only be applied to the position built-in value.");let t=Mn(e)||En(e)?e.attribs.find(lo):void 0;if(!t||t.params[0]!=="position")throw new Error("The @invariant attribute must only be applied to the position built-in value.");return fs(e,{[E]:!0,type:"@invariant",params:[]})}function Dr(e){return(Mn(e)||En(e))&&e.attribs.find(lo)!==void 0}function Bo(e){return!Mn(e)&&!En(e)?"":e.attribs.map(t=>t.params.length===0?`${t.type} `:`${t.type}(${t.params.join(", ")}) `).join("")}var lc=class{constructor(t,n){this.inner=t,this.attribs=n;let r=n.find(oo)?.params[0],s=n.find(uo)?.params[0];if(r!==void 0){if(r<=0)throw new Error(`Custom data alignment must be a positive number, got: ${r}.`);if(Math.log2(r)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${r}.`);if(Mt(this.inner)&&r%tt(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${r}, expected multiple of: ${tt(this.inner)}.`)}if(s!==void 0){if(s<_e(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${s}, expected at least: ${_e(this.inner)}.`);if(s<=0)throw new Error(`Custom data size must be a positive number. Got: ${s}.`)}}[E]=!0},hu=class extends lc{[E]=!0;type="decorated"},pu=class extends lc{[E]=!0;type="loose-decorated"};function Ir(e,t){let n=e?.type,r=n in sr?sr[n]:e;return typeof r!="function"?t:t===void 0?r():r(t)}function Cn(e){return cc(e,!1)}function wt(e){return cc(e,!0)}function cc(e,t){let n=r=>Object.fromEntries(Object.entries(e).map(([s,i])=>[s,Ir(i,r?.[s])]));return Object.setPrototypeOf(n,Xd),n.propTypes=e,Object.defineProperty(n,E,{value:{isAbstruct:t}}),n}var Xd={type:"struct",$name(e){return Ne(this,e),this},toString(){return`struct:${W(this)??"<unnamed>"}`}},Yn=ce(((e,t)=>t===void 0?n=>pa(e,n):pa(e,t)),(e,t)=>{if(t?.value===void 0){let n=r=>Yn[E].gpuImpl(e,r);return n[E]=!0,B(n,Bt)}if(typeof t.value!="number")throw new Error(`Cannot create array schema with count unknown at compile-time: '${t.value}'`);return B(pa(e.value,t.value),e.value)},"arrayOf");function pa(e,t){let n=r=>{if(r&&r.length!==t)throw new Error(`Array schema of ${t} elements of type ${e.type} called with ${r.length} argument(s).`);return Array.from({length:t},(s,i)=>Ir(e,r?.[i]))};if(Object.setPrototypeOf(n,Jd),Number.isNaN(_e(e)))throw new Error("Cannot nest runtime sized arrays.");if(n.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create array schema with invalid element count: ${t}.`);return n.elementCount=t,n}var Jd={[E]:!0,type:"array",toString(){return`arrayOf(${this.elementType}, ${this.elementCount})`}};function Rt(e,t){return fs(e,{[E]:!0,type:"@builtin",params:[t]})}var Rs={vertexIndex:Rt(J,"vertex_index"),instanceIndex:Rt(J,"instance_index"),position:Rt(k,"position"),clipDistances:Rt(Yn(J,8),"clip_distances"),frontFacing:Rt(ke,"front_facing"),fragDepth:Rt($,"frag_depth"),sampleIndex:Rt(J,"sample_index"),sampleMask:Rt(J,"sample_mask"),localInvocationId:Rt(rt,"local_invocation_id"),localInvocationIndex:Rt(J,"local_invocation_index"),globalInvocationId:Rt(rt,"global_invocation_id"),workgroupId:Rt(rt,"workgroup_id"),numWorkgroups:Rt(rt,"num_workgroups"),subgroupInvocationId:Rt(J,"subgroup_invocation_id"),subgroupSize:Rt(J,"subgroup_size")},Zd={block:0,binaryExpr:1,assignmentExpr:2,logicalExpr:3,unaryExpr:4,numericLiteral:5,call:6,memberAccess:7,indexAccess:8,return:10,if:11,let:12,const:13,for:14,while:15,continue:16,break:17,arrayExpr:100,preUpdate:101,postUpdate:102,stringLiteral:103,objectExpr:104},Oa={identifier:"i",destructuredObject:"d"},Hd=1;const Qd=Object.freeze(Object.defineProperty({__proto__:null,FORMAT_VERSION:Hd,FuncParameterType:Oa,NodeTypeCatalog:Zd},Symbol.toStringTag,{value:"Module"}));function Us(e,t){for(let[n,r]of Object.entries(t))e[n]=r,r&&(typeof r=="object"||typeof r=="function")&&W(r)===void 0&&Ne(r,n)}function Kd(e,t,n){let r=[...e.matchAll(/:\s*(?<arg>.*?)\s*[,)]/g)].map(s=>s?s[1]:void 0);n(Object.fromEntries(t.flatMap((s,i)=>{let p=r?r[i]:void 0;return vt(s)&&p!==void 0?[[p,s]]:[]})))}function hc(e,t,n){let r=e.match(/->\s(?<output>[\w\d_]+)\s{/),s=r?r[1]?.trim():void 0;vt(t)&&s&&!/\s/g.test(s)&&n({[s]:t})}function ef(e){return new RegExp(`(?<![\\w\\$_.])${e.replaceAll(".","\\.").replaceAll("$","\\$")}(?![\\w\\$_])`,"g")}function Ki(e,t,n){return Object.entries(t).reduce((r,[s,i])=>{let p=ef(s);if(n&&s!=="Out"&&s!=="In"&&!p.test(n)&&console.warn(`The external '${s}' wasn't used in the resolved template.`),Up(i)||ds(i)||Es(i))return r.replaceAll(p,e.resolve(i).value);if(i!==null&&typeof i=="object"){let y=[...n.matchAll(new RegExp(`${s.replaceAll(".","\\.").replaceAll("$","\\$")}\\.(?<prop>.*?)(?![\\w\\$_])`,"g"))].map(v=>v[1]);return[...new Set(y)].reduce((v,_)=>_&&_ in i?Ki(e,{[`${s}.${_}`]:i[_]},v):v,r)}return console.warn(`During resolution, the external '${s}' has been omitted. Only primitives, TGPU resources and plain JS objects can be used as externals.`),r},n)}function tf(e){let{strippedCode:t,argRange:n}=nf(e),r=new pc(t);r.consume("(");let s=[];for(;!r.isAt(")");){let p=[];for(;r.isAt("@");)r.parseUntil(du,fu),r.consume(")"),p.push(r.lastParsed);r.parseUntil(sf);let y=r.lastParsed,v;r.isAt(":")&&(r.consume(":"),r.parseUntil(af,uf),v=r.lastParsed),s.push({identifier:y,attributes:p,type:v}),r.isAt(",")&&r.consume(",")}r.consume(")");let i;if(r.isAt("->")){r.consume("->");let p=[];for(;r.isAt("@");)r.parseUntil(du,fu),r.consume(")"),p.push(r.lastParsed);i={type:r.str.slice(r.pos),attributes:p}}return{args:s,ret:i,range:{begin:n[0],end:n[1]}}}function nf(e){let t=new pc(e),n="",r;for(;!t.isFinished();){if(t.isAt(rf)){t.advanceBy(1);continue}if(t.isAt("//")){t.consume("//"),t.parseUntil(dc),t.advanceBy(1);continue}if(t.isAt("/*")){t.parseUntil(of,lf),t.consume("*/");continue}if(t.isAt("{"))return{strippedCode:n,argRange:[r,t.pos]};t.isAt("(")&&r===void 0&&(r=t.pos),r!==void 0&&(n+=t.str[t.pos]),t.advanceBy(1)}throw new Error("Invalid wgsl code!")}var pc=class{constructor(t){this.str=t,this.#t=0}#e;#t;get pos(){return this.#t}get lastParsed(){if(this.#e===void 0)throw new Error("Parse was not called yet!");return this.str.slice(this.#e,this.pos)}isFinished(){return this.#t>=this.str.length}isAt(t){if(typeof t=="string"){for(let n=0;n<t.length;n++)if(this.str[this.#t+n]!==t[n])return!1;return!0}for(let n of t)if(this.isAt(n))return!0;return!1}parseUntil(t,n){this.#e=this.#t;let r=0;for(;this.#t<this.str.length;){if(n&&this.isAt(n[0])&&(r+=1),n&&this.isAt(n[1])&&(r-=1),r===0&&this.isAt(t))return this.#t;this.#t+=1}throw new Error("Reached the end of the string without finding a match!")}advanceBy(t){this.#t+=t}consume(t){if(!this.isAt(t))throw new Error(`Expected '${t}' at position ${this.#t}, but found '${this.str.slice(this.#t,this.#t+t.length)}'`);this.advanceBy(t.length)}},dc=new Set([`
`,"\v","\f","\r","","\u2028","\u2029"]),rf=new Set([...dc," ","	","",""]),du=new Set([")"]),sf=new Set([":",",",")"]),af=new Set([",",")"]),of=new Set(["*/"]),fu=["(",")"],uf=["<",">"],lf=["/*","*/"];function Qs(e,t=""){let n=[],r={applyExternals(i){n.push(i)},resolve(i,p,y){let v={};for(let oe of n)Us(v,oe);let _=i.getUniqueName(this);if(typeof e=="string"){if(!y)throw new Error("Explicit return type is required for string implementation");let oe=Ki(i,v,e),be="",ze="";if(t!==""){let Se=vt(p[0])?`(in: ${i.resolve(p[0]).value})`:"()",Pe=Mt(y)?Bo(y):"",yt=y!==at?vt(y)?`-> ${i.resolve(y).value}`:`-> ${Pe!==""?Pe:"@location(0)"} ${i.resolve(y).value}`:"";be=`${Se} ${yt} `,ze=oe}else{let Se=tf(oe);if(Se.args.length!==p.length)throw new Error(`WGSL implementation has ${Se.args.length} arguments, while the shell has ${p.length} arguments.`);let Pe=Se.args.map((ht,it)=>`${ht.identifier}: ${mu(i,`parameter ${ht.identifier}`,ht.type,p[it])}`).join(", "),yt=y===at?"":`-> ${mu(i,"return type",Se.ret?.type,y)}`;be=`(${Pe}) ${yt}`,ze=oe.slice(Se.range.end)}return i.addDeclaration(`${t}fn ${_}${be}${ze}`),B(_,y)}let P=Hi(e);if(P?.externals){let oe=Object.fromEntries(Object.entries(P.externals).filter(([be])=>!(be in v)));Us(v,oe)}let U=P?.ast;if(!U)throw new Error("Missing metadata for tgpu.fn function body (either missing 'use gpu' directive, or misconfigured `unplugin-typegpu`)");let R=U.externalNames.filter(oe=>!(oe in v));if(R.length>0)throw new Ep(W(this),R);let j=U.params[1];j&&j.type==="i"&&t!==""&&Us(v,{[j.name]:dr(y)});let L=[],Z=[];for(let[oe,be]of p.entries()){let ze=U.params[oe];switch(ze?.type){case Oa.identifier:{let Se=ze.name,Pe=B(i.makeNameValid(Se),be);L.push(Pe),Pe.value!==Se&&Z.push([Se,Pe]);break}case Oa.destructuredObject:{L.push(B(`_arg_${oe}`,be)),Z.push(...ze.props.map(({name:Se,alias:Pe})=>[Pe,B(`_arg_${oe}.${Se}`,p[oe].propTypes[Se])]));break}case void 0:L.push(B(`_arg_${oe}`,be))}}let{head:Q,body:re,returnType:Me}=i.fnToWgsl({args:L,argAliases:Object.fromEntries(Z),returnType:y,body:U.body,externalMap:v});return i.addDeclaration(`${t}fn ${_}${i.resolve(Q).value}${i.resolve(re).value}`),B(_,Me)}},s=W(e);return s!==void 0&&Ne(r,s),r}function mu(e,t,n,r){let s=e.resolve(r).value.replace(/\s/g,"");if(!n)return s;let i=n.replace(/\s/g,"");if(i!==s)throw new Error(`Type mismatch between TGPU shell and WGSL code string: ${t}, JS type "${s}", WGSL type "${i}".`);return n}function cf(e,t={}){let n=0,r=new Set;return Object.fromEntries(Object.entries(e??{}).map(([s,i])=>{let p=fr(i);if(p!==void 0){if(r.has(p))throw new Error("Duplicate custom location attributes found");r.add(p)}return[s,i]}).map(([s,i])=>{if(Dr(i))return[s,i];if(fr(i)!==void 0)return[s,i];if(t[s])return[s,Gi(t[s],i)];for(;r.has(n);)n++;return[s,Gi(n++,i)]}))}function Ks(e,t={}){return Vr(e)?Pl(e)||fr(e)!==void 0?e:Gi(0,e):Cn(cf(e,t))}function ea(e,...t){return hf(e)?pf(e,...t):e}function hf(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)&&e.raw.every(t=>typeof t=="string")}function pf(e,...t){return e.slice(1).reduce((n,r,s)=>`${n}${t[s]}${r}`,e[0])}function fc(e){if(Object.keys(e.out).length===0)throw new Error("A vertexFn output cannot be empty since it must include the 'position' builtin.");let t={in:e.in,out:e.out,argTypes:e.in&&Object.keys(e.in).length!==0?[Ks(e.in)]:[],isEntry:!0},n=(r,...s)=>df(t,ea(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function df(e,t){let n=Qs(t,"@vertex "),r=e.argTypes[0];return{shell:e,$uses(s){return n.applyExternals(s),this},[E]:!0,[st]:n,$name(s){return Ne(n,s),Zi(r)&&r.$name(`${s}_Input`),this},[he](s){let i=Ks(e.out,s.varyingLocations).$name(`${W(this)??""}_Output`);return typeof t=="string"&&(r&&n.applyExternals({In:r}),n.applyExternals({Out:i})),n.resolve(s,e.argTypes,i)},toString(){return`vertexFn:${W(n)??"<unnamed>"}`}}}var ms=class{};function ko(e){let t=ce((...r)=>{let s=[];for(let i of r)if(typeof i=="number")s.push(i);else for(let p=0;p<i.length;++p)s.push(i[p]);if(s.length!==0&&s.length!==e.columns*e.rows)throw new Error(`'${e.type}' constructor called with invalid number of arguments.`);for(let i=s.length;i<e.columns*e.rows;++i)s.push(0);return new e.MatImpl(...s)},(...r)=>B(S`${e.type}(${r})`,n),e.type),n=Object.assign(t,{type:e.type,identity:vf[e.columns],translation:e.columns===4?ta:void 0,scaling:e.columns===4?na:void 0,rotationX:e.columns===4?ra:void 0,rotationY:e.columns===4?sa:void 0,rotationZ:e.columns===4?ia:void 0});return n}var ff=class extends ms{[E]=!0;columns;length=4;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1]),this.makeColumn(t[2],t[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[1].x=t}set 3(t){this.columns[1].y=t}*[Symbol.iterator](){yield this[0],yield this[1],yield this[2],yield this[3]}[he](){return B(`${this.kind}(${Array.from({length:this.length}).map((t,n)=>this[n]).join(", ")})`,wn)}toString(){return this[he]().value}},mf=class extends ff{kind="mat2x2f";makeColumn(t,n){return F(t,n)}},yf=class extends ms{[E]=!0;columns;length=12;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}*[Symbol.iterator](){for(let t=0;t<12;t++)yield this[t]}[he](){return B(`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`,In)}toString(){return this[he]().value}},gf=class extends yf{kind="mat3x3f";makeColumn(t,n,r){return O(t,n,r)}},wf=class extends ms{[E]=!0;columns;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2],t[3]),this.makeColumn(t[4],t[5],t[6],t[7]),this.makeColumn(t[8],t[9],t[10],t[11]),this.makeColumn(t[12],t[13],t[14],t[15])]}length=16;get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){this.columns[0].w=t}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){this.columns[1].w=t}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){this.columns[2].w=t}set 12(t){this.columns[3].x=t}set 13(t){this.columns[3].y=t}set 14(t){this.columns[3].z=t}set 15(t){this.columns[3].w=t}*[Symbol.iterator](){for(let t=0;t<16;t++)yield this[t]}[he](){return B(`${this.kind}(${Array.from({length:this.length}).map((t,n)=>this[n]).join(", ")})`,we)}toString(){return this[he]().value}},xf=class extends wf{kind="mat4x4f";makeColumn(t,n,r,s){return k(t,n,r,s)}},mc=ce(()=>wn(1,0,0,1),()=>B("mat2x2f(1, 0, 0, 1)",wn),"identity2"),yc=ce(()=>In(1,0,0,0,1,0,0,0,1),()=>B("mat3x3f(1, 0, 0, 0, 1, 0, 0, 0, 1)",In),"identity3"),gc=ce(()=>we(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),()=>B("mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)",we),"identity4"),vf={2:mc,3:yc,4:gc},ta=ce(e=>we(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1),e=>B(S`mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ${e}.x, ${e}.y, ${e}.z, 1)`,we),"translation4"),na=ce(e=>we(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),e=>B(S`mat4x4f(${e}.x, 0, 0, 0, 0, ${e}.y, 0, 0, 0, 0, ${e}.z, 0, 0, 0, 0, 1)`,we),"scaling4"),ra=ce(e=>we(1,0,0,0,0,Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1),e=>B(S`mat4x4f(1, 0, 0, 0, 0, cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1)`,we),"rotationX4"),sa=ce(e=>we(Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1),e=>B(S`mat4x4f(cos(${e}), 0, -sin(${e}), 0, 0, 1, 0, 0, sin(${e}), 0, cos(${e}), 0, 0, 0, 0, 1)`,we),"rotationY4"),ia=ce(e=>we(Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1),e=>B(S`mat4x4f(cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)`,we),"rotationZ4"),wn=ko({type:"mat2x2f",rows:2,columns:2,MatImpl:mf}),In=ko({type:"mat3x3f",rows:3,columns:3,MatImpl:gf}),we=ko({type:"mat4x4f",rows:4,columns:4,MatImpl:xf});function bf(e){return e.kind==="mat3x3f"?[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]:Array.from({length:e.length}).map((t,n)=>e[n])}function Tf(e){return e?.[Re]}var _f={f:{1:$,2:F,3:O,4:k},h:{1:ut,2:Pn,3:Un,4:An},i:{1:Ue,2:Be,3:kt,4:Fe},u:{1:J,2:xt,3:rt,4:Ye},b:{1:ke,2:xr,3:vr,4:br}},$f={vec2f:F,vec2h:Pn,vec2i:Be,vec2u:xt,"vec2<bool>":xr,vec3f:O,vec3h:Un,vec3i:kt,vec3u:rt,"vec3<bool>":vr,vec4f:k,vec4h:An,vec4i:Fe,vec4u:Ye,"vec4<bool>":br,mat2x2f:wn,mat3x3f:In,mat4x4f:we};function Va(e,t){if(vt(e)||zn(e))return e.propTypes[t]??Bt;if(e===ke||nr(e))return Bt;let n=t.length;if(tr(e)&&n>=1&&n<=4){let r=e.type.includes("bool")?"b":e.type[4],s=_f[r][n];if(s)return s}return Bt}var yu={mat2x2f:F,mat3x3f:O,mat4x4f:k};function da(e){return Ft(e)||rr(e)?e.elementType:tr(e)?e.primitive:e.type in yu?yu[e.type]:Bt}function Di(e){return e>=2**63||e<-9223372036854776e3?B(e,Sn):Number.isInteger(e)?(Number.isSafeInteger(e)||console.warn(`The integer ${e} exceeds the safe integer range and may have lost precision.`),B(e,Xs)):B(e,Sn)}function Ns(e){return e.type==="abstractFloat"?$:e.type==="abstractInt"?Ue:e}function Mf(e){return e.map(t=>B(t.value,Ns(t.dataType)))}function $i(e){return po(e)?e:fo(e)||(Je(e)||Ln(e)?B(e,$f[e.kind]):typeof e=="string"||typeof e=="function"||typeof e=="object"||typeof e=="symbol"||typeof e>"u"||e===null?B(e,Bt):typeof e=="number"?Di(e):typeof e=="boolean"?B(e,ke):B(e,Bt))}var kn={get(e,t){if(t in e)return Reflect.get(e,t);if(t==="toString"||t===Symbol.toStringTag||t===Symbol.toPrimitive)return()=>e.toString();if(typeof t=="symbol")return;let n=fo(e).dataType,r=Va(n,String(t));if(r.type!=="unknown")return new Proxy({[E]:!0,[he]:s=>B(`${s.resolve(e).value}.${String(t)}`,r),get[Wt](){return B(this,r)},toString:()=>`${String(e)}.${t}`},kn)}};function aa(e){let t=e;for(;;){let n=Tf(t);if(!n)break;t=n}return t}function Ga(e,t){return new zf(e,t)}var zf=class{constructor(t,n){this.dataType=t,this.#e=n}[E]={};#e;$name(t){return Ne(this,t),this}[he](t){let n=t.getUniqueName(this),r=t.resolve(this.dataType).value,s=t.resolve(this.#e,this.dataType).value;return t.addDeclaration(`const ${n}: ${r} = ${s};`),B(n,this.dataType)}toString(){return`const:${W(this)??"<unnamed>"}`}get[Re](){let t=this.dataType;return new Proxy({[E]:!0,get[Wt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`const:${W(this)??"<unnamed>"}.$`},kn)}get value(){return Bn()?this[Re]:this.#e}get $(){return this.value}};function Oo(){return{[E]:!0,type:"sampler",[ps]:void 0}}function Vo(){return{[E]:!0,type:"sampler_comparison",[ps]:void 0}}function Ef(e){return!!e[E]&&e.type==="sampler"}function Sf(e){return!!e[E]&&e.type==="sampler_comparison"}function Da(e){if("multisampled"in e){if(e.multisampled){if(e.dimension==="2d")return xc(e.sampleType);throw new Error(`Multisampled textures only support '2d' dimension, got '${e.dimension}'`)}switch(e.dimension){case"1d":return wc(e.sampleType);case"2d":return cs(e.sampleType);case"2d-array":return vc(e.sampleType);case"3d":return _c(e.sampleType);case"cube":return bc(e.sampleType);case"cube-array":return Tc(e.sampleType);default:throw new Error(`Unsupported texture dimension: '${e.dimension}'`)}}if(!("access"in e))throw new Error("Descriptor is neither a sampled nor a storage texture");switch(e.dimension){case"1d":return $c(e.format,e.access);case"2d":return ti(e.format,e.access);case"2d-array":return Mc(e.format,e.access);case"3d":return zc(e.format,e.access);default:throw new Error(`Unsupported storage texture dimension: '${e.dimension}'`)}}function vn(e,t){let n=e.startsWith("texture_depth")?["depth","float","unfilterable-float"]:t.sampleType.type==="i32"?["sint"]:t.sampleType.type==="u32"?["uint"]:["float","unfilterable-float"];return{[E]:!0,[ps]:void 0,type:e,bindingSampleType:n,...t}}function oa(e,t){return{[E]:!0,[ps]:void 0,type:e,...t}}var gu=new Map,ei={"write-only":"write","read-only":"read","read-write":"read_write"};function zt(e,t){let n=gu.get(e);return n||(n=t(),gu.set(e,n)),n}function wc(e){let t=e||$,n=`texture_1d<${t.type}>`;return zt(n,()=>vn("texture_1d",{dimension:"1d",sampleType:t,multisampled:!1}))}function cs(e){let t=e||$,n=`texture_2d<${t.type}>`;return zt(n,()=>vn("texture_2d",{dimension:"2d",sampleType:t,multisampled:!1}))}function xc(e){let t=e||$,n=`texture_multisampled_2d<${t.type}>`;return zt(n,()=>vn("texture_multisampled_2d",{dimension:"2d",sampleType:t,multisampled:!0}))}function vc(e){let t=e||$,n=`texture_2d_array<${t.type}>`;return zt(n,()=>vn("texture_2d_array",{dimension:"2d-array",sampleType:t,multisampled:!1}))}function bc(e){let t=e||$,n=`texture_cube<${t.type}>`;return zt(n,()=>vn("texture_cube",{dimension:"cube",sampleType:t,multisampled:!1}))}function Tc(e){let t=e||$,n=`texture_cube_array<${t.type}>`;return zt(n,()=>vn("texture_cube_array",{dimension:"cube-array",sampleType:t,multisampled:!1}))}function _c(e){let t=e||$,n=`texture_3d<${t.type}>`;return zt(n,()=>vn("texture_3d",{dimension:"3d",sampleType:t,multisampled:!1}))}function $c(e,t){let n=t||"write-only",r=`texture_storage_1d<${e}, ${ei[n]}>`;return zt(r,()=>oa("texture_storage_1d",{dimension:"1d",format:e,access:n}))}function ti(e,t){let n=t||"write-only",r=`texture_storage_2d<${e}, ${ei[n]}>`;return zt(r,()=>oa("texture_storage_2d",{dimension:"2d",format:e,access:n}))}function Mc(e,t){let n=t||"write-only",r=`texture_storage_2d_array<${e}, ${ei[n]}>`;return zt(r,()=>oa("texture_storage_2d_array",{dimension:"2d-array",format:e,access:n}))}function zc(e,t){let n=t||"write-only",r=`texture_storage_3d<${e}, ${ei[n]}>`;return zt(r,()=>oa("texture_storage_3d",{dimension:"3d",format:e,access:n}))}function Pf(){return zt("texture_depth_2d",()=>vn("texture_depth_2d",{dimension:"2d",sampleType:$,multisampled:!1}))}function Uf(){return zt("texture_depth_multisampled_2d",()=>vn("texture_depth_multisampled_2d",{dimension:"2d",sampleType:$,multisampled:!0}))}function Af(){return zt("texture_depth_2d_array",()=>vn("texture_depth_2d_array",{dimension:"2d-array",sampleType:$,multisampled:!1}))}function If(){return zt("texture_depth_cube",()=>vn("texture_depth_cube",{dimension:"cube",sampleType:$,multisampled:!1}))}function Bf(){return zt("texture_depth_cube_array",()=>vn("texture_depth_cube_array",{dimension:"cube-array",sampleType:$,multisampled:!1}))}function Ec(){return zt("texture_external",()=>({[E]:!0,[ps]:void 0,type:"texture_external",dimension:"2d"}))}function Sc(e){return!!e[E]&&typeof e.multisampled=="boolean"}function Ra(e){return!!e[E]&&typeof e.format=="string"&&typeof e.access=="string"}function Pc(e){return new kf(e)}var kf=class{constructor(t){this.inner=t}[E]=!0;type="atomic"},Mr=(e,t,n)=>{if(e===t)return 0;let r=me((n-e)/(t-e),0,1);return r*r*(3-2*r)},me=(e,t,n)=>Math.min(Math.max(t,e),n),Lr=(e,t)=>t===0?e:Math.trunc(e/t);function Vn(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getFloat32(0,!0)}function Gn(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getInt32(0,!0)}var cn=xr[E].jsImpl,dn=F[E].jsImpl,Xn=Pn[E].jsImpl,ss=Be[E].jsImpl,As=xt[E].jsImpl,hn=vr[E].jsImpl,en=O[E].jsImpl,Rn=Un[E].jsImpl,is=kt[E].jsImpl,Is=rt[E].jsImpl,pn=br[E].jsImpl,fn=k[E].jsImpl,Jn=An[E].jsImpl,as=Fe[E].jsImpl,Bs=Ye[E].jsImpl,jr=e=>Math.sqrt(e.x**2+e.y**2),Yr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2),Cr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2+e.w**2),di=(e,t)=>e.x*t.x+e.y*t.y,fi=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,mi=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,Xe=e=>t=>dn(e(t.x),e(t.y)),Qe=e=>t=>Xn(e(t.x),e(t.y)),qr=e=>t=>ss(e(t.x),e(t.y)),xs=e=>t=>As(e(t.x),e(t.y)),qe=e=>t=>en(e(t.x),e(t.y),e(t.z)),Ke=e=>t=>Rn(e(t.x),e(t.y),e(t.z)),Wr=e=>t=>is(e(t.x),e(t.y),e(t.z)),vs=e=>t=>Is(e(t.x),e(t.y),e(t.z)),je=e=>t=>fn(e(t.x),e(t.y),e(t.z),e(t.w)),et=e=>t=>Jn(e(t.x),e(t.y),e(t.z),e(t.w)),Xr=e=>t=>as(e(t.x),e(t.y),e(t.z),e(t.w)),bs=e=>t=>Bs(e(t.x),e(t.y),e(t.z),e(t.w)),wu=e=>t=>{let n=t.columns;return wn(Xe(e)(n[0]),Xe(e)(n[1]))},xu=e=>t=>{let n=t.columns;return In(qe(e)(n[0]),qe(e)(n[1]),qe(e)(n[2]))},vu=e=>t=>{let n=t.columns;return we(je(e)(n[0]),je(e)(n[1]),je(e)(n[2]),je(e)(n[3]))},Wn=e=>(t,n)=>dn(e(t.x,n.x),e(t.y,n.y)),Tr=e=>(t,n)=>Xn(e(t.x,n.x),e(t.y,n.y)),Jr=e=>(t,n)=>ss(e(t.x,n.x),e(t.y,n.y)),Zr=e=>(t,n)=>As(e(t.x,n.x),e(t.y,n.y)),Nn=e=>(t,n)=>en(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),_r=e=>(t,n)=>Rn(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),Hr=e=>(t,n)=>is(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),Qr=e=>(t,n)=>Is(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),$n=e=>(t,n)=>fn(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),$r=e=>(t,n)=>Jn(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),Kr=e=>(t,n)=>as(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),es=e=>(t,n)=>Bs(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),Of=e=>(t,n)=>{let r=t.columns,s=n.columns;return wn(Wn(e)(r[0],s[0]),Wn(e)(r[1],s[1]))},Vf=e=>(t,n)=>{let r=t.columns,s=n.columns;return In(Nn(e)(r[0],s[0]),Nn(e)(r[1],s[1]),Nn(e)(r[2],s[2]))},Gf=e=>(t,n)=>{let r=t.columns,s=n.columns;return we($n(e)(r[0],s[0]),$n(e)(r[1],s[1]),$n(e)(r[2],s[2]),$n(e)(r[3],s[3]))},Df=e=>(t,n,r)=>dn(e(t.x,n.x,r.x),e(t.y,n.y,r.y)),Rf=e=>(t,n,r)=>Xn(e(t.x,n.x,r.x),e(t.y,n.y,r.y)),Nf=e=>(t,n,r)=>en(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z)),Ff=e=>(t,n,r)=>Rn(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z)),Lf=e=>(t,n,r)=>fn(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z),e(t.w,n.w,r.w)),jf=e=>(t,n,r)=>Jn(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z),e(t.w,n.w,r.w)),ee={eq:{vec2f:(e,t)=>cn(e.x===t.x,e.y===t.y),vec2h:(e,t)=>cn(e.x===t.x,e.y===t.y),vec2i:(e,t)=>cn(e.x===t.x,e.y===t.y),vec2u:(e,t)=>cn(e.x===t.x,e.y===t.y),"vec2<bool>":(e,t)=>cn(e.x===t.x,e.y===t.y),vec3f:(e,t)=>hn(e.x===t.x,e.y===t.y,e.z===t.z),vec3h:(e,t)=>hn(e.x===t.x,e.y===t.y,e.z===t.z),vec3i:(e,t)=>hn(e.x===t.x,e.y===t.y,e.z===t.z),vec3u:(e,t)=>hn(e.x===t.x,e.y===t.y,e.z===t.z),"vec3<bool>":(e,t)=>hn(e.x===t.x,e.y===t.y,e.z===t.z),vec4f:(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4h:(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4i:(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4u:(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),"vec4<bool>":(e,t)=>pn(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w)},lt:{vec2f:(e,t)=>cn(e.x<t.x,e.y<t.y),vec2h:(e,t)=>cn(e.x<t.x,e.y<t.y),vec2i:(e,t)=>cn(e.x<t.x,e.y<t.y),vec2u:(e,t)=>cn(e.x<t.x,e.y<t.y),vec3f:(e,t)=>hn(e.x<t.x,e.y<t.y,e.z<t.z),vec3h:(e,t)=>hn(e.x<t.x,e.y<t.y,e.z<t.z),vec3i:(e,t)=>hn(e.x<t.x,e.y<t.y,e.z<t.z),vec3u:(e,t)=>hn(e.x<t.x,e.y<t.y,e.z<t.z),vec4f:(e,t)=>pn(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4h:(e,t)=>pn(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4i:(e,t)=>pn(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4u:(e,t)=>pn(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w)},or:{"vec2<bool>":(e,t)=>cn(e.x||t.x,e.y||t.y),"vec3<bool>":(e,t)=>hn(e.x||t.x,e.y||t.y,e.z||t.z),"vec4<bool>":(e,t)=>pn(e.x||t.x,e.y||t.y,e.z||t.z,e.w||t.w)},all:{"vec2<bool>":e=>e.x&&e.y,"vec3<bool>":e=>e.x&&e.y&&e.z,"vec4<bool>":e=>e.x&&e.y&&e.z&&e.w},abs:{vec2f:Xe(Math.abs),vec2h:Qe(Math.abs),vec2i:qr(Math.abs),vec2u:xs(Math.abs),vec3f:qe(Math.abs),vec3h:Ke(Math.abs),vec3i:Wr(Math.abs),vec3u:vs(Math.abs),vec4f:je(Math.abs),vec4h:et(Math.abs),vec4i:Xr(Math.abs),vec4u:bs(Math.abs)},atan2:{vec2f:Wn(Math.atan2),vec2h:Tr(Math.atan2),vec3f:Nn(Math.atan2),vec3h:_r(Math.atan2),vec4f:$n(Math.atan2),vec4h:$r(Math.atan2)},acos:{vec2f:Xe(Math.acos),vec2h:Qe(Math.acos),vec2i:qr(Math.acos),vec2u:xs(Math.acos),vec3f:qe(Math.acos),vec3h:Ke(Math.acos),vec3i:Wr(Math.acos),vec3u:vs(Math.acos),vec4f:je(Math.acos),vec4h:et(Math.acos),vec4i:Xr(Math.acos),vec4u:bs(Math.acos)},acosh:{vec2f:Xe(Math.acosh),vec2h:Qe(Math.acosh),vec3f:qe(Math.acosh),vec3h:Ke(Math.acosh),vec4f:je(Math.acosh),vec4h:et(Math.acosh)},asin:{vec2f:Xe(Math.asin),vec2h:Qe(Math.asin),vec3f:qe(Math.asin),vec3h:Ke(Math.asin),vec4f:je(Math.asin),vec4h:et(Math.asin)},asinh:{vec2f:Xe(Math.asinh),vec2h:Qe(Math.asinh),vec3f:qe(Math.asinh),vec3h:Ke(Math.asinh),vec4f:je(Math.asinh),vec4h:et(Math.asinh)},atan:{vec2f:Xe(Math.atan),vec2h:Qe(Math.atan),vec3f:qe(Math.atan),vec3h:Ke(Math.atan),vec4f:je(Math.atan),vec4h:et(Math.atan)},atanh:{vec2f:Xe(Math.atanh),vec2h:Qe(Math.atanh),vec3f:qe(Math.atanh),vec3h:Ke(Math.atanh),vec4f:je(Math.atanh),vec4h:et(Math.atanh)},ceil:{vec2f:Xe(Math.ceil),vec2h:Qe(Math.ceil),vec3f:qe(Math.ceil),vec3h:Ke(Math.ceil),vec4f:je(Math.ceil),vec4h:et(Math.ceil)},clamp:{vec2f:(e,t,n)=>dn(me(e.x,t.x,n.x),me(e.y,t.y,n.y)),vec2h:(e,t,n)=>Xn(me(e.x,t.x,n.x),me(e.y,t.y,n.y)),vec2i:(e,t,n)=>ss(me(e.x,t.x,n.x),me(e.y,t.y,n.y)),vec2u:(e,t,n)=>As(me(e.x,t.x,n.x),me(e.y,t.y,n.y)),vec3f:(e,t,n)=>en(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z)),vec3h:(e,t,n)=>Rn(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z)),vec3i:(e,t,n)=>is(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z)),vec3u:(e,t,n)=>Is(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z)),vec4f:(e,t,n)=>fn(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z),me(e.w,t.w,n.w)),vec4h:(e,t,n)=>Jn(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z),me(e.w,t.w,n.w)),vec4i:(e,t,n)=>as(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z),me(e.w,t.w,n.w)),vec4u:(e,t,n)=>Bs(me(e.x,t.x,n.x),me(e.y,t.y,n.y),me(e.z,t.z,n.z),me(e.w,t.w,n.w))},length:{vec2f:jr,vec2h:jr,vec3f:Yr,vec3h:Yr,vec4f:Cr,vec4h:Cr},add:{vec2f:Wn((e,t)=>e+t),vec2h:Tr((e,t)=>e+t),vec2i:Jr((e,t)=>e+t),vec2u:Zr((e,t)=>e+t),vec3f:Nn((e,t)=>e+t),vec3h:_r((e,t)=>e+t),vec3i:Hr((e,t)=>e+t),vec3u:Qr((e,t)=>e+t),vec4f:$n((e,t)=>e+t),vec4h:$r((e,t)=>e+t),vec4i:Kr((e,t)=>e+t),vec4u:es((e,t)=>e+t),mat2x2f:Of((e,t)=>e+t),mat3x3f:Vf((e,t)=>e+t),mat4x4f:Gf((e,t)=>e+t)},smoothstep:{vec2f:Df(Mr),vec2h:Rf(Mr),vec3f:Nf(Mr),vec3h:Ff(Mr),vec4f:Lf(Mr),vec4h:jf(Mr)},addMixed:{vec2f:(e,t)=>Xe(n=>n+t)(e),vec2h:(e,t)=>Qe(n=>n+t)(e),vec2i:(e,t)=>qr(n=>n+t)(e),vec2u:(e,t)=>xs(n=>n+t)(e),vec3f:(e,t)=>qe(n=>n+t)(e),vec3h:(e,t)=>Ke(n=>n+t)(e),vec3i:(e,t)=>Wr(n=>n+t)(e),vec3u:(e,t)=>vs(n=>n+t)(e),vec4f:(e,t)=>je(n=>n+t)(e),vec4h:(e,t)=>et(n=>n+t)(e),vec4i:(e,t)=>Xr(n=>n+t)(e),vec4u:(e,t)=>bs(n=>n+t)(e),mat2x2f:(e,t)=>wu(n=>n+t)(e),mat3x3f:(e,t)=>xu(n=>n+t)(e),mat4x4f:(e,t)=>vu(n=>n+t)(e)},mulSxV:{vec2f:(e,t)=>Xe(n=>e*n)(t),vec2h:(e,t)=>Qe(n=>e*n)(t),vec2i:(e,t)=>qr(n=>e*n)(t),vec2u:(e,t)=>xs(n=>e*n)(t),vec3f:(e,t)=>qe(n=>e*n)(t),vec3h:(e,t)=>Ke(n=>e*n)(t),vec3i:(e,t)=>Wr(n=>e*n)(t),vec3u:(e,t)=>vs(n=>e*n)(t),vec4f:(e,t)=>je(n=>e*n)(t),vec4h:(e,t)=>et(n=>e*n)(t),vec4i:(e,t)=>Xr(n=>e*n)(t),vec4u:(e,t)=>bs(n=>e*n)(t),mat2x2f:(e,t)=>wu(n=>e*n)(t),mat3x3f:(e,t)=>xu(n=>e*n)(t),mat4x4f:(e,t)=>vu(n=>e*n)(t)},mulVxV:{vec2f:Wn((e,t)=>e*t),vec2h:Tr((e,t)=>e*t),vec2i:Jr((e,t)=>e*t),vec2u:Zr((e,t)=>e*t),vec3f:Nn((e,t)=>e*t),vec3h:_r((e,t)=>e*t),vec3i:Hr((e,t)=>e*t),vec3u:Qr((e,t)=>e*t),vec4f:$n((e,t)=>e*t),vec4h:$r((e,t)=>e*t),vec4i:Kr((e,t)=>e*t),vec4u:es((e,t)=>e*t),mat2x2f:(e,t)=>{let n=e.columns,r=t.columns;return wn(n[0].x*r[0].x+n[1].x*r[0].y,n[0].y*r[0].x+n[1].y*r[0].y,n[0].x*r[1].x+n[1].x*r[1].y,n[0].y*r[1].x+n[1].y*r[1].y)},mat3x3f:(e,t)=>{let n=e.columns,r=t.columns;return In(n[0].x*r[0].x+n[1].x*r[0].y+n[2].x*r[0].z,n[0].y*r[0].x+n[1].y*r[0].y+n[2].y*r[0].z,n[0].z*r[0].x+n[1].z*r[0].y+n[2].z*r[0].z,n[0].x*r[1].x+n[1].x*r[1].y+n[2].x*r[1].z,n[0].y*r[1].x+n[1].y*r[1].y+n[2].y*r[1].z,n[0].z*r[1].x+n[1].z*r[1].y+n[2].z*r[1].z,n[0].x*r[2].x+n[1].x*r[2].y+n[2].x*r[2].z,n[0].y*r[2].x+n[1].y*r[2].y+n[2].y*r[2].z,n[0].z*r[2].x+n[1].z*r[2].y+n[2].z*r[2].z)},mat4x4f:(e,t)=>{let n=e.columns,r=t.columns;return we(n[0].x*r[0].x+n[1].x*r[0].y+n[2].x*r[0].z+n[3].x*r[0].w,n[0].y*r[0].x+n[1].y*r[0].y+n[2].y*r[0].z+n[3].y*r[0].w,n[0].z*r[0].x+n[1].z*r[0].y+n[2].z*r[0].z+n[3].z*r[0].w,n[0].w*r[0].x+n[1].w*r[0].y+n[2].w*r[0].z+n[3].w*r[0].w,n[0].x*r[1].x+n[1].x*r[1].y+n[2].x*r[1].z+n[3].x*r[1].w,n[0].y*r[1].x+n[1].y*r[1].y+n[2].y*r[1].z+n[3].y*r[1].w,n[0].z*r[1].x+n[1].z*r[1].y+n[2].z*r[1].z+n[3].z*r[1].w,n[0].w*r[1].x+n[1].w*r[1].y+n[2].w*r[1].z+n[3].w*r[1].w,n[0].x*r[2].x+n[1].x*r[2].y+n[2].x*r[2].z+n[3].x*r[2].w,n[0].y*r[2].x+n[1].y*r[2].y+n[2].y*r[2].z+n[3].y*r[2].w,n[0].z*r[2].x+n[1].z*r[2].y+n[2].z*r[2].z+n[3].z*r[2].w,n[0].w*r[2].x+n[1].w*r[2].y+n[2].w*r[2].z+n[3].w*r[2].w,n[0].x*r[3].x+n[1].x*r[3].y+n[2].x*r[3].z+n[3].x*r[3].w,n[0].y*r[3].x+n[1].y*r[3].y+n[2].y*r[3].z+n[3].y*r[3].w,n[0].z*r[3].x+n[1].z*r[3].y+n[2].z*r[3].z+n[3].z*r[3].w,n[0].w*r[3].x+n[1].w*r[3].y+n[2].w*r[3].z+n[3].w*r[3].w)}},mulMxV:{mat2x2f:(e,t)=>{let n=e.columns;return dn(n[0].x*t.x+n[1].x*t.y,n[0].y*t.x+n[1].y*t.y)},mat3x3f:(e,t)=>{let n=e.columns;return en(n[0].x*t.x+n[1].x*t.y+n[2].x*t.z,n[0].y*t.x+n[1].y*t.y+n[2].y*t.z,n[0].z*t.x+n[1].z*t.y+n[2].z*t.z)},mat4x4f:(e,t)=>{let n=e.columns;return fn(n[0].x*t.x+n[1].x*t.y+n[2].x*t.z+n[3].x*t.w,n[0].y*t.x+n[1].y*t.y+n[2].y*t.z+n[3].y*t.w,n[0].z*t.x+n[1].z*t.y+n[2].z*t.z+n[3].z*t.w,n[0].w*t.x+n[1].w*t.y+n[2].w*t.z+n[3].w*t.w)}},mulVxM:{mat2x2f:(e,t)=>{let n=t.columns;return dn(e.x*n[0].x+e.y*n[0].y,e.x*n[1].x+e.y*n[1].y)},mat3x3f:(e,t)=>{let n=t.columns;return en(e.x*n[0].x+e.y*n[0].y+e.z*n[0].z,e.x*n[1].x+e.y*n[1].y+e.z*n[1].z,e.x*n[2].x+e.y*n[2].y+e.z*n[2].z)},mat4x4f:(e,t)=>{let n=t.columns;return fn(e.x*n[0].x+e.y*n[0].y+e.z*n[0].z+e.w*n[0].w,e.x*n[1].x+e.y*n[1].y+e.z*n[1].z+e.w*n[1].w,e.x*n[2].x+e.y*n[2].y+e.z*n[2].z+e.w*n[2].w,e.x*n[3].x+e.y*n[3].y+e.z*n[3].z+e.w*n[3].w)}},div:{vec2f:Wn((e,t)=>e/t),vec2h:Tr((e,t)=>e/t),vec2i:Jr(Lr),vec2u:Zr(Lr),vec3f:Nn((e,t)=>e/t),vec3h:_r((e,t)=>e/t),vec3i:Hr(Lr),vec3u:Qr(Lr),vec4f:$n((e,t)=>e/t),vec4h:$r((e,t)=>e/t),vec4i:Kr(Lr),vec4u:es(Lr)},dot:{vec2f:di,vec2h:di,vec2i:di,vec2u:di,vec3f:fi,vec3h:fi,vec3i:fi,vec3u:fi,vec4f:mi,vec4h:mi,vec4i:mi,vec4u:mi},normalize:{vec2f:e=>{let t=jr(e);return dn(e.x/t,e.y/t)},vec2h:e=>{let t=jr(e);return Xn(e.x/t,e.y/t)},vec2i:e=>{let t=jr(e);return ss(e.x/t,e.y/t)},vec2u:e=>{let t=jr(e);return As(e.x/t,e.y/t)},vec3f:e=>{let t=Yr(e);return en(e.x/t,e.y/t,e.z/t)},vec3h:e=>{let t=Yr(e);return Rn(e.x/t,e.y/t,e.z/t)},vec3i:e=>{let t=Yr(e);return is(e.x/t,e.y/t,e.z/t)},vec3u:e=>{let t=Yr(e);return Is(e.x/t,e.y/t,e.z/t)},vec4f:e=>{let t=Cr(e);return fn(e.x/t,e.y/t,e.z/t,e.w/t)},vec4h:e=>{let t=Cr(e);return Jn(e.x/t,e.y/t,e.z/t,e.w/t)},vec4i:e=>{let t=Cr(e);return as(e.x/t,e.y/t,e.z/t,e.w/t)},vec4u:e=>{let t=Cr(e);return Bs(e.x/t,e.y/t,e.z/t,e.w/t)}},cross:{vec3f:(e,t)=>en(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),vec3h:(e,t)=>Rn(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},mod:{vec2f:Wn((e,t)=>e%t),vec2h:Tr((e,t)=>e%t),vec2i:Jr((e,t)=>e%t),vec2u:Zr((e,t)=>e%t),vec3f:Nn((e,t)=>e%t),vec3h:_r((e,t)=>e%t),vec3i:Hr((e,t)=>e%t),vec3u:Qr((e,t)=>e%t),vec4f:$n((e,t)=>e%t),vec4h:$r((e,t)=>e%t),vec4i:Kr((e,t)=>e%t),vec4u:es((e,t)=>e%t)},floor:{vec2f:Xe(Math.floor),vec2h:Qe(Math.floor),vec3f:qe(Math.floor),vec3h:Ke(Math.floor),vec4f:je(Math.floor),vec4h:et(Math.floor)},max:{vec2f:Wn(Math.max),vec2h:Tr(Math.max),vec2i:Jr(Math.max),vec2u:Zr(Math.max),vec3f:Nn(Math.max),vec3h:_r(Math.max),vec3i:Hr(Math.max),vec3u:Qr(Math.max),vec4f:$n(Math.max),vec4h:$r(Math.max),vec4i:Kr(Math.max),vec4u:es(Math.max)},min:{vec2f:Wn(Math.min),vec2h:Tr(Math.min),vec2i:Jr(Math.min),vec2u:Zr(Math.min),vec3f:Nn(Math.min),vec3h:_r(Math.min),vec3i:Hr(Math.min),vec3u:Qr(Math.min),vec4f:$n(Math.min),vec4h:$r(Math.min),vec4i:Kr(Math.min),vec4u:es(Math.min)},pow:{vec2f:(e,t)=>dn(e.x**t.x,e.y**t.y),vec2h:(e,t)=>Xn(e.x**t.x,e.y**t.y),vec3f:(e,t)=>en(e.x**t.x,e.y**t.y,e.z**t.z),vec3h:(e,t)=>Rn(e.x**t.x,e.y**t.y,e.z**t.z),vec4f:(e,t)=>fn(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w),vec4h:(e,t)=>Jn(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w)},sign:{vec2f:Xe(Math.sign),vec2h:Qe(Math.sign),vec2i:qr(Math.sign),vec3f:qe(Math.sign),vec3h:Ke(Math.sign),vec3i:Wr(Math.sign),vec4f:je(Math.sign),vec4h:et(Math.sign),vec4i:Xr(Math.sign)},sqrt:{vec2f:Xe(Math.sqrt),vec2h:Qe(Math.sqrt),vec3f:qe(Math.sqrt),vec3h:Ke(Math.sqrt),vec4f:je(Math.sqrt),vec4h:et(Math.sqrt)},mix:{vec2f:(e,t,n)=>typeof n=="number"?dn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n):dn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y),vec2h:(e,t,n)=>typeof n=="number"?Xn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n):Xn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y),vec3f:(e,t,n)=>typeof n=="number"?en(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n):en(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z),vec3h:(e,t,n)=>typeof n=="number"?Rn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n):Rn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z),vec4f:(e,t,n)=>typeof n=="number"?fn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n,e.w*(1-n)+t.w*n):fn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z,e.w*(1-n.w)+t.w*n.w),vec4h:(e,t,n)=>typeof n=="number"?Jn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n,e.w*(1-n)+t.w*n):Jn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z,e.w*(1-n.w)+t.w*n.w)},sin:{vec2f:Xe(Math.sin),vec2h:Qe(Math.sin),vec3f:qe(Math.sin),vec3h:Ke(Math.sin),vec4f:je(Math.sin),vec4h:et(Math.sin)},cos:{vec2f:Xe(Math.cos),vec2h:Qe(Math.cos),vec3f:qe(Math.cos),vec3h:Ke(Math.cos),vec4f:je(Math.cos),vec4h:et(Math.cos)},cosh:{vec2f:Xe(Math.cosh),vec2h:Qe(Math.cosh),vec3f:qe(Math.cosh),vec3h:Ke(Math.cosh),vec4f:je(Math.cosh),vec4h:et(Math.cosh)},exp:{vec2f:Xe(Math.exp),vec2h:Qe(Math.exp),vec3f:qe(Math.exp),vec3h:Ke(Math.exp),vec4f:je(Math.exp),vec4h:et(Math.exp)},exp2:{vec2f:Xe(e=>2**e),vec2h:Qe(e=>2**e),vec3f:qe(e=>2**e),vec3h:Ke(e=>2**e),vec4f:je(e=>2**e),vec4h:et(e=>2**e)},log:{vec2f:Xe(Math.log),vec2h:Qe(Math.log),vec3f:qe(Math.log),vec3h:Ke(Math.log),vec4f:je(Math.log),vec4h:et(Math.log)},log2:{vec2f:Xe(Math.log2),vec2h:Qe(Math.log2),vec3f:qe(Math.log2),vec3h:Ke(Math.log2),vec4f:je(Math.log2),vec4h:et(Math.log2)},fract:{vec2f:Xe(e=>e-Math.floor(e)),vec2h:Qe(e=>e-Math.floor(e)),vec3f:qe(e=>e-Math.floor(e)),vec3h:Ke(e=>e-Math.floor(e)),vec4f:je(e=>e-Math.floor(e)),vec4h:et(e=>e-Math.floor(e))},isCloseToZero:{vec2f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec2h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec3f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec3h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec4f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t,vec4h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t},neg:{vec2f:Xe(e=>-e),vec2h:Qe(e=>-e),vec2i:qr(e=>-e),vec2u:xs(e=>-e),"vec2<bool>":e=>cn(!e.x,!e.y),vec3f:qe(e=>-e),vec3h:Ke(e=>-e),vec3i:Wr(e=>-e),vec3u:vs(e=>-e),"vec3<bool>":e=>hn(!e.x,!e.y,!e.z),vec4f:je(e=>-e),vec4h:et(e=>-e),vec4i:Xr(e=>-e),vec4u:bs(e=>-e),"vec4<bool>":e=>pn(!e.x,!e.y,!e.z,!e.w)},select:{vec2f:(e,t,n)=>dn(n.x?t.x:e.x,n.y?t.y:e.y),vec2h:(e,t,n)=>Xn(n.x?t.x:e.x,n.y?t.y:e.y),vec2i:(e,t,n)=>ss(n.x?t.x:e.x,n.y?t.y:e.y),vec2u:(e,t,n)=>As(n.x?t.x:e.x,n.y?t.y:e.y),"vec2<bool>":(e,t,n)=>cn(n.x?t.x:e.x,n.y?t.y:e.y),vec3f:(e,t,n)=>en(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3h:(e,t,n)=>Rn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3i:(e,t,n)=>is(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3u:(e,t,n)=>Is(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),"vec3<bool>":(e,t,n)=>hn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec4f:(e,t,n)=>fn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4h:(e,t,n)=>Jn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4i:(e,t,n)=>as(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4u:(e,t,n)=>Bs(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),"vec4<bool>":(e,t,n)=>pn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w)},tanh:{vec2f:Xe(Math.tanh),vec2h:Qe(Math.tanh),vec3f:qe(Math.tanh),vec3h:Ke(Math.tanh),vec4f:je(Math.tanh),vec4h:et(Math.tanh)},bitcastU32toF32:{vec2u:e=>dn(Vn(e.x),Vn(e.y)),vec3u:e=>en(Vn(e.x),Vn(e.y),Vn(e.z)),vec4u:e=>fn(Vn(e.x),Vn(e.y),Vn(e.z),Vn(e.w))},bitcastU32toI32:{vec2u:e=>ss(Gn(e.x),Gn(e.y)),vec3u:e=>is(Gn(e.x),Gn(e.y),Gn(e.z)),vec4u:e=>as(Gn(e.x),Gn(e.y),Gn(e.z),Gn(e.w))}};function Uc(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="number"&&Je(t))return ee.addMixed[t.kind](t,e);if(Je(e)&&typeof t=="number")return ee.addMixed[e.kind](e,t);if(Je(e)&&Je(t)||Ln(e)&&Ln(t))return ee.add[e.kind](e,t);throw new Error("Add/Sub called with invalid arguments.")}var ue=G({name:"add",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:nr(t[0])?t[1]:t[0]}},normalImpl:Uc,codegenImpl:(e,t)=>S`(${e} + ${t})`});function Yf(e,t){return Uc(e,Ac(-1,t))}var K=G({name:"sub",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:nr(t[0])?t[1]:t[0]}},normalImpl:Yf,codegenImpl:(e,t)=>S`(${e} - ${t})`});function Ac(e,t){if(typeof e=="number"&&typeof t=="number")return e*t;if(typeof e=="number"&&(Je(t)||Ln(t)))return ee.mulSxV[t.kind](e,t);if((Je(e)||Ln(e))&&typeof t=="number")return ee.mulSxV[e.kind](t,e);if(Je(e)&&Je(t))return ee.mulVxV[e.kind](e,t);if(eu(e)&&Ln(t))return ee.mulVxM[t.kind](e,t);if(Ln(e)&&eu(t))return ee.mulMxV[e.kind](e,t);if(Ln(e)&&Ln(t))return ee.mulVxV[e.kind](e,t);throw new Error("Mul called with invalid arguments.")}var xe=G({name:"mul",signature:(...e)=>{let t=ct(e)??e,n=nr(t[0])?t[1]:nr(t[1])||t[0].type.startsWith("vec")?t[0]:t[1].type.startsWith("vec")?t[1]:t[0];return{argTypes:t,returnType:n}},normalImpl:Ac,codegenImpl:(e,t)=>S`(${e} * ${t})`});function Cf(e,t){if(typeof e=="number"&&typeof t=="number")return e/t;if(typeof e=="number"&&Je(t)){let n=Vi[t.kind][E].jsImpl;return ee.div[t.kind](n(e),t)}if(Je(e)&&typeof t=="number"){let n=Vi[e.kind][E].jsImpl;return ee.div[e.kind](e,n(t))}if(Je(e)&&Je(t))return ee.div[e.kind](e,t);throw new Error("Div called with invalid arguments.")}var Go=G({name:"div",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:nr(t[0])?t[1]:t[0]}},normalImpl:Cf,codegenImpl:(e,t)=>S`(${e} / ${t})`,ignoreImplicitCastWarning:!0}),qf=G({name:"mod",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:nr(t[0])?t[1]:t[0]}},normalImpl(e,t){if(typeof e=="number"&&typeof t=="number")return e%t;if(typeof e=="number"&&Je(t)){let n=Vi[t.kind];return ee.mod[t.kind](n(e),t)}if(Je(e)&&typeof t=="number"){let n=Vi[e.kind];return ee.mod[e.kind](e,n(t))}if(Je(e)&&Je(t))return ee.mod[e.kind](e,t);throw new Error("Mod called with invalid arguments, expected types: number or vector.")},codegenImpl:(e,t)=>S`(${e} % ${t})`});function Wf(e){return typeof e=="number"?-e:ee.neg[e.kind](e)}var Fs=G({name:"neg",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Wf,codegenImpl:e=>S`-(${e})`});function Xf(e){return typeof e=="number"?Math.abs(e):ee.abs[e.kind](e)}var He=G({name:"abs",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Xf,codegenImpl:e=>S`abs(${e})`});function Jf(e){return typeof e=="number"?Math.acos(e):ee.acos[e.kind](e)}var Na=G({name:"acos",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Jf,codegenImpl:e=>S`acos(${e})`});function Zf(e){return typeof e=="number"?Math.acosh(e):ee.acosh[e.kind](e)}var Hf=G({name:"acosh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Zf,codegenImpl:e=>S`acosh(${e})`});function Qf(e){return typeof e=="number"?Math.asin(e):ee.asin[e.kind](e)}var Kf=G({name:"asin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Qf,codegenImpl:e=>S`asin(${e})`});function em(e){return typeof e=="number"?Math.asinh(e):ee.asinh[e.kind](e)}var tm=G({name:"asinh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:em,codegenImpl:e=>S`asinh(${e})`});function nm(e){return typeof e=="number"?Math.atan(e):ee.atan[e.kind](e)}var rm=G({name:"atan",signature:e=>({argTypes:[e],returnType:e}),normalImpl:nm,codegenImpl:e=>S`atan(${e})`});function sm(e){return typeof e=="number"?Math.atanh(e):ee.atanh[e.kind](e)}var im=G({name:"atanh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:sm,codegenImpl:e=>S`atanh(${e})`});function am(e,t){return typeof e=="number"&&typeof t=="number"?Math.atan2(e,t):ee.atan2[e.kind](e,t)}var om=G({name:"atan2",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:t[0]}},normalImpl:am,codegenImpl:(e,t)=>S`atan2(${e}, ${t})`});function um(e){return typeof e=="number"?Math.ceil(e):ee.ceil[e.kind](e)}var Ic=G({name:"ceil",signature:e=>({argTypes:[e],returnType:e}),normalImpl:um,codegenImpl:e=>S`ceil(${e})`});function lm(e,t,n){return typeof e=="number"?Math.min(Math.max(t,e),n):ee.clamp[e.kind](e,t,n)}var Br=G({name:"clamp",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:lm,codegenImpl:(e,t,n)=>S`clamp(${e}, ${t}, ${n})`});function cm(e){return typeof e=="number"?Math.cos(e):ee.cos[e.kind](e)}var Nt=G({name:"cos",signature:e=>({argTypes:[e],returnType:e}),normalImpl:cm,codegenImpl:e=>S`cos(${e})`});function hm(e){return typeof e=="number"?Math.cosh(e):ee.cosh[e.kind](e)}var pm=G({name:"cosh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:hm,codegenImpl:e=>S`cosh(${e})`}),dm=G({name:"countLeadingZeros",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countLeadingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`countLeadingZeros(${e})`}),fm=G({name:"countOneBits",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countOneBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`countOneBits(${e})`}),mm=G({name:"countTrailingZeros",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countTrailingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`countTrailingZeros(${e})`}),Bc=G({name:"cross",signature:(e,t)=>({argTypes:[e,t],returnType:e}),normalImpl:(e,t)=>ee.cross[e.kind](e,t),codegenImpl:(e,t)=>S`cross(${e}, ${t})`});function ym(e){if(typeof e=="number")return e*180/Math.PI;throw new sn("CPU implementation for degrees on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var gm=G({name:"degrees",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ym,codegenImpl:e=>S`degrees(${e})`}),wm=G({name:"determinant",signature:e=>({argTypes:[e],returnType:$}),normalImpl:"CPU implementation for determinant not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`determinant(${e})`});function xm(e,t){return typeof e=="number"&&typeof t=="number"?Math.abs(e-t):$e(K(e,t))}var vm=G({name:"distance",signature:(e,t)=>({argTypes:[e,t],returnType:co(e)?ut:$}),normalImpl:xm,codegenImpl:(e,t)=>S`distance(${e}, ${t})`}),ae=G({name:"dot",signature:(e,t)=>({argTypes:[e,t],returnType:e.primitive}),normalImpl:(e,t)=>ee.dot[e.kind](e,t),codegenImpl:(e,t)=>S`dot(${e}, ${t})`}),bm=G({name:"dot4U8Packed",signature:(e,t)=>({argTypes:[J,J],returnType:J}),normalImpl:"CPU implementation for dot4U8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>S`dot4U8Packed(${e}, ${t})`}),Tm=G({name:"dot4I8Packed",signature:(e,t)=>({argTypes:[J,J],returnType:Ue}),normalImpl:"CPU implementation for dot4I8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>S`dot4I8Packed(${e}, ${t})`});function _m(e){return typeof e=="number"?Math.exp(e):ee.exp[e.kind](e)}var kc=G({name:"exp",signature:e=>({argTypes:[e],returnType:e}),normalImpl:_m,codegenImpl:e=>S`exp(${e})`});function $m(e){return typeof e=="number"?2**e:ee.exp2[e.kind](e)}var Mm=G({name:"exp2",signature:e=>({argTypes:[e],returnType:e}),normalImpl:$m,codegenImpl:e=>S`exp2(${e})`}),zm=G({name:"extractBits",signature:(e,t,n)=>({argTypes:[e,J,J],returnType:e}),normalImpl:"CPU implementation for extractBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n)=>S`extractBits(${e}, ${t}, ${n})`}),Em=G({name:"faceForward",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:"CPU implementation for faceForward not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n)=>S`faceForward(${e}, ${t}, ${n})`}),Sm=G({name:"firstLeadingBit",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for firstLeadingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`firstLeadingBit(${e})`}),Pm=G({name:"firstTrailingBit",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for firstTrailingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`firstTrailingBit(${e})`});function Um(e){return typeof e=="number"?Math.floor(e):ee.floor[e.kind](e)}var kr=G({name:"floor",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Um,codegenImpl:e=>S`floor(${e})`});function Am(e,t,n){if(typeof e=="number")return e*t+n;throw new sn("CPU implementation for fma on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Im=G({name:"fma",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:Am,codegenImpl:(e,t,n)=>S`fma(${e}, ${t}, ${n})`});function Bm(e){return typeof e=="number"?e-Math.floor(e):ee.fract[e.kind](e)}var Kn=G({name:"fract",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Bm,codegenImpl:e=>S`fract(${e})`}),km={f32:wt({fract:$,exp:Ue}),f16:wt({fract:ut,exp:Ue}),abstractFloat:wt({fract:Sn,exp:Xs}),vec2f:wt({fract:F,exp:Be}),vec3f:wt({fract:O,exp:kt}),vec4f:wt({fract:k,exp:Fe}),vec2h:wt({fract:Pn,exp:Be}),vec3h:wt({fract:Un,exp:kt}),vec4h:wt({fract:An,exp:Fe})},Om=ce(e=>{throw new sn("CPU implementation for frexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")},e=>{let t=km[e.dataType.type];if(!t)throw new Error(`Unsupported data type for frexp: ${e.dataType.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return B(S`frexp(${e})`,t)},"frexp"),Vm=G({name:"insertBits",signature:(e,t,n,r)=>({argTypes:[e,t,J,J],returnType:e}),normalImpl:"CPU implementation for insertBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n,r)=>S`insertBits(${e}, ${t}, ${n}, ${r})`});function Gm(e){if(typeof e=="number")return 1/Math.sqrt(e);throw new sn("CPU implementation for inverseSqrt on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Dm=G({name:"inverseSqrt",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Gm,codegenImpl:e=>S`inverseSqrt(${e})`}),Rm=G({name:"ldexp",signature:(e,t)=>{switch(e.type){case"abstractFloat":return{argTypes:[Sn,Xs],returnType:e};case"f32":case"f16":return{argTypes:[e,Ue],returnType:e};case"vec2f":case"vec2h":return{argTypes:[e,Be],returnType:e};case"vec3f":case"vec3h":return{argTypes:[e,kt],returnType:e};case"vec4f":case"vec4h":return{argTypes:[e,Fe],returnType:e};default:throw new Error(`Unsupported data type for ldexp: ${e.type}. Supported types are abstractFloat, f32, f16, vec2f, vec2h, vec3f, vec3h, vec4f, vec4h.`)}},normalImpl:"CPU implementation for ldexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>S`ldexp(${e}, ${t})`});function Nm(e){return typeof e=="number"?Math.abs(e):ee.length[e.kind](e)}var $e=G({name:"length",signature:e=>({argTypes:[e],returnType:co(e)?ut:$}),normalImpl:Nm,codegenImpl:e=>S`length(${e})`});function Fm(e){return typeof e=="number"?Math.log(e):ee.log[e.kind](e)}var Ls=G({name:"log",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Fm,codegenImpl:e=>S`log(${e})`});function Lm(e){return typeof e=="number"?Math.log2(e):ee.log2[e.kind](e)}var jm=G({name:"log2",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Lm,codegenImpl:e=>S`log2(${e})`});function Ym(e,t){return typeof e=="number"?Math.max(e,t):ee.max[e.kind](e,t)}var ie=G({name:"max",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:Ym,codegenImpl:(e,t)=>S`max(${e}, ${t})`});function Cm(e,t){return typeof e=="number"?Math.min(e,t):ee.min[e.kind](e,t)}var Ie=G({name:"min",signature:(...e)=>{let t=ct(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:Cm,codegenImpl:(e,t)=>S`min(${e}, ${t})`});function qm(e,t,n){if(typeof e=="number"){if(typeof n!="number"||typeof t!="number")throw new Error("When e1 and e2 are numbers, the blend factor must be a number.");return e*(1-n)+t*n}if(typeof e=="number"||typeof t=="number")throw new Error("e1 and e2 need to both be vectors of the same kind.");return ee.mix[e.kind](e,t,n)}var tn=G({name:"mix",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:qm,codegenImpl:(e,t,n)=>S`mix(${e}, ${t}, ${n})`}),Wm={f32:wt({fract:$,whole:$}),f16:wt({fract:ut,whole:ut}),abstractFloat:wt({fract:Sn,whole:Sn}),vec2f:wt({fract:F,whole:F}),vec3f:wt({fract:O,whole:O}),vec4f:wt({fract:k,whole:k}),vec2h:wt({fract:Pn,whole:Pn}),vec3h:wt({fract:Un,whole:Un}),vec4h:wt({fract:An,whole:An})},Xm=G({name:"modf",signature:e=>{let t=Wm[e.type];if(!t)throw new Error(`Unsupported data type for modf: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},normalImpl:"CPU implementation for modf not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`modf(${e})`}),rn=G({name:"normalize",signature:e=>({argTypes:[e],returnType:e}),normalImpl:e=>ee.normalize[e.kind](e),codegenImpl:e=>S`normalize(${e})`});function Jm(e,t){if(typeof e=="number"&&typeof t=="number")return e**t;if(Je(e)&&Je(t))return ee.pow[e.kind](e,t);throw new Error("Invalid arguments to pow()")}var yr=G({name:"pow",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:nr(t[0])?t[1]:t[0]}},normalImpl:Jm,codegenImpl:(e,t)=>S`pow(${e}, ${t})`}),Zm=G({name:"quantizeToF16",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for quantizeToF16 not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`quantizeToF16(${e})`});function Hm(e){if(typeof e=="number")return e*Math.PI/180;throw new sn("CPU implementation for radians on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Qm=G({name:"radians",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Hm,codegenImpl:e=>S`radians(${e})`}),Oc=G({name:"reflect",signature:(e,t)=>({argTypes:[e,t],returnType:e}),normalImpl:(e,t)=>K(e,xe(2*ae(t,e),t)),codegenImpl:(e,t)=>S`reflect(${e}, ${t})`}),Km=ce((e,t,n)=>{throw new sn("CPU implementation for refract not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")},(e,t,n)=>B(S`refract(${e}, ${t}, ${n})`,e.dataType),"refract",(e,t,n)=>[e.dataType,t.dataType,co(e)?ut:$]),e1=G({name:"reverseBits",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for reverseBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`reverseBits(${e})`});function t1(e){if(typeof e=="number")return Math.round(e);throw new sn("CPU implementation for round on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var n1=G({name:"round",signature:e=>({argTypes:[e],returnType:e}),normalImpl:t1,codegenImpl:e=>S`round(${e})`});function r1(e){if(typeof e=="number")return Math.max(0,Math.min(1,e));throw new sn("CPU implementation for saturate on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Lt=G({name:"saturate",signature:e=>({argTypes:[e],returnType:e}),normalImpl:r1,codegenImpl:e=>S`saturate(${e})`});function s1(e){return typeof e=="number"?Math.sign(e):ee.sign[e.kind](e)}var ir=G({name:"sign",signature:e=>({argTypes:[e],returnType:e}),normalImpl:s1,codegenImpl:e=>S`sign(${e})`});function i1(e){return typeof e=="number"?Math.sin(e):ee.sin[e.kind](e)}var an=G({name:"sin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:i1,codegenImpl:e=>S`sin(${e})`});function a1(e){if(typeof e=="number")return Math.sinh(e);throw new sn("CPU implementation for sinh on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var o1=G({name:"sinh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:a1,codegenImpl:e=>S`sinh(${e})`});function u1(e,t,n){return typeof n=="number"?Mr(e,t,n):ee.smoothstep[n.kind](e,t,n)}var Vc=G({name:"smoothstep",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:n}),normalImpl:u1,codegenImpl:(e,t,n)=>S`smoothstep(${e}, ${t}, ${n})`});function l1(e){return typeof e=="number"?Math.sqrt(e):ee.sqrt[e.kind](e)}var yn=G({name:"sqrt",signature:e=>({argTypes:[e],returnType:e}),normalImpl:l1,codegenImpl:e=>S`sqrt(${e})`});function c1(e,t){if(typeof e=="number")return e<=t?1:0;throw new sn("CPU implementation for step on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Fa=G({name:"step",signature:(...e)=>{let t=ct(e,[$,ut,Sn])??e;return{argTypes:t,returnType:t[0]}},normalImpl:c1,codegenImpl:(e,t)=>S`step(${e}, ${t})`});function h1(e){if(typeof e=="number")return Math.tan(e);throw new sn("CPU implementation for tan on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var La=G({name:"tan",signature:e=>({argTypes:[e],returnType:e}),normalImpl:h1,codegenImpl:e=>S`tan(${e})`});function p1(e){return typeof e=="number"?Math.tanh(e):ee.tanh[e.kind](e)}var Gc=G({name:"tanh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:p1,codegenImpl:e=>S`tanh(${e})`}),d1=G({name:"transpose",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for transpose not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`transpose(${e})`}),f1=G({name:"trunc",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for trunc not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>S`trunc(${e})`}),{NodeTypeCatalog:Ce}=Qd,m1=["==","!=","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"],y1=["&&","||","==","!=","<","<=",">",">="],g1=["vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"],ja={add:ue,sub:K,mul:xe,div:Go};function bu(e,t,n){return n?y1.includes(t)?ke:t==="="?n:e:t==="!"||t==="~"?ke:e}var w1={"+":ue[E].gpuImpl,"-":K[E].gpuImpl,"*":xe[E].gpuImpl,"/":Go[E].gpuImpl,"**":yr[E].gpuImpl},x1=class{#e=void 0;initGenerator(t){this.#e=t}get ctx(){if(!this.#e)throw new Error("WGSL Generator has not yet been initialized. Please call initialize(ctx) before using the generator.");return this.#e}block([t,n]){this.ctx.pushBlockScope();try{this.ctx.indent();let r=n.map(s=>this.statement(s)).join(`
`);return this.ctx.dedent(),`{
${r}
${this.ctx.pre}}`}finally{this.ctx.popBlockScope()}}blockVariable(t,n){let r=B(this.ctx.makeNameValid(t),n);return this.ctx.defineVariable(t,r),r}identifier(t){if(!t)throw new Error("Cannot resolve an empty identifier");let n=this.ctx.getById(t);if(!n)throw new Error(`Identifier ${t} not found`);return n}typedExpression(t,n){let r=this.ctx.expectedType;this.ctx.expectedType=n;try{let s=this.expression(t);return Ba(s,n)}finally{this.ctx.expectedType=r}}expression(t){if(typeof t=="string")return this.identifier(t);if(typeof t=="boolean")return B(t,ke);if(t[0]===Ce.logicalExpr||t[0]===Ce.binaryExpr||t[0]===Ce.assignmentExpr){let[n,r,s,i]=t,p=this.expression(r),y=this.expression(i),v=w1[s];if(v)return v(p,y);let _=t[0]===Ce.assignmentExpr?p.dataType.type==="ptr"?[p.dataType.inner]:[p.dataType]:void 0,[P,U]=Ps([p,y],_)??[p,y],R=this.ctx.resolve(P.value,P.dataType).value,j=this.ctx.resolve(U.value,U.dataType).value,L=bu(P.dataType,s,U.dataType);return B(m1.includes(s)?`(${R} ${s} ${j})`:`${R} ${s} ${j}`,L)}if(t[0]===Ce.postUpdate){let[n,r,s]=t,i=this.expression(s),p=this.ctx.resolve(i.value,i.dataType).value;return B(`${p}${r}`,i.dataType)}if(t[0]===Ce.unaryExpr){let[n,r,s]=t,i=this.expression(s),p=this.ctx.resolve(i.value,i.dataType).value,y=bu(i.dataType,r);return B(`${r}${p}`,y)}if(t[0]===Ce.memberAccess){let[n,r,s]=t,i=this.expression(r);if(i.value===console)return B(new ru(s),Bt);if(g1.includes(i.dataType.type)&&s in ja)return{value:new tu(s,i,ja[s][E].gpuImpl),dataType:Bt};if(i.dataType.type==="unknown"){let p=i.value[s];return $i(p)}return Ar(i.dataType)?B(`(*${this.ctx.resolve(i.value).value}).${s}`,Va(i.dataType.inner,s)):Ft(i.dataType)&&s==="length"?i.dataType.elementCount===0?B(`arrayLength(&${this.ctx.resolve(i.value).value})`,J):B(String(i.dataType.elementCount),Xs):Ds(i.dataType)&&s==="columns"?B(new nu(i),Bt):tr(i.dataType)&&Je(i.value)?$i(i.value[s]):B(`${this.ctx.resolve(i.value).value}.${s}`,Va(i.dataType,s))}if(t[0]===Ce.indexAccess){let[n,r,s]=t,i=this.expression(r),p=this.expression(s),y=this.ctx.resolve(p.value,p.dataType).value;if(i.value instanceof nu)return B(S`${i.value.matrix}[${y}]`,da(i.value.matrix.dataType));let v=this.ctx.resolve(i.value,i.dataType).value;if(i.dataType.type==="unknown"){if(Array.isArray(s)&&s[0]===Ce.numericLiteral)return $i(i.value[s[1]]);throw new Error(`Unable to index a value of unknown type with index ${y}. If the value is an array, to address this, consider one of the following approaches: (1) declare the array using 'tgpu.const', (2) store the array in a buffer, or (3) define the array within the GPU function scope.`)}if(Ds(i.dataType))throw new Error("The only way of accessing matrix elements in TGSL is through the 'columns' property.");return Ar(i.dataType)?B(`(*${v})[${y}]`,da(i.dataType.inner)):B(`${v}[${y}]`,Vr(i.dataType)?da(i.dataType):Bt)}if(t[0]===Ce.numericLiteral){let n=typeof t[1]=="string"?Di(b1(t[1])):Di(t[1]);if(!n)throw new Error(`Invalid numeric literal ${t[1]}`);return n}if(t[0]===Ce.call){let[n,r,s]=t,i=this.expression(r);if(vt(i.value)||Ft(i.value)){if(s.length>1)throw new mn("Array and struct schemas should always be called with at most 1 argument");if(!s[0])return B(`${this.ctx.resolve(i.value).value}()`,i.value);let y=this.typedExpression(s[0],i.value);return B(this.ctx.resolve(y.value,i.value).value,i.value)}if(i.value===Ga)throw new Error("Constants cannot be defined within TypeGPU function scope. To address this, move the constant definition outside the function scope.");if(i.value instanceof tu){if(!s[0])throw new mn(`An infix operator '${i.value.name}' was called without any arguments`);let y=this.expression(s[0]);return i.value.operator(i.value.lhs,y)}if(!Ge(i.value)){let y=s.map(_=>this.expression(_)),v=this.ctx.shelllessRepo.get(i.value,y);if(v)return this.ctx.withResetIndentLevel(()=>{let _=this.ctx.resolve(v);return B(S`${_.value}(${y})`,_.dataType)});throw new Error(`Function '${W(i.value)??String(i.value)}' is not marked with the 'use gpu' directive and cannot be used in a shader`)}let p=i.value[E]?.argConversionHint??"keep";try{let y;if(Array.isArray(p))y=s.map((_,P)=>{let U=p[P];if(!U)throw new mn(`Function '${W(i.value)}' was called with too many arguments`);return this.typedExpression(_,U)});else{let _=s.map(P=>this.expression(P));p==="keep"?y=_:p==="unify"?y=Ps(_)??_:y=p(..._).map((P,U)=>[P,_[U]]).map(([P,U])=>Ba(U,P))}if(i.value instanceof ru)return this.ctx.generateLog(i.value.op,y);let v=i.value(...y);if(!po(v))throw new Error("Functions running in codegen mode must return snippets");return v}catch(y){throw new _s(y,[{toString:()=>W(i.value)}])}}if(t[0]===Ce.objectExpr){let n=t[1],r=this.ctx.expectedType;if(!r||!vt(r))throw new mn(`No target type could be inferred for object with keys [${Object.keys(n).join(", ")}], please wrap the object in the corresponding schema.`);let s=Object.fromEntries(Object.entries(r.propTypes).map(([p,y])=>{let v=n[p];if(v===void 0)throw new mn(`Missing property ${p} in object literal for struct ${r}`);let _=this.typedExpression(v,y);return[p,_]})),i=Op(r,s);return B(S`${this.ctx.resolve(r).value}(${i})`,r)}if(t[0]===Ce.arrayExpr){let[n,r]=t,s=this.ctx.expectedType,i,p;if(Ft(s)){if(i=s.elementType,p=r.map(v=>this.typedExpression(v,i)),p.length!==s.elementCount)throw new mn(`Cannot create value of type '${s}' from an array of length: ${p.length}`)}else{let v=r.map(P=>this.expression(P));if(v.length===0)throw new mn("Cannot infer the type of an empty array literal.");let _=Ps(v);if(!_)throw new mn("The given values cannot be automatically converted to a common type. Consider wrapping the array in an appropriate schema");p=_,i=Ns(p[0]?.dataType)}let y=`array<${this.ctx.resolve(i).value}, ${p.length}>`;return B(S`${y}(${p})`,Yn[E].jsImpl(i,p.length))}if(t[0]===Ce.stringLiteral)return B(t[1],Bt);if(t[0]===Ce.preUpdate)throw new Error("Cannot use pre-updates in TGSL.");v1(t)}functionDefinition(t){return this.block(t)}statement(t){if(typeof t=="string")return`${this.ctx.pre}${this.ctx.resolve(this.identifier(t).value).value};`;if(typeof t=="boolean")return`${this.ctx.pre}${t?"true":"false"};`;if(t[0]===Ce.return){let n=t[1];if(n!==void 0){let r=this.ctx.topFunctionReturnType,s=r?this.typedExpression(n,r):this.expression(n);return Qn(s.dataType.type!=="unknown"),this.ctx.reportReturnType(s.dataType),S`${this.ctx.pre}return ${s};`}return`${this.ctx.pre}return;`}if(t[0]===Ce.if){let[n,r,s,i]=t,p=this.typedExpression(r,ke),y=p.value===!1?void 0:this.block(yi(s)),v=p.value===!0||!i?void 0:this.block(yi(i));return p.value===!0?`${this.ctx.pre}${y}`:p.value===!1?v?`${this.ctx.pre}${v}`:"":v?S`\
${this.ctx.pre}if (${p}) ${y}
${this.ctx.pre}else ${v}`:S`${this.ctx.pre}if (${p}) ${y}`}if(t[0]===Ce.let||t[0]===Ce.const){let[n,r,s]=t,i=s!==void 0?this.expression(s):void 0;if(!i)throw new Error(`Cannot create variable '${r}' without an initial value.`);if(ds(i.dataType))throw new Error(`Cannot create variable '${r}' with loose data type.`);let p=this.blockVariable(r,Ns(i.dataType));return S`${this.ctx.pre}var ${p.value} = ${i};`}if(t[0]===Ce.block)return this.block(t);if(t[0]===Ce.for){let[n,r,s,i,p]=t,[y,v,_]=this.ctx.withResetIndentLevel(()=>[r?this.statement(r):void 0,s?this.typedExpression(s,ke):void 0,i?this.statement(i):void 0]),P=y?y.slice(0,-1):"",U=_?_.slice(0,-1):"",R=this.block(yi(p));return S`${this.ctx.pre}for (${P}; ${v}; ${U}) ${R}`}if(t[0]===Ce.while){let[n,r,s]=t,i=this.typedExpression(r,ke),p=this.ctx.resolve(i.value).value,y=this.block(yi(s));return`${this.ctx.pre}while (${p}) ${y}`}return t[0]===Ce.continue?`${this.ctx.pre}continue;`:t[0]===Ce.break?`${this.ctx.pre}break;`:`${this.ctx.pre}${this.ctx.resolve(this.expression(t).value).value};`}};function v1(e){throw new Error(`'${Xt(e)}' was not handled by the WGSL generator.`)}function b1(e){return/^0x[0-9a-f]+$/i.test(e)?Number.parseInt(e):/^0b[01]+$/i.test(e)?Number.parseInt(e.slice(2),2):Number.parseFloat(e)}function yi(e){return typeof e!="object"||e[0]!==Ce.block?[Ce.block,[e]]:e}var T1=new x1,Dc=T1,Rc=Object.defineProperty,_1=(e,t,n)=>t in e?Rc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$1=(e,t)=>{for(var n in t)Rc(e,n,{get:t[n],enumerable:!0})},ye=(e,t,n)=>_1(e,typeof t!="symbol"?t+"":t,n),M1={};$1(M1,{BufferReader:()=>cr,BufferWriter:()=>Rr,MaxValue:()=>ot,Measurer:()=>nt,UnresolvedReferenceError:()=>Er,ValidationError:()=>ua,arrayOf:()=>U1,bool:()=>I1,byte:()=>D1,chars:()=>Q1,concat:()=>ny,dynamicArrayOf:()=>sy,f16:()=>X1,f32:()=>Z1,f32Array:()=>vy,f64Array:()=>by,generic:()=>ey,genericEnum:()=>ty,i16:()=>N1,i16Array:()=>wy,i32:()=>Y1,i32Array:()=>xy,i8:()=>V1,i8Array:()=>gy,keyed:()=>oy,object:()=>K1,optional:()=>ly,string:()=>k1,tupleOf:()=>py,u16:()=>L1,u16Array:()=>my,u32:()=>q1,u32Array:()=>yy,u8:()=>Yc,u8Array:()=>dy,u8ClampedArray:()=>fy});var Er=class Nc extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Nc.prototype)}},ua=class Fc extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Fc.prototype)}},z1=class{constructor(){ye(this,"size",Number.NaN),ye(this,"unbounded",this),ye(this,"isUnbounded",!0)}add(){return this}fork(){return this}},E1=new z1,nt=class Lc{constructor(){ye(this,"size",0),ye(this,"unbounded",E1),ye(this,"isUnbounded",!1)}add(t){return this.size+=t,this}fork(){const t=new Lc;return t.size=this.size,t}},ot=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),bt=class{constructor(){ye(this,"__unwrapped")}resolveReferences(e){}seekProperty(e,t){return null}},S1=class{constructor(e){this.key=e}},ks={STRING:"string",ENUM:"enum"},P1=class extends bt{constructor(e,t){super(),this._unstableElementSchema=e,this.length=t,ye(this,"elementSchema"),this.elementSchema=e}resolveReferences(e){this.elementSchema=e.resolve(this._unstableElementSchema)}write(e,t){if(t.length!==this.length)throw new ua(`Expected array of length ${this.length}, got ${t.length}`);for(const n of t)this.elementSchema.write(e,n)}read(e){const t=[];for(let n=0;n<this.length;++n)t.push(this.elementSchema.read(e));return t}get maxSize(){return this.elementSchema.measure(ot).size*this.length}measure(e,t=new nt){for(let n=0;n<this.length;++n)this.elementSchema.measure(e===ot?ot:e[n],t);return t}};function U1(e,t){return new P1(e,t)}var A1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",1)}read(e){return e.readBool()}write(e,t){e.writeBool(t)}measure(e,t=new nt){return t.add(1)}},I1=new A1,jc=class $s extends bt{static get _encoder(){return $s._cachedEncoder||($s._cachedEncoder=new TextEncoder),$s._cachedEncoder}read(t){return t.readString()}write(t,n){t.writeString(n)}measure(t,n=new nt){if(t===ot)return n.unbounded;const r=$s._encoder.encode(t);return n.add(r.byteLength+1)}};ye(jc,"_cachedEncoder");var B1=jc,k1=new B1,O1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",1)}read(e){return e.readInt8()}write(e,t){e.writeInt8(t)}measure(e,t=new nt){return t.add(1)}},V1=new O1,G1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",1)}read(e){return e.readUint8()}write(e,t){e.writeUint8(t)}measure(e,t=new nt){return t.add(1)}},Yc=new G1,D1=Yc,R1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",2)}read(e){return e.readInt16()}write(e,t){e.writeInt16(t)}measure(e,t=new nt){return t.add(2)}},N1=new R1,F1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",2)}read(e){return e.readUint16()}write(e,t){e.writeUint16(t)}measure(e,t=new nt){return t.add(2)}},L1=new F1,j1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",4)}read(e){return e.readInt32()}write(e,t){e.writeInt32(t)}measure(e,t=new nt){return t.add(4)}},Y1=new j1,C1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",4)}read(e){return e.readUint32()}write(e,t){e.writeUint32(t)}measure(e,t=new nt){return t.add(4)}},q1=new C1,W1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",2)}read(e){return e.readFloat16()}write(e,t){e.writeFloat16(t)}measure(e,t=new nt){return t.add(2)}},X1=new W1,J1=class extends bt{constructor(){super(...arguments),ye(this,"maxSize",4)}read(e){return e.readFloat32()}write(e,t){e.writeFloat32(t)}measure(e,t=new nt){return t.add(4)}},Z1=new J1,H1=class extends bt{constructor(e){super(),this.length=e}write(e,t){if(t.length!==this.length)throw new ua(`Expected char-string of length ${this.length}, got ${t.length}`);for(let n=0;n<t.length;++n)e.writeUint8(t.charCodeAt(n))}read(e){let t="";for(let n=0;n<this.length;++n)t+=String.fromCharCode(e.readByte());return t}measure(e,t=new nt){return t.add(this.length)}};function Q1(e){return new H1(e)}function lr(e){return Object.entries(e)}function Cc(e,t){const n={};for(const[r,s]of lr(t))n[r]=e.resolve(s);return n}var Do=class extends bt{constructor(e){super(),this._properties=e,ye(this,"properties"),this.properties=e}resolveReferences(e){this.properties=Cc(e,this._properties)}write(e,t){for(const[n,r]of lr(this.properties))r.write(e,t[n])}read(e){const t={};for(const[n,r]of lr(this.properties))t[n]=r.read(e);return t}get maxSize(){const e=new nt;for(const t of Object.values(this.properties))t.measure(ot,e);return e.size}measure(e,t=new nt){for(const[n,r]of lr(this.properties))r.measure(e===ot?ot:e[n],t);return t}seekProperty(e,t){let n=0;for(const[r,s]of lr(this.properties)){if(r===t)return{bufferOffset:n,schema:s};n+=s.measure(e).size}return null}};function K1(e){return new Do(e)}var qc=class extends bt{constructor(e,t,n){super(),this.keyedBy=e,this._subTypeMap=n,ye(this,"_baseObject"),ye(this,"subTypeMap"),this._baseObject=new Do(t),this.subTypeMap=n}resolveReferences(e){this._baseObject.resolveReferences(e),this.subTypeMap=Cc(e,this._subTypeMap)}write(e,t){const n=t.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===ks.ENUM?e.writeUint8(t.type):e.writeString(t.type),this._baseObject.write(e,t);for(const[s,i]of lr(r.properties))i.write(e,t[s])}read(e){const t=this.keyedBy===ks.ENUM?e.readByte():e.readString(),n=this.subTypeMap[t]||null;if(n===null)throw new Error(`Unknown sub-type '${t}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const r=this._baseObject.read(e);if(r.type=t,n!==null)for(const[s,i]of lr(n.properties))r[s]=i.read(e);return r}measure(e,t=new nt){if(this._baseObject.measure(e,t),this.keyedBy===ks.ENUM)t.add(1);else if(e!==ot)t.add(e.type.length+1);else return t.unbounded;if(e===ot){const n=Object.values(this.subTypeMap).map(r=>{const s=t.fork();for(const i of Object.values(r.properties))i.measure(ot,s);return[r,s.size]}).reduce((r,s)=>r[1]>s[1]?r:s)[0];for(const r of Object.values(n.properties))r.measure(ot,t)}else{const n=e.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[s,i]of lr(r.properties))i.measure(e[s],t)}return t}};function ey(e,t){return new qc(ks.STRING,e,t)}function ty(e,t){return new qc(ks.ENUM,e,t)}function ny(e){return new Do(Object.fromEntries(e.flatMap(({properties:t})=>Object.entries(t))))}var ry=class extends bt{constructor(e){super(),this._unstableElementType=e,ye(this,"elementType"),this.elementType=e}resolveReferences(e){this.elementType=e.resolve(this._unstableElementType)}write(e,t){e.writeUint32(t.length);for(const n of t)this.elementType.write(e,n)}read(e){const t=[],n=e.readUint32();for(let r=0;r<n;++r)t.push(this.elementType.read(e));return t}get maxSize(){return this.measure(ot).size}measure(e,t=new nt){if(e===ot)return t.unbounded;t.add(4);for(const n of e)this.elementType.measure(n,t);return t}seekProperty(e,t){if(typeof t=="symbol")return null;const n=Number.parseInt(String(t),10);if(Number.isNaN(n))return null;if(e===ot)return{bufferOffset:this.elementType.measure(ot).size*n,schema:this.elementType};if(n>=e.length)return null;const r=new nt;for(let s=0;s<n;++s)this.elementType.measure(e[s],r);return{bufferOffset:r.size,schema:this.elementType}}};function sy(e){return new ry(e)}var Wc=class{constructor(e){ye(this,"__unwrapped"),ye(this,"ref"),this.ref=new S1(e)}resolveReferences(){throw new Er("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new Er("Tried to read a reference directly. Resolve it instead.")}write(){throw new Er("Tried to write a reference directly. Resolve it instead.")}measure(){throw new Er("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new Er("Tried to seek property of a reference directly. Resolve it instead.")}},iy=class{constructor(){ye(this,"registry",{})}hasKey(e){return this.registry[e]!==void 0}register(e,t){this.registry[e]=t}resolve(e){if(e instanceof Wc){const n=e.ref.key;if(this.registry[n]!==void 0)return this.registry[n];throw new Er(`Couldn't resolve reference to ${n}. Unknown key.`)}return e.resolveReferences(this),e}},ay=class{constructor(e,t){this.key=e,ye(this,"__unwrapped"),ye(this,"__keyDefinition"),ye(this,"innerType"),this.innerType=t(new Wc(e)),this.resolveReferences(new iy)}resolveReferences(e){e.hasKey(this.key)||(e.register(this.key,this.innerType),this.innerType.resolveReferences(e))}read(e){return this.innerType.read(e)}write(e,t){this.innerType.write(e,t)}get maxSize(){return this.measure(ot).size}measure(e,t=new nt){return this.innerType.measure(e,t)}seekProperty(e,t){return this.innerType.seekProperty(e,t)}};function oy(e,t){return new ay(e,t)}var uy=class extends bt{constructor(e){super(),this._innerUnstableSchema=e,ye(this,"innerSchema"),this.innerSchema=e}resolveReferences(e){this.innerSchema=e.resolve(this._innerUnstableSchema)}write(e,t){t!=null?(e.writeBool(!0),this.innerSchema.write(e,t)):e.writeBool(!1)}read(e){if(e.readBool())return this.innerSchema.read(e)}get maxSize(){return this.measure(ot).size}measure(e,t=new nt){return e!==void 0&&this.innerSchema.measure(e,t),t.add(1)}};function ly(e){return new uy(e)}function cy(e,t){return t.map(n=>e.resolve(n))}var hy=class extends bt{constructor(e){super(),this._unstableSchemas=e,ye(this,"schemas"),this.schemas=e}resolveReferences(e){this.schemas=cy(e,this._unstableSchemas)}write(e,t){if(t.length!==this.schemas.length)throw new ua(`Expected tuple of length ${this.schemas.length}, got ${t.length}`);for(let n=0;n<this.schemas.length;++n)this.schemas[n].write(e,t[n])}read(e){const t=[];for(let n=0;n<this.schemas.length;++n)t.push(this.schemas[n].read(e));return t}get maxSize(){return this.measure(ot).size}measure(e,t=new nt){for(let n=0;n<this.schemas.length;++n)this.schemas[n].measure(e===ot?ot:e[n],t);return t}};function py(e){return new hy(e)}var ar=class extends bt{constructor(e,t){super(),this.length=e,this._arrayConstructor=t,ye(this,"byteLength"),this.byteLength=e*t.BYTES_PER_ELEMENT}write(e,t){e.writeSlice(t)}read(e){const t=new ArrayBuffer(this.byteLength),n=new this._arrayConstructor(t,0,this.length);return e.readSlice(n,0,this.byteLength),n}measure(e,t=new nt){return t.add(this.byteLength)}},dy=e=>new ar(e,Uint8Array),fy=e=>new ar(e,Uint8ClampedArray),my=e=>new ar(e,Uint16Array),yy=e=>new ar(e,Uint32Array),gy=e=>new ar(e,Int8Array),wy=e=>new ar(e,Int16Array),xy=e=>new ar(e,Int32Array),vy=e=>new ar(e,Float32Array),by=e=>new ar(e,Float64Array);function Ty(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return t[0]=1,e[0]===0}function Xc(){return Ty()?"big":"little"}function Ro(e){let t=0,n=e;return n&&"buffer"in n&&"byteOffset"in n&&(t+=n.byteOffset,n=n.buffer),{buffer:n,byteOffset:t,byteLength:e.byteLength}}var Jc=class{constructor(e,t){ye(this,"dataView"),ye(this,"littleEndian"),ye(this,"byteOffset",0),ye(this,"endianness");const{byteOffset:n=0,endianness:r="system"}=t??{};this.byteOffset=n;const s=Xc();this.endianness=r==="system"?s:r,this.littleEndian=this.endianness==="little";const i=Ro(e);this.byteOffset+=i.byteOffset,this.dataView=new DataView(i.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(e){this.byteOffset=e}skipBytes(e){this.byteOffset+=e}};function _y(e){if(e===0)return 0;if(Number.isNaN(e))return 32256;if(!Number.isFinite(e))return e>0?31744:64512;const t=e<0?1:0,n=Math.abs(e),r=Math.floor(Math.log2(n)),s=n/2**r-1,i=r+15,p=Math.floor(s*1024);return t<<15|i<<10|p}function $y(e){const t=(e&32768)>>15,n=(e&31744)>>10,r=e&1023;return n===0?t===0?r/1024:-r/1024:n===31?r===0?t===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(t===0?1:-1)*(1+r/1024)*2**(n-15)}var cr=class extends Jc{constructor(){super(...arguments),ye(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const e=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readUint16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readInt32(){const e=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readUint32(){const e=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readFloat16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,$y(e)}readFloat32(){const e=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readString(){let e=0;for(;this.byteOffset+e<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+e++)!==0;);const t=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,e-1));return this.byteOffset+=e,t}readSlice(e,t,n){const r=Ro(e),s=new Uint8Array(r.buffer,r.byteOffset+t);for(let i=0;i<n;++i)s[i]=this.dataView.getUint8(this.byteOffset++)}},Rr=class extends Jc{constructor(){super(...arguments),ye(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(e){this.dataView.setUint8(this.byteOffset++,e?1:0)}writeByte(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt8(e){this.dataView.setInt8(this.byteOffset++,e)}writeUint8(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt16(e){this.dataView.setInt16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeUint16(e){this.dataView.setUint16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeInt32(e){this.dataView.setInt32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeUint32(e){this.dataView.setUint32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeFloat16(e){this.dataView.setUint16(this.byteOffset,_y(e),this.littleEndian),this.byteOffset+=2}writeFloat32(e){this.dataView.setFloat32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeString(e){const t=this._textEncoder.encodeInto(e,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=t.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(e){const t=Ro(e),n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(const r of n)this.dataView.setUint8(this.byteOffset++,r)}},Zc=G({name:"bitcastU32toF32",normalImpl:(e=>typeof e=="number"?Vn(e):ee.bitcastU32toF32[e.kind](e)),codegenImpl:e=>S`bitcast<f32>(${e})`,signature:(...e)=>{let t=ct(e,[J])??e;return{argTypes:t,returnType:tr(t[0])?t[0].type==="vec2u"?F:t[0].type==="vec3u"?O:k:$}}}),Hc=G({name:"bitcastU32toI32",normalImpl:(e=>typeof e=="number"?Gn(e):ee.bitcastU32toI32[e.kind](e)),codegenImpl:e=>S`bitcast<i32>(${e})`,signature:(...e)=>{let t=ct(e,[J])??e;return{argTypes:t,returnType:tr(t[0])?t[0].type==="vec2u"?Be:t[0].type==="vec3u"?kt:Fe:Ue}}}),Qc=ce(e=>{let t=new ArrayBuffer(4);new Rr(t).writeUint32(e);let n=new cr(t);return F(n.readFloat16(),n.readFloat16())},e=>B(S`unpack2x16float(${e})`,F),"unpack2x16float"),My=ce(e=>{let t=new ArrayBuffer(4),n=new Rr(t);n.writeFloat16(e.x),n.writeFloat16(e.y);let r=new cr(t);return J(r.readUint32())},e=>B(S`pack2x16float(${e})`,J),"pack2x16float"),zy=ce(e=>{let t=new ArrayBuffer(4);new Rr(t).writeUint32(e);let n=new cr(t);return k(n.readUint8()/255,n.readUint8()/255,n.readUint8()/255,n.readUint8()/255)},e=>B(S`unpack4x8unorm(${e})`,k),"unpack4x8unorm"),Ey=ce(e=>{let t=new ArrayBuffer(4),n=new Rr(t);n.writeUint8(e.x*255),n.writeUint8(e.y*255),n.writeUint8(e.z*255),n.writeUint8(e.w*255);let r=new cr(t);return J(r.readUint32())},e=>B(S`pack4x8unorm(${e})`,J),"pack4x8unorm");function ys(e){return e.type.includes("2")?xr:e.type.includes("3")?vr:br}var Kc=G({name:"allEq",signature:(...e)=>({argTypes:e,returnType:ke}),normalImpl:(e,t)=>Fo(ni(e,t)),codegenImpl:(e,t)=>S`all(${e} == ${t})`}),ni=(e,t)=>ee.eq[e.kind](e,t),Sy=G({name:"eq",signature:(...e)=>({argTypes:e,returnType:ys(e[0])}),normalImpl:ni,codegenImpl:(e,t)=>S`(${e} == ${t})`}),Py=G({name:"ne",signature:(...e)=>({argTypes:e,returnType:ys(e[0])}),normalImpl:(e,t)=>er(ni(e,t)),codegenImpl:(e,t)=>S`(${e} != ${t})`}),la=(e,t)=>ee.lt[e.kind](e,t),Uy=G({name:"lt",signature:(...e)=>({argTypes:e,returnType:ys(e[0])}),normalImpl:la,codegenImpl:(e,t)=>S`(${e} < ${t})`}),Ay=G({name:"le",signature:(...e)=>({argTypes:e,returnType:ys(e[0])}),normalImpl:(e,t)=>No(la(e,t),ni(e,t)),codegenImpl:(e,t)=>S`(${e} <= ${t})`}),Iy=G({name:"gt",signature:(...e)=>({argTypes:e,returnType:ys(e[0])}),normalImpl:(e,t)=>eh(er(la(e,t)),er(ni(e,t))),codegenImpl:(e,t)=>S`(${e} > ${t})`}),By=G({name:"ge",signature:(...e)=>({argTypes:e,returnType:ys(e[0])}),normalImpl:(e,t)=>er(la(e,t)),codegenImpl:(e,t)=>S`(${e} >= ${t})`}),er=e=>ee.neg[e.kind](e),ky=G({name:"not",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:er,codegenImpl:e=>S`!(${e})`}),No=(e,t)=>ee.or[e.kind](e,t),Oy=G({name:"or",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:No,codegenImpl:(e,t)=>S`(${e} | ${t})`}),eh=(e,t)=>er(No(er(e),er(t))),Vy=G({name:"and",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:eh,codegenImpl:(e,t)=>S`(${e} & ${t})`}),Fo=e=>ee.all[e.kind](e),Gy=G({name:"all",signature:(...e)=>({argTypes:e,returnType:ke}),normalImpl:Fo,codegenImpl:e=>S`all(${e})`}),Dy=G({name:"any",signature:(...e)=>({argTypes:e,returnType:ke}),normalImpl:e=>!Fo(er(e)),codegenImpl:e=>S`any(${e})`}),Ry=G({name:"isCloseTo",signature:(...e)=>({argTypes:e,returnType:ke}),normalImpl:(e,t,n=.01)=>typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<n:Je(e)&&Je(t)?ee.isCloseToZero[e.kind](K[E].jsImpl(e,t),n):!1,codegenImpl:(e,t,n=B(.01,$))=>pi(e)&&pi(t)?S`(abs(f32(${e}) - f32(${t})) <= ${n})`:!pi(e)&&!pi(t)?S`all(abs(${e} - ${t}) <= (${e} - ${e}) + ${n})`:"false"});function Ny(e,t,n){return typeof n=="boolean"?n?t:e:ee.select[e.kind](e,t,n)}var js=G({name:"select",signature:(e,t,n)=>{let[r,s]=ct([e,t])??[e,t];return{argTypes:[r,s,n],returnType:r}},normalImpl:Ny,codegenImpl:(e,t,n)=>S`select(${e}, ${t}, ${n})`}),gs={r8unorm:{channelType:$,vectorType:k,texelSize:1,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},r8snorm:{channelType:$,vectorType:k,texelSize:1,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},r8uint:{channelType:J,vectorType:Ye,texelSize:1,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r8sint:{channelType:Ue,vectorType:Fe,texelSize:1,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rg8unorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rg8snorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg8uint:{channelType:J,vectorType:Ye,texelSize:2,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg8sint:{channelType:Ue,vectorType:Fe,texelSize:2,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba8unorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},"rgba8unorm-srgb":{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:null},rgba8snorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba8uint:{channelType:J,vectorType:Ye,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba8sint:{channelType:Ue,vectorType:Fe,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},bgra8unorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only"]},"bgra8unorm-srgb":{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:null},r16unorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},r16snorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},r16uint:{channelType:J,vectorType:Ye,texelSize:2,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r16sint:{channelType:Ue,vectorType:Fe,texelSize:2,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r16float:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},rg16unorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16snorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16uint:{channelType:J,vectorType:Ye,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16sint:{channelType:Ue,vectorType:Fe,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16float:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rgba16unorm:{channelType:$,vectorType:k,texelSize:8,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba16snorm:{channelType:$,vectorType:k,texelSize:8,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba16uint:{channelType:J,vectorType:Ye,texelSize:8,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba16sint:{channelType:Ue,vectorType:Fe,texelSize:8,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba16float:{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},r32uint:{channelType:J,vectorType:Ye,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r32sint:{channelType:Ue,vectorType:Fe,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r32float:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rg32uint:{channelType:J,vectorType:Ye,texelSize:8,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg32sint:{channelType:Ue,vectorType:Fe,texelSize:8,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg32float:{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32uint:{channelType:J,vectorType:Ye,texelSize:16,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32sint:{channelType:Ue,vectorType:Fe,texelSize:16,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32float:{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgb10a2uint:{channelType:J,vectorType:Ye,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgb10a2unorm:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rg11b10ufloat:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rgb9e5ufloat:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},stencil8:{channelType:J,vectorType:Ye,texelSize:1,sampleTypes:["uint"],aspects:["stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth16unorm:{channelType:$,vectorType:k,texelSize:2,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth24plus:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"depth24plus-stencil8":{channelType:$,vectorType:k,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth","stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth32float:{channelType:$,vectorType:k,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"depth32float-stencil8":{channelType:$,vectorType:k,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth","stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"bc1-rgba-unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc1-rgba-unorm-srgb":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc2-rgba-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc2-rgba-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc3-rgba-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc3-rgba-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc4-r-unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc4-r-snorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc5-rg-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc5-rg-snorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc6h-rgb-ufloat":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc6h-rgb-float":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc7-rgba-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc7-rgba-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8unorm-srgb":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8a1unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8a1unorm-srgb":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgba8unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgba8unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-r11unorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-r11snorm":{channelType:$,vectorType:k,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-rg11unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-rg11snorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-4x4-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-4x4-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x4-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x4-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x5-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x5-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x5-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x5-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x6-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x6-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x5-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x5-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x6-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x6-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x8-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x8-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x5-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x5-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x6-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x6-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x8-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x8-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x10-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x10-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x10-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x10-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x12-unorm":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x12-unorm-srgb":{channelType:$,vectorType:k,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null}};function th(e,t){let n=gs[e];if(!n)throw new Error(`Unknown texture format: ${e}`);let r={...n};switch(e){case"r32float":case"rg32float":case"rgba32float":t.features.has("float32-filterable")||(r={...r,sampleTypes:n.sampleTypes.filter(s=>s!=="float")}),t.features.has("float32-blendable")||(r={...r,canBlend:!1});break;case"bgra8unorm":t.features.has("bgra8unorm-storage")||(r={...r,storageBindings:null});break;case"rg11b10ufloat":t.features.has("rg11b10ufloat-renderable")||(r={...r,canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1});break}if(r.storageBindings){let s=t.features.has("texture-formats-tier1"),i=t.features.has("texture-formats-tier2"),p=[...r.storageBindings],y=["r8unorm","r8uint","r8sint","r16uint","r16sint","r16float","rgba8unorm","rgba8uint","rgba8sint","rgba16uint","rgba16sint","rgba16float","r32uint","r32sint","r32float","rgba32uint","rgba32sint","rgba32float"],v=["r8snorm","rg8unorm","rg8snorm","rg8uint","rg8sint","rgba8snorm","r16unorm","r16snorm","rg16unorm","rg16snorm","rg16uint","rg16sint","rg16float","rgba16unorm","rgba16snorm","rgb10a2uint","rgb10a2unorm","rg11b10ufloat"];y.includes(e)&&!i&&(p=p.filter(_=>_!=="read-write")),v.includes(e)&&!s&&(p=p.filter(_=>_!=="write-only"&&_!=="read-only")),r={...r,storageBindings:p.length>0?p:null}}return r}var Lo=["f16","clip_distances","dual_source_blending","subgroups","primitive_index"],nh={f16:"shader-f16",clip_distances:"clip-distances",dual_source_blending:"dual-source-blending",subgroups:"subgroups",primitive_index:"primitive-index"};function Fy(e){return new Ly(e)}var Ly=class{constructor(t){this.declaration=t}[E]=!0;externalsToApply=[];$uses(t){return this.externalsToApply.push(t),this}[he](t){let n={};for(let s of this.externalsToApply)Us(n,s);let r=Ki(t,n,this.declaration);return t.addDeclaration(r),B("",at)}toString(){return`declare: ${this.declaration}`}};function rh(e){let t={argTypes:e.in&&Object.keys(e.in).length!==0?[Ks(e.in)]:[],returnType:at,workgroupSize:[e.workgroupSize[0]??1,e.workgroupSize[1]??1,e.workgroupSize[2]??1],isEntry:!0},n=(r,...s)=>jy(t,e.workgroupSize,ea(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function jy(e,t,n){let r=Qs(n,`@compute @workgroup_size(${t.join(", ")}) `),s=e.argTypes[0];return{shell:e,$uses(i){return r.applyExternals(i),this},[E]:!0,[st]:r,$name(i){return Ne(r,i),Zi(s)&&s.$name(`${i}_Input`),this},[he](i){return r.resolve(i,e.argTypes,e.returnType)},toString(){return`computeFn:${W(r)??"<unnamed>"}`}}}function Ve(e,t){let n={[E]:!0,argTypes:e,returnType:t??at,isEntry:!1};return Object.assign((r,...s)=>Cy(n,ea(r,...s)),n)}function sh(e){return Ge(e)&&e?.resourceType==="function"}function Yy([e,t]){return`${W(e)??"<unnamed>"}=${t}`}function Cy(e,t){let n=Qs(t,""),r={shell:e,resourceType:"function",$uses(p){return n.applyExternals(p),this},[st]:n,$name(p){return Ne(n,p),this},with(p,y){return ih(i,[[Qi(p)?p.slot:p,y]])},[he](p){return typeof t=="string"&&(Kd(t,e.argTypes,n.applyExternals),hc(t,e.returnType,n.applyExternals)),n.resolve(p,e.argTypes,e.returnType)}},s=ce((...p)=>Ap(()=>{try{if(typeof t=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");let y=p.map((_,P)=>Ir(e.argTypes[P],_)),v=t(...y);return Ir(e.returnType,v)}catch(y){throw y instanceof su?y.appendToTrace(i):new su(y,[i])}}),(...p)=>B(new ah(i,p),e.returnType),"tgpuFnCall",e.argTypes),i=Object.assign(s,r);return i[E].implementation=t,Object.defineProperty(i,"toString",{value(){return`fn:${W(n)??"<unnamed>"}`}}),i}function ih(e,t){let n={resourceType:"function",shell:e.shell,[Pr]:{inner:e,pairs:t},$uses(i){return e.$uses(i),this},[st]:e,$name(i){return e.$name(i),this},with(i,p){return ih(s,[...t,[Qi(i)?i.slot:i,p]])}},r=ce((...i)=>e(...i),(...i)=>B(new ah(s,i),e.shell.returnType),"tgpuFnCall",e.shell.argTypes),s=Object.assign(r,n);return s[E].implementation=e[E].implementation,Object.defineProperty(s,"toString",{value(){return`fn:${W(e)??"<unnamed>"}[${t.map(Yy).join(", ")}]`}}),s[E].implementation=e[E].implementation,s}var ah=class{[E]=!0;[Wt];[st];#e;#t;constructor(t,n){this.#e=t,this.#t=n,this[st]=t,this[Wt]=B(this,this.#e.shell.returnType)}[he](t){return t.withResetIndentLevel(()=>B(S`${t.resolve(this.#e).value}(${this.#t})`,this.#e.shell.returnType))}toString(){return`call:${W(this)??"<unnamed>"}`}};function qy(e){let t={in:e.in,out:e.out,returnType:Ks(e.out),isEntry:!0},n=(r,...s)=>Wy(t,ea(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function Wy(e,t){let n=Qs(t,"@fragment "),r=e.returnType;return typeof t=="string"&&hc(t,r,s=>n.applyExternals(s)),{shell:e,outputType:r,$uses(s){return n.applyExternals(s),this},[E]:!0,[st]:n,$name(s){return Ne(n,s),Zi(r)&&r.$name(`${s}_Output`),this},[he](s){let i=e.in?Ks(e.in,s.varyingLocations).$name(`${W(this)??""}_Input`):void 0;return i&&n.applyExternals({In:i}),n.applyExternals({Out:r}),n.resolve(s,i?[i]:[],e.returnType)},toString(){return`fragmentFn:${W(n)??"<unnamed>"}`}}}var oh=new Set(["alias","break","case","const","const_assert","continue","continuing","default","diagnostic","discard","else","enable","false","fn","for","if","let","loop","override","requires","return","struct","switch","true","var","while","NULL","Self","abstract","active","alignas","alignof","as","asm","asm_fragment","async","attribute","auto","await","become","cast","catch","class","co_await","co_return","co_yield","coherent","column_major","common","compile","compile_fragment","concept","const_cast","consteval","constexpr","constinit","crate","debugger","decltype","delete","demote","demote_to_helper","do","dynamic_cast","enum","explicit","export","extends","extern","external","fallthrough","filter","final","finally","friend","from","fxgroup","get","goto","groupshared","highp","impl","implements","import","inline","instanceof","interface","layout","lowp","macro","macro_rules","match","mediump","meta","mod","module","move","mut","mutable","namespace","new","nil","noexcept","noinline","nointerpolation","non_coherent","noncoherent","noperspective","null","nullptr","of","operator","package","packoffset","partition","pass","patch","pixelfragment","precise","precision","premerge","priv","protected","pub","public","readonly","ref","regardless","register","reinterpret_cast","require","resource","restrict","self","set","shared","sizeof","smooth","snorm","static","static_assert","static_cast","std","subroutine","super","target","template","this","thread_local","throw","trait","try","type","typedef","typeid","typename","typeof","union","unless","unorm","unsafe","unsized","use","using","varying","virtual","volatile","wgsl","where","with","writeonly","yield"]);function uh(e){if(e==="_"||e.startsWith("__")||/\s/.test(e))throw new Error(`Invalid identifier '${e}'. Choose an identifier without whitespaces or leading underscores.`);let t=e.split("_")[0];return!oh.has(t)}var lh=class{makeValid(t){return uh(t)?t:this.makeUnique(t)}},Xy=class extends lh{lastUniqueId=0;makeUnique(t){let n;return t?(n=t.replaceAll(/\s/g,"_"),n=n.replaceAll(/[^\w\d]/g,"")):n="item",`${n}_${this.lastUniqueId++}`}},Jy=class extends lh{_usedNames=new Set(oh);makeUnique(t){if(t===void 0)throw new Error("Unnamed item found when using a strict name registry");let n=0,r=t;for(;this._usedNames.has(r);)n++,r=`${t}_${n}`;return this._usedNames.add(r),r}};function Zy(e,t){let n=Qs(t,"");return{[E]:!0,[st]:n,resourceType:"shellless-impl",[he](r){return n.resolve(r,e,void 0)},toString(){return`fn*:${W(n)??"<unnamed>"}`}}}var Hy=class{cache=new Map;get(t,n){let r=Hi(t);if(!r?.ast)return;if(!n&&r.ast.params.length>0)throw new Error(`Cannot resolve '${W(t)}' directly, because it expects arguments. Either call it from another function, or wrap it in a shell`);let s=(n??[]).map(y=>Ns(y.dataType)),i=this.cache.get(t);if(i){let y=i.find(v=>v.argTypes.every((_,P)=>_===s[P]));if(y)return y.value}else i=[],this.cache.set(t,i);let p=Zy(s,t);return i.push({argTypes:s,value:p}),p}},Qy=class{[E];constructor(t){this[E]={nameRegistry:t,shelllessRepo:new Hy,memoizedResolves:new WeakMap,memoizedDerived:new WeakMap,listeners:{name:new Set}}}on(t,n){if(t==="name"){let r=this[E].listeners.name;return r.add(n),()=>r.delete(n)}throw new Error(`Unsupported event: ${t}`)}};function Ky(e,t){let n=e.nameRegistry.makeUnique(W(t));for(let r of e.listeners.name)r({target:t,name:n});return n}function ri(e){let{names:t="random"}=e||{};return new Qy(t==="strict"?new Jy:new Xy)}function ca(e){return typeof e?.format=="string"}function eg(e,t){let n=[];if(Vr(e)){if(!ca(t))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return n.push(t._layout),{usedVertexLayouts:n,bufferDefinitions:[{arrayStride:t._layout.stride,stepMode:t._layout.stepMode,attributes:[{format:t.format,offset:t.offset,shaderLocation:fr(e)??0}]}]}}let r=[],s=new WeakMap,i=0;for(let[p,y]of Object.entries(e)){if(Dr(y))continue;let v=t[p];if(!v)throw new Error(`An attribute by the name of '${p}' was not provided to the shader.`);let _=v._layout,P=s.get(_);P||(n.push(_),P=[],r.push({arrayStride:_.stride,stepMode:_.stepMode,attributes:P}),s.set(_,P)),i=fr(y)??i,P.push({format:v.format,offset:v.offset,shaderLocation:i++})}return{usedVertexLayouts:n,bufferDefinitions:r}}var tg=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","vec2<bool>","vec3<bool>","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","texture_external"];function ng(e){return tg.includes(e.type)}function Ya(e,[t,n]){if(!uh(t))throw new Error(`Property key '${t}' is a reserved WGSL word. Choose a different name.`);return`  ${Bo(n)}${t}: ${e.resolve(n).value},
`}function rg(e,t){if(t[E].isAbstruct)throw new Error("Cannot resolve abstract struct types to WGSL.");let n=e.getUniqueName(t);return e.addDeclaration(`struct ${n} {
${Object.entries(t.propTypes).map(r=>Ya(e,r)).join("")}}`),n}function sg(e,t){let n=e.getUniqueName(t);return e.addDeclaration(`struct ${n} {
${Object.entries(t.propTypes).map(r=>ca(r[1])?Ya(e,[r[0],sr[r[1].format]]):Ya(e,r)).join("")}
}`),n}function ig(e,t){let n=e.resolve(t.elementType).value;return t.elementCount===0?`array<${n}>`:`array<${n}, ${t.elementCount}>`}function ag(e,t){let n=e.resolve(ca(t.elementType)?sr[t.elementType.format]:t.elementType).value;return t.elementCount===0?`array<${n}>`:`array<${n}, ${t.elementCount}>`}function ch(e,t){if(ds(t))return t.type==="unstruct"?sg(e,t):t.type==="disarray"?ag(e,t):t.type==="loose-decorated"?e.resolve(ca(t.inner)?sr[t.inner.format]:t.inner).value:e.resolve(sr[t.type]).value;if(ng(t))return t.type;if(t.type==="struct")return rg(e,t);if(t.type==="array")return ig(e,t);if(t.type==="atomic")return`atomic<${ch(e,t.inner)}>`;if(t.type==="decorated")return e.resolve(t.inner).value;if(t.type==="ptr")return t.addressSpace==="storage"?`ptr<storage, ${e.resolve(t.inner).value}, ${t.access==="read-write"?"read_write":t.access}>`:`ptr<${t.addressSpace}, ${e.resolve(t.inner).value}>`;if(t.type==="abstractInt"||t.type==="abstractFloat"||t.type==="void"||t.type==="u16")throw new Error(`${t.type} has no representation in WGSL`);if(Ra(t))return`${t.type}<${t.format}, ${ei[t.access]}>`;if(Sc(t))return t.type.startsWith("texture_depth")?t.type:`${t.type}<${t.sampleType.type}>`;if(Sf(t)||Ef(t))return t.type;ls(t,"resolveData")}var hh=class Ca{constructor(t){this.bindings=t}with(t,n){return new Ca([...this.bindings,[Qi(t)?t.slot:t,n]])}pipe(t){let n=t(this);return new Ca([...this.bindings,...n.bindings])}};function*og(e){let t=0;for(;;)e.has(t)||(yield t),t++}function ug(e,t){let n="size"in e?e.size:e.currentByteOffset,r=t-1,s=n&r;"skipBytes"in e?e.skipBytes(t-s&r):e.add(t-s&r)}var mt=ug,Tu=new WeakMap;function ph(e){let t=Tu.get(e);if(t)return t;let n=new nt,r={},s;for(let i in e.propTypes){let p=e.propTypes[i];if(p===void 0)throw new Error(`Property ${i} is undefined in struct`);let y=n.size;mt(n,zn(e)?gn(p):tt(p)),s&&(s.padding=n.size-y);let v=_e(p);r[i]={offset:n.size,size:v},s=r[i],n.add(v)}return s&&(s.padding=nn(_e(e),tt(e))-n.size),Tu.set(e,r),r}var lg=(()=>{try{return new Function("return true"),!0}catch{return!1}})(),fa=new WeakMap,gi={u32:"u32",vec2u:"u32",vec3u:"u32",vec4u:"u32",u16:"u16",i32:"i32",vec2i:"i32",vec3i:"i32",vec4i:"i32",f32:"f32",vec2f:"f32",vec3f:"f32",vec4f:"f32",f16:"f16",vec2h:"f16",vec3h:"f16",vec4h:"f16",mat2x2f:"f32",mat3x3f:"f32",mat4x4f:"f32"},cg={uint8:"u8",uint8x2:"u8",uint8x4:"u8",sint8:"i8",sint8x2:"i8",sint8x4:"i8",unorm8:"u8",unorm8x2:"u8",unorm8x4:"u8",snorm8:"i8",snorm8x2:"i8",snorm8x4:"i8",uint16:"u16",uint16x2:"u16",uint16x4:"u16",sint16:"i16",sint16x2:"i16",sint16x4:"i16",unorm16:"u16",unorm16x2:"u16",unorm16x4:"u16",snorm16:"i16",snorm16x2:"i16",snorm16x4:"i16",float16:"f16",float16x2:"f16",float16x4:"f16",float32:"f32",float32x2:"f32",float32x3:"f32",float32x4:"f32",uint32:"u32",uint32x2:"u32",uint32x3:"u32",uint32x4:"u32",sint32:"i32",sint32x2:"i32",sint32x3:"i32",sint32x4:"i32"},wi={u32:"setUint32",i32:"setInt32",f32:"setFloat32",u16:"setUint16",i16:"setInt16",f16:"setFloat16",u8:"setUint8",i8:"setInt8"},hg={unorm8:e=>`Math.round(${e} * 255)`,unorm8x2:e=>`Math.round(${e} * 255)`,unorm8x4:e=>`Math.round(${e} * 255)`,snorm8:e=>`Math.round(${e} * 127)`,snorm8x2:e=>`Math.round(${e} * 127)`,snorm8x4:e=>`Math.round(${e} * 127)`,unorm16:e=>`Math.round(${e} * 65535)`,unorm16x2:e=>`Math.round(${e} * 65535)`,unorm16x4:e=>`Math.round(${e} * 65535)`,snorm16:e=>`Math.round(${e} * 32767)`,snorm16x2:e=>`Math.round(${e} * 32767)`,snorm16x4:e=>`Math.round(${e} * 32767)`},_u={"unorm10-10-10-2":{writeFunction:"setUint32",generator:(e,t)=>`output.setUint32(${e}, ((${t}.x*1023&0x3FF)<<22)|((${t}.y*1023&0x3FF)<<12)|((${t}.z*1023&0x3FF)<<2)|(${t}.w*3&3), littleEndian);
`},"unorm8x4-bgra":{writeFunction:"setUint8",generator:(e,t)=>{let n=["z","y","x","w"],r="";for(let s=0;s<4;s++)r+=`output.setUint8((${e} + ${s}), Math.round(${t}.${n[s]} * 255), littleEndian);
`;return r}}};function Mi(e,t,n,r=0){let s=["i","j","k"][r]||`i${r}`;if(Ii(e)||Mn(e))return Mi(e.inner,t,n,r);if(vt(e)||zn(e)){let p=ph(e),y="";for(let[v,_]of Object.entries(p)){let P=e.propTypes[v];P&&(y+=Mi(P,`(${t} + ${_.offset})`,`${n}.${v}`,r))}return y}if(Ft(e)||rr(e)){let p=nn(_e(e.elementType),tt(e)),y="";return y+=`for (let ${s} = 0; ${s} < ${e.elementCount}; ${s}++) {
`,y+=Mi(e.elementType,`(${t} + ${s} * ${p})`,`${n}[${s}]`,r+1),y+=`}
`,y}if(tr(e)){let p=gi[e.type],y="",v=wi[p],_=["x","y","z","w"],P=$a(e)?2:Ma(e)?3:4;for(let U=0;U<P;U++)y+=`output.${v}((${t} + ${U*4}), ${n}.${_[U]}, littleEndian);
`;return y}if(Ds(e)){let p=gi[e.type],y=wi[p],v=zl(e)?2:El(e)?3:4,_=v*v,P=nn(v*4,8),U="";for(let R=0;R<_;R++){let j=Math.floor(R/v),L=R%v,Z=j*P+L*4;U+=`output.${y}((${t} + ${Z}), ${n}.columns[${j}].${["x","y","z","w"][L]}, littleEndian);
`}return U}if(uc(e)){let p=e.type;if(p in _u)return _u[p].generator(t,n);let y=cg[p],v=wi[y],_=sr[p],P=Ml(_)?4:Ma(_)?3:$a(_)?2:1,U=y==="u8"||y==="i8"?1:y==="u16"||y==="i16"||y==="f16"?2:4,R=["x","y","z","w"],j=hg[p],L="";for(let Z=0;Z<P;Z++){let Q=P===1?n:`${n}.${R[Z]}`,re=j?j(Q):Q;L+=`output.${v}((${t} + ${Z*U}), ${re}, littleEndian);
`}return L}if(!Object.hasOwn(gi,e.type))throw new Error(`Primitive ${e.type} is unsupported by compiled writer`);let i=gi[e.type];return`output.${wi[i]}(${t}, ${n}, littleEndian);
`}function $u(e){if(!lg){console.warn("This environment does not allow eval - using default writer as fallback");return}if(fa.has(e))return fa.get(e);try{let t=Mi(e,"offset","value",0),n=new Function("output","offset","value","littleEndian=true",t);return fa.set(e,n),n}catch(t){console.warn(`Failed to compile writer for schema: ${e}
Reason: ${t instanceof Error?t.message:String(t)}
Falling back to default writer`)}}var ns={bool(){throw new Error("Booleans are not host-shareable")},f32(e,t,n){e.writeFloat32(n)},f16(e,t,n){e.writeFloat16(n)},i32(e,t,n){e.writeInt32(n)},u32(e,t,n){e.writeUint32(n)},u16(e,t,n){e.writeUint16(n)},vec2f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y)},vec2h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y)},vec2i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y)},vec2u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y)},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},vec3f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z)},vec3h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z)},vec3i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z)},vec3u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z)},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},vec4f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z),e.writeFloat32(n.w)},vec4h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z),e.writeFloat16(n.w)},vec4i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z),e.writeInt32(n.w)},vec4u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z),e.writeUint32(n.w)},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},mat3x3f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},mat4x4f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},struct(e,t,n){let r=tt(t);mt(e,r);for(let[s,i]of Object.entries(t.propTypes))mt(e,tt(i)),Ri(e,i,n[s]);mt(e,r)},array(e,t,n){if(t.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let r=tt(t);mt(e,r);let s=e.currentByteOffset;for(let i=0;i<Math.min(t.elementCount,n.length);i++)mt(e,r),Ri(e,t.elementType,n[i]);e.seekTo(s+_e(t))},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t,n){ns[t.inner.type]?.(e,t,n)},decorated(e,t,n){let r=gn(t);mt(e,r);let s=e.currentByteOffset;ns[t.inner?.type]?.(e,t.inner,n),e.seekTo(s+_e(t))},uint8(e,t,n){e.writeUint8(n)},uint8x2(e,t,n){e.writeUint8(n.x),e.writeUint8(n.y)},uint8x4(e,t,n){e.writeUint8(n.x),e.writeUint8(n.y),e.writeUint8(n.z),e.writeUint8(n.w)},sint8(e,t,n){e.writeInt8(n)},sint8x2(e,t,n){e.writeInt8(n.x),e.writeInt8(n.y)},sint8x4(e,t,n){e.writeInt8(n.x),e.writeInt8(n.y),e.writeInt8(n.z),e.writeInt8(n.w)},unorm8(e,t,n){e.writeUint8(Math.round(n*255))},unorm8x2(e,t,n){e.writeUint8(Math.round(n.x*255)),e.writeUint8(Math.round(n.y*255))},unorm8x4(e,t,n){e.writeUint8(Math.round(n.x*255)),e.writeUint8(Math.round(n.y*255)),e.writeUint8(Math.round(n.z*255)),e.writeUint8(Math.round(n.w*255))},snorm8(e,t,n){e.writeInt8(Math.round(n*127))},snorm8x2(e,t,n){e.writeInt8(Math.round(n.x*127)),e.writeInt8(Math.round(n.y*127))},snorm8x4(e,t,n){e.writeInt8(Math.round(n.x*127)),e.writeInt8(Math.round(n.y*127)),e.writeInt8(Math.round(n.z*127)),e.writeInt8(Math.round(n.w*127))},uint16(e,t,n){e.writeUint16(n)},uint16x2(e,t,n){e.writeUint16(n.x),e.writeUint16(n.y)},uint16x4(e,t,n){e.writeUint16(n.x),e.writeUint16(n.y),e.writeUint16(n.z),e.writeUint16(n.w)},sint16(e,t,n){e.writeInt16(n)},sint16x2(e,t,n){e.writeInt16(n.x),e.writeInt16(n.y)},sint16x4(e,t,n){e.writeInt16(n.x),e.writeInt16(n.y),e.writeInt16(n.z),e.writeInt16(n.w)},unorm16(e,t,n){e.writeUint16(n*65535)},unorm16x2(e,t,n){e.writeUint16(n.x*65535),e.writeUint16(n.y*65535)},unorm16x4(e,t,n){e.writeUint16(n.x*65535),e.writeUint16(n.y*65535),e.writeUint16(n.z*65535),e.writeUint16(n.w*65535)},snorm16(e,t,n){e.writeInt16(Math.round(n*32767))},snorm16x2(e,t,n){e.writeInt16(Math.round(n.x*32767)),e.writeInt16(Math.round(n.y*32767))},snorm16x4(e,t,n){e.writeInt16(Math.round(n.x*32767)),e.writeInt16(Math.round(n.y*32767)),e.writeInt16(Math.round(n.z*32767)),e.writeInt16(Math.round(n.w*32767))},float16(e,t,n){e.writeFloat16(n)},float16x2(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y)},float16x4(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z),e.writeFloat16(n.w)},float32(e,t,n){e.writeFloat32(n)},float32x2(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y)},float32x3(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z)},float32x4(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z),e.writeFloat32(n.w)},uint32(e,t,n){e.writeUint32(n)},uint32x2(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y)},uint32x3(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z)},uint32x4(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z),e.writeUint32(n.w)},sint32(e,t,n){e.writeInt32(n)},sint32x2(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y)},sint32x3(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z)},sint32x4(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z),e.writeInt32(n.w)},"unorm10-10-10-2"(e,t,n){let r=0;r|=(n.x*1023&1023)<<22,r|=(n.y*1023&1023)<<12,r|=(n.z*1023&1023)<<2,r|=n.w*3&3,e.writeUint32(r)},"unorm8x4-bgra"(e,t,n){e.writeUint8(n.z*255),e.writeUint8(n.y*255),e.writeUint8(n.x*255),e.writeUint8(n.w*255)},disarray(e,t,n){let r=tt(t);mt(e,r);let s=e.currentByteOffset;for(let i=0;i<Math.min(t.elementCount,n.length);i++)mt(e,r),ns[t.elementType?.type]?.(e,t.elementType,n[i]);e.seekTo(s+_e(t))},unstruct(e,t,n){let r=t.propTypes;for(let[s,i]of Object.entries(r))ns[i.type]?.(e,i,n[s])},"loose-decorated"(e,t,n){let r=gn(t);mt(e,r);let s=e.currentByteOffset,i=ns[t.inner?.type];return i?.(e,t.inner,n),e.seekTo(s+_e(t)),n}};function Ri(e,t,n){let r=ns[t.type];if(!r)throw new Error(`Cannot write data of type '${t.type}'.`);r(e,t,n)}var pg={bool(){throw new Error("Booleans are not host-shareable")},f32(e){return e.readFloat32()},f16(e){return e.readFloat16()},i32(e){return e.readInt32()},u32(e){return e.readUint32()},u16(e){return e.readUint16()},vec2f(e){return F(e.readFloat32(),e.readFloat32())},vec3f(e){return O(e.readFloat32(),e.readFloat32(),e.readFloat32())},vec4f(e){return k(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},vec2h(e){return Pn(e.readFloat16(),e.readFloat16())},vec3h(e){return Un(e.readFloat16(),e.readFloat16(),e.readFloat16())},vec4h(e){return An(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16())},vec2i(e){return Be(e.readInt32(),e.readInt32())},vec3i(e){return kt(e.readInt32(),e.readInt32(),e.readInt32())},vec4i(e){return Fe(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32())},vec2u(e){return xt(e.readUint32(),e.readUint32())},vec3u(e){return rt(e.readUint32(),e.readUint32(),e.readUint32())},vec4u(e){return Ye(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32())},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e){return wn(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},mat3x3f(e){let t=()=>{let n=e.readFloat32();return e.readFloat32(),n};return In(e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t())},mat4x4f(e){return we(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},struct(e,t){let n=tt(t);mt(e,n);let r={},s=t.propTypes;for(let[i,p]of Object.entries(s))mt(e,tt(p)),r[i]=Fn(e,p);return mt(e,n),r},array(e,t){if(t.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let n=tt(t),r=[];for(let s=0;s<t.elementCount;s++){mt(e,n);let i=t.elementType,p=Fn(e,i);r.push(p)}return mt(e,n),r},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t){return Fn(e,t.inner)},decorated(e,t){let n=gn(t);mt(e,n);let r=e.currentByteOffset,s=Fn(e,t.inner);return e.seekTo(r+_e(t)),s},uint8:e=>e.readUint8(),uint8x2:e=>xt(e.readUint8(),e.readUint8()),uint8x4:e=>Ye(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),sint8:e=>e.readInt8(),sint8x2:e=>Be(e.readInt8(),e.readInt8()),sint8x4:e=>Fe(e.readInt8(),e.readInt8(),e.readInt8(),e.readInt8()),unorm8:e=>e.readUint8()/255,unorm8x2:e=>F(e.readUint8()/255,e.readUint8()/255),unorm8x4:e=>k(e.readUint8()/255,e.readUint8()/255,e.readUint8()/255,e.readUint8()/255),snorm8:e=>e.readInt8()/127,snorm8x2:e=>F(e.readInt8()/127,e.readInt8()/127),snorm8x4:e=>k(e.readInt8()/127,e.readInt8()/127,e.readInt8()/127,e.readInt8()/127),uint16:e=>e.readUint16(),uint16x2:e=>xt(e.readUint16(),e.readUint16()),uint16x4:e=>Ye(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16()),sint16:e=>e.readInt16(),sint16x2:e=>Be(e.readInt16(),e.readInt16()),sint16x4:e=>Fe(e.readInt16(),e.readInt16(),e.readInt16(),e.readInt16()),unorm16:e=>e.readUint16()/65535,unorm16x2:e=>F(e.readUint16()/65535,e.readUint16()/65535),unorm16x4:e=>k(e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535),snorm16:e=>e.readInt16()/32767,snorm16x2:e=>F(e.readInt16()/32767,e.readInt16()/32767),snorm16x4:e=>k(e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767),float16(e){return e.readFloat16()},float16x2:e=>F(e.readFloat16(),e.readFloat16()),float16x4:e=>k(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16()),float32:e=>e.readFloat32(),float32x2:e=>F(e.readFloat32(),e.readFloat32()),float32x3:e=>O(e.readFloat32(),e.readFloat32(),e.readFloat32()),float32x4:e=>k(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()),uint32:e=>e.readUint32(),uint32x2:e=>xt(e.readUint32(),e.readUint32()),uint32x3:e=>rt(e.readUint32(),e.readUint32(),e.readUint32()),uint32x4:e=>Ye(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32()),sint32:e=>e.readInt32(),sint32x2:e=>Be(e.readInt32(),e.readInt32()),sint32x3:e=>kt(e.readInt32(),e.readInt32(),e.readInt32()),sint32x4:e=>Fe(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32()),"unorm10-10-10-2"(e){let t=e.readUint32(),n=(t>>22)/1023,r=(t>>12&1023)/1023,s=(t>>2&1023)/1023,i=(t&3)/3;return k(n,r,s,i)},"unorm8x4-bgra"(e){let t=e.readByte()/255,n=e.readByte()/255,r=e.readByte()/255,s=e.readByte()/255;return k(r,n,t,s)},unstruct(e,t){let n={},r=t.propTypes;for(let[s,i]of Object.entries(r))n[s]=Fn(e,i);return n},disarray(e,t){let n=tt(t),r=[];for(let s=0;s<t.elementCount;s++)mt(e,n),r.push(Fn(e,t.elementType));return mt(e,n),r},"loose-decorated"(e,t){mt(e,gn(t));let n=e.currentByteOffset,r=Fn(e,t.inner);return e.seekTo(n+_e(t)),r}};function Fn(e,t){let n=pg[t.type];if(!n)throw new Error(`Cannot read data of type '${t.type}'.`);return n(e,t)}function dg(e,t){let n=_e(e);if(n===0||t===void 0||t===null)return[];let r=new ArrayBuffer(n),s=new Rr(r),i=[];function p(_,P,U,R){if(P!=null){if(vt(_)||zn(_)){let j=ph(_);for(let[L,Z]of Object.entries(j)){let Q=_.propTypes[L];if(!Q)continue;let re=P[L];re!==void 0&&p(Q,re,U+Z.offset,Z.padding??R)}return}if(Ft(_)||rr(_)){let j=_,L=nn(_e(j.elementType),tt(j.elementType));if(!Array.isArray(P))throw new Error("Partial value for array must be an array");let Z=P??[];Z.sort((Q,re)=>Q.idx-re.idx);for(let{idx:Q,value:re}of Z)p(j.elementType,re,U+Q*L,L-_e(j.elementType))}else{let j=_e(_);s.seekTo(U),Ri(s,_,P),i.push({start:U,end:U+j,padding:R})}}}if(p(e,t,0),i.length===0)return[];let y=[],v=i[0];for(let _=1;_<i.length;_++){let P=i[_];if(!P||!v)throw new Error("Internal error: missing segment");P.start===v.end+(v.padding??0)?(v.end=P.end,v.padding=P.padding):(y.push({data:new Uint8Array(r,v.start,v.end-v.start)}),v=P)}if(!v)throw new Error("Internal error: missing segment");return y.push({data:new Uint8Array(r,v.start,v.end-v.start)}),y}function Ni(e){return!!e?.usableAsStorage}var Mu=class dh extends Error{constructor(t){super(`Resource '${W(t)??"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,dh.prototype)}};function fh(e){return!!e.usableAsUniform}var mh={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},jo=class{constructor(e,t){this.usage=e,this.buffer=t,this[E]={dataType:t.dataType},this[st]=t}resourceType="buffer-usage";[E];[st];$name(e){return this.buffer.$name(e),this}[he](e){let t=this.buffer.dataType,n=e.getUniqueName(this),{group:r,binding:s}=e.allocateFixedEntry(this.usage==="uniform"?{uniform:t}:{storage:t,access:this.usage},this.buffer),i=mh[this.usage];return e.addDeclaration(`@group(${r}) @binding(${s}) var<${i}> ${n}: ${e.resolve(t).value};`),B(n,t)}toString(){return`${this.usage}:${W(this)??"<unnamed>"}`}get[Re](){let e=this.buffer.dataType;return new Proxy({[E]:!0,get[Wt](){return B(this,e)},[he]:t=>t.resolve(this),toString:()=>`${this.usage}:${W(this)??"<unnamed>"}.$`},kn)}get $(){let e=ki(),t=Bi();if(e.type==="normal")throw new au(t?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.read()`");return e.type==="codegen"?this[Re]:e.type==="simulate"?(e.buffers.has(this.buffer)||e.buffers.set(this.buffer,Ir(this.buffer.dataType,this.buffer.initial)),e.buffers.get(this.buffer)):ls(e,"bufferUsage.ts#TgpuFixedBufferImpl/$")}get value(){return this.$}set $(e){let t=ki(),n=Bi();if(t.type==="normal")throw new au(n?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.write()`");if(t.type==="codegen")throw new Error("Unreachable bufferUsage.ts#TgpuFixedBufferImpl/$");if(t.type==="simulate"){t.buffers.set(this.buffer,e);return}ls(t,"bufferUsage.ts#TgpuFixedBufferImpl/$")}set value(e){this.$=e}},zu=class{constructor(e,t,n){this.usage=e,this.dataType=t,this[E]={dataType:t},this.#e=n,Ne(this,n.key)}[E];resourceType="buffer-usage";#e;[he](e){let t=this.dataType,n=e.getUniqueName(this),r=e.allocateLayoutEntry(this.#e.layout),s=mh[this.usage];return e.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var<${s}> ${n}: ${e.resolve(t).value};`),B(n,t)}toString(){return`${this.usage}:${W(this)??"<unnamed>"}`}get[Re](){let e=this.dataType;return new Proxy({[E]:!0,get[Wt](){return B(this,e)},[he]:t=>t.resolve(this),toString:()=>`${this.usage}:${W(this)??"<unnamed>"}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to buffer values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},Eu=new WeakMap;function fg(e){if(!Ni(e))throw new Error(`Cannot pass ${e} to asMutable, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=Eu.get(e);return t||(t=new jo("mutable",e),Eu.set(e,t)),t}var Su=new WeakMap;function mg(e){if(!Ni(e))throw new Error(`Cannot pass ${e} to asReadonly, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=Su.get(e);return t||(t=new jo("readonly",e),Su.set(e,t)),t}var Pu=new WeakMap;function yg(e){if(!fh(e))throw new Error(`Cannot pass ${e} to asUniform, as it is not allowed to be used as a uniform. To allow it, call .$usage('uniform') when creating the buffer.`);let t=Pu.get(e);return t||(t=new jo("uniform",e),Pu.set(e,t)),t}var gg={uniform:yg,mutable:fg,readonly:mg};function xi(e,t,n){return Mt(t)?new Uu(e,t,n):new Uu(e,t,n,["storage","uniform"])}function Os(e){return e.resourceType==="buffer"}var wg=Xc(),Uu=class{constructor(t,n,r,s){this.dataType=n,this.initialOrBuffer=r,this._disallowedUsages=s,this.#e=t.device,Ia(r)?(this._ownBuffer=!1,this._buffer=r):(this._ownBuffer=!0,this.initial=r)}[E]=!0;resourceType="buffer";flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;#e;_buffer=null;_ownBuffer;_destroyed=!1;_hostBuffer;initial;usableAsUniform=!1;usableAsStorage=!1;usableAsVertex=!1;usableAsIndex=!1;get buffer(){if(this._destroyed)throw new Error("This buffer has been destroyed");return this._buffer||(this._buffer=this.#e.createBuffer({size:_e(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:W(this)??"<unnamed>"}),this.initial&&(this._writeToTarget(this._buffer.getMappedRange(),this.initial),this._buffer.unmap())),this._buffer}get destroyed(){return this._destroyed}$name(t){return Ne(this,t),this._buffer&&(this._buffer.label=t),this}$usage(...t){for(let n of t){if(this._disallowedUsages?.includes(n))throw new Error(`Buffer of type ${this.dataType.type} cannot be used as ${n}`);this.flags|=n==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=n==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=n==="vertex"?GPUBufferUsage.VERTEX:0,this.flags|=n==="index"?GPUBufferUsage.INDEX:0,this.usableAsUniform=this.usableAsUniform||n==="uniform",this.usableAsStorage=this.usableAsStorage||n==="storage",this.usableAsVertex=this.usableAsVertex||n==="vertex",this.usableAsIndex=this.usableAsIndex||n==="index"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}compileWriter(){$u(this.dataType)}_writeToTarget(t,n){let r=$u(this.dataType);if(r)try{r(new DataView(t),0,n,wg==="little");return}catch(s){console.error(`Error when using compiled writer for buffer ${W(this)??"<unnamed>"} - this is likely a bug, please submit an issue at https://github.com/software-mansion/TypeGPU/issues
Using fallback writer instead.`,s)}Ri(new Rr(t),this.dataType,n)}write(t){let n=this.buffer;if(n.mapState==="mapped"){let s=n.getMappedRange();this._writeToTarget(s,t);return}let r=_e(this.dataType);this._hostBuffer||(this._hostBuffer=new ArrayBuffer(r)),this._writeToTarget(this._hostBuffer,t),this.#e.queue.writeBuffer(n,0,this._hostBuffer,0,r)}writePartial(t){let n=this.buffer,r=dg(this.dataType,t);if(n.mapState==="mapped"){let s=n.getMappedRange(),i=new Uint8Array(s);for(let p of r)i.set(p.data,p.data.byteOffset)}else for(let s of r)this.#e.queue.writeBuffer(n,s.data.byteOffset,s.data,0,s.data.byteLength)}clear(){let t=this.buffer;if(t.mapState==="mapped"){new Uint8Array(t.getMappedRange()).fill(0);return}let n=this.#e.createCommandEncoder();n.clearBuffer(t),this.#e.queue.submit([n.finish()])}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let n=_e(this.dataType),r=this.#e.createCommandEncoder();r.copyBufferToBuffer(t.buffer,0,this.buffer,0,n),this.#e.queue.submit([r.finish()])}async read(){let t=this.buffer;if(t.mapState==="mapped"){let i=t.getMappedRange();return Fn(new cr(i),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let i=t.getMappedRange(),p=Fn(new cr(i),this.dataType);return t.unmap(),p}let n=(globalThis.__TYPEGPU_AUTONAME__??(i=>i))(this.#e.createBuffer({size:_e(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"r"),r=this.#e.createCommandEncoder();r.copyBufferToBuffer(t,0,n,0,_e(this.dataType)),this.#e.queue.submit([r.finish()]),await n.mapAsync(GPUMapMode.READ,0,_e(this.dataType));let s=Fn(new cr(n.getMappedRange()),this.dataType);return n.unmap(),n.destroy(),s}as(t){return gg[t]?.(this)}destroy(){this._destroyed||(this._destroyed=!0,this._ownBuffer&&this._buffer?.destroy())}toString(){return`buffer:${W(this)??"<unnamed>"}`}};function xg(e,t){return new wh(Oo(),e,t)}function vg(e,t){return new wh(Vo(),e,t)}function yh(e){let t=e;return t?.resourceType==="sampler"&&!!t[E]}function gh(e){let t=e;return t?.resourceType==="sampler-comparison"&&!!t[E]}var bg=class{constructor(t,n){this.schema=t,this.#e=n,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",Ne(this,n.key)}[E]={unwrap:void 0};resourceType;#e;[he](t){let n=t.getUniqueName(this),r=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${n}: ${t.resolve(this.schema).value};`),B(n,this.schema)}get[Re](){let t=this.schema;return new Proxy({[E]:!0,get[Wt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`${this.toString()}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}toString(){return`${this.resourceType}:${W(this)??"<unnamed>"}`}},wh=class{constructor(t,n,r){this.schema=t,this.#n=n,this.#r=r,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",this[E]={unwrap:()=>(this.#t||(this.#t=this.#r.device.createSampler({...this.#n,label:W(this)??"<unnamed>"})),this.#t)},this.#e=n.minFilter==="linear"||n.magFilter==="linear"||n.mipmapFilter==="linear"}[E];resourceType;#e;#t=null;#n;#r;[he](t){let n=t.getUniqueName(this),{group:r,binding:s}=t.allocateFixedEntry(this.schema.type==="sampler_comparison"?{sampler:"comparison"}:{sampler:this.#e?"filtering":"non-filtering"},this);return t.addDeclaration(`@group(${r}) @binding(${s}) var ${n}: ${t.resolve(this.schema).value};`),B(n,this.schema)}get[Re](){let t=this.schema;return new Proxy({[E]:!0,get[Wt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`${this.toString()}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}$name(t){return Ne(this,t),this}toString(){return`${this.resourceType}:${W(this)??"<unnamed>"}`}},Tg=class{constructor(t,n){this.schema=t,this.#e=n,Ne(this,n.key)}resourceType="external-texture";[E]=!0;#e;[he](t){let n=t.getUniqueName(this),r=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${n}: ${t.resolve(this.schema).value};`),B(n,Ec())}get[Re](){let t=this.schema;return new Proxy({[E]:!0,get[Wt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`textureExternal:${W(this)??"<unnamed>"}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureExternal:${W(this)??"<unnamed>"}`}};function qa(e){let{videoWidth:t,videoHeight:n}=e;if(t&&n)return{width:t,height:n};let{naturalWidth:r,naturalHeight:s}=e;if(r&&s)return{width:r,height:s};let{codedWidth:i,codedHeight:p}=e;if(i&&p)return{width:i,height:p};let{width:y,height:v}=e||HTMLCanvasElement||OffscreenCanvas||HTMLImageElement||ImageData;if(!y||!v)throw new Error("Cannot determine dimensions of the provided image source.");return{width:y,height:v}}var Wa=new WeakMap;function xh(e){let t=Wa.get(e);return t||(t=new Map,Wa.set(e,t)),t}function _g(e){let t=Wa.get(e);t&&t.clear()}function $g(e,t,n=0,r){if(t.dimension!=="2d")throw new Error("Cannot generate mipmaps for non-2D textures: only 2D textures are currently supported.");let s=r??t.mipLevelCount-n,i=th(t.format,e);if(![...i.sampleTypes].some(p=>p==="float"||p==="unfilterable-float"))throw new Error(`Cannot generate mipmaps for format '${t.format}': only float and unfilterable-float formats are currently supported.`);if(!i.canRenderAttachment)throw new Error(`Cannot generate mipmaps for format '${t.format}': format does not support render attachments.`);for(let p=0;p<t.depthOrArrayLayers;p++)for(let y=n;y<n+s-1;y++){let v=y,_=y+1;Eg(e,t,v,_,p)}}function Mg(e,t,n,r){if(t.dimension==="3d")throw new Error("Cannot resample to 3D textures: only 2D textures are currently supported.");let s=gs[t.format];if(![...s.sampleTypes].some(i=>i==="float"||i==="unfilterable-float"))throw new Error(`Cannot resample to format '${t.format}': only float and unfilterable-float formats are currently supported.`);if(!s.canRenderAttachment)throw new Error(`Cannot resample to format '${t.format}': format does not support render attachments.`);return zg(e,t,n,r)}function zg(e,t,n,r=0){let s=[...gs[t.format].sampleTypes].includes("float"),i=`${s?"filterable":"unfilterable"}`,p=xh(e),y=p.get(i);if(!y){let Q=e.createShaderModule({code:`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {
  let pos = array<vec2f, 3>(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  let uv = array<vec2f, 3>(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));

  var output: VertexOutput;
  output.pos = vec4f(pos[vertexIndex], 0, 1);
  output.uv = uv[vertexIndex];
  return output;
}
      `}),re=(globalThis.__TYPEGPU_AUTONAME__??(ze=>ze))(e.createSampler({magFilter:s?"linear":"nearest",minFilter:s?"linear":"nearest"}),"R"),Me=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:s?"filtering":"non-filtering"}}]}),oe=e.createPipelineLayout({bindGroupLayouts:[Me]}),be=e.createShaderModule({code:`
@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var inputSampler: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  ${s?"return textureSample(inputTexture, inputSampler, uv);":`let texelCoord = vec2u(uv * vec2f(textureDimensions(inputTexture)));
        return textureLoad(inputTexture, texelCoord, 0);`}
}
      `});y={vertexShader:Q,fragmentShader:be,bindGroupLayout:Me,pipelineLayout:oe,sampler:re},p.set(i,y)}let v=(globalThis.__TYPEGPU_AUTONAME__??(Q=>Q))(e.createTexture({size:[...Object.values(qa(n))],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST}),"l"),{width:_,height:P}=qa(n);e.queue.copyExternalImageToTexture({source:n},{texture:v},[_,P,1]);let U=(globalThis.__TYPEGPU_AUTONAME__??(Q=>Q))(e.createTexture({size:[t.width,t.height,1],format:t.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),"f"),R=e.createRenderPipeline({layout:y.pipelineLayout,vertex:{module:y.vertexShader},fragment:{module:y.fragmentShader,targets:[{format:t.format}]},primitive:{topology:"triangle-list"}}),j=e.createBindGroup({layout:y.bindGroupLayout,entries:[{binding:0,resource:v.createView()},{binding:1,resource:y.sampler}]}),L=e.createCommandEncoder(),Z=L.beginRenderPass({colorAttachments:[{view:U.createView(),loadOp:"clear",storeOp:"store"}]});Z.setPipeline(R),Z.setBindGroup(0,j),Z.draw(3),Z.end(),L.copyTextureToTexture({texture:U},{texture:t,origin:{x:0,y:0,z:r}},{width:t.width,height:t.height,depthOrArrayLayers:1}),e.queue.submit([L.finish()]),v.destroy(),U.destroy()}function Eg(e,t,n,r,s){let i=[...th(t.format,e).sampleTypes].includes("float"),p=`${i?"filterable":"unfilterable"}`,y=xh(e),v=y.get(p);if(!v){let Z=e.createShaderModule({code:`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {
  let pos = array<vec2f, 3>(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  let uv = array<vec2f, 3>(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));

  var output: VertexOutput;
  output.pos = vec4f(pos[vertexIndex], 0, 1);
  output.uv = uv[vertexIndex];
  return output;
}
      `}),Q=e.createShaderModule({code:`
@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var inputSampler: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  return textureSample(inputTexture, inputSampler, uv);
}
      `}),re=(globalThis.__TYPEGPU_AUTONAME__??(be=>be))(e.createSampler({magFilter:i?"linear":"nearest",minFilter:i?"linear":"nearest"}),"R"),Me=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:i?"float":"unfilterable-float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:i?"filtering":"non-filtering"}}]}),oe=e.createPipelineLayout({bindGroupLayouts:[Me]});v={vertexShader:Z,fragmentShader:Q,bindGroupLayout:Me,pipelineLayout:oe,sampler:re},y.set(p,v)}let _=e.createRenderPipeline({layout:v.pipelineLayout,vertex:{module:v.vertexShader},fragment:{module:v.fragmentShader,targets:[{format:t.format}]},primitive:{topology:"triangle-list"}}),P=t.createView({baseMipLevel:n,dimension:"2d",mipLevelCount:1,...s!==void 0&&{baseArrayLayer:s,arrayLayerCount:1}}),U=t.createView({baseMipLevel:r,dimension:"2d",mipLevelCount:1,...s!==void 0&&{baseArrayLayer:s,arrayLayerCount:1}}),R=e.createBindGroup({layout:v.bindGroupLayout,entries:[{binding:0,resource:P},{binding:1,resource:v.sampler}]}),j=e.createCommandEncoder(),L=j.beginRenderPass({colorAttachments:[{view:U,loadOp:"clear",storeOp:"store"}]});L.setPipeline(_),L.setBindGroup(0,R),L.draw(3),L.end(),e.queue.submit([j.finish()])}function Sg(e){return{dimension:e.dimension??"2d",sampleType:gs[e.format].channelType,multisampled:(e.sampleCount??1)!==1}}function Pg(e){return e==="depth24plus-stencil8"||e==="depth32float-stencil8"?["depth","stencil"]:e==="depth16unorm"||e==="depth24plus"||e==="depth32float"?["depth"]:e==="stencil8"?["stencil"]:["color"]}function Ug(e,t){return new Ag(e,t)}function Ys(e){return e?.resourceType==="texture"&&!!e[E]}function Fi(e){return e?.resourceType==="texture-view"&&!!e[E]}var Ag=class{constructor(t,n){this.props=t;let r=t.format;this.#i=n,this.#e=gs[r],this.#t=t.size[0]*(t.size[1]??1)*(t.size[2]??1)*this.#e.texelSize,this.aspects=Pg(r),this[E]={unwrap:()=>{if(this.#n)throw new Error("This texture has been destroyed");return this.#s||(this.#s=n.device.createTexture({label:W(this)??"<unnamed>",format:t.format,size:t.size,usage:this.#r,dimension:t.dimension??"2d",viewFormats:t.viewFormats??[],mipLevelCount:t.mipLevelCount??1,sampleCount:t.sampleCount??1})),this.#s}}}[E];resourceType="texture";aspects;usableAsSampled=!1;usableAsStorage=!1;usableAsRender=!1;#e;#t;#n=!1;#r=GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;#s=null;#i;$name(t){return Ne(this,t),this}$usage(...t){let n=t.includes("storage"),r=t.includes("sampled"),s=t.includes("render");return this.#r|=r?GPUTextureUsage.TEXTURE_BINDING:0,this.#r|=n?GPUTextureUsage.STORAGE_BINDING:0,this.#r|=s?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||=n,this.usableAsSampled||=r,this.usableAsRender||=s,this}createView(t,n){return new Ig(t??Da(Sg(this.props)),this,n)}#a(t=0){let n=2**t,[r,s,i]=[Math.max(1,Math.floor((this.props.size[0]??1)/n)),Math.max(1,Math.floor((this.props.size[1]??1)/n)),Math.max(1,Math.floor((this.props.size[2]??1)/n))];this.#i.device.queue.writeTexture({texture:this[E].unwrap(),mipLevel:t},new Uint8Array(r*s*i*this.#e.texelSize),{bytesPerRow:this.#e.texelSize*r,rowsPerImage:s},[r,s,i])}clear(t="all"){if(t==="all"){let n=this.props.mipLevelCount??1;for(let r=0;r<n;r++)this.#a(r)}else this.#a(t)}generateMipmaps(t=0,n){if(this.usableAsRender===!1)throw new Error("generateMipmaps called without specifying 'render' usage. Add it via the $usage('render') method.");let r=n??(this.props.mipLevelCount??1)-t;if(r<=1){console.warn(`generateMipmaps is a no-op: would generate ${r} mip levels (base: ${t}, total: ${this.props.mipLevelCount??1})`);return}if(t>=(this.props.mipLevelCount??1))throw new Error(`Base mip level ${t} is out of range. Texture has ${this.props.mipLevelCount??1} mip levels.`);$g(this.#i.device,this[E].unwrap(),t,r)}write(t,n=0){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){this.#o(t,n);return}let r=this.props.dimension??"2d";if(!Array.isArray(t)){this.#u(t,r==="3d"?0:void 0);return}let s=this.props.size[2]??1;t.length>s&&console.warn(`Too many image sources provided. Expected ${s} layers, got ${t.length}. Extra sources will be ignored.`);for(let i=0;i<Math.min(t.length,s);i++){let p=t[i];p&&this.#u(p,i)}}#o(t,n){let r=Math.max(1,this.props.size[0]>>n),s=Math.max(1,(this.props.size[1]??1)>>n),i=Math.max(1,(this.props.size[2]??1)>>n),p=r*s*i*this.#e.texelSize,y=t.byteLength??t.byteLength;if(y!==p)throw new Error(`Buffer size mismatch. Expected ${p} bytes for mip level ${n}, got ${y} bytes.`);this.#i.device.queue.writeTexture({texture:this[E].unwrap(),mipLevel:n},t,{bytesPerRow:this.#e.texelSize*r,rowsPerImage:s},[r,s,i])}#u(t,n){let r=this.props.size[0],s=this.props.size[1]??1,{width:i,height:p}=qa(t);if(i!==r||p!==s){Mg(this.#i.device,this[E].unwrap(),t,n);return}this.#i.device.queue.copyExternalImageToTexture({source:t},{texture:this[E].unwrap(),...n!==void 0&&{origin:{x:0,y:0,z:n}}},n!==void 0?[r,s,1]:this.props.size)}copyFrom(t){if(t.props.format!==this.props.format)throw new Error(`Texture format mismatch. Source texture has format ${t.props.format}, target texture has format ${this.props.format}`);if(t.props.size[0]!==this.props.size[0]||(t.props.size[1]??1)!==(this.props.size[1]??1)||(t.props.size[2]??1)!==(this.props.size[2]??1))throw new Error(`Texture size mismatch. Source texture has size ${t.props.size.join("x")}, target texture has size ${this.props.size.join("x")}`);let n=this.#i.device.createCommandEncoder();n.copyTextureToTexture({texture:t[E].unwrap()},{texture:this[E].unwrap()},t.props.size),this.#i.device.queue.submit([n.finish()])}get destroyed(){return this.#n}destroy(){this.#n||(this.#n=!0,this.#s?.destroy())}},Ig=class{constructor(t,n,r){this.schema=t,this.#e=n,this.#n=r,this[E]={unwrap:()=>{if(!this.#t){let s=this.schema,i;Ra(s)?i={label:W(this)??"<unnamed>",format:this.#n?.format??s.format,dimension:s.dimension}:i={label:W(this)??"<unnamed>",format:this.#n?.format??this.#e.props.format,dimension:s.dimension},this.#n?.mipLevelCount!==void 0&&(i.mipLevelCount=this.#n.mipLevelCount),this.#n?.arrayLayerCount!==void 0&&(i.arrayLayerCount=this.#n.arrayLayerCount),this.#t=this.#e[E].unwrap().createView(i)}return this.#t}}}[E];resourceType="texture-view";#e;#t;#n;$name(t){return Ne(this,t),this.#t&&(this.#t.label=t),this}get[Re](){let t=this.schema;return new Proxy({[E]:!0,get[Wt](){return B(this,t)},[he]:n=>n.resolve(this),toString:()=>`${this.toString()}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to texture view values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureView:${W(this)??"<unnamed>"}`}[he](t){let n=t.getUniqueName(this),{group:r,binding:s}=t.allocateFixedEntry(Ra(this.schema)?{storageTexture:this.schema}:{texture:this.schema,sampleType:this.#n?.sampleType??this.schema.bindingSampleType[0]},this);return t.addDeclaration(`@group(${r}) @binding(${s}) var ${n}: ${t.resolve(this.schema).value};`),B(n,this.schema)}},Au=class{constructor(e,t){this.schema=e,this.#e=t,Ne(this,t.key)}[E]={unwrap:void 0};resourceType="texture-view";#e;toString(){return`textureView:${W(this)??"<unnamed>"}`}[he](e){let t=e.getUniqueName(this),n=e.allocateLayoutEntry(this.#e.layout);return e.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${t}: ${e.resolve(this.schema).value};`),B(t,this.schema)}get[Re](){let e=this.schema;return new Proxy({[E]:!0,get[Wt](){return B(this,e)},[he]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},kn)}get $(){if(Bn())return this[Re];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}};function Bg(e){return!!e?.usableAsSampled}var kg=class vh extends Error{constructor(t){super(`Resource '${W(t)??"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,vh.prototype)}};function Og(e){let t={};for(let[n,r]of Object.entries(e)){if(r===null){t[n]=null;continue}if("texture"in r&&typeof r.texture=="string"){let s=r.texture;t[n]={...r,texture:Da({dimension:r.viewDimension??"2d",sampleType:s==="sint"?Ue:s==="uint"?J:$,multisampled:r.multisampled??!1})}}else if("storageTexture"in r&&typeof r.storageTexture=="string"){let s={readonly:"read-only",writeonly:"write-only",mutable:"read-write"};t[n]={...r,storageTexture:Da({access:s[r.access??"writeonly"],format:r.storageTexture,dimension:r.viewDimension??"2d"})}}else"externalTexture"in r&&Object.keys(r.externalTexture).length===0?t[n]={...r,externalTexture:{type:"texture_external",dimension:"2d"}}:t[n]=r}return t}function bh(e){let t=Og(e);return new Gg(t)}function Th(e){return!!e&&e.resourceType==="bind-group-layout"}function Li(e){return!!e&&e.resourceType==="bind-group"}var Vg=class _h extends Error{constructor(t,n){super(`Bind group '${t??"<unnamed>"}' is missing a required binding '${n}'`),Object.setPrototypeOf(this,_h.prototype)}},Iu=["compute","fragment"],Ts=["compute","vertex","fragment"],Gg=class{constructor(t){this.entries=t;let n=0;for(let[r,s]of Object.entries(t)){if(s===null){n++;continue}let i={layout:this,key:r,idx:n};if("uniform"in s&&(this.bound[r]=new zu("uniform",s.uniform,i)),"storage"in s){let p="type"in s.storage?s.storage:s.storage(0);this.bound[r]=new zu(s.access??"readonly",p,i)}"texture"in s&&(this.bound[r]=new Au(s.texture,i)),"storageTexture"in s&&(this.bound[r]=new Au(s.storageTexture,i)),"externalTexture"in s&&(this.bound[r]=new Tg(s.externalTexture,i)),"sampler"in s&&(this.bound[r]=new bg(s.sampler==="comparison"?Vo():Oo(),i)),Object.defineProperty(this.value,r,{get:()=>this.bound[r].value}),n++}}[E]=!0;_index;resourceType="bind-group-layout";bound={};value={};$=this.value;get[Re](){return this.$}toString(){return`bindGroupLayout:${W(this)??"<unnamed>"}`}get index(){return this._index}$name(t){return Ne(this,t),this}$idx(t){return this._index=t,this}unwrap(t){return t.device.createBindGroupLayout({label:W(this)??"<unnamed>",entries:Object.values(this.entries).map((n,r)=>{if(n===null)return null;let s=n.visibility,i={binding:r,visibility:0};if("uniform"in n)s=s??Ts,i.buffer={type:"uniform"};else if("storage"in n)s=s??(n.access==="mutable"?Iu:Ts),i.buffer={type:n.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in n)s=s??Ts,i.sampler={type:n.sampler};else if("texture"in n){s=s??Ts;let{multisampled:p,dimension:y,bindingSampleType:v}=n.texture;i.texture={sampleType:n.sampleType??v[0],viewDimension:y,multisampled:p}}else if("storageTexture"in n){s=s??Iu;let{dimension:p,access:y,format:v}=n.storageTexture;i.storageTexture={access:y,format:v,viewDimension:p}}else"externalTexture"in n&&(s=s??Ts,i.externalTexture={});return s?.includes("compute")&&(i.visibility|=GPUShaderStage.COMPUTE),s?.includes("vertex")&&(i.visibility|=GPUShaderStage.VERTEX),s?.includes("fragment")&&(i.visibility|=GPUShaderStage.FRAGMENT),i}).filter(n=>n!==null)})}},$h=class{constructor(e,t){this.layout=e,this.entries=t;for(let n of Object.keys(e.entries))if(e.entries[n]!==null&&!(n in t))throw new Vg(W(e),n)}resourceType="bind-group";unwrap(e){return e.device.createBindGroup({label:W(this.layout)??"<unnamed>",layout:e.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([t,n],r)=>{if(n===null)return null;let s=this.entries[t];if(s===void 0)throw new Error(`'${t}' is a resource required to populate bind group layout '${W(this.layout)??"<unnamed>"}'.`);if("uniform"in n){let i;if(Os(s)){if(!fh(s))throw new zp(s);i={buffer:e.unwrap(s)}}else i={buffer:s};return{binding:r,resource:i}}if("storage"in n){let i;if(Os(s)){if(!Ni(s))throw new Mu(s);i={buffer:e.unwrap(s)}}else i={buffer:s};return{binding:r,resource:i}}if("texture"in n){let i;if(Ys(s)){if(!Bg(s))throw new kg(s);i=e.unwrap(s.createView(n.texture))}else Fi(s)?i=e.unwrap(s):i=s;return{binding:r,resource:i}}if("storageTexture"in n){let i;if(Ys(s)){if(!Ni(s))throw new Mu(s);i=e.unwrap(s.createView(n.storageTexture))}else Fi(s)?i=e.unwrap(s):i=s;return{binding:r,resource:i}}if("sampler"in n)return gh(s)||yh(s)?{binding:r,resource:e.unwrap(s)}:{binding:r,resource:s};if("externalTexture"in n)return{binding:r,resource:s};throw new Error(`Malformed bind group entry: ${Xt(s)}`)}).filter(t=>t!==null)})}};function ji(e){return new Dg(e)}var Dg=class{constructor(t=void 0){this.defaultValue=t}[E]=!0;resourceType="slot";$name(t){return Ne(this,t),this}areEqual(t,n){return Object.is(t,n)}toString(){return`slot:${W(this)??"<unnamed>"}`}get[Re](){let t=mr();if(!t)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return aa(t.unwrap(this))}get value(){return this[Re]}get $(){return this.value}};function Yi(e,t){return new Mh("private",e,t)}function Bu(e){return new Mh("workgroup",e)}var Mh=class{[E]={};#e;#t;#n;constructor(e,t,n){this.#e=e,this.#t=t,this.#n=n}[he](e){let t=e.getUniqueName(this),n=`var<${this.#e}> ${t}: ${e.resolve(this.#t).value}`;return this.#n?e.addDeclaration(`${n} = ${e.resolve(this.#n,this.#t).value};`):e.addDeclaration(`${n};`),B(t,this.#t)}$name(e){return Ne(this,e),this}toString(){return`var:${W(this)??"<unnamed>"}`}get[Re](){let e=this.#t;return new Proxy({[E]:!0,get[Wt](){return B(this,e)},[he]:t=>t.resolve(this),toString:()=>`var:${W(this)??"<unnamed>"}.$`},kn)}get $(){let e=ki(),t=Bi();if(e.type==="normal")throw new iu(t?`Cannot access variable '${W(this)??"<unnamed>"}'. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");return e.type==="codegen"?this[Re]:e.type==="simulate"?(e.vars[this.#e].has(this)||e.vars[this.#e].set(this,this.#n),e.vars[this.#e].get(this)):ls(e,"tgpuVariable.ts#TgpuVarImpl/$")}set $(e){let t=ki(),n=Bi();if(t.type==="normal")throw new iu(n?`Cannot access ${String(this)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");if(t.type==="codegen")throw new Error("Unreachable tgpuVariable.ts#TgpuVarImpl/$");if(t.type==="simulate"){t.vars[this.#e].set(this,e);return}ls(t,"tgpuVariable.ts#TgpuVarImpl/$")}get value(){return this.$}set value(e){this.$=e}},zh=Yi(J,0).$name("dataBlockIndex"),Eh=Yi(J,0).$name("dataByteIndex"),Sh=ji().$name("dataBuffer"),Rg=Ve([],J)`() {
  let i = dataByteIndex;
  dataByteIndex = dataByteIndex + 1u;
  return i;
}`.$uses({dataByteIndex:Eh}).$name("nextByteIndex"),q="dataBuffer[dataBlockIndex].serializedData[nextByteIndex()]",Ph={f32:Ve([$])`(n) => {
  ${q} = bitcast<u32>(n);
}`,f16:Ve([ut])`(n) => {
  ${q} = pack2x16float(vec2f(f32(n), 0.0));
}`,i32:Ve([Ue])`(n) => {
  ${q} = bitcast<u32>(n);
}`,u32:Ve([J])`(n) => {
  ${q} = n;
}`,bool:Ve([ke])`(b) => {
  ${q} = u32(b);
}`,vec2f:Ve([F])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
}`,vec3f:Ve([O])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
  ${q} = bitcast<u32>(v.z);
}`,vec4f:Ve([k])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
  ${q} = bitcast<u32>(v.z);
  ${q} = bitcast<u32>(v.w);
}`,vec2h:Ve([Pn])`(v) => {
  ${q} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
}`,vec3h:Ve([Un])`(v) => {
  ${q} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${q} = pack2x16float(vec2f(f32(v.z), 0.0));
}`,vec4h:Ve([An])`(v) => {
  ${q} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${q} = pack2x16float(vec2f(f32(v.z), f32(v.w)));
}`,vec2i:Ve([Be])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
}`,vec3i:Ve([kt])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
  ${q} = bitcast<u32>(v.z);
}`,vec4i:Ve([Fe])`(v) => {
  ${q} = bitcast<u32>(v.x);
  ${q} = bitcast<u32>(v.y);
  ${q} = bitcast<u32>(v.z);
  ${q} = bitcast<u32>(v.w);
}`,vec2u:Ve([xt])`(v) => {
  ${q} = v.x;
  ${q} = v.y;
}`,vec3u:Ve([rt])`(v) => {
  ${q} = v.x;
  ${q} = v.y;
  ${q} = v.z;
}`,vec4u:Ve([Ye])`(v) => {
  ${q} = v.x;
  ${q} = v.y;
  ${q} = v.z;
  ${q} = v.w;
}`,"vec2<bool>":Ve([xr])`(v) => {
  ${q} = u32(v.x);
  ${q} = u32(v.y);
}`,"vec3<bool>":Ve([vr])`(v) => {
  ${q} = u32(v.x);
  ${q} = u32(v.y);
  ${q} = u32(v.z);
}`,"vec4<bool>":Ve([br])`(v) => {
  ${q} = u32(v.x);
  ${q} = u32(v.y);
  ${q} = u32(v.z);
  ${q} = u32(v.w);
}`,mat2x2f:Ve([wn])`(m) => {
  ${q} = bitcast<u32>(m[0][0]);
  ${q} = bitcast<u32>(m[0][1]);
  ${q} = bitcast<u32>(m[1][0]);
  ${q} = bitcast<u32>(m[1][1]);
}`,mat3x3f:Ve([In])`(m) => {
  ${q} = bitcast<u32>(m[0][0]);
  ${q} = bitcast<u32>(m[0][1]);
  ${q} = bitcast<u32>(m[0][2]);
  ${q} = 0u;
  ${q} = bitcast<u32>(m[1][0]);
  ${q} = bitcast<u32>(m[1][1]);
  ${q} = bitcast<u32>(m[1][2]);
  ${q} = 0u;
  ${q} = bitcast<u32>(m[2][0]);
  ${q} = bitcast<u32>(m[2][1]);
  ${q} = bitcast<u32>(m[2][2]);
  ${q} = 0u;
}`,mat4x4f:Ve([we])`(m) => {
  ${q} = bitcast<u32>(m[0][0]);
  ${q} = bitcast<u32>(m[0][1]);
  ${q} = bitcast<u32>(m[0][2]);
  ${q} = bitcast<u32>(m[0][3]);
  ${q} = bitcast<u32>(m[1][0]);
  ${q} = bitcast<u32>(m[1][1]);
  ${q} = bitcast<u32>(m[1][2]);
  ${q} = bitcast<u32>(m[1][3]);
  ${q} = bitcast<u32>(m[2][0]);
  ${q} = bitcast<u32>(m[2][1]);
  ${q} = bitcast<u32>(m[2][2]);
  ${q} = bitcast<u32>(m[2][3]);
  ${q} = bitcast<u32>(m[3][0]);
  ${q} = bitcast<u32>(m[3][1]);
  ${q} = bitcast<u32>(m[3][2]);
  ${q} = bitcast<u32>(m[3][3]);
}`};for(let[e,t]of Object.entries(Ph))t.$name(`serialize${e[0].toLocaleUpperCase()}${e.slice(1)}`).$uses({dataBlockIndex:zh,nextByteIndex:Rg,dataBuffer:Sh});function Uh(e){return`(${e.map((t,n)=>`_arg_${n}`).join(", ")})`}function Ah(e,t){let n=Ph[e.type];if(n)return n.with(Sh,t);if(vt(e)){let r=Object.keys(e.propTypes),s=Object.values(e.propTypes),i=Ih(s,t);return Ve([e])`(arg) {\n  propsSerializer(${r.map(p=>`arg.${p}`).join(", ")});\n}`.$uses({propsSerializer:i}).$name(`${W(e)??"struct"}Serializer`)}if(Ft(e)){let r=e.elementType,s=e.elementCount,i=Ah(r,t);return Ve([e])`(arg) {\n${Array.from({length:s},(p,y)=>`  elementSerializer(arg[${y}]);`).join(`
`)}\n}`.$uses({elementSerializer:i}).$name("arraySerializer")}throw new Error(`Cannot serialize data of type ${e.type}`)}function Ih(e,t){let n={},r=Ve(e),s=Uh(e),i=e.map((p,y)=>(n[`serializer${y}`]=Ah(p,t),`  serializer${y}(_arg_${y});`)).join(`
`);return r`${s} {\n${i}\n}`.$uses(n).$name("compoundSerializer")}function Ng(e,t,n,r,s){let i=t.map(_e).reduce((v,_)=>v+_,0);if(i>s.logSizeLimit)throw new Error(`Logged data needs to fit in ${s.logSizeLimit} bytes (one of the logs requires ${i} bytes). Consider increasing the limit by passing appropriate options to tgpu.init().`);let p=Ih(t,n).$name(`log${e}serializer`),y=Uh(t);return Ve(t)`${y} {
  dataBlockIndex = atomicAdd(&indexBuffer, 1);
  if (dataBlockIndex >= ${s.logCountLimit}) {
    return;
  }
  dataBuffer[dataBlockIndex].id = ${e};
  dataByteIndex = 0;

  compoundSerializer${y};
}`.$uses({indexBuffer:r,dataBuffer:n,dataBlockIndex:zh,dataByteIndex:Eh,compoundSerializer:p}).$name(`log${e}`)}var Fg=["log","debug","info","warn","error","clear"],Lg={logCountLimit:64,logSizeLimit:252,messagePrefix:" GPU "},Bh=B("/* console.log() */",at),jg=class{get logResources(){}generateLog(){return console.warn("'console.log' is currently only supported in compute pipelines."),Bh}},Yg=class{#e;#t;#n=1;#r;#s;constructor(t){this.#e={...Lg,...t[E].logOptions},this.#t=new Map;let n=Cn({id:J,serializedData:Yn(J,Math.ceil(this.#e.logSizeLimit/4))}).$name("SerializedLogData");this.#s=t.createMutable(Yn(n,this.#e.logCountLimit)).$name("dataBuffer"),this.#r=t.createMutable(Pc(J)).$name("indexBuffer")}generateLog(t,n,r){if(!Fg.includes(n))return console.warn(`Unsupported log method '${n}' was used in TGSL.`),Bh;let s=Mf(r),i=this.#n++,p=s.filter(_=>_.dataType!==Bt),y=Ng(i,p.map(_=>_.dataType),this.#s,this.#r,this.#e),v=s.map(_=>_.dataType===Bt?_.value:_.dataType);return this.#t.set(i,{op:n,argTypes:v}),B(S`${t.resolve(y).value}(${p})`,at)}get logResources(){return this.#n===1?void 0:{dataBuffer:this.#s,indexBuffer:this.#r,options:this.#e,logIdToMeta:this.#t}}},kh="#CATCHALL#",Cg=class{_stack=[];_itemDepth=0;get itemDepth(){return this._itemDepth}get topItem(){let t=this._stack[this._stack.length-1];if(!t||t.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return t}get topFunctionScope(){return this._stack.findLast(t=>t.type==="functionScope")}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}popItem(){this.pop("item")}pushSlotBindings(t){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(t)})}popSlotBindings(){this.pop("slotBinding")}pushFunctionScope(t,n,r,s){let i={type:"functionScope",args:t,argAliases:n,returnType:r,externalMap:s,reportedReturnTypes:new Set};return this._stack.push(i),i}popFunctionScope(){this.pop("functionScope")}pushBlockScope(){this._stack.push({type:"blockScope",declarations:new Map})}popBlockScope(){this.pop("blockScope")}pop(t){let n=this._stack[this._stack.length-1];if(!n||t&&n.type!==t)throw new Error(`Internal error, expected a ${t} layer to be on top.`);this._stack.pop(),t==="item"&&this._itemDepth--}readSlot(t){for(let n=this._stack.length-1;n>=0;--n){let r=this._stack[n];if(r?.type==="item")r.usedSlots.add(t);else if(r?.type==="slotBinding"){let s=r.bindingMap.get(t);if(s!==void 0)return s}else if(!(r?.type==="functionScope"||r?.type==="blockScope"))throw new Error("Unknown layer type.")}return t.defaultValue}getSnippetById(t){for(let n=this._stack.length-1;n>=0;--n){let r=this._stack[n];if(r?.type==="functionScope"){let s=r.args.find(p=>p.value===t);if(s!==void 0)return s;if(r.argAliases[t])return r.argAliases[t];let i=r.externalMap[t];return i!=null?$i(i):void 0}if(r?.type==="blockScope"){let s=r.declarations.get(t);if(s!==void 0)return s}}}defineBlockVariable(t,n){if(n.dataType.type==="unknown")throw Error(`Tried to define variable '${t}' of unknown type`);for(let r=this._stack.length-1;r>=0;--r){let s=this._stack[r];if(s?.type==="blockScope"){s.declarations.set(t,n);return}}throw new Error("No block scope found to define a variable in.")}},zi=["","  ","    ","      ","        ","          ","            ","              ","                "],ma=zi.length-1,qg=class{identLevel=0;get pre(){return zi[this.identLevel]??zi[ma].repeat(this.identLevel/ma)+zi[this.identLevel%ma]}indent(){let t=this.pre;return this.identLevel++,t}dedent(){return this.identLevel--,this.pre}withResetLevel(t){let n=this.identLevel;this.identLevel=0;try{return t()}finally{this.identLevel=n}}},Oh=class{#e;#t;_indentController=new qg;_itemStateStack=new Cg;#n=[];_declarations=[];_varyingLocations;#r=new WeakSet;#s;get varyingLocations(){return this._varyingLocations}[E]={itemStateStack:this._itemStateStack};bindGroupLayoutsToPlaceholderMap=new Map;_nextFreeLayoutPlaceholderIdx=0;fixedBindings=[];enableExtensions;expectedType;constructor(e){this.enableExtensions=e.enableExtensions,this.#t=e.shaderGenerator??Dc,this.#s=e.root?new Yg(e.root):new jg,this.#e=e.namespace[E]}getUniqueName(e){return Ky(this.#e,e)}makeNameValid(e){return this.#e.nameRegistry.makeValid(e)}get pre(){return this._indentController.pre}get topFunctionReturnType(){let e=this._itemStateStack.topFunctionScope;return Qn(e),e.returnType}get shelllessRepo(){return this.#e.shelllessRepo}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}withResetIndentLevel(e){return this._indentController.withResetLevel(e)}getById(e){let t=this._itemStateStack.getSnippetById(e);return t===void 0?null:t}defineVariable(e,t){this._itemStateStack.defineBlockVariable(e,t)}reportReturnType(e){let t=this._itemStateStack.topFunctionScope;Qn(t),t.reportedReturnTypes.add(e)}pushBlockScope(){this._itemStateStack.pushBlockScope()}popBlockScope(){this._itemStateStack.popBlockScope()}generateLog(e,t){return this.#s.generateLog(this,e,t)}get logResources(){return this.#s.logResources}fnToWgsl(e){let t=this._itemStateStack.pushFunctionScope(e.args,e.argAliases,e.returnType,e.externalMap);try{this.#t.initGenerator(this);let n=this.#t.functionDefinition(e.body),r=e.returnType;if(!r){let s=[...t.reportedReturnTypes];if(s.length===0)r=at;else{let i=yo(s);i&&!i.hasImplicitConversions&&(r=i.targetType)}if(!r)throw new Error(`Expected function to have a single return type, got [${s.join(", ")}]. Cast explicitly to the desired type.`);r=Ns(r)}return{head:Wg(this,e.args,r),body:n,returnType:r}}finally{this._itemStateStack.popFunctionScope()}}addDeclaration(e){this._declarations.push(e)}allocateLayoutEntry(e){let t=this.bindGroupLayoutsToPlaceholderMap,n=t.get(e);return n||(n=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,t.set(e,n)),n}allocateFixedEntry(e,t){let n=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:e,resource:t}),{group:kh,binding:n}}readSlot(e){let t=this._itemStateStack.readSlot(e);if(t===void 0)throw new Mp(e);return t}withSlots(e,t){this._itemStateStack.pushSlotBindings(e);try{return t()}finally{this._itemStateStack.popSlotBindings()}}withVaryingLocations(e,t){this._varyingLocations=e;try{return t()}finally{this._varyingLocations=void 0}}unwrap(e){if(Aa(e))return this.withSlots(e[Pr].pairs,()=>this.unwrap(e[Pr].inner));let t=e;for(;;)if(Pa(t))t=this.readSlot(t);else if(Ua(t))t=this._getOrCompute(t);else break;return t}_getOrCompute(e){let t=this.#e.memoizedDerived.get(e)??[];this._itemStateStack.pushItem();try{for(let s of t)if([...s.slotToValueMap.entries()].every(([i,p])=>i.areEqual(this._itemStateStack.readSlot(i),p)))return s.result;this.pushMode(new Ll);let n;try{n=e["~compute"]()}finally{this.popMode("normal")}let r=new Map;for(let s of this._itemStateStack.topItem.usedSlots)r.set(s,this._itemStateStack.readSlot(s));return t.push({slotToValueMap:r,result:n}),this.#e.memoizedDerived.set(e,t),n}catch(n){throw n instanceof _s?n.appendToTrace(e):new _s(n,[e])}finally{this._itemStateStack.popItem()}}_getOrInstantiate(e){let t=this.#e.memoizedResolves.get(e)??[];this._itemStateStack.pushItem();try{for(let s of t)if([...s.slotToValueMap.entries()].every(([i,p])=>i.areEqual(this._itemStateStack.readSlot(i),p)))return s.result;let n;if(Vr(e))n=B(ch(this,e),at);else if(Ua(e)||Pa(e))n=this.resolve(this.unwrap(e));else if(jl(e))n=e[he](this);else if(Es(e)){let s=this.#e.shelllessRepo.get(e,void 0);if(!s)throw new Error(`Couldn't resolve ${e.name}. Make sure it's a function that accepts no arguments, or call it from another TypeGPU function.`);return this.withResetIndentLevel(()=>this.resolve(s))}else throw new TypeError(`Unresolvable internal value: ${Xt(e)}`);let r=new Map;for(let s of this._itemStateStack.topItem.usedSlots)r.set(s,this._itemStateStack.readSlot(s));return t.push({slotToValueMap:r,result:n}),this.#e.memoizedResolves.set(e,t),n}catch(n){throw n instanceof _s?n.appendToTrace(e):new _s(n,[e])}finally{this._itemStateStack.popItem()}}resolve(e,t){if(sh(e)||Es(e)){if(this.#r.has(e)&&!this.#e.memoizedResolves.has(e))throw new Error(`Recursive function ${e} detected. Recursion is not allowed on the GPU.`);this.#r.add(e)}if(Aa(e))return this.withSlots(e[Pr].pairs,()=>this.resolve(e[Pr].inner,t));if(Ge(e)||Es(e)){if(this._itemStateStack.itemDepth===0)try{this.pushMode(new Sp);let n=Yl(this,()=>this._getOrInstantiate(e));return B(`${[...this._declarations].join(`

`)}${n.value}`,at)}finally{this.popMode("codegen")}return this._getOrInstantiate(e)}if(typeof e=="number"){let n=t??Di(e).dataType;if(Qn(n.type!=="unknown"),n.type==="abstractInt")return B(`${e}`,n);if(n.type==="u32")return B(`${e}u`,n);if(n.type==="i32")return B(`${e}i`,n);let r=e.toExponential(),s=n.type==="abstractFloat"&&Number.isInteger(e)?`${e}.`:`${e}`,i=r.length<s.length?r:s;return n.type==="f32"?B(`${i}f`,n):n.type==="f16"?B(`${i}h`,n):B(i,n)}if(typeof e=="boolean")return B(e?"true":"false",ke);if(typeof e=="string")return B(e,at);if(t&&Ft(t)){if(!Array.isArray(e))throw new mn(`Cannot coerce ${e} into value of type '${t}'`);if(t.elementCount!==e.length)throw new mn(`Cannot create value of type '${t}' from an array of length: ${e.length}`);let n=this.resolve(t.elementType);return B(S`array<${n}, ${t.elementCount}>(${e.map(r=>B(r,t.elementType))})`,t)}if(Array.isArray(e))return B(S`array(${e.map(n=>this.resolve(n))})`,Bt);if(t&&vt(t))return B(S`${this.resolve(t)}(${Object.entries(t.propTypes).map(([n,r])=>B(e[n],r))})`,t);throw new mn(`Value ${e} (as json: ${Xt(e)}) is not resolvable${t?` to type ${t.type}`:""}`)}pushMode(e){this.#n.push(e)}popMode(e){let t=this.#n.pop();e!==void 0&&Qn(t?.type===e)}get mode(){return this.#n[this.#n.length-1]??Cl}};function Yo(e,t){let n=new Oh(t),r=(t.config?n.withSlots(t.config(new hh([])).bindings,()=>n.resolve(e)):n.resolve(e)).value,s=n.bindGroupLayoutsToPlaceholderMap,i=[],p=new Set([...s.keys()].map(U=>U.index).filter(U=>U!==void 0)),y=og(p),v=n.fixedBindings.map((U,R)=>[String(R),U.layoutEntry]),_=()=>{let U=y.next().value,R=bh(Object.fromEntries(v));return i[U]=R,r=r.replaceAll(kh,String(U)),[U,new $h(R,Object.fromEntries(n.fixedBindings.map((j,L)=>[String(L),j.resource])))]},P=v.length>0?_():void 0;for(let[U,R]of s.entries()){let j=U.index??y.next().value;i[j]=U,r=r.replaceAll(R,String(j))}return t.enableExtensions&&t.enableExtensions.length>0&&(r=`${t.enableExtensions.map(U=>`enable ${U};`).join(`
`)}

${r}`),{code:r,usedBindGroupLayouts:i,catchall:P,logResources:n.logResources}}function Wg(e,t,n){let r=t.map(s=>`${s.value}: ${e.resolve(s.dataType).value}`).join(", ");return n.type!=="void"?`(${r}) -> ${Bo(n)}${e.resolve(n).value} `:`(${r}) `}function Vh(e){let t=e;return t?.resourceType==="compute-pipeline"&&!!t[E]}function Gh(e){let t=e;return t?.resourceType==="render-pipeline"&&!!t[E]}function Xg(e){return Gh(e)||Vh(e)}function Dh(e){let{externals:t,shaderGenerator:n,template:r,names:s="random",config:i,enableExtensions:p}=e,y={};Us(y,t??{});let v={[E]:!0,[he](P){return B(Ki(P,y,r??""),at)},toString:()=>"<root>"},_=Object.values(t).filter(Xg);if(_.length>1)throw new Error(`Found ${_.length} pipelines but can only resolve one at a time.`);return Yo(v,{namespace:typeof s=="string"?ri({names:s}):s,enableExtensions:p,shaderGenerator:n,config:i,root:_[0]?.[E].branch})}function Jg(e){return Dh(e).code}function Zg(e){let t=mr()??new Oh({namespace:ri(),shaderGenerator:Dc}),n=[1,1,1],r=[1,1,1],s=[n[0]*r[0],n[1]*r[1],n[2]*r[2]],i=new Map,p=Array.from({length:n[0]},()=>Array.from({length:n[1]},()=>Array.from({length:n[2]},()=>new Map))),y=Array.from({length:s[0]},()=>Array.from({length:s[1]},()=>Array.from({length:s[2]},()=>new Map))),v=Array.from({length:s[0]},(_,P)=>Array.from({length:s[1]},(U,R)=>Array.from({length:s[2]},(j,L)=>{let Z=Math.floor(P/r[0]),Q=Math.floor(R/r[1]),re=Math.floor(L/r[2]);return new Pp(i,{private:y[P][R][L],workgroup:p[Z][Q][re]})})));t.pushMode(v[0][0][0]);try{return{value:Yl(t,e),buffers:i,privateVars:y,workgroupVars:p}}finally{t.popMode("simulate")}}function Hg(e,t,n,r){return new Qg(e,t,n,r)}function Co(e){let t=e;return t?.resourceType==="query-set"&&!!t[E]}var Qg=class{constructor(t,n,r,s){this.type=n,this.count=r,this.rawQuerySet=s,this.#e=t.device,this._ownQuerySet=!s,this._querySet=s||null}resourceType="query-set";#e;_querySet=null;_ownQuerySet;_destroyed=!1;_available=!0;_readBuffer=null;_resolveBuffer=null;get querySet(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");return this.rawQuerySet?this.rawQuerySet:this._querySet?this._querySet:(this._querySet=this.#e.createQuerySet({type:this.type,count:this.count}),this._querySet)}get destroyed(){return this._destroyed}get available(){return this._available}get[E](){let t=this;return{get readBuffer(){return t._readBuffer||(t._readBuffer=t.#e.createBuffer({size:t.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),t._readBuffer},get resolveBuffer(){return t._resolveBuffer||(t._resolveBuffer=t.#e.createBuffer({size:t.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC})),t._resolveBuffer}}}$name(t){return Ne(this,t),this._querySet&&(this._querySet.label=t),this}resolve(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");if(!this._available)throw new Error("This QuerySet is busy resolving or reading.");let t=this.#e.createCommandEncoder();t.resolveQuerySet(this.querySet,0,this.count,this[E].resolveBuffer,0),this.#e.queue.submit([t.finish()])}async read(){if(!this._resolveBuffer)throw new Error("QuerySet must be resolved before reading.");this._available=!1;try{let t=this.#e.createCommandEncoder();t.copyBufferToBuffer(this[E].resolveBuffer,0,this[E].readBuffer,0,this.count*BigUint64Array.BYTES_PER_ELEMENT),this.#e.queue.submit([t.finish()]);let n=this[E].readBuffer;await n.mapAsync(GPUMapMode.READ);let r=new BigUint64Array(n.getMappedRange().slice());return n.unmap(),Array.from(r)}finally{this._available=!0}}destroy(){this._destroyed||(this._destroyed=!0,this._querySet&&this._ownQuerySet&&this._querySet.destroy(),this._readBuffer?.destroy(),this._resolveBuffer?.destroy(),this._readBuffer=this._resolveBuffer=null)}},ku=class{constructor(e){this._make=e}_map=new WeakMap;getOrMake(e,...t){if(this._map.has(e))return this._map.get(e);let n=this._make(e,...t);return this._map.set(e,n),n}},ya=class{constructor(e,t){this.resourceType=e,this.buffer=t,this[st]=t,this.#e=this.buffer.as(this.resourceType)}[E]=!0;[st];#e;$name(e){return Ne(this[st],e),this}write(e){this.buffer.write(e)}writePartial(e){this.buffer.writePartial(e)}read(){return this.buffer.read()}get[Re](){return this.#e.$}get $(){return this.#e.$}get value(){return this.$}[he](e){return e.resolve(this.#e)}},fe=e=>Zc(e??0),On=e=>Hc(e??0),ts=e=>Qc(e??0),Kg={f32:e=>fe(e[0]),f16:e=>ts(e[0]).x,i32:e=>On(e[0]),u32:e=>e[0]??0,bool:e=>!!e[0],vec2f:e=>F(fe(e[0]),fe(e[1])),vec3f:e=>O(fe(e[0]),fe(e[1]),fe(e[2])),vec4f:e=>k(fe(e[0]),fe(e[1]),fe(e[2]),fe(e[3])),vec2h(e){let t=ts(e[0]);return Pn(t.x,t.y)},vec3h(e){let t=ts(e[0]),n=ts(e[1]);return Un(t.x,t.y,n.x)},vec4h(e){let t=ts(e[0]),n=ts(e[1]);return An(t.x,t.y,n.x,n.y)},vec2i:e=>Be(On(e[0]),On(e[1])),vec3i:e=>kt(On(e[0]),On(e[1]),On(e[2])),vec4i:e=>Fe(On(e[0]),On(e[1]),On(e[2]),On(e[3])),vec2u:e=>xt(e[0]??0,e[1]??0),vec3u:e=>rt(e[0]??0,e[1]??0,e[2]??0),vec4u:e=>Ye(e[0]??0,e[1]??0,e[2]??0,e[3]??0),"vec2<bool>":e=>xr(!!e[0],!!e[1]),"vec3<bool>":e=>vr(!!e[0],!!e[1],!!e[2]),"vec4<bool>":e=>br(!!e[0],!!e[1],!!e[2],!!e[3]),mat2x2f:e=>wn(fe(e[0]),fe(e[1]),fe(e[2]),fe(e[3])),mat3x3f:e=>In(fe(e[0]),fe(e[1]),fe(e[2]),fe(e[4]),fe(e[5]),fe(e[6]),fe(e[8]),fe(e[9]),fe(e[10])),mat4x4f:e=>we(fe(e[0]),fe(e[1]),fe(e[2]),fe(e[3]),fe(e[4]),fe(e[5]),fe(e[6]),fe(e[7]),fe(e[8]),fe(e[9]),fe(e[10]),fe(e[11]),fe(e[12]),fe(e[13]),fe(e[14]),fe(e[15]))};function ew(e,t){let n=Kg[t.type];if(n)return n(e);if(vt(t)){let r=Object.keys(t.propTypes),s=Object.values(t.propTypes),i=Xa(e,s);return Object.fromEntries(r.map((p,y)=>[p,i[y]]))}if(Ft(t)){let r=t.elementType,s=t.elementCount;return Xa(e,Array.from({length:s},()=>r))}throw new Error(`Cannot deserialize data of type ${t.type}`)}function Xa(e,t){let n=0;return t.map(r=>{if(!Mt(r))return r;let s=Math.ceil(_e(r)/4),i=ew(e.subarray(n,n+s),r);return n+=s,i})}function tw(e,t){return Xa(e,t).map(ka)}function Ja(e){let{indexBuffer:t,dataBuffer:n,logIdToMeta:r,options:s}=e;n.read().then(i=>{i.filter(p=>p.id).forEach(({id:p,serializedData:y})=>{let{argTypes:v,op:_}=r.get(p),P=tw(new Uint32Array(y),v);P.length===0&&P.push(""),console[_](`%c${s.messagePrefix}%c ${P[0]}`,"background: #936ff5; color: white;","color: inherit; background: none",...P.slice(1))})}),t.read().then(i=>{i>s.logCountLimit&&console.warn(`Log count limit per dispatch (${s.logCountLimit}) exceeded by ${i-s.logCountLimit} calls. Consider increasing the limit by passing appropriate options to tgpu.init().`)}),n.buffer.clear(),t.buffer.clear()}function Rh(e,t,n){if(!n.enabledFeatures.has("timestamp-query"))throw new Error('Performance callback requires the "timestamp-query" feature to be enabled on GPU device.');return e.timestampWrites?{...e,performanceCallback:t}:{...e,performanceCallback:t,hasAutoQuerySet:!0,timestampWrites:{querySet:(globalThis.__TYPEGPU_AUTONAME__??(r=>r))(n.createQuerySet("timestamp",2),"querySet"),beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}}function Nh(e,t,n){if(!n.enabledFeatures.has("timestamp-query"))throw new Error('Timestamp writes require the "timestamp-query" feature to be enabled on GPU device.');e.hasAutoQuerySet&&e.timestampWrites&&e.timestampWrites.querySet.destroy();let r={querySet:t.querySet};return t.beginningOfPassWriteIndex!==void 0&&(r.beginningOfPassWriteIndex=t.beginningOfPassWriteIndex),t.endOfPassWriteIndex!==void 0&&(r.endOfPassWriteIndex=t.endOfPassWriteIndex),{...e,hasAutoQuerySet:!1,timestampWrites:r}}function Fh(e,t){if(!e.timestampWrites)return{};let{querySet:n,beginningOfPassWriteIndex:r,endOfPassWriteIndex:s}=e.timestampWrites,i={querySet:Co(n)?t.unwrap(n):n};return r!==void 0&&(i.beginningOfPassWriteIndex=r),s!==void 0&&(i.endOfPassWriteIndex=s),{timestampWrites:i}}function Za({root:e,priors:t}){let n=t.timestampWrites?.querySet,r=t.performanceCallback;if(!n)throw new Error("Cannot dispatch workgroups with performance callback without a query set.");if(!Co(n))throw new Error("Performance callback with raw GPUQuerySet is not supported. Use TgpuQuerySet instead.");let s=e.device.createCommandEncoder();s.resolveQuerySet(e.unwrap(n),0,n.count,n[E].resolveBuffer,0),e.device.queue.submit([s.finish()]),e.device.queue.onSubmittedWorkDone().then(async()=>{if(!n.available)return;let i=await n.read(),p=i[t.timestampWrites?.beginningOfPassWriteIndex??0],y=i[t.timestampWrites?.endOfPassWriteIndex??1];if(p===void 0||y===void 0)throw new Error("QuerySet did not return valid timestamps.");await r(p,y)})}function nw(e,t,n){return new rw(new sw(e,t,n),{})}var rw=class Ms{constructor(t,n){this._core=t,this._priors=n,this[E]={get rawPipeline(){return t.unwrap().pipeline},get priors(){return n},get branch(){return t.branch}},this[st]=t}[E];resourceType="compute-pipeline";[st];[he](t){return t.resolve(this._core)}toString(){return`computePipeline:${W(this)??"<unnamed>"}`}get rawPipeline(){return this._core.unwrap().pipeline}with(t,n){return Li(t)?new Ms(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t.layout,t]])}):new Ms(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t,n]])})}withPerformanceCallback(t){let n=Rh(this._priors,t,this._core.branch);return new Ms(this._core,n)}withTimestampWrites(t){let n=Nh(this._priors,t,this._core.branch);return new Ms(this._core,n)}dispatchWorkgroups(t,n,r){let s=this._core.unwrap(),{branch:i}=this._core,p={label:W(this._core)??"<unnamed>",...Fh(this._priors,i)},y=i.device.createCommandEncoder(),v=y.beginComputePass(p);v.setPipeline(s.pipeline);let _=new Set(s.usedBindGroupLayouts);if(s.usedBindGroupLayouts.forEach((P,U)=>{if(s.catchall&&U===s.catchall[0])v.setBindGroup(U,i.unwrap(s.catchall[1])),_.delete(P);else{let R=this._priors.bindGroupLayoutMap?.get(P);R!==void 0&&(_.delete(P),v.setBindGroup(U,i.unwrap(R)))}}),_.size>0)throw new ho(_);v.dispatchWorkgroups(t,n,r),v.end(),i.device.queue.submit([y.finish()]),s.logResources&&Ja(s.logResources),this._priors.performanceCallback&&Za({root:i,priors:this._priors})}$name(t){return Ne(this._core,t),this}},sw=class{constructor(t,n,r){this.branch=t,this._slotBindings=n,this._entryFn=r}[E]=!0;_memo;[he](t){return t.withSlots(this._slotBindings,()=>(t.resolve(this._entryFn),B("",at)))}toString(){return"computePipelineCore"}unwrap(){if(this._memo===void 0){let t=this.branch.device,n=Lo.filter(P=>this.branch.enabledFeatures.has(nh[P])),r,s=ri({names:this.branch.nameRegistrySetting});r=Yo(this,{namespace:s,enableExtensions:n,shaderGenerator:this.branch.shaderGenerator,root:this.branch});let{code:i,usedBindGroupLayouts:p,catchall:y,logResources:v}=r;y!==void 0&&p[y[0]]?.$name(`${W(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let _=t.createShaderModule({label:`${W(this)??"<unnamed>"} - Shader`,code:i});this._memo={pipeline:t.createComputePipeline({label:W(this)??"<unnamed>",layout:t.createPipelineLayout({label:`${W(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:p.map(P=>this.branch.unwrap(P))}),compute:{module:_}}),usedBindGroupLayouts:p,catchall:y,logResources:v}}return this._memo}};function Ou(e,t="vertex"){return new iw(e,t)}function Lh(e){return e?.resourceType==="vertex-layout"}var Ha=Symbol("defaultAttribEntry");function Ei(e,t,n,r,s){if(Mn(t)||En(t)){let i=fr(t);return i!==void 0&&(r[s??Ha]=i),Ei(e,t.inner,nn(n,gn(t)),r)}if(vt(t)){let i=n,p=t.propTypes;return Object.fromEntries(Object.entries(p).map(([y,v])=>{i=nn(i,tt(v));let _=[y,Ei(e,v,i,r,y)];return i+=_e(v),_}))}if(zn(t)){let i=n,p=t.propTypes;return Object.fromEntries(Object.entries(p).map(([y,v])=>{i=nn(i,gn(v));let _=[y,Ei(e,v,i,r,y)];return i+=_e(v),_}))}if("type"in t&&typeof t.type=="string"){if(Al.includes(t.type))return{_layout:e,format:t.type,offset:n};let i=bp[t.type];if(i)return{_layout:e,format:i,offset:n}}throw new Error(`Unsupported data used in vertex layout: ${String(t)}`)}var iw=class{constructor(t,n){this.schemaForCount=t,this.stepMode=n;let r=t(0);this.stride=nn(_e(r.elementType),tt(r)),this.attrib=Ei(this,r.elementType,0,this._customLocationMap)}[E]=!0;resourceType="vertex-layout";stride;attrib;_customLocationMap={};get vertexLayout(){if(this._customLocationMap[Ha]!==void 0){if(typeof this.attrib.format!="string"||typeof this.attrib.offset!="number")throw new Error("Single attribute vertex layouts must have a format and offset.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[{format:this.attrib.format,offset:this.attrib.offset,shaderLocation:this._customLocationMap[Ha]}]}}if(!Object.keys(this.attrib).every(t=>this._customLocationMap[t]!==void 0))throw new Error("All attributes must have custom locations in order to unwrap a vertex layout.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[...Object.entries(this.attrib).map(([t,n])=>({format:n.format,offset:n.offset,shaderLocation:this._customLocationMap[t]}))]}}$name(t){return Ne(this,t),this}};function aw(e){return typeof e?.loadOp=="string"}function ow(e,t){if(Vr(e)){if(!aw(t))throw new Error("Expected a single color attachment, not a record.");return[t]}let n=[];for(let r of Object.keys(e)){let s=e[r];if(Dr(s))continue;let i=t[r];if(!i)throw new Error(`A color attachment by the name of '${r}' was not provided to the shader.`);n.push(i)}return n}function uw(e){return typeof e?.format=="string"}function lw(e,t){if(Vr(e)){if(Pl(e))return[];if(!uw(t))throw new Error("Expected a single color target configuration, not a record.");return[t]}let n=[];for(let r of Object.keys(e)){let s=e[r];if(Dr(s))continue;let i=t[r];if(!i)throw new Error(`A color target by the name of '${r}' was not provided to the shader.`);n.push(i)}return n}function jh(e){return new cw(new hw(e),{})}var cw=class Dn{[E];resourceType="render-pipeline";[st];hasIndexBuffer=!1;constructor(t,n){this[E]={core:t,priors:n,branch:t.options.branch},this[st]=t}[he](t){return t.resolve(this[E].core)}toString(){return`renderPipeline:${W(this)??"<unnamed>"}`}$name(t){return Ne(this[E].core,t),this}with(t,n){let r=this[E];if(Li(t))return new Dn(r.core,{...r.priors,bindGroupLayoutMap:new Map([...r.priors.bindGroupLayoutMap??[],[t.layout,t]])});if(Th(t))return new Dn(r.core,{...r.priors,bindGroupLayoutMap:new Map([...r.priors.bindGroupLayoutMap??[],[t,n]])});if(Lh(t))return new Dn(r.core,{...r.priors,vertexLayoutMap:new Map([...r.priors.vertexLayoutMap??[],[t,n]])});throw new Error("Unsupported value passed into .with()")}withPerformanceCallback(t){let n=this[E],r=Rh(n.priors,t,n.core.options.branch);return new Dn(n.core,r)}withTimestampWrites(t){let n=this[E],r=Nh(n.priors,t,n.core.options.branch);return new Dn(n.core,r)}withColorAttachment(t){let n=this[E];return new Dn(n.core,{...n.priors,colorAttachment:t})}withDepthStencilAttachment(t){let n=this[E];return new Dn(n.core,{...n.priors,depthStencilAttachment:t})}withIndexBuffer(t,n,r,s){let i=this[E];if(Ia(t)){if(typeof n!="string")throw new Error("If a GPUBuffer is passed, indexFormat must be provided.");return new Dn(i.core,{...i.priors,indexBuffer:{buffer:t,indexFormat:n,offsetBytes:r,sizeBytes:s}})}let p={u32:"uint32",u16:"uint16"},y=t.dataType.elementType;return new Dn(i.core,{...i.priors,indexBuffer:{buffer:t,indexFormat:p[y.type],offsetBytes:n!==void 0?n*_e(y):void 0,sizeBytes:s!==void 0?s*_e(y):void 0}})}setupRenderPass(t){let n=this[E],r=n.core.unwrap(),{branch:s,fragmentFn:i}=n.core.options,p=i?ow(i.shell.out,n.priors.colorAttachment??{}).map(U=>Ys(U.view)?{...U,view:s.unwrap(U.view).createView()}:Fi(U.view)?{...U,view:s.unwrap(U.view)}:U):[null],y={label:W(n.core)??"<unnamed>",colorAttachments:p,...Fh(n.priors,s)};if(n.priors.depthStencilAttachment!==void 0){let U=n.priors.depthStencilAttachment;Ys(U.view)?y.depthStencilAttachment={...U,view:s.unwrap(U.view).createView()}:y.depthStencilAttachment=U}let v=t.beginRenderPass(y);v.setPipeline(r.pipeline);let _=new Set(r.usedBindGroupLayouts);r.usedBindGroupLayouts.forEach((U,R)=>{if(r.catchall&&R===r.catchall[0])v.setBindGroup(R,s.unwrap(r.catchall[1])),_.delete(U);else{let j=n.priors.bindGroupLayoutMap?.get(U);j!==void 0&&(_.delete(U),v.setBindGroup(R,s.unwrap(j)))}});let P=new Set(n.core.usedVertexLayouts);if(n.core.usedVertexLayouts.forEach((U,R)=>{let j=n.priors.vertexLayoutMap?.get(U);j&&(P.delete(U),v.setVertexBuffer(R,s.unwrap(j)))}),_.size>0)throw new ho(_);if(P.size>0)throw new Vl(P);return v}draw(t,n,r,s){let i=this[E],{branch:p}=i.core.options,{logResources:y}=i.core.unwrap(),v=p.device.createCommandEncoder(),_=this.setupRenderPass(v);_.draw(t,n,r,s),_.end(),p.device.queue.submit([v.finish()]),y&&Ja(y),i.priors.performanceCallback&&Za({root:p,priors:i.priors})}drawIndexed(t,n,r,s,i){let p=this[E];if(!p.priors.indexBuffer)throw new Error("No index buffer set for this render pipeline.");let{logResources:y}=p.core.unwrap(),{branch:v}=p.core.options,{buffer:_,indexFormat:P,offsetBytes:U,sizeBytes:R}=p.priors.indexBuffer,j=v.device.createCommandEncoder(),L=this.setupRenderPass(j);Ia(_)?L.setIndexBuffer(_,P,U,R):L.setIndexBuffer(v.unwrap(_),P,U,R),L.drawIndexed(t,n,r,s,i),L.end(),v.device.queue.submit([j.finish()]),y&&Ja(y),p.priors.performanceCallback&&Za({root:v,priors:p.priors})}},hw=class{constructor(t){this.options=t;let n=eg(t.vertexFn.shell.in??{},t.vertexAttribs);this._vertexBufferLayouts=n.bufferDefinitions,this.usedVertexLayouts=n.usedVertexLayouts,this._targets=t.fragmentFn&&t.targets?lw(t.fragmentFn.shell.out,t.targets):[null]}[E]=!0;usedVertexLayouts;_memo;_vertexBufferLayouts;_targets;[he](t){let{vertexFn:n,fragmentFn:r,slotBindings:s}=this.options,i=pw(n.shell.out,r?.shell.in,W(n)??"<unnamed>",W(r)??"<unnamed>");return t.withVaryingLocations(i,()=>t.withSlots(s,()=>(t.resolve(n),r&&t.resolve(r),B("",at))))}toString(){return"renderPipelineCore"}unwrap(){if(this._memo===void 0){let{branch:t,primitiveState:n,depthStencilState:r,multisampleState:s}=this.options,i=t.device,p=Lo.filter(Q=>t.enabledFeatures.has(nh[Q])),y,v=ri({names:t.nameRegistrySetting});y=Yo(this,{namespace:v,enableExtensions:p,shaderGenerator:t.shaderGenerator,root:t});let{code:_,usedBindGroupLayouts:P,catchall:U,logResources:R}=y;U!==void 0&&P[U[0]]?.$name(`${W(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let j=i.createShaderModule({label:`${W(this)??"<unnamed>"} - Shader`,code:_}),L={layout:i.createPipelineLayout({label:`${W(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:P.map(Q=>t.unwrap(Q))}),vertex:{module:j,buffers:this._vertexBufferLayouts}},Z=W(this);Z!==void 0&&(L.label=Z),this.options.fragmentFn&&(L.fragment={module:j,targets:this._targets}),n&&(Mt(n.stripIndexFormat)?L.primitive={...n,stripIndexFormat:{u32:"uint32",u16:"uint16"}[n.stripIndexFormat.type]}:L.primitive=n),r&&(L.depthStencil=r),s&&(L.multisample=s),this._memo={pipeline:i.createRenderPipeline(L),usedBindGroupLayouts:P,catchall:U,logResources:R}}return this._memo}};function pw(e,t,n,r){let s={},i=new Set;function p(v,_){s[v]=_,i.add(_)}for(let[v,_]of Object.entries(e)){let P=fr(_);P!==void 0&&p(v,P)}for(let[v,_]of Object.entries(t??{})){let P=fr(_);P!==void 0&&(s[v]===void 0?p(v,P):s[v]!==P&&console.warn(`Mismatched location between vertexFn (${n}) output (${s[v]}) and fragmentFn (${r}) input (${P}) for the key "${v}", using the location set on vertex output.`))}let y=0;for(let v of Object.keys(e??{}))if(!(Dr(e[v])||s[v]!==void 0)){for(;i.has(y);)y++;p(v,y)}return s}function dw(e){if(e.includes(0))throw new Error("Size and workgroupSize cannot contain zeroes.");return rt(e[0]??1,e[1]??1,e[2]??1)}var fw=[rt(1,1,1),rt(256,1,1),rt(16,16,1),rt(8,8,4)],mw=class Yh{#e;#t;#n;#r;#s;constructor(t,n,r,s){this.#e=t,this.#t=n,this.#n=r,this.#r=s,this.#s=rt()}with(t){return new Yh(this.#e,this.#t.with(t),this.#n,this.#r)}dispatchThreads(...t){let n=dw(t),r=Ic(O(n).div(O(this.#r)));Kc(n,this.#s)||(this.#s=n,this.#n.write(n)),this.#t.dispatchWorkgroups(r.x,r.y,r.z)}get pipeline(){return this.#t}get sizeUniform(){return this.#n}},yw=class Qa{constructor(t,n){this._getRoot=t,this._slotBindings=n}with(t,n){return new Qa(this._getRoot,[...this._slotBindings,[Qi(t)?t.slot:t,n]])}withCompute(t){return new gw(this._getRoot(),this._slotBindings,t)}createGuardedComputePipeline(t){let n=this._getRoot();if(t.length>=4)throw new Error("Guarded compute callback only supports up to three dimensions.");let r=fw[t.length],s=Ve([J,J,J])(t),i=(globalThis.__TYPEGPU_AUTONAME__??(v=>v))(n.createUniform(rt),"o"),p=rh({workgroupSize:r,in:{id:Rs.globalInvocationId}})`{
  if (any(in.id >= sizeUniform)) {
    return;
  }
  wrappedCallback(in.id.x, in.id.y, in.id.z);
}`.$uses({sizeUniform:i,wrappedCallback:s}),y=(globalThis.__TYPEGPU_AUTONAME__??(v=>v))(this.withCompute(p).createPipeline(),"i");return new mw(n,y,i,r)}withVertex(t,n){return new ww({branch:this._getRoot(),primitiveState:void 0,depthStencilState:void 0,slotBindings:this._slotBindings,vertexFn:t,vertexAttribs:n,multisampleState:void 0})}pipe(t){let n=t(new hh([]));return new Qa(this._getRoot,[...this._slotBindings,...n.bindings])}},gw=class{constructor(e,t,n){this._root=e,this._slotBindings=t,this._entryFn=n}createPipeline(){return nw(this._root,this._slotBindings,this._entryFn)}},ww=class Si{constructor(t){this._options=t}withFragment(t,n,r){return Qn(typeof t!="string"),Qn(typeof n!="string"),new xw({...this._options,fragmentFn:t,targets:n})}withPrimitive(t){return new Si({...this._options,primitiveState:t})}withDepthStencil(t){return new Si({...this._options,depthStencilState:t})}withMultisample(t){return new Si({...this._options,multisampleState:t})}createPipeline(){return jh({...this._options,fragmentFn:null,targets:null})}},xw=class Pi{constructor(t){this._options=t}withPrimitive(t){return new Pi({...this._options,primitiveState:t})}withDepthStencil(t){return new Pi({...this._options,depthStencilState:t})}withMultisample(t){return new Pi({...this._options,multisampleState:t})}createPipeline(){return jh(this._options)}},Ch=class extends yw{constructor(t,n,r,s,i){super(()=>this,[]),this.device=t,this.nameRegistrySetting=n,this._ownDevice=r,this.shaderGenerator=i,this["~unstable"]=this,this[E]={logOptions:s}}"~unstable";_unwrappedBindGroupLayouts=new ku(t=>t.unwrap(this));_unwrappedBindGroups=new ku(t=>t.unwrap(this));[E];get enabledFeatures(){return new Set(this.device.features)}createBuffer(t,n){return xi(this,t,n)}createUniform(t,n){let r=xi(this,t,n).$usage("uniform");return new ya("uniform",r)}createMutable(t,n){let r=xi(this,t,n).$usage("storage");return new ya("mutable",r)}createReadonly(t,n){let r=xi(this,t,n).$usage("storage");return new ya("readonly",r)}createQuerySet(t,n,r){return Hg(this,t,n,r)}createBindGroup(t,n){return new $h(t,n)}destroy(){_g(this.device),this._ownDevice&&this.device.destroy()}createTexture(t){return Ug(t,this)}createSampler(t){return xg(t,this)}createComparisonSampler(t){return vg(t,this)}unwrap(t){if(Vh(t))return t[E].rawPipeline;if(Gh(t))return t[E].core.unwrap().pipeline;if(Th(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(Li(t))return this._unwrappedBindGroups.getOrMake(t);if(Os(t))return t.buffer;if(Ys(t))return t[E].unwrap();if(Fi(t)){if(!t[E].unwrap)throw new Error("Cannot unwrap laid-out texture view as it has no underlying resource.");return t[E].unwrap()}if(Lh(t))return t.vertexLayout;if(yh(t)||gh(t)){if(t[E].unwrap)return t[E].unwrap();throw new Error("Cannot unwrap laid-out sampler.")}if(Co(t))return t.querySet;throw new Error(`Unknown resource type: ${t}`)}beginRenderPass(t,n){let r=this.device.createCommandEncoder(),s=r.beginRenderPass(t),i=new Map,p=new Map,y,v=()=>{if(!y)throw new Error("Cannot draw without a call to pass.setPipeline");let{core:_,priors:P}=y[E],U=_.unwrap();s.setPipeline(U.pipeline);let R=new Set(U.usedBindGroupLayouts);U.usedBindGroupLayouts.forEach((L,Z)=>{if(U.catchall&&Z===U.catchall[0])s.setBindGroup(Z,this.unwrap(U.catchall[1])),R.delete(L);else{let Q=P.bindGroupLayoutMap?.get(L)??i.get(L);Q!==void 0&&(R.delete(L),Li(Q)?s.setBindGroup(Z,this.unwrap(Q)):s.setBindGroup(Z,Q))}});let j=new Set;if(_.usedVertexLayouts.forEach((L,Z)=>{let Q=P.vertexLayoutMap?.get(L),re=Q?{buffer:Q,offset:void 0,size:void 0}:p.get(L);!re||!re.buffer?j.add(L):Os(re.buffer)?s.setVertexBuffer(Z,this.unwrap(re.buffer),re.offset,re.size):s.setVertexBuffer(Z,re.buffer,re.offset,re.size)}),R.size>0)throw new ho(R);if(j.size>0)throw new Vl(j)};n({setViewport(..._){s.setViewport(..._)},setScissorRect(..._){s.setScissorRect(..._)},setBlendConstant(..._){s.setBlendConstant(..._)},setStencilReference(..._){s.setStencilReference(..._)},beginOcclusionQuery(..._){s.beginOcclusionQuery(..._)},endOcclusionQuery(..._){s.endOcclusionQuery(..._)},executeBundles(..._){s.executeBundles(..._)},setPipeline(_){y=_},setIndexBuffer:(_,P,U,R)=>{Os(_)?s.setIndexBuffer(this.unwrap(_),P,U,R):s.setIndexBuffer(_,P,U,R)},setVertexBuffer(_,P,U,R){p.set(_,{buffer:P,offset:U,size:R})},setBindGroup(_,P){i.set(_,P)},draw(_,P,U,R){v(),s.draw(_,P,U,R)},drawIndexed(..._){v(),s.drawIndexed(..._)},drawIndirect(..._){v(),s.drawIndirect(..._)},drawIndexedIndirect(..._){v(),s.drawIndexedIndirect(..._)}}),s.end(),this.device.queue.submit([r.finish()])}flush(){console.warn("flush() has been deprecated, and has no effect.")}};async function vw(e){let{adapter:t,device:n,unstable_names:r="random",unstable_logOptions:s}=e??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let i=await navigator.gpu.requestAdapter(t);if(!i)throw new Error("Could not find a compatible GPU");let p=[];for(let v of n?.requiredFeatures??[]){if(!i.features.has(v))throw new Error(`Requested feature "${v}" is not supported by the adapter.`);p.push(v)}for(let v of n?.optionalFeatures??[])i.features.has(v)?p.push(v):console.warn(`Optional feature "${v}" is not supported by the adapter.`);let y=await i.requestDevice({...n,requiredFeatures:p});return new Ch(y,r,!0,s??{},e?.shaderGenerator)}function bw(e){let{device:t,unstable_names:n="random",unstable_logOptions:r}=e??{};return new Ch(t,n,!1,r??{},e?.shaderGenerator)}function Tw(e,t){return new _w(e,t)}var _w=class{constructor(e,t=void 0){this.schema=e,this.defaultValue=t,this.slot=ji(t),this[st]=this.slot}[E]=!0;[st];resourceType="accessor";slot;get[Re](){return new Proxy({[E]:!0,[Wt]:this.#e(),[he]:e=>e.resolve(this),toString:()=>`accessor:${W(this)??"<unnamed>"}.$`},kn)}#e(){let e=mr(),t=aa(e.unwrap(this.slot));return sh(t)?t[E].gpuImpl():B(t,this.schema)}$name(e){return this.slot.$name(e),this}toString(){return`accessor:${W(this)??"<unnamed>"}`}get value(){if(Bn())return this[Re];throw new Error("`tgpu.accessor` relies on GPU resources and cannot be accessed outside of a compute dispatch or draw call")}get $(){return this.value}[he](e){let t=this.#e();return B(e.resolve(t.value,t.dataType).value,t.dataType)}};function $w(e){return zw(e)}function Mw([e,t]){return`${W(e)??"<unnamed>"}=${t}`}function zw(e){if(mr())throw new Error("Cannot create tgpu.derived objects at the resolution stage.");return{[E]:!0,resourceType:"derived","~compute":e,get[Re](){let t=mr();if(!t)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return aa(t.unwrap(this))},get value(){return this[Re]},get $(){return this.value},with(t,n){return qh(this,[[t,n]])},toString(){return"derived"}}}function qh(e,t){return{[E]:!0,resourceType:"derived","~compute"(){throw new Error("'~compute' should never be read on bound derived items.")},[Pr]:{inner:e,pairs:t},get[Re](){let n=mr();if(!n)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return aa(n.unwrap(this))},get value(){return this[Re]},get $(){return this.value},with(n,r){return qh(e,[...t,[n,r]])},toString(){return`derived[${t.map(Mw).join(", ")}]`}}}var Ew={fn:Ve,bindGroupLayout:bh,vertexLayout:Ou,slot:ji,init:vw,initFromDevice:bw,resolve:Jg,resolveWithContext:Dh,privateVar:Yi,workgroupVar:Bu,const:Ga,"~unstable":{fn:Ve,fragmentFn:qy,vertexFn:fc,computeFn:rh,vertexLayout:Ou,namespace:ri,derived:$w,slot:ji,accessor:Tw,privateVar:Yi,workgroupVar:Bu,const:Ga,declare:Fy,simulate:Zg}},H=Ew;function Wh(e){return ws("function",e,"read-write")}function Sw(e){return ws("private",e,"read-write")}function Pw(e){return ws("workgroup",e,"read-write")}function Uw(e,t="read"){return ws("storage",e,t)}function Aw(e){return ws("uniform",e,"read")}function Iw(e){return ws("handle",e,"read")}function ws(e,t,n){return{[E]:!0,type:"ptr",addressSpace:e,inner:t,access:n}}var Xh=ce(((e,t)=>t===void 0?n=>ga(e,n):ga(e,t)),(e,t)=>{if(t===void 0||t.value===void 0){let n=r=>Xh[E].gpuImpl(e,r);return n[E]=!0,B(n,Bt)}if(typeof t.value!="number")throw new Error(`Cannot create disarray schema with count unknown at compile-time: '${t.value}'`);return B(ga(e.value,t.value),e.value)},"disarrayOf");function ga(e,t){let n=r=>{if(r&&r.length!==t)throw new Error(`Disarray schema of ${t} elements of type ${e.type} called with ${r.length} argument(s).`);return Array.from({length:t},(s,i)=>Ir(e,r?.[i]))};if(Object.setPrototypeOf(n,Bw),n.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create disarray schema with invalid element count: ${t}.`);return n.elementCount=t,n}var Bw={[E]:!0,type:"disarray",toString(){return`disarrayOf(${this.elementType}, ${this.elementCount})`}};function kw(e){let t=n=>Object.fromEntries(Object.entries(e).map(([r,s])=>[r,Ir(s,n?.[r])]));return Object.setPrototypeOf(t,Ow),t.propTypes=e,t}var Ow={[E]:!0,type:"unstruct",$name(e){return Ne(this,e),this},toString(){return`unstruct:${W(this)??"<unnamed>"}`}};function rs(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(vt(e)&&vt(t)||zn(e)&&zn(t)){let n=e.propTypes,r=t.propTypes,s=Object.keys(n),i=Object.keys(r);if(s.length!==i.length)return!1;for(let p=0;p<s.length;p++){let y=s[p],v=i[p];if(y!==v||!y||!v||!rs(n[y],r[v]))return!1}return!0}if(Ft(e)&&Ft(t)||rr(e)&&rr(t))return e.elementCount===t.elementCount&&rs(e.elementType,t.elementType);if(Ar(e)&&Ar(t))return e.addressSpace===t.addressSpace&&e.access===t.access&&rs(e.inner,t.inner);if(Ii(e)&&Ii(t))return rs(e.inner,t.inner);if(Mn(e)&&Mn(t)||En(e)&&En(t)){if(!rs(e.inner,t.inner)||e.attribs.length!==t.attribs.length)return!1;let n=i=>{let p=i;return`${p.type}(${(p.params??[]).join(",")})`},r=e.attribs.map(n),s=t.attribs.map(n);for(let i=0;i<r.length;i++)if(r[i]!==s[i])return!1}return!0}function Nr(e,t){let n=e.prototype,r=ja[t][E].jsImpl;n[t]=function(s){return r(this,s)}}Nr(Gr,"add");Nr(Gr,"sub");Nr(Gr,"mul");Nr(Gr,"div");Nr(ms,"add");Nr(ms,"sub");Nr(ms,"mul");const ve=Object.freeze(Object.defineProperty({__proto__:null,Void:at,align:Yd,alignmentOf:Dd,arrayOf:Yn,atomic:Pc,bool:ke,builtin:Rs,comparisonSampler:Vo,deepEqual:rs,disarrayOf:Xh,f16:ut,f32:$,float16:wd,float16x2:xd,float16x4:vd,float32:bd,float32x2:Td,float32x3:_d,float32x4:$d,formatToWGSLType:sr,i32:Ue,interpolate:qd,invariant:Wd,isAlignAttrib:oo,isAtomic:Ii,isBuiltin:Dr,isBuiltinAttrib:lo,isData:Vr,isDecorated:Mn,isDisarray:rr,isInterpolateAttrib:xp,isLocationAttrib:Sl,isLooseData:ds,isLooseDecorated:En,isPackedData:uc,isPtr:Ar,isSizeAttrib:uo,isUnstruct:zn,isWgslArray:Ft,isWgslData:Mt,isWgslStruct:vt,location:Gi,mat2x2f:wn,mat3x3f:In,mat4x4f:we,matToArray:bf,packedFormats:Io,ptrFn:Wh,ptrHandle:Iw,ptrPrivate:Sw,ptrStorage:Uw,ptrUniform:Aw,ptrWorkgroup:Pw,sampler:Oo,sint16:ld,sint16x2:cd,sint16x4:hd,sint32:Pd,sint32x2:Ud,sint32x3:Ad,sint32x4:Id,sint8:Hp,sint8x2:Qp,sint8x4:Kp,size:Cd,sizeOf:jd,snorm16:md,snorm16x2:yd,snorm16x4:gd,snorm8:rd,snorm8x2:sd,snorm8x4:id,struct:Cn,texture1d:wc,texture2d:cs,texture2dArray:vc,texture3d:_c,textureCube:bc,textureCubeArray:Tc,textureDepth2d:Pf,textureDepth2dArray:Af,textureDepthCube:If,textureDepthCubeArray:Bf,textureDepthMultisampled2d:Uf,textureExternal:Ec,textureMultisampled2d:xc,textureStorage1d:$c,textureStorage2d:ti,textureStorage2dArray:Mc,textureStorage3d:zc,u16:Np,u32:J,uint16:ad,uint16x2:od,uint16x4:ud,uint32:Md,uint32x2:zd,uint32x3:Ed,uint32x4:Sd,uint8:Xp,uint8x2:Jp,uint8x4:Zp,unorm10_10_10_2:Bd,unorm16:pd,unorm16x2:dd,unorm16x4:fd,unorm8:ed,unorm8x2:td,unorm8x4:nd,unorm8x4_bgra:kd,unstruct:kw,vec2b:xr,vec2f:F,vec2h:Pn,vec2i:Be,vec2u:xt,vec3b:vr,vec3f:O,vec3h:Un,vec3i:kt,vec3u:rt,vec4b:br,vec4f:k,vec4h:An,vec4i:Fe,vec4u:Ye},Symbol.toStringTag,{value:"Module"}));var Vw=ce(()=>{throw new Error("`discard` relies on GPU resources and cannot be executed outside of a draw call")},()=>B("discard;",at),"discard"),si=xe[E].jsImpl,Gw=ta[E].jsImpl,Dw=ta[E].gpuImpl,Rw=na[E].jsImpl,Nw=na[E].gpuImpl,Fw=ra[E].jsImpl,Lw=ra[E].gpuImpl,jw=sa[E].jsImpl,Yw=sa[E].gpuImpl,Cw=ia[E].jsImpl,qw=ia[E].gpuImpl,Ww=ce((e,t)=>si(Gw(t),e),(e,t)=>B(S`(${Dw(t)} * ${e})`,e.dataType),"translate4"),Xw=ce((e,t)=>si(Rw(t),e),(e,t)=>B(S`(${Nw(t)} * ${e})`,e.dataType),"scale4"),Jw=ce((e,t)=>si(Fw(t),e),(e,t)=>B(S`(${Lw(t)} * ${e})`,e.dataType),"rotateX4"),Zw=ce((e,t)=>si(jw(t),e),(e,t)=>B(S`(${Yw(t)} * ${e})`,e.dataType),"rotateY4"),Hw=ce((e,t)=>si(Cw(t),e),(e,t)=>B(S`(${qw(t)} * ${e})`,e.dataType),"rotateZ4"),Qw=ce(()=>console.warn("workgroupBarrier is a no-op outside of CODEGEN mode."),()=>B("workgroupBarrier()",at),"workgroupBarrier"),Kw=ce(()=>console.warn("storageBarrier is a no-op outside of CODEGEN mode."),()=>B("storageBarrier()",at),"storageBarrier"),e0=ce(()=>console.warn("textureBarrier is a no-op outside of CODEGEN mode."),()=>B("textureBarrier()",at),"textureBarrier"),t0=ce(e=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},e=>{if(Mt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicLoad(&${e})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`)},"atomicLoad"),n0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(!Mt(e.dataType)||e.dataType.type!=="atomic")throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`);return B(S`atomicStore(&${e}, ${t})`,at)},"atomicStore"),Fr=(e,t)=>e.dataType.type==="atomic"&&e.dataType.inner.type==="i32"?[e.dataType,Ue]:[e.dataType,J],r0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(Mt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicAdd(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`)},"atomicAdd",Fr),s0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(Mt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicSub(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`)},"atomicSub",Fr),i0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(Mt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicMax(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`)},"atomicMax",Fr),a0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(Mt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicMin(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`)},"atomicMin",Fr),o0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(Mt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicAnd(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`)},"atomicAnd",Fr),u0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(Mt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicOr(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`)},"atomicOr",Fr),l0=ce((e,t)=>{throw new Error("Atomic operations are not supported outside of CODEGEN mode.")},(e,t)=>{if(Mt(e.dataType)&&e.dataType.type==="atomic")return B(S`atomicXor(&${e}, ${t})`,e.dataType.inner);throw new Error(`Invalid atomic type: ${Xt(e.dataType)}`)},"atomicXor",Fr);function c0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var h0=ce(c0,e=>B(S`dpdx(${e})`,e.dataType),"dpdx");function p0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var d0=ce(p0,e=>B(S`dpdxCoarse(${e})`,e.dataType),"dpdxCoarse");function f0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var m0=ce(f0,e=>B(S`dpdxFine(${e})`,e.dataType),"dpdxFine");function y0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var g0=ce(y0,e=>B(S`dpdy(${e})`,e.dataType),"dpdy");function w0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var x0=ce(w0,e=>B(S`dpdyCoarse(${e})`,e.dataType),"dpdyCoarse");function v0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var b0=ce(v0,e=>B(S`dpdyFine(${e})`,e.dataType),"dpdyFine");function T0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var _0=ce(T0,e=>B(S`fwidth(${e})`,e.dataType),"fwidth");function $0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var M0=ce($0,e=>B(S`fwidthCoarse(${e})`,e.dataType),"fwidthCoarse");function z0(e){throw new Error("Derivative builtins are not allowed on the cpu")}var E0=ce(z0,e=>B(S`fwidthFine(${e})`,e.dataType),"fwidthFine"),Vu=e=>Ar(e)&&Ft(e.inner)?e.inner.elementCount:0,S0=G({name:"arrayLength",signature:e=>{let t=Ar(e)?e:Wh(e);return{argTypes:[t],returnType:Vu(t)>0?Xs:J}},normalImpl:e=>e.length,codegenImpl(e){let t=Vu(e.dataType);return t>0?String(t):S`arrayLength(${e})`}});function P0(e,t,n,r,s){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var Jh=G({name:"textureSample",normalImpl:P0,codegenImpl:(...e)=>S`textureSample(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?$:k}}});function U0(e,t,n,r,s,i){throw new Error("Texture sampling with bias relies on GPU resources and cannot be executed outside of a draw call")}var A0=G({name:"textureSampleBias",normalImpl:U0,codegenImpl:(...e)=>S`textureSampleBias(${e})`,signature:(...e)=>({argTypes:e,returnType:k})});function I0(e,t,n,r,s,i){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var B0=G({name:"textureSampleLevel",normalImpl:I0,codegenImpl:(...e)=>S`textureSampleLevel(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?$:k}}});function k0(e,t,n){throw new Error("`textureLoad` relies on GPU resources and cannot be executed outside of a draw call")}var Ui=G({name:"textureLoad",normalImpl:k0,codegenImpl:(...e)=>S`textureLoad(${e})`,signature:(...e)=>{let t=e[0];if(Sc(t)){let s=t.type.startsWith("texture_depth"),i=t.sampleType;return{argTypes:e,returnType:s?$:i.type==="f32"?k:i.type==="u32"?Ye:Fe}}let n=t.format,r=gs[n].vectorType;return{argTypes:e,returnType:r}}});function O0(e,t,n,r){throw new Error("`textureStore` relies on GPU resources and cannot be executed outside of a draw call")}var Zh=G({name:"textureStore",normalImpl:O0,codegenImpl:(...e)=>S`textureStore(${e})`,signature:(...e)=>({argTypes:e,returnType:at})});function V0(e,t){throw new Error("`textureDimensions` relies on GPU resources and cannot be executed outside of a draw call")}var Hh=G({name:"textureDimensions",normalImpl:V0,codegenImpl:(...e)=>S`textureDimensions(${e})`,signature:(...e)=>{let t=e[0].dimension;return t==="1d"?{argTypes:e,returnType:J}:t==="3d"?{argTypes:e,returnType:rt}:{argTypes:e,returnType:xt}}});function G0(e,t,n,r,s,i){throw new Error("Texture comparison sampling relies on GPU resources and cannot be executed outside of a draw call")}var D0=G({name:"textureSampleCompare",normalImpl:G0,codegenImpl:(...e)=>S`textureSampleCompare(${e})`,signature:(...e)=>({argTypes:e,returnType:$})});function R0(e,t,n){throw new Error("Texture sampling with base clamp to edge is not supported outside of GPU mode.")}var N0=G({name:"textureSampleBaseClampToEdge",normalImpl:R0,codegenImpl:(...e)=>S`textureSampleBaseClampToEdge(${e})`,signature:(...e)=>({argTypes:e,returnType:k})}),lt="Subgroup operations can only be used in the GPU context.",F0=G({name:"subgroupAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupAdd(${e})`}),L0=G({name:"subgroupExclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupExclusiveAdd(${e})`}),j0=G({name:"subgroupInclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupInclusiveAdd(${e})`}),Y0=G({name:"subgroupAll",signature:{argTypes:[ke],returnType:ke},normalImpl:lt,codegenImpl:e=>S`subgroupAll(${e})`}),C0=G({name:"subgroupAnd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupAnd(${e})`}),q0=G({name:"subgroupAny",signature:{argTypes:[ke],returnType:ke},normalImpl:lt,codegenImpl:e=>S`subgroupAny(${e})`}),W0=G({name:"subgroupBallot",signature:{argTypes:[ke],returnType:Ye},normalImpl:lt,codegenImpl:e=>S`subgroupBallot(${e})`}),X0=G({name:"subgroupBroadcast",signature:(...e)=>{let t=ct([e[1]],[Ue,J]);if(!t)throw new Error(`subgroupBroadcast's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupBroadcast(${e}, ${t})`}),J0=G({name:"subgroupBroadcastFirst",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupBroadcastFirst(${e})`}),Z0=G({name:"subgroupElect",signature:{argTypes:[],returnType:ke},normalImpl:lt,codegenImpl:()=>S`subgroupElect()`}),H0=G({name:"subgroupMax",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupMax(${e})`}),Q0=G({name:"subgroupMin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupMin(${e})`}),K0=G({name:"subgroupMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupMul(${e})`}),ex=G({name:"subgroupExclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupExclusiveMul(${e})`}),tx=G({name:"subgroupInclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupInclusiveMul(${e})`}),nx=G({name:"subgroupOr",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupOr(${e})`}),rx=G({name:"subgroupShuffle",signature:(...e)=>{let t=ct([e[1]],[Ue,J]);if(!t)throw new Error(`subgroupShuffle's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupShuffle(${e}, ${t})`}),sx=G({name:"subgroupShuffleDown",signature:(...e)=>{let t=ct([e[1]],[J]);if(!t)throw new Error(`subgroupShuffleDown's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupShuffleDown(${e}, ${t})`}),ix=G({name:"subgroupShuffleUp",signature:(...e)=>{let t=ct([e[1]],[J]);if(!t)throw new Error(`subgroupShuffleUp's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupShuffleUp(${e}, ${t})`}),ax=G({name:"subgroupShuffleXor",signature:(...e)=>{let t=ct([e[1]],[J]);if(!t)throw new Error(`subgroupShuffleXor's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:lt,codegenImpl:(e,t)=>S`subgroupShuffleXor(${e}, ${t})`}),ox=G({name:"subgroupXor",signature:e=>({argTypes:[e],returnType:e}),normalImpl:lt,codegenImpl:e=>S`subgroupXor(${e})`}),ux=(()=>{let e=r=>{let s=mr();if(!s)throw new Error("extensionEnabled can only be called in a GPU codegen context.");return(s.enableExtensions??[]).includes(r)},t=r=>{let{value:s}=r;if(typeof s!="string"||!Lo.includes(s))throw new Error(`extensionEnabled has to be called with a string literal representing a valid WGSL extension name. Got: ${s}`);return B(e(s),ke)},n=r=>{if(Bn())return t(r);throw new Error("extensionEnabled can only be called in a GPU codegen context.")};return Object.defineProperty(n,E,{value:{jsImpl:e,gpuImpl:t,argConversionHint:"keep"}}),n})();const We=Object.freeze(Object.defineProperty({__proto__:null,abs:He,acos:Na,acosh:Hf,add:ue,all:Gy,allEq:Kc,and:Vy,any:Dy,arrayLength:S0,asin:Kf,asinh:tm,atan:rm,atan2:om,atanh:im,atomicAdd:r0,atomicAnd:o0,atomicLoad:t0,atomicMax:i0,atomicMin:a0,atomicOr:u0,atomicStore:n0,atomicSub:s0,atomicXor:l0,bitcastU32toF32:Zc,bitcastU32toI32:Hc,ceil:Ic,clamp:Br,cos:Nt,cosh:pm,countLeadingZeros:dm,countOneBits:fm,countTrailingZeros:mm,cross:Bc,degrees:gm,determinant:wm,discard:Vw,distance:vm,div:Go,dot:ae,dot4I8Packed:Tm,dot4U8Packed:bm,dpdx:h0,dpdxCoarse:d0,dpdxFine:m0,dpdy:g0,dpdyCoarse:x0,dpdyFine:b0,eq:Sy,exp:kc,exp2:Mm,extensionEnabled:ux,extractBits:zm,faceForward:Em,firstLeadingBit:Sm,firstTrailingBit:Pm,floor:kr,fma:Im,fract:Kn,frexp:Om,fwidth:_0,fwidthCoarse:M0,fwidthFine:E0,ge:By,gt:Iy,identity2:mc,identity3:yc,identity4:gc,insertBits:Vm,inverseSqrt:Dm,isCloseTo:Ry,ldexp:Rm,le:Ay,length:$e,log:Ls,log2:jm,lt:Uy,max:ie,min:Ie,mix:tn,mod:qf,modf:Xm,mul:xe,ne:Py,neg:Fs,normalize:rn,not:ky,or:Oy,pack2x16float:My,pack4x8unorm:Ey,pow:yr,quantizeToF16:Zm,radians:Qm,reflect:Oc,refract:Km,reverseBits:e1,rotateX4:Jw,rotateY4:Zw,rotateZ4:Hw,rotationX4:ra,rotationY4:sa,rotationZ4:ia,round:n1,saturate:Lt,scale4:Xw,scaling4:na,select:js,sign:ir,sin:an,sinh:o1,smoothstep:Vc,sqrt:yn,step:Fa,storageBarrier:Kw,sub:K,subgroupAdd:F0,subgroupAll:Y0,subgroupAnd:C0,subgroupAny:q0,subgroupBallot:W0,subgroupBroadcast:X0,subgroupBroadcastFirst:J0,subgroupElect:Z0,subgroupExclusiveAdd:L0,subgroupExclusiveMul:ex,subgroupInclusiveAdd:j0,subgroupInclusiveMul:tx,subgroupMax:H0,subgroupMin:Q0,subgroupMul:K0,subgroupOr:nx,subgroupShuffle:rx,subgroupShuffleDown:sx,subgroupShuffleUp:ix,subgroupShuffleXor:ax,subgroupXor:ox,tan:La,tanh:Gc,textureBarrier:e0,textureDimensions:Hh,textureLoad:Ui,textureSample:Jh,textureSampleBaseClampToEdge:N0,textureSampleBias:A0,textureSampleCompare:D0,textureSampleLevel:B0,textureStore:Zh,translate4:Ww,translation4:ta,transpose:d1,trunc:f1,unpack2x16float:Qc,unpack4x8unorm:zy,workgroupBarrier:Qw},Symbol.toStringTag,{value:"Module"})),lx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=ie(r-He(t-n),0)/r;return Ie(t,n)-s*s*r*(1/4)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"d1"},{type:"i",name:"d2"},{type:"i",name:"k"}],body:[0,[[13,"h",[1,[6,[7,"std","max"],[[1,"k","-",[6,[7,"std","abs"],[[1,"d1","-","d2"]]]],[5,"0"]]],"/","k"]],[10,[1,[6,[7,"std","min"],["d1","d2"]],"-",[1,[1,[1,"h","*","h"],"*","k"],"*",[1,[5,"1"],"/",[5,"4"]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({})),"opSmoothUnion"),cx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=ie(r-He(-t-n),0)/r;return ie(-n,t)+s*s*r*(1/4)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"d1"},{type:"i",name:"d2"},{type:"i",name:"k"}],body:[0,[[13,"h",[1,[6,[7,"std","max"],[[1,"k","-",[6,[7,"std","abs"],[[1,[4,"-","d1"],"-","d2"]]]],[5,"0"]]],"/","k"]],[10,[1,[6,[7,"std","max"],[[4,"-","d2"],"d1"]],"+",[1,[1,[1,"h","*","h"],"*","k"],"*",[1,[5,"1"],"/",[5,"4"]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({})),"opSmoothDifference"),hx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=F(n,He(t.z)-r);return Ie(ie(s.x,s.y),0)+$e(ie(s,F()))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"dd"},{type:"i",name:"h"}],body:[0,[[13,"w",[6,[7,"d","vec2f"],["dd",[1,[6,[7,"std","abs"],[[7,"p","z"]]],"-","h"]]]],[10,[1,[6,[7,"std","min"],[[6,[7,"std","max"],[[7,"w","x"],[7,"w","y"]]],[5,"0"]]],"+",[6,[7,"std","length"],[[6,[7,"std","max"],["w",[6,[7,"d","vec2f"],[]]]]]]]]]],externalNames:["d","std"]},get externals(){return{d:ve,std:We}}})&&e.f)({})),"opExtrudeZ"),px=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=F(n,He(t.x)-r);return Ie(ie(s.x,s.y),0)+$e(ie(s,F()))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"dd"},{type:"i",name:"h"}],body:[0,[[13,"w",[6,[7,"d","vec2f"],["dd",[1,[6,[7,"std","abs"],[[7,"p","x"]]],"-","h"]]]],[10,[1,[6,[7,"std","min"],[[6,[7,"std","max"],[[7,"w","x"],[7,"w","y"]]],[5,"0"]]],"+",[6,[7,"std","length"],[[6,[7,"std","max"],["w",[6,[7,"d","vec2f"],[]]]]]]]]]],externalNames:["d","std"]},get externals(){return{d:ve,std:We}}})&&e.f)({})),"opExtrudeX"),Qh=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=F(n,He(t.y)-r);return Ie(ie(s.x,s.y),0)+$e(ie(s,F()))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"dd"},{type:"i",name:"h"}],body:[0,[[13,"w",[6,[7,"d","vec2f"],["dd",[1,[6,[7,"std","abs"],[[7,"p","y"]]],"-","h"]]]],[10,[1,[6,[7,"std","min"],[[6,[7,"std","max"],[[7,"w","x"],[7,"w","y"]]],[5,"0"]]],"+",[6,[7,"std","length"],[[6,[7,"std","max"],["w",[6,[7,"d","vec2f"],[]]]]]]]]]],externalNames:["d","std"]},get externals(){return{d:ve,std:We}}})&&e.f)({})),"opExtrudeY"),Kh=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>Ie(t,n)),{v:1,name:void 0,ast:{params:[{type:"i",name:"d1"},{type:"i",name:"d2"}],body:[0,[[10,[6,[7,"std","min"],["d1","d2"]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({})),"opUnion"),dx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>$e(t)-n),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"radius"}],body:[0,[[10,[1,[6,"length",["p"]],"-","radius"]]]],externalNames:["length"]},get externals(){return{length:$e}}})&&e.f)({})),"sdDisk"),fx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=K(He(t),n);return $e(ie(r,F(0)))+Ie(ie(r.x,r.y),0)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"}],body:[0,[[13,"d",[6,"sub",[[6,"abs",["p"]],"size"]]],[10,[1,[6,"length",[[6,"max",["d",[6,"vec2f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"d","x"],[7,"d","y"]]],[5,"0"]]]]]]],externalNames:["sub","abs","length","max","vec2f","min"]},get externals(){return{sub:K,abs:He,length:$e,max:ie,vec2f:F,min:Ie}}})&&e.f)({})),"sdBox2d"),mx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=ue(K(He(t),n),F(r));return $e(ie(s,F(0)))+Ie(ie(s.x,s.y),0)-r}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"},{type:"i",name:"cornerRadius"}],body:[0,[[13,"d",[6,"add",[[6,"sub",[[6,"abs",["p"]],"size"]],[6,"vec2f",["cornerRadius"]]]]],[10,[1,[1,[6,"length",[[6,"max",["d",[6,"vec2f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"d","x"],[7,"d","y"]]],[5,"0"]]]],"-","cornerRadius"]]]],externalNames:["add","sub","abs","vec2f","length","max","min"]},get externals(){return{add:ue,sub:K,abs:He,vec2f:F,length:$e,max:ie,min:Ie}}})&&e.f)({})),"sdRoundedBox2d"),yx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=K(t,n),i=K(r,n),p=ie(0,Ie(1,ae(s,i)/ae(i,i)));return $e(K(s,i.mul(p)))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"a"},{type:"i",name:"b"}],body:[0,[[13,"pa",[6,"sub",["p","a"]]],[13,"ba",[6,"sub",["b","a"]]],[13,"h",[6,"max",[[5,"0"],[6,"min",[[5,"1"],[1,[6,"dot",["pa","ba"]],"/",[6,"dot",["ba","ba"]]]]]]]],[10,[6,"length",[[6,"sub",["pa",[6,[7,"ba","mul"],["h"]]]]]]]]],externalNames:["sub","max","min","dot","length"]},get externals(){return{sub:K,max:ie,min:Ie,dot:ae,length:$e}}})&&e.f)({})),"sdLine"),os=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{"use gpu";return ae(n,n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"v"}],body:[0,[[10,[6,"dot",["v","v"]]]]],externalNames:["dot"]},get externals(){return{dot:ae}}})&&t.f)({}),{v:1,name:"dot2",ast:{params:[{type:"i",name:"v"}],body:[0,[[10,[6,"dot",["v","v"]]]]],externalNames:["dot"]},get externals(){return{dot:ae}}})&&e.f)({}),gx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,F,F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r,s)=>{const i=r.sub(n),p=n.sub(r.mul(2)).add(s),y=i.mul($(2)),v=n.sub(t),P=1/ie(ae(p,p),1e-4),U=P*ae(i,p),R=P*($(2)*ae(i,i)+ae(v,p))/3,j=P*ae(v,i);let L=$(0);const Z=R-U*U,Q=Z*Z*Z,re=U*(2*U*U-3*R)+j;let Me=re*re+4*Q;if(Me>=0){Me=yn(Me);const oe=F(Me,-Me).sub(re).mul(.5),be=ir(oe).mul(yr(He(oe),F(1/3))),ze=Br(be.x+be.y-U,0,1);L=os(v.add(y.add(p.mul(ze)).mul(ze)))}else{const oe=yn(-Z),be=Na(re/(Z*oe*2))/3,ze=Nt(be),Se=xe(an(be),1.732050808),Pe=Lt(O(ze+ze,-Se-ze,Se-ze).mul(oe).sub(U));L=Ie(os(v.add(y.add(p.mul(Pe.x)).mul(Pe.x))),os(v.add(y.add(p.mul(Pe.y)).mul(Pe.y))))}return yn(L)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"},{type:"i",name:"A"},{type:"i",name:"B"},{type:"i",name:"C"}],body:[0,[[13,"a",[6,[7,"B","sub"],["A"]]],[13,"b",[6,[7,[6,[7,"A","sub"],[[6,[7,"B","mul"],[[5,"2"]]]]],"add"],["C"]]],[13,"c",[6,[7,"a","mul"],[[6,"f32",[[5,"2"]]]]]],[13,"d",[6,[7,"A","sub"],["pos"]]],[13,"dotB",[6,"max",[[6,"dot",["b","b"]],[5,"0.0001"]]]],[13,"kk",[1,[5,"1"],"/","dotB"]],[13,"kx",[1,"kk","*",[6,"dot",["a","b"]]]],[13,"ky",[1,[1,"kk","*",[1,[1,[6,"f32",[[5,"2"]]],"*",[6,"dot",["a","a"]]],"+",[6,"dot",["d","b"]]]],"/",[5,"3"]]],[13,"kz",[1,"kk","*",[6,"dot",["d","a"]]]],[12,"res",[6,"f32",[[5,"0"]]]],[13,"p",[1,"ky","-",[1,"kx","*","kx"]]],[13,"p3",[1,[1,"p","*","p"],"*","p"]],[13,"q",[1,[1,"kx","*",[1,[1,[1,[5,"2"],"*","kx"],"*","kx"],"-",[1,[5,"3"],"*","ky"]]],"+","kz"]],[12,"h",[1,[1,"q","*","q"],"+",[1,[5,"4"],"*","p3"]]],[11,[1,"h",">=",[5,"0"]],[0,[[2,"h","=",[6,"sqrt",["h"]]],[13,"x",[6,[7,[6,[7,[6,"vec2f",["h",[4,"-","h"]]],"sub"],["q"]],"mul"],[[5,"0.5"]]]],[13,"uv",[6,[7,[6,"sign",["x"]],"mul"],[[6,"pow",[[6,"abs",["x"]],[6,"vec2f",[[1,[5,"1"],"/",[5,"3"]]]]]]]]],[13,"t",[6,"clamp",[[1,[1,[7,"uv","x"],"+",[7,"uv","y"]],"-","kx"],[5,"0"],[5,"1"]]]],[2,"res","=",[6,"dot2",[[6,[7,"d","add"],[[6,[7,[6,[7,"c","add"],[[6,[7,"b","mul"],["t"]]]],"mul"],["t"]]]]]]]]],[0,[[13,"z",[6,"sqrt",[[4,"-","p"]]]],[13,"v",[1,[6,"acos",[[1,"q","/",[1,[1,"p","*","z"],"*",[5,"2"]]]]],"/",[5,"3"]]],[13,"m",[6,"cos",["v"]]],[13,"n",[6,"mul",[[6,"sin",["v"]],[5,"1.732050808"]]]],[13,"t",[6,"saturate",[[6,[7,[6,[7,[6,"vec3f",[[1,"m","+","m"],[1,[4,"-","n"],"-","m"],[1,"n","-","m"]]],"mul"],["z"]],"sub"],["kx"]]]]],[2,"res","=",[6,"min",[[6,"dot2",[[6,[7,"d","add"],[[6,[7,[6,[7,"c","add"],[[6,[7,"b","mul"],[[7,"t","x"]]]]],"mul"],[[7,"t","x"]]]]]]],[6,"dot2",[[6,[7,"d","add"],[[6,[7,[6,[7,"c","add"],[[6,[7,"b","mul"],[[7,"t","y"]]]]],"mul"],[[7,"t","y"]]]]]]]]]]]]],[10,[6,"sqrt",["res"]]]]],externalNames:["f32","max","dot","sqrt","vec2f","sign","pow","abs","clamp","dot2","acos","cos","mul","sin","saturate","vec3f","min"]},get externals(){return{f32:$,max:ie,dot:ae,sqrt:yn,vec2f:F,sign:ir,pow:yr,abs:He,clamp:Br,dot2:os,acos:Na,cos:Nt,mul:xe,sin:an,saturate:Lt,vec3f:O,min:Ie}}})&&e.f)({})),"sdBezier"),vi=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=((n,r)=>{"use gpu";return n.x*r.y-n.y*r.x}),{v:1,name:void 0,ast:{params:[{type:"i",name:"a"},{type:"i",name:"b"}],body:[0,[[10,[1,[1,[7,"a","x"],"*",[7,"b","y"]],"-",[1,[7,"a","y"],"*",[7,"b","x"]]]]]],externalNames:[]},get externals(){return{}}})&&t.f)({}),{v:1,name:"cro",ast:{params:[{type:"i",name:"a"},{type:"i",name:"b"}],body:[0,[[10,[1,[1,[7,"a","x"],"*",[7,"b","y"]],"-",[1,[7,"a","y"],"*",[7,"b","x"]]]]]],externalNames:[]},get externals(){return{}}})&&e.f)({}),wx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,F,F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r,s)=>{const i=n.sub(s),p=s.sub(r),y=r.sub(n),v=p.sub(y),_=n.sub(t),P=r.sub(t),U=s.sub(t),R=vi(_,U),j=vi(P,_),L=vi(U,P),Z=p.mul(j).add(y.mul(L)).mul(2).sub(i.mul(R)),Q=(j*L-R*R*.25)/os(Z),re=Lt((.5*R+j+Q*ae(Z,v))/(R+j+L)),Me=_.add(y.add(y).add(v.mul(re)).mul(re));return $e(Me)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"},{type:"i",name:"A"},{type:"i",name:"B"},{type:"i",name:"C"}],body:[0,[[13,"i",[6,[7,"A","sub"],["C"]]],[13,"j",[6,[7,"C","sub"],["B"]]],[13,"k",[6,[7,"B","sub"],["A"]]],[13,"w",[6,[7,"j","sub"],["k"]]],[13,"v0",[6,[7,"A","sub"],["pos"]]],[13,"v1",[6,[7,"B","sub"],["pos"]]],[13,"v2",[6,[7,"C","sub"],["pos"]]],[13,"x",[6,"cro",["v0","v2"]]],[13,"y",[6,"cro",["v1","v0"]]],[13,"z",[6,"cro",["v2","v1"]]],[13,"s",[6,[7,[6,[7,[6,[7,[6,[7,"j","mul"],["y"]],"add"],[[6,[7,"k","mul"],["z"]]]],"mul"],[[5,"2"]]],"sub"],[[6,[7,"i","mul"],["x"]]]]],[13,"r",[1,[1,[1,"y","*","z"],"-",[1,[1,"x","*","x"],"*",[5,"0.25"]]],"/",[6,"dot2",["s"]]]],[13,"t",[6,"saturate",[[1,[1,[1,[1,[5,"0.5"],"*","x"],"+","y"],"+",[1,"r","*",[6,"dot",["s","w"]]]],"/",[1,[1,"x","+","y"],"+","z"]]]]],[13,"d",[6,[7,"v0","add"],[[6,[7,[6,[7,[6,[7,"k","add"],["k"]],"add"],[[6,[7,"w","mul"],["t"]]]],"mul"],["t"]]]]],[10,[6,"length",["d"]]]]],externalNames:["cro","dot2","saturate","dot","length"]},get externals(){return{cro:vi,dot2:os,saturate:Lt,dot:ae,length:$e}}})&&e.f)({})),"sdBezierApprox"),xx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F,F,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=t;s.x=He(t.x);const i=$e(s)-r,p=$e(s.sub(n.mul(Br(ae(s,n),0,r))));return ie(i,p*ir(n.y*s.x-n.x*s.y))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"c"},{type:"i",name:"r"}],body:[0,[[13,"p_w","p"],[2,[7,"p_w","x"],"=",[6,"abs",[[7,"p","x"]]]],[13,"l",[1,[6,"length",["p_w"]],"-","r"]],[13,"m",[6,"length",[[6,[7,"p_w","sub"],[[6,[7,"c","mul"],[[6,"clamp",[[6,"dot",["p_w","c"]],[5,"0"],"r"]]]]]]]]],[10,[6,"max",["l",[1,"m","*",[6,"sign",[[1,[1,[7,"c","y"],"*",[7,"p_w","x"]],"-",[1,[7,"c","x"],"*",[7,"p_w","y"]]]]]]]]]]],externalNames:["abs","length","clamp","dot","max","sign"]},get externals(){return{abs:He,length:$e,clamp:Br,dot:ae,max:ie,sign:ir}}})&&e.f)({})),"sdPie"),vx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>$e(t)-n),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"radius"}],body:[0,[[10,[1,[6,"length",["p"]],"-","radius"]]]],externalNames:["length"]},get externals(){return{length:$e}}})&&e.f)({})),"sdSphere"),bx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=K(He(t),n);return $e(ie(r,O(0)))+Ie(ie(ie(r.x,r.y),r.z),0)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"}],body:[0,[[13,"d",[6,"sub",[[6,"abs",["p"]],"size"]]],[10,[1,[6,"length",[[6,"max",["d",[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[6,"max",[[7,"d","x"],[7,"d","y"]]],[7,"d","z"]]],[5,"0"]]]]]]],externalNames:["sub","abs","length","max","vec3f","min"]},get externals(){return{sub:K,abs:He,length:$e,max:ie,vec3f:O,min:Ie}}})&&e.f)({})),"sdBox3d"),ep=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=ue(K(He(t),n),O(r));return $e(ie(s,O(0)))+Ie(ie(ie(s.x,s.y),s.z),0)-r}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"},{type:"i",name:"cornerRadius"}],body:[0,[[13,"d",[6,"add",[[6,"sub",[[6,"abs",["p"]],"size"]],[6,"vec3f",["cornerRadius"]]]]],[10,[1,[1,[6,"length",[[6,"max",["d",[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[6,"max",[[7,"d","x"],[7,"d","y"]]],[7,"d","z"]]],[5,"0"]]]],"-","cornerRadius"]]]],externalNames:["add","sub","abs","vec3f","length","max","min"]},get externals(){return{add:ue,sub:K,abs:He,vec3f:O,length:$e,max:ie,min:Ie}}})&&e.f)({})),"sdRoundedBox3d"),Tx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=K(He(t),n),i=K(He(ue(s,r)),O(r)),p=$e(ie(O(s.x,i.y,i.z),O(0)))+Ie(ie(s.x,ie(i.y,i.z)),0),y=$e(ie(O(i.x,s.y,i.z),O(0)))+Ie(ie(i.x,ie(s.y,i.z)),0),v=$e(ie(O(i.x,i.y,s.z),O(0)))+Ie(ie(i.x,ie(i.y,s.z)),0);return Ie(Ie(p,y),v)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"size"},{type:"i",name:"thickness"}],body:[0,[[13,"p1",[6,"sub",[[6,"abs",["p"]],"size"]]],[13,"q",[6,"sub",[[6,"abs",[[6,"add",["p1","thickness"]]]],[6,"vec3f",["thickness"]]]]],[13,"d1",[1,[6,"length",[[6,"max",[[6,"vec3f",[[7,"p1","x"],[7,"q","y"],[7,"q","z"]]],[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"p1","x"],[6,"max",[[7,"q","y"],[7,"q","z"]]]]],[5,"0"]]]]],[13,"d2",[1,[6,"length",[[6,"max",[[6,"vec3f",[[7,"q","x"],[7,"p1","y"],[7,"q","z"]]],[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"q","x"],[6,"max",[[7,"p1","y"],[7,"q","z"]]]]],[5,"0"]]]]],[13,"d3",[1,[6,"length",[[6,"max",[[6,"vec3f",[[7,"q","x"],[7,"q","y"],[7,"p1","z"]]],[6,"vec3f",[[5,"0"]]]]]]],"+",[6,"min",[[6,"max",[[7,"q","x"],[6,"max",[[7,"q","y"],[7,"p1","z"]]]]],[5,"0"]]]]],[10,[6,"min",[[6,"min",["d1","d2"]],"d3"]]]]],externalNames:["sub","abs","add","vec3f","length","max","min"]},get externals(){return{sub:K,abs:He,add:ue,vec3f:O,length:$e,max:ie,min:Ie}}})&&e.f)({})),"sdBoxFrame3d"),_x=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,O],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{const s=K(t,n),i=K(r,n),p=ie(0,Ie(1,ae(s,i)/ae(i,i)));return $e(K(s,i.mul(p)))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"a"},{type:"i",name:"b"}],body:[0,[[13,"pa",[6,"sub",["p","a"]]],[13,"ba",[6,"sub",["b","a"]]],[13,"h",[6,"max",[[5,"0"],[6,"min",[[5,"1"],[1,[6,"dot",["pa","ba"]],"/",[6,"dot",["ba","ba"]]]]]]]],[10,[6,"length",[[6,"sub",["pa",[6,[7,"ba","mul"],["h"]]]]]]]]],externalNames:["sub","max","min","dot","length"]},get externals(){return{sub:K,max:ie,min:Ie,dot:ae,length:$e}}})&&e.f)({})),"sdLine3d"),tp=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>ae(t,n)+r),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"n"},{type:"i",name:"h"}],body:[0,[[10,[1,[6,"dot",["p","n"]],"+","h"]]]],externalNames:["dot"]},get externals(){return{dot:ae}}})&&e.f)({})),"sdPlane"),$x=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O,O,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r,s)=>{const i=K(t,n),p=K(r,n),y=Lt(ae(i,p)/ae(p,p));return $e(K(i,p.mul(y)))-s}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"},{type:"i",name:"a"},{type:"i",name:"b"},{type:"i",name:"radius"}],body:[0,[[13,"pa",[6,"sub",["p","a"]]],[13,"ba",[6,"sub",["b","a"]]],[13,"h",[6,"saturate",[[1,[6,"dot",["pa","ba"]],"/",[6,"dot",["ba","ba"]]]]]],[10,[1,[6,"length",[[6,"sub",["pa",[6,[7,"ba","mul"],["h"]]]]]],"-","radius"]]]],externalNames:["sub","saturate","dot","length"]},get externals(){return{sub:K,saturate:Lt,dot:ae,length:$e}}})&&e.f)({})),"sdCapsule"),np=Object.freeze(Object.defineProperty({__proto__:null,opExtrudeX:px,opExtrudeY:Qh,opExtrudeZ:hx,opSmoothDifference:cx,opSmoothUnion:lx,opUnion:Kh,sdBezier:gx,sdBezierApprox:wx,sdBox2d:fx,sdBox3d:bx,sdBoxFrame3d:Tx,sdCapsule:$x,sdDisk:dx,sdLine:yx,sdLine3d:_x,sdPie:xx,sdPlane:tp,sdRoundedBox2d:mx,sdRoundedBox3d:ep,sdSphere:vx},Symbol.toStringTag,{value:"Module"}));var rp=fc({in:{vertexIndex:Rs.vertexIndex},out:{pos:Rs.position,uv:F}})`{
  const pos = array<vec2f, 3>(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  const uv = array<vec2f, 3>(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));

  return Out(vec4f(pos[in.vertexIndex], 0, 1), uv[in.vertexIndex]);
}`;const Mx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],$),"randomGeneratorShell"),zx=(()=>{const e=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.privateVar(F),"seed");return{seed:(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.fn([$])((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{e.value=F(n,0)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"value"}],body:[0,[[2,[7,"seed","value"],"=",[6,[7,"d","vec2f"],["value",[5,"0"]]]]]],externalNames:["seed","d"]},get externals(){return{seed:e,d:ve}}})&&t.f)({})),"seed"),seed2:(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.fn([F])((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{e.value=n}),{v:1,name:void 0,ast:{params:[{type:"i",name:"value"}],body:[0,[[2,[7,"seed","value"],"=","value"]]],externalNames:["seed"]},get externals(){return{seed:e}}})&&t.f)({})),"seed2"),seed3:(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.fn([O])((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{e.value=ue(n.xy,F(n.z))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"value"}],body:[0,[[2,[7,"seed","value"],"=",[6,"add",[[7,"value","xy"],[6,[7,"d","vec2f"],[[7,"value","z"]]]]]]]],externalNames:["seed","add","d"]},get externals(){return{seed:e,add:ue,d:ve}}})&&t.f)({})),"seed3"),seed4:(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(H.fn([k])((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{e.value=ue(n.xy,n.zw)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"value"}],body:[0,[[2,[7,"seed","value"],"=",[6,"add",[[7,"value","xy"],[7,"value","zw"]]]]]],externalNames:["seed","add"]},get externals(){return{seed:e,add:ue}}})&&t.f)({})),"seed4"),sample:Mx((t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(n.f=(()=>{"use gpu";const r=ae(e.value,F(23.14077926,232.61690225)),s=ae(e.value,F(54.47856553,345.84153136));return e.value.x=Kn(Nt(r)*136.8168),e.value.y=Kn(Nt(s)*534.7645),e.value.y}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"a",[6,"dot",[[7,"seed","value"],[6,[7,"d","vec2f"],[[5,"23.14077926"],[5,"232.61690225"]]]]]],[13,"b",[6,"dot",[[7,"seed","value"],[6,[7,"d","vec2f"],[[5,"54.47856553"],[5,"345.84153136"]]]]]],[2,[7,[7,"seed","value"],"x"],"=",[6,"fract",[[1,[6,"cos",["a"]],"*",[5,"136.8168"]]]]],[2,[7,[7,"seed","value"],"y"],"=",[6,"fract",[[1,[6,"cos",["b"]],"*",[5,"534.7645"]]]]],[10,[7,[7,"seed","value"],"y"]]]],externalNames:["dot","seed","d","fract","cos"]},get externals(){return{dot:ae,seed:e,d:ve,fract:Kn,cos:Nt}}})&&n.f)({}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"a",[6,"dot",[[7,"seed","value"],[6,[7,"d","vec2f"],[[5,"23.14077926"],[5,"232.61690225"]]]]]],[13,"b",[6,"dot",[[7,"seed","value"],[6,[7,"d","vec2f"],[[5,"54.47856553"],[5,"345.84153136"]]]]]],[2,[7,[7,"seed","value"],"x"],"=",[6,"fract",[[1,[6,"cos",["a"]],"*",[5,"136.8168"]]]]],[2,[7,[7,"seed","value"],"y"],"=",[6,"fract",[[1,[6,"cos",["b"]],"*",[5,"534.7645"]]]]],[10,[7,[7,"seed","value"],"y"]]]],externalNames:["dot","seed","d","fract","cos"]},get externals(){return{dot:ae,seed:e,d:ve,fract:Kn,cos:Nt}}})&&t.f)({}))}})(),Ex=zx,Oe=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.slot(Ex),"randomGeneratorSlot"),gr=Math.PI*2,Vs=1e-7,Sx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$])((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{Oe.value.seed(t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"seed"}],body:[0,[[6,[7,[7,"randomGeneratorSlot","value"],"seed"],["seed"]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randSeed"),Ka=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F])((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{Oe.value.seed2(t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"seed"}],body:[0,[[6,[7,[7,"randomGeneratorSlot","value"],"seed2"],["seed"]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randSeed2"),eo=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O])((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{Oe.value.seed3(t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"seed"}],body:[0,[[6,[7,[7,"randomGeneratorSlot","value"],"seed3"],["seed"]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randSeed3"),Px=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([k])((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{Oe.value.seed4(t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"seed"}],body:[0,[[6,[7,[7,"randomGeneratorSlot","value"],"seed4"],["seed"]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randSeed4"),Ux=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>Oe.value.sample()),{v:1,name:void 0,ast:{params:[],body:[0,[[10,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]]]],externalNames:["randomGeneratorSlot"]},get externals(){return{randomGeneratorSlot:Oe}}})&&e.f)({})),"randFloat01"),Ax=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>O(Oe.value.sample(),Oe.value.sample(),Oe.value.sample())),{v:1,name:void 0,ast:{params:[],body:[0,[[10,[6,[7,"d","vec3f"],[[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]]]]]],externalNames:["d","randomGeneratorSlot"]},get externals(){return{d:ve,randomGeneratorSlot:Oe}}})&&e.f)({})),"randInUnitCube"),Ix=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=J(Oe.value.sample()*6),n=t%3,r=O();return r[n]=$(js(0,1,t>2)),r[(n+1)%3]=Oe.value.sample(),r[(n+2)%3]=Oe.value.sample(),r}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"face",[6,[7,"d","u32"],[[1,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],"*",[5,"6"]]]]],[13,"axis",[1,"face","%",[5,"3"]]],[13,"result",[6,[7,"d","vec3f"],[]]],[2,[8,"result","axis"],"=",[6,[7,"d","f32"],[[6,"select",[[5,"0"],[5,"1"],[1,"face",">",[5,"2"]]]]]]],[2,[8,"result",[1,[1,"axis","+",[5,"1"]],"%",[5,"3"]]],"=",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],[2,[8,"result",[1,[1,"axis","+",[5,"2"]],"%",[5,"3"]]],"=",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],[10,"result"]]],externalNames:["d","randomGeneratorSlot","select"]},get externals(){return{d:ve,randomGeneratorSlot:Oe,select:js}}})&&e.f)({})),"randOnUnitCube"),Bx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],F)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=yn(Oe.value.sample()),n=Oe.value.sample()*gr;return F(Nt(n)*t,an(n)*t)}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"radius",[6,"sqrt",[[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]]]],[13,"angle",[1,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],"*","TWO_PI"]],[10,[6,[7,"d","vec2f"],[[1,[6,"cos",["angle"]],"*","radius"],[1,[6,"sin",["angle"]],"*","radius"]]]]]],externalNames:["sqrt","randomGeneratorSlot","TWO_PI","d","cos","sin"]},get externals(){return{sqrt:yn,randomGeneratorSlot:Oe,TWO_PI:gr,d:ve,cos:Nt,sin:an}}})&&e.f)({})),"randInUnitCircle"),to=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],F)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=Oe.value.sample()*gr;return F(Nt(t),an(t))}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"angle",[1,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],"*","TWO_PI"]],[10,[6,[7,"d","vec2f"],[[6,"cos",["angle"]],[6,"sin",["angle"]]]]]]],externalNames:["randomGeneratorSlot","TWO_PI","d","cos","sin"]},get externals(){return{randomGeneratorSlot:Oe,TWO_PI:gr,d:ve,cos:Nt,sin:an}}})&&e.f)({})),"randOnUnitCircle");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{let n=t;return $e(t)===0&&(n=t.add(Vs)),rn(n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"v"}],body:[0,[[12,"vNonZero","v"],[11,[1,[6,"length",["v"]],"==",[5,"0"]],[0,[[2,"vNonZero","=",[6,[7,"v","add"],["EPS"]]]]]],[10,[6,"normalize",["vNonZero"]]]]],externalNames:["length","EPS","normalize"]},get externals(){return{length:$e,EPS:Vs,normalize:rn}}})&&e.f)({})),"safeNormalize");const no=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=Oe.value.sample(),n=O(zs(0,1),zs(0,1),zs(0,1));return rn(n).mul(yr(t,.33))}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"u",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],[13,"v",[6,[7,"d","vec3f"],[[6,"randNormal",[[5,"0"],[5,"1"]]],[6,"randNormal",[[5,"0"],[5,"1"]]],[6,"randNormal",[[5,"0"],[5,"1"]]]]]],[13,"vNorm",[6,"normalize",["v"]]],[10,[6,[7,"vNorm","mul"],[[6,"pow",["u",[5,"0.33"]]]]]]]],externalNames:["randomGeneratorSlot","d","randNormal","normalize","pow"]},get externals(){return{randomGeneratorSlot:Oe,d:ve,randNormal:zs,normalize:rn,pow:yr}}})&&e.f)({})),"randInUnitSphere"),Cs=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{const t=2*Oe.value.sample()-1,n=yn(1-t*t),r=gr*Oe.value.sample(),s=Nt(r)*n,i=an(r)*n;return O(s,i,t)}),{v:1,name:void 0,ast:{params:[],body:[0,[[13,"z",[1,[1,[5,"2"],"*",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],"-",[5,"1"]]],[13,"oneMinusZSq",[6,"sqrt",[[1,[5,"1"],"-",[1,"z","*","z"]]]]],[13,"theta",[1,"TWO_PI","*",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]]],[13,"x",[1,[6,"cos",["theta"]],"*","oneMinusZSq"]],[13,"y",[1,[6,"sin",["theta"]],"*","oneMinusZSq"]],[10,[6,[7,"d","vec3f"],["x","y","z"]]]]],externalNames:["randomGeneratorSlot","sqrt","TWO_PI","cos","sin","d"]},get externals(){return{randomGeneratorSlot:Oe,sqrt:yn,TWO_PI:gr,cos:Nt,sin:an,d:ve}}})&&e.f)({})),"randOnUnitSphere"),kx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=no(),r=ae(t,n);return xe(ir(r),n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"normal"}],body:[0,[[13,"value",[6,"randInUnitSphere",[]]],[13,"alignment",[6,"dot",["normal","value"]]],[10,[6,"mul",[[6,"sign",["alignment"]],"value"]]]]],externalNames:["randInUnitSphere","dot","mul","sign"]},get externals(){return{randInUnitSphere:no,dot:ae,mul:xe,sign:ir}}})&&e.f)({})),"randInUnitHemisphere"),Ox=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=Cs(),r=ae(t,n);return xe(ir(r),n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"normal"}],body:[0,[[13,"value",[6,"randOnUnitSphere",[]]],[13,"alignment",[6,"dot",["normal","value"]]],[10,[6,"mul",[[6,"sign",["alignment"]],"value"]]]]],externalNames:["randOnUnitSphere","dot","mul","sign"]},get externals(){return{randOnUnitSphere:Cs,dot:ae,mul:xe,sign:ir}}})&&e.f)({})),"randOnUnitHemisphere"),hr=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>Oe.value.sample()*(1-2*Vs)+Vs),{v:1,name:void 0,ast:{params:[],body:[0,[[10,[1,[1,[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]],"*",[1,[5,"1"],"-",[1,[5,"2"],"*","EPS"]]],"+","EPS"]]]],externalNames:["randomGeneratorSlot","EPS"]},get externals(){return{randomGeneratorSlot:Oe,EPS:Vs}}})&&e.f)({})),"randUniformExclusive"),zs=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=gr*hr();return yn(-2*Ls(hr()))*an(r)*n+t}),{v:1,name:void 0,ast:{params:[{type:"i",name:"mu"},{type:"i",name:"sigma"}],body:[0,[[13,"theta",[1,"TWO_PI","*",[6,"randUniformExclusive",[]]]],[13,"R",[6,"sqrt",[[1,[4,"-",[5,"2"]],"*",[6,"log",[[6,"randUniformExclusive",[]]]]]]]],[10,[1,[1,[1,"R","*",[6,"sin",["theta"]]],"*","sigma"],"+","mu"]]]],externalNames:["TWO_PI","randUniformExclusive","sqrt","log","sin"]},get externals(){return{TWO_PI:gr,randUniformExclusive:hr,sqrt:yn,log:Ls,sin:an}}})&&e.f)({})),"randNormal"),Vx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=hr();return-1/t*Ls(n)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"rate"}],body:[0,[[13,"u",[6,"randUniformExclusive",[]]],[10,[1,[1,[4,"-",[5,"1"]],"/","rate"],"*",[6,"log",["u"]]]]]],externalNames:["randUniformExclusive","log"]},get externals(){return{randUniformExclusive:hr,log:Ls}}})&&e.f)({})),"randExponential"),Gx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$,$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=hr();return t+n*La(Math.PI*(r-.5))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"x0"},{type:"i",name:"gamma"}],body:[0,[[13,"u",[6,"randUniformExclusive",[]]],[10,[1,"x0","+",[1,"gamma","*",[6,"tan",[[1,[7,"Math","PI"],"*",[1,"u","-",[5,"0.5"]]]]]]]]]],externalNames:["randUniformExclusive","tan","Math"]},get externals(){return{randUniformExclusive:hr,tan:La,Math}}})&&e.f)({})),"randCauchy"),Dx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([$],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=Oe.value.sample();return Fa(n,t)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"p"}],body:[0,[[13,"u",[6,[7,[7,"randomGeneratorSlot","value"],"sample"],[]]],[10,[6,"step",["u","p"]]]]],externalNames:["randomGeneratorSlot","step"]},get externals(){return{randomGeneratorSlot:Oe,step:Fa}}})&&e.f)({})),"randBernoulli"),sp=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{"use gpu";return xe(xe(n,xe(n,n)),ue(xe(n,K(xe(n,6),15)),10))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"t"}],body:[0,[[10,[6,"mul",[[6,"mul",["t",[6,"mul",["t","t"]]]],[6,"add",[[6,"mul",["t",[6,"sub",[[6,"mul",["t",[5,"6"]]],[5,"15"]]]]],[5,"10"]]]]]]]],externalNames:["mul","add","sub"]},get externals(){return{mul:xe,add:ue,sub:K}}})&&t.f)({}),{v:1,name:"quinticInterpolationImpl",ast:{params:[{type:"i",name:"t"}],body:[0,[[10,[6,"mul",[[6,"mul",["t",[6,"mul",["t","t"]]]],[6,"add",[[6,"mul",["t",[6,"sub",[[6,"mul",["t",[5,"6"]]],[5,"15"]]]]],[5,"10"]]]]]]]],externalNames:["mul","add","sub"]},get externals(){return{mul:xe,add:ue,sub:K}}})&&e.f)({}),Ci=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F],F)(sp),"quinticInterpolation2"),Gu=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)(sp),"quinticInterpolation3"),ip=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(t.f=(n=>{"use gpu";return xe(xe(xe(30,n),n),ue(xe(n,K(n,2)),1))}),{v:1,name:void 0,ast:{params:[{type:"i",name:"t"}],body:[0,[[10,[6,"mul",[[6,"mul",[[6,"mul",[[5,"30"],"t"]],"t"]],[6,"add",[[6,"mul",["t",[6,"sub",["t",[5,"2"]]]]],[5,"1"]]]]]]]],externalNames:["mul","add","sub"]},get externals(){return{mul:xe,add:ue,sub:K}}})&&t.f)({}),{v:1,name:"quinticDerivativeImpl",ast:{params:[{type:"i",name:"t"}],body:[0,[[10,[6,"mul",[[6,"mul",[[6,"mul",[[5,"30"],"t"]],"t"]],[6,"add",[[6,"mul",["t",[6,"sub",["t",[5,"2"]]]]],[5,"1"]]]]]]]],externalNames:["mul","add","sub"]},get externals(){return{mul:xe,add:ue,sub:K}}})&&e.f)({}),Du=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F],F)(ip),"quinticDerivative2");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],O)(ip),"quinticDerivative3");const Rx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([Be],F)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(Ka(xe(.001,F(t))),to())),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[6,"randSeed2",[[6,"mul",[[5,"0.001"],[6,[7,"d","vec2f"],["pos"]]]]]],[10,[6,"randOnUnitCircle",[]]]]],externalNames:["randSeed2","mul","d","randOnUnitCircle"]},get externals(){return{randSeed2:Ka,mul:xe,d:ve,randOnUnitCircle:to}}})&&e.f)({})),"computeJunctionGradient"),jn=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.slot(Rx),"getJunctionGradientSlot");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=Be(kr(t)),r=Kn(t),s=Ci(r),i=jn.$(n),p=jn.$(ue(n,Be(1,0))),y=jn.$(ue(n,Be(0,1))),v=jn.$(ue(n,Be(1,1))),_=ae(i,K(r,F(0,0))),P=ae(p,K(r,F(1,0))),U=ae(y,K(r,F(0,1))),R=ae(v,K(r,F(1,1)));return _+s.x*(P-_)+s.y*(U-_)+s.x*s.y*(_-P-U+R)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[13,"i",[6,[7,"d","vec2i"],[[6,"floor",["pos"]]]]],[13,"f",[6,"fract",["pos"]]],[13,"u",[6,"quinticInterpolation2",["f"]]],[13,"ga",[6,[7,"getJunctionGradientSlot","$"],["i"]]],[13,"gb",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"1"],[5,"0"]]]]]]]],[13,"gc",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"0"],[5,"1"]]]]]]]],[13,"gd",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"1"],[5,"1"]]]]]]]],[13,"va",[6,"dot",["ga",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"0"],[5,"0"]]]]]]]],[13,"vb",[6,"dot",["gb",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"1"],[5,"0"]]]]]]]],[13,"vc",[6,"dot",["gc",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"0"],[5,"1"]]]]]]]],[13,"vd",[6,"dot",["gd",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"1"],[5,"1"]]]]]]]],[13,"noise",[1,[1,[1,"va","+",[1,[7,"u","x"],"*",[1,"vb","-","va"]]],"+",[1,[7,"u","y"],"*",[1,"vc","-","va"]]],"+",[1,[1,[7,"u","x"],"*",[7,"u","y"]],"*",[1,[1,[1,"va","-","vb"],"-","vc"],"+","vd"]]]],[10,"noise"]]],externalNames:["d","floor","fract","quinticInterpolation2","getJunctionGradientSlot","add","dot","sub"]},get externals(){return{d:ve,floor:kr,fract:Kn,quinticInterpolation2:Ci,getJunctionGradientSlot:jn,add:ue,dot:ae,sub:K}}})&&e.f)({})),"sample");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([F],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=Be(kr(t)),r=Kn(t),s=Ci(r),i=Du(r),p=jn.$(n),y=jn.$(ue(n,Be(1,0))),v=jn.$(ue(n,Be(0,1))),_=jn.$(ue(n,Be(1,1))),P=ae(p,K(r,F(0,0))),U=ae(y,K(r,F(1,0))),R=ae(v,K(r,F(0,1))),j=ae(_,K(r,F(1,1))),L=P+s.x*(U-P)+s.y*(R-P)+s.x*s.y*(P-U-R+j),Z=ue(p,ue(ue(ue(xe(s.x,K(y,p)),xe(s.y,K(v,p))),xe(s.x,xe(s.y,ue(K(K(p,y),v),_)))),xe(i,K(ue(xe(s.yx,P-U-R+j),F(U,R)),P))));return O(L,Z)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[13,"i",[6,[7,"d","vec2i"],[[6,"floor",["pos"]]]]],[13,"f",[6,"fract",["pos"]]],[13,"u",[6,"quinticInterpolation2",["f"]]],[13,"du",[6,"quinticDerivative2",["f"]]],[13,"ga",[6,[7,"getJunctionGradientSlot","$"],["i"]]],[13,"gb",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"1"],[5,"0"]]]]]]]],[13,"gc",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"0"],[5,"1"]]]]]]]],[13,"gd",[6,[7,"getJunctionGradientSlot","$"],[[6,"add",["i",[6,[7,"d","vec2i"],[[5,"1"],[5,"1"]]]]]]]],[13,"va",[6,"dot",["ga",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"0"],[5,"0"]]]]]]]],[13,"vb",[6,"dot",["gb",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"1"],[5,"0"]]]]]]]],[13,"vc",[6,"dot",["gc",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"0"],[5,"1"]]]]]]]],[13,"vd",[6,"dot",["gd",[6,"sub",["f",[6,[7,"d","vec2f"],[[5,"1"],[5,"1"]]]]]]]],[13,"noise",[1,[1,[1,"va","+",[1,[7,"u","x"],"*",[1,"vb","-","va"]]],"+",[1,[7,"u","y"],"*",[1,"vc","-","va"]]],"+",[1,[1,[7,"u","x"],"*",[7,"u","y"]],"*",[1,[1,[1,"va","-","vb"],"-","vc"],"+","vd"]]]],[13,"grad",[6,"add",["ga",[6,"add",[[6,"add",[[6,"add",[[6,"mul",[[7,"u","x"],[6,"sub",["gb","ga"]]]],[6,"mul",[[7,"u","y"],[6,"sub",["gc","ga"]]]]]],[6,"mul",[[7,"u","x"],[6,"mul",[[7,"u","y"],[6,"add",[[6,"sub",[[6,"sub",["ga","gb"]],"gc"]],"gd"]]]]]]]],[6,"mul",["du",[6,"sub",[[6,"add",[[6,"mul",[[7,"u","yx"],[1,[1,[1,"va","-","vb"],"-","vc"],"+","vd"]]],[6,[7,"d","vec2f"],["vb","vc"]]]],"va"]]]]]]]]],[10,[6,[7,"d","vec3f"],["noise","grad"]]]]],externalNames:["d","floor","fract","quinticInterpolation2","quinticDerivative2","getJunctionGradientSlot","add","dot","sub","mul"]},get externals(){return{d:ve,floor:kr,fract:Kn,quinticInterpolation2:Ci,quinticDerivative2:Du,getJunctionGradientSlot:jn,add:ue,dot:ae,sub:K,mul:xe}}})&&e.f)({})),"sampleWithGradient");Yn(F);Yn(F);const Nx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([kt],O)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>(eo(xe(.001,O(t))),Cs())),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[6,"randSeed3",[[6,"mul",[[5,"0.001"],[6,[7,"d","vec3f"],["pos"]]]]]],[10,[6,"randOnUnitSphere",[]]]]],externalNames:["randSeed3","mul","d","randOnUnitSphere"]},get externals(){return{randSeed3:eo,mul:xe,d:ve,randOnUnitSphere:Cs}}})&&e.f)({})),"computeJunctionGradient"),Ru=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.slot(Nx),"getJunctionGradientSlot"),qn=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O,O],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{const r=K(t,n),s=Ru.value(kt(n));return ae(r,s)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"},{type:"i",name:"junction"}],body:[0,[[13,"relative",[6,"sub",["pos","junction"]]],[13,"gridVector",[6,[7,"getJunctionGradientSlot","value"],[[6,[7,"d","vec3i"],["junction"]]]]],[10,[6,"dot",["relative","gridVector"]]]]],externalNames:["sub","getJunctionGradientSlot","d","dot"]},get externals(){return{sub:K,getJunctionGradientSlot:Ru,d:ve,dot:ae}}})&&e.f)({})),"dotProdGrid");(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.fn([O],$)((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{const n=kr(t),r=qn(t,n),s=qn(t,ue(n,O(0,0,1))),i=qn(t,ue(n,O(0,1,0))),p=qn(t,ue(n,O(0,1,1))),y=qn(t,ue(n,O(1,0,0))),v=qn(t,ue(n,O(1,0,1))),_=qn(t,ue(n,O(1,1,0))),P=qn(t,ue(n,O(1,1,1))),U=K(t,n),R=Gu(U),j=tn(r,s,R.z),L=tn(i,p,R.z),Z=tn(y,v,R.z),Q=tn(_,P,R.z),re=tn(j,L,R.y),Me=tn(Z,Q,R.y);return tn(re,Me,R.x)}),{v:1,name:void 0,ast:{params:[{type:"i",name:"pos"}],body:[0,[[13,"minJunction",[6,"floor",["pos"]]],[13,"xyz",[6,"dotProdGrid",["pos","minJunction"]]],[13,"xyZ",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"0"],[5,"0"],[5,"1"]]]]]]]],[13,"xYz",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"0"],[5,"1"],[5,"0"]]]]]]]],[13,"xYZ",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"0"],[5,"1"],[5,"1"]]]]]]]],[13,"Xyz",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"1"],[5,"0"],[5,"0"]]]]]]]],[13,"XyZ",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"1"],[5,"0"],[5,"1"]]]]]]]],[13,"XYz",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"1"],[5,"1"],[5,"0"]]]]]]]],[13,"XYZ",[6,"dotProdGrid",["pos",[6,"add",["minJunction",[6,[7,"d","vec3f"],[[5,"1"],[5,"1"],[5,"1"]]]]]]]],[13,"partial",[6,"sub",["pos","minJunction"]]],[13,"smoothPartial",[6,"quinticInterpolation3",["partial"]]],[13,"xy",[6,"mix",["xyz","xyZ",[7,"smoothPartial","z"]]]],[13,"xY",[6,"mix",["xYz","xYZ",[7,"smoothPartial","z"]]]],[13,"Xy",[6,"mix",["Xyz","XyZ",[7,"smoothPartial","z"]]]],[13,"XY",[6,"mix",["XYz","XYZ",[7,"smoothPartial","z"]]]],[13,"x",[6,"mix",["xy","xY",[7,"smoothPartial","y"]]]],[13,"X",[6,"mix",["Xy","XY",[7,"smoothPartial","y"]]]],[10,[6,"mix",["x","X",[7,"smoothPartial","x"]]]]]],externalNames:["floor","dotProdGrid","add","d","sub","quinticInterpolation3","mix"]},get externals(){return{floor:kr,dotProdGrid:qn,add:ue,d:ve,sub:K,quinticInterpolation3:Gu,mix:tn}}})&&e.f)({})),"sample");Yn(O);Yn(O);const Nu={seed:Sx,seed2:Ka,seed3:eo,seed4:Px,sample:Ux,sampleExclusive:hr,normal:zs,exponential:Vx,cauchy:Gx,bernoulli:Dx,inUnitCircle:Bx,onUnitCircle:to,inUnitCube:Ax,onUnitCube:Ix,inHemisphere:kx,onHemisphere:Ox,inUnitSphere:no,onUnitSphere:Cs},Fx=O(1,2,1.3),bi=64,wa=10,ur=.001,Fu=O(1),Lu=O(.2),ju=O(.6),Yu=.6,Cu=10,qu=.6,xa=1.22,Wu=3,va=3,Ti=.1,ba=.5,Xu=ur*5,us=O(.5,.3,.5),Lx={mass:1,stiffness:1e3,damping:10},jx={mass:1,stiffness:900,damping:12},Yx={mass:1,stiffness:1e3,damping:20},Cx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Cn({direction:O,color:O}),"DirectionalLight"),Gs={SLIDER:1,BACKGROUND:2},Ju=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Cn({distance:$,objectType:Ue}),"HitInfo"),Zu=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Cn({hit:ke,tMin:$,tMax:$}),"BoxIntersection"),Hu=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Cn({origin:O,direction:O}),"Ray"),Qu=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Cn({min:O,max:O}),"BoundingBox"),qx=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Cn({posX:$,posY:$,posZ:$,squashX:$,squashZ:$,wiggleX:$}),"SwitchState"),ap=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.bindGroupLayout({backgroundTexture:{texture:cs($)}}),"rayMarchLayout"),zr=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.bindGroupLayout({currentTexture:{texture:cs()},historyTexture:{texture:cs()},outputTexture:{storageTexture:ti("rgba8unorm","write-only")}}),"taaResolveLayout"),ro=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H.bindGroupLayout({currentTexture:{texture:cs()}}),"sampleLayout");class Ta{value;target;properties;velocity;constructor(t){this.target=0,this.value=this.target,this.properties={...t},this.velocity=0}update(t){const n=-this.properties.stiffness*(this.value-this.target),r=-this.properties.damping*this.velocity,s=(n+r)/this.properties.mass;this.velocity=this.velocity+s*t,this.value=this.value+this.velocity*t}}class Wx{#e;stateUniform;pressed=!1;#t;#n;#r;#s;#i;#a;#o;constructor(t){this.#e=t,this.#t=0,this.#n=0,this.#r=new Ta(Lx),this.#s=new Ta(jx),this.#i=new Ta(Yx),this.#a=0,this.#o=0,this.stateUniform=this.#e.createUniform(qx)}async init(){window.addEventListener("devicemotion",t=>{const n=t.accelerationIncludingGravity;n&&(this.#a=n.x??0,this.#o=n.z??0)})}update(t){if(t<=0)return;const n=this.pressed?0:1,r=100;this.#t<n?this.#n+=r*t:this.#t>n&&(this.#n-=r*t),this.pressed&&this.#t<.1&&(this.#r.velocity=5,this.#s.velocity=5,this.#i.velocity=Math.random()*2-2),this.#t=this.#t+this.#n*t,Math.abs(this.#n)>.1&&(this.#i.velocity=this.#n*-.1),this.#t>1&&(this.#t=1,this.#n=0,this.#r.velocity=5,this.#s.velocity=5,this.#i.velocity=5),this.#t<0&&(this.#t=0,this.#n=0,this.#r.velocity=-5,this.#s.velocity=5,this.#i.velocity=8),this.#t=Lt(this.#t),this.#n*=.95,this.#r.update(t),this.#s.update(t),this.#i.update(t),this.#u()}#u(){this.stateUniform.write({posX:this.#t*(this.#a??0)/-3,posY:this.#t,posZ:this.#t*(this.#o??0)/-3,squashX:this.#r.value,squashZ:this.#s.value,wiggleX:this.#i.value})}}function Xx(e,t){return class extends e{constructor(...n){super(...n),t(this)}}}const Jx=Xx(Array,e=>e.fill(0));let de=1e-6;function Zx(e){function t(T=0,M=0){const z=new e(2);return T!==void 0&&(z[0]=T,M!==void 0&&(z[1]=M)),z}const n=t;function r(T,M,z){const a=z??new e(2);return a[0]=T,a[1]=M,a}function s(T,M){const z=M??new e(2);return z[0]=Math.ceil(T[0]),z[1]=Math.ceil(T[1]),z}function i(T,M){const z=M??new e(2);return z[0]=Math.floor(T[0]),z[1]=Math.floor(T[1]),z}function p(T,M){const z=M??new e(2);return z[0]=Math.round(T[0]),z[1]=Math.round(T[1]),z}function y(T,M=0,z=1,a){const m=a??new e(2);return m[0]=Math.min(z,Math.max(M,T[0])),m[1]=Math.min(z,Math.max(M,T[1])),m}function v(T,M,z){const a=z??new e(2);return a[0]=T[0]+M[0],a[1]=T[1]+M[1],a}function _(T,M,z,a){const m=a??new e(2);return m[0]=T[0]+M[0]*z,m[1]=T[1]+M[1]*z,m}function P(T,M){const z=T[0],a=T[1],m=M[0],l=M[1],h=Math.sqrt(z*z+a*a),u=Math.sqrt(m*m+l*l),d=h*u,b=d&&ht(T,M)/d;return Math.acos(b)}function U(T,M,z){const a=z??new e(2);return a[0]=T[0]-M[0],a[1]=T[1]-M[1],a}const R=U;function j(T,M){return Math.abs(T[0]-M[0])<de&&Math.abs(T[1]-M[1])<de}function L(T,M){return T[0]===M[0]&&T[1]===M[1]}function Z(T,M,z,a){const m=a??new e(2);return m[0]=T[0]+z*(M[0]-T[0]),m[1]=T[1]+z*(M[1]-T[1]),m}function Q(T,M,z,a){const m=a??new e(2);return m[0]=T[0]+z[0]*(M[0]-T[0]),m[1]=T[1]+z[1]*(M[1]-T[1]),m}function re(T,M,z){const a=z??new e(2);return a[0]=Math.max(T[0],M[0]),a[1]=Math.max(T[1],M[1]),a}function Me(T,M,z){const a=z??new e(2);return a[0]=Math.min(T[0],M[0]),a[1]=Math.min(T[1],M[1]),a}function oe(T,M,z){const a=z??new e(2);return a[0]=T[0]*M,a[1]=T[1]*M,a}const be=oe;function ze(T,M,z){const a=z??new e(2);return a[0]=T[0]/M,a[1]=T[1]/M,a}function Se(T,M){const z=M??new e(2);return z[0]=1/T[0],z[1]=1/T[1],z}const Pe=Se;function yt(T,M,z){const a=z??new e(3),m=T[0]*M[1]-T[1]*M[0];return a[0]=0,a[1]=0,a[2]=m,a}function ht(T,M){return T[0]*M[0]+T[1]*M[1]}function it(T){const M=T[0],z=T[1];return Math.sqrt(M*M+z*z)}const Yt=it;function Tt(T){const M=T[0],z=T[1];return M*M+z*z}const Jt=Tt;function gt(T,M){const z=T[0]-M[0],a=T[1]-M[1];return Math.sqrt(z*z+a*a)}const Ee=gt;function Te(T,M){const z=T[0]-M[0],a=T[1]-M[1];return z*z+a*a}const ge=Te;function _t(T,M){const z=M??new e(2),a=T[0],m=T[1],l=Math.sqrt(a*a+m*m);return l>1e-5?(z[0]=a/l,z[1]=m/l):(z[0]=0,z[1]=0),z}function Zt(T,M){const z=M??new e(2);return z[0]=-T[0],z[1]=-T[1],z}function Le(T,M){const z=M??new e(2);return z[0]=T[0],z[1]=T[1],z}const bn=Le;function Ct(T,M,z){const a=z??new e(2);return a[0]=T[0]*M[0],a[1]=T[1]*M[1],a}const Tn=Ct;function qt(T,M,z){const a=z??new e(2);return a[0]=T[0]/M[0],a[1]=T[1]/M[1],a}const un=qt;function ln(T=1,M){const z=M??new e(2),a=Math.random()*2*Math.PI;return z[0]=Math.cos(a)*T,z[1]=Math.sin(a)*T,z}function A(T){const M=T??new e(2);return M[0]=0,M[1]=0,M}function N(T,M,z){const a=z??new e(2),m=T[0],l=T[1];return a[0]=m*M[0]+l*M[4]+M[12],a[1]=m*M[1]+l*M[5]+M[13],a}function x(T,M,z){const a=z??new e(2),m=T[0],l=T[1];return a[0]=M[0]*m+M[4]*l+M[8],a[1]=M[1]*m+M[5]*l+M[9],a}function o(T,M,z,a){const m=a??new e(2),l=T[0]-M[0],h=T[1]-M[1],u=Math.sin(z),d=Math.cos(z);return m[0]=l*d-h*u+M[0],m[1]=l*u+h*d+M[1],m}function f(T,M,z){const a=z??new e(2);return _t(T,a),oe(a,M,a)}function c(T,M,z){const a=z??new e(2);return it(T)>M?f(T,M,a):Le(T,a)}function g(T,M,z){const a=z??new e(2);return Z(T,M,.5,a)}return{create:t,fromValues:n,set:r,ceil:s,floor:i,round:p,clamp:y,add:v,addScaled:_,angle:P,subtract:U,sub:R,equalsApproximately:j,equals:L,lerp:Z,lerpV:Q,max:re,min:Me,mulScalar:oe,scale:be,divScalar:ze,inverse:Se,invert:Pe,cross:yt,dot:ht,length:it,len:Yt,lengthSq:Tt,lenSq:Jt,distance:gt,dist:Ee,distanceSq:Te,distSq:ge,normalize:_t,negate:Zt,copy:Le,clone:bn,multiply:Ct,mul:Tn,divide:qt,div:un,random:ln,zero:A,transformMat4:N,transformMat3:x,rotate:o,setLength:f,truncate:c,midpoint:g}}const Ku=new Map;function op(e){let t=Ku.get(e);return t||(t=Zx(e),Ku.set(e,t)),t}function Hx(e){function t(u,d,b){const w=new e(3);return u!==void 0&&(w[0]=u,d!==void 0&&(w[1]=d,b!==void 0&&(w[2]=b))),w}const n=t;function r(u,d,b,w){const I=w??new e(3);return I[0]=u,I[1]=d,I[2]=b,I}function s(u,d){const b=d??new e(3);return b[0]=Math.ceil(u[0]),b[1]=Math.ceil(u[1]),b[2]=Math.ceil(u[2]),b}function i(u,d){const b=d??new e(3);return b[0]=Math.floor(u[0]),b[1]=Math.floor(u[1]),b[2]=Math.floor(u[2]),b}function p(u,d){const b=d??new e(3);return b[0]=Math.round(u[0]),b[1]=Math.round(u[1]),b[2]=Math.round(u[2]),b}function y(u,d=0,b=1,w){const I=w??new e(3);return I[0]=Math.min(b,Math.max(d,u[0])),I[1]=Math.min(b,Math.max(d,u[1])),I[2]=Math.min(b,Math.max(d,u[2])),I}function v(u,d,b){const w=b??new e(3);return w[0]=u[0]+d[0],w[1]=u[1]+d[1],w[2]=u[2]+d[2],w}function _(u,d,b,w){const I=w??new e(3);return I[0]=u[0]+d[0]*b,I[1]=u[1]+d[1]*b,I[2]=u[2]+d[2]*b,I}function P(u,d){const b=u[0],w=u[1],I=u[2],V=d[0],D=d[1],X=d[2],Y=Math.sqrt(b*b+w*w+I*I),C=Math.sqrt(V*V+D*D+X*X),te=Y*C,le=te&&ht(u,d)/te;return Math.acos(le)}function U(u,d,b){const w=b??new e(3);return w[0]=u[0]-d[0],w[1]=u[1]-d[1],w[2]=u[2]-d[2],w}const R=U;function j(u,d){return Math.abs(u[0]-d[0])<de&&Math.abs(u[1]-d[1])<de&&Math.abs(u[2]-d[2])<de}function L(u,d){return u[0]===d[0]&&u[1]===d[1]&&u[2]===d[2]}function Z(u,d,b,w){const I=w??new e(3);return I[0]=u[0]+b*(d[0]-u[0]),I[1]=u[1]+b*(d[1]-u[1]),I[2]=u[2]+b*(d[2]-u[2]),I}function Q(u,d,b,w){const I=w??new e(3);return I[0]=u[0]+b[0]*(d[0]-u[0]),I[1]=u[1]+b[1]*(d[1]-u[1]),I[2]=u[2]+b[2]*(d[2]-u[2]),I}function re(u,d,b){const w=b??new e(3);return w[0]=Math.max(u[0],d[0]),w[1]=Math.max(u[1],d[1]),w[2]=Math.max(u[2],d[2]),w}function Me(u,d,b){const w=b??new e(3);return w[0]=Math.min(u[0],d[0]),w[1]=Math.min(u[1],d[1]),w[2]=Math.min(u[2],d[2]),w}function oe(u,d,b){const w=b??new e(3);return w[0]=u[0]*d,w[1]=u[1]*d,w[2]=u[2]*d,w}const be=oe;function ze(u,d,b){const w=b??new e(3);return w[0]=u[0]/d,w[1]=u[1]/d,w[2]=u[2]/d,w}function Se(u,d){const b=d??new e(3);return b[0]=1/u[0],b[1]=1/u[1],b[2]=1/u[2],b}const Pe=Se;function yt(u,d,b){const w=b??new e(3),I=u[2]*d[0]-u[0]*d[2],V=u[0]*d[1]-u[1]*d[0];return w[0]=u[1]*d[2]-u[2]*d[1],w[1]=I,w[2]=V,w}function ht(u,d){return u[0]*d[0]+u[1]*d[1]+u[2]*d[2]}function it(u){const d=u[0],b=u[1],w=u[2];return Math.sqrt(d*d+b*b+w*w)}const Yt=it;function Tt(u){const d=u[0],b=u[1],w=u[2];return d*d+b*b+w*w}const Jt=Tt;function gt(u,d){const b=u[0]-d[0],w=u[1]-d[1],I=u[2]-d[2];return Math.sqrt(b*b+w*w+I*I)}const Ee=gt;function Te(u,d){const b=u[0]-d[0],w=u[1]-d[1],I=u[2]-d[2];return b*b+w*w+I*I}const ge=Te;function _t(u,d){const b=d??new e(3),w=u[0],I=u[1],V=u[2],D=Math.sqrt(w*w+I*I+V*V);return D>1e-5?(b[0]=w/D,b[1]=I/D,b[2]=V/D):(b[0]=0,b[1]=0,b[2]=0),b}function Zt(u,d){const b=d??new e(3);return b[0]=-u[0],b[1]=-u[1],b[2]=-u[2],b}function Le(u,d){const b=d??new e(3);return b[0]=u[0],b[1]=u[1],b[2]=u[2],b}const bn=Le;function Ct(u,d,b){const w=b??new e(3);return w[0]=u[0]*d[0],w[1]=u[1]*d[1],w[2]=u[2]*d[2],w}const Tn=Ct;function qt(u,d,b){const w=b??new e(3);return w[0]=u[0]/d[0],w[1]=u[1]/d[1],w[2]=u[2]/d[2],w}const un=qt;function ln(u=1,d){const b=d??new e(3),w=Math.random()*2*Math.PI,I=Math.random()*2-1,V=Math.sqrt(1-I*I)*u;return b[0]=Math.cos(w)*V,b[1]=Math.sin(w)*V,b[2]=I*u,b}function A(u){const d=u??new e(3);return d[0]=0,d[1]=0,d[2]=0,d}function N(u,d,b){const w=b??new e(3),I=u[0],V=u[1],D=u[2],X=d[3]*I+d[7]*V+d[11]*D+d[15]||1;return w[0]=(d[0]*I+d[4]*V+d[8]*D+d[12])/X,w[1]=(d[1]*I+d[5]*V+d[9]*D+d[13])/X,w[2]=(d[2]*I+d[6]*V+d[10]*D+d[14])/X,w}function x(u,d,b){const w=b??new e(3),I=u[0],V=u[1],D=u[2];return w[0]=I*d[0]+V*d[4]+D*d[8],w[1]=I*d[1]+V*d[5]+D*d[9],w[2]=I*d[2]+V*d[6]+D*d[10],w}function o(u,d,b){const w=b??new e(3),I=u[0],V=u[1],D=u[2];return w[0]=I*d[0]+V*d[4]+D*d[8],w[1]=I*d[1]+V*d[5]+D*d[9],w[2]=I*d[2]+V*d[6]+D*d[10],w}function f(u,d,b){const w=b??new e(3),I=d[0],V=d[1],D=d[2],X=d[3]*2,Y=u[0],C=u[1],te=u[2],le=V*te-D*C,ne=D*Y-I*te,se=I*C-V*Y;return w[0]=Y+le*X+(V*se-D*ne)*2,w[1]=C+ne*X+(D*le-I*se)*2,w[2]=te+se*X+(I*ne-V*le)*2,w}function c(u,d){const b=d??new e(3);return b[0]=u[12],b[1]=u[13],b[2]=u[14],b}function g(u,d,b){const w=b??new e(3),I=d*4;return w[0]=u[I+0],w[1]=u[I+1],w[2]=u[I+2],w}function T(u,d){const b=d??new e(3),w=u[0],I=u[1],V=u[2],D=u[4],X=u[5],Y=u[6],C=u[8],te=u[9],le=u[10];return b[0]=Math.sqrt(w*w+I*I+V*V),b[1]=Math.sqrt(D*D+X*X+Y*Y),b[2]=Math.sqrt(C*C+te*te+le*le),b}function M(u,d,b,w){const I=w??new e(3),V=[],D=[];return V[0]=u[0]-d[0],V[1]=u[1]-d[1],V[2]=u[2]-d[2],D[0]=V[0],D[1]=V[1]*Math.cos(b)-V[2]*Math.sin(b),D[2]=V[1]*Math.sin(b)+V[2]*Math.cos(b),I[0]=D[0]+d[0],I[1]=D[1]+d[1],I[2]=D[2]+d[2],I}function z(u,d,b,w){const I=w??new e(3),V=[],D=[];return V[0]=u[0]-d[0],V[1]=u[1]-d[1],V[2]=u[2]-d[2],D[0]=V[2]*Math.sin(b)+V[0]*Math.cos(b),D[1]=V[1],D[2]=V[2]*Math.cos(b)-V[0]*Math.sin(b),I[0]=D[0]+d[0],I[1]=D[1]+d[1],I[2]=D[2]+d[2],I}function a(u,d,b,w){const I=w??new e(3),V=[],D=[];return V[0]=u[0]-d[0],V[1]=u[1]-d[1],V[2]=u[2]-d[2],D[0]=V[0]*Math.cos(b)-V[1]*Math.sin(b),D[1]=V[0]*Math.sin(b)+V[1]*Math.cos(b),D[2]=V[2],I[0]=D[0]+d[0],I[1]=D[1]+d[1],I[2]=D[2]+d[2],I}function m(u,d,b){const w=b??new e(3);return _t(u,w),oe(w,d,w)}function l(u,d,b){const w=b??new e(3);return it(u)>d?m(u,d,w):Le(u,w)}function h(u,d,b){const w=b??new e(3);return Z(u,d,.5,w)}return{create:t,fromValues:n,set:r,ceil:s,floor:i,round:p,clamp:y,add:v,addScaled:_,angle:P,subtract:U,sub:R,equalsApproximately:j,equals:L,lerp:Z,lerpV:Q,max:re,min:Me,mulScalar:oe,scale:be,divScalar:ze,inverse:Se,invert:Pe,cross:yt,dot:ht,length:it,len:Yt,lengthSq:Tt,lenSq:Jt,distance:gt,dist:Ee,distanceSq:Te,distSq:ge,normalize:_t,negate:Zt,copy:Le,clone:bn,multiply:Ct,mul:Tn,divide:qt,div:un,random:ln,zero:A,transformMat4:N,transformMat4Upper3x3:x,transformMat3:o,transformQuat:f,getTranslation:c,getAxis:g,getScaling:T,rotateX:M,rotateY:z,rotateZ:a,setLength:m,truncate:l,midpoint:h}}const el=new Map;function ha(e){let t=el.get(e);return t||(t=Hx(e),el.set(e,t)),t}function Qx(e){const t=op(e),n=ha(e);function r(o,f,c,g,T,M,z,a,m){const l=new e(12);return l[3]=0,l[7]=0,l[11]=0,o!==void 0&&(l[0]=o,f!==void 0&&(l[1]=f,c!==void 0&&(l[2]=c,g!==void 0&&(l[4]=g,T!==void 0&&(l[5]=T,M!==void 0&&(l[6]=M,z!==void 0&&(l[8]=z,a!==void 0&&(l[9]=a,m!==void 0&&(l[10]=m))))))))),l}function s(o,f,c,g,T,M,z,a,m,l){const h=l??new e(12);return h[0]=o,h[1]=f,h[2]=c,h[3]=0,h[4]=g,h[5]=T,h[6]=M,h[7]=0,h[8]=z,h[9]=a,h[10]=m,h[11]=0,h}function i(o,f){const c=f??new e(12);return c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=0,c[4]=o[4],c[5]=o[5],c[6]=o[6],c[7]=0,c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=0,c}function p(o,f){const c=f??new e(12),g=o[0],T=o[1],M=o[2],z=o[3],a=g+g,m=T+T,l=M+M,h=g*a,u=T*a,d=T*m,b=M*a,w=M*m,I=M*l,V=z*a,D=z*m,X=z*l;return c[0]=1-d-I,c[1]=u+X,c[2]=b-D,c[3]=0,c[4]=u-X,c[5]=1-h-I,c[6]=w+V,c[7]=0,c[8]=b+D,c[9]=w-V,c[10]=1-h-d,c[11]=0,c}function y(o,f){const c=f??new e(12);return c[0]=-o[0],c[1]=-o[1],c[2]=-o[2],c[4]=-o[4],c[5]=-o[5],c[6]=-o[6],c[8]=-o[8],c[9]=-o[9],c[10]=-o[10],c}function v(o,f,c){const g=c??new e(12);return g[0]=o[0]*f,g[1]=o[1]*f,g[2]=o[2]*f,g[4]=o[4]*f,g[5]=o[5]*f,g[6]=o[6]*f,g[8]=o[8]*f,g[9]=o[9]*f,g[10]=o[10]*f,g}const _=v;function P(o,f,c){const g=c??new e(12);return g[0]=o[0]+f[0],g[1]=o[1]+f[1],g[2]=o[2]+f[2],g[4]=o[4]+f[4],g[5]=o[5]+f[5],g[6]=o[6]+f[6],g[8]=o[8]+f[8],g[9]=o[9]+f[9],g[10]=o[10]+f[10],g}function U(o,f){const c=f??new e(12);return c[0]=o[0],c[1]=o[1],c[2]=o[2],c[4]=o[4],c[5]=o[5],c[6]=o[6],c[8]=o[8],c[9]=o[9],c[10]=o[10],c}const R=U;function j(o,f){return Math.abs(o[0]-f[0])<de&&Math.abs(o[1]-f[1])<de&&Math.abs(o[2]-f[2])<de&&Math.abs(o[4]-f[4])<de&&Math.abs(o[5]-f[5])<de&&Math.abs(o[6]-f[6])<de&&Math.abs(o[8]-f[8])<de&&Math.abs(o[9]-f[9])<de&&Math.abs(o[10]-f[10])<de}function L(o,f){return o[0]===f[0]&&o[1]===f[1]&&o[2]===f[2]&&o[4]===f[4]&&o[5]===f[5]&&o[6]===f[6]&&o[8]===f[8]&&o[9]===f[9]&&o[10]===f[10]}function Z(o){const f=o??new e(12);return f[0]=1,f[1]=0,f[2]=0,f[4]=0,f[5]=1,f[6]=0,f[8]=0,f[9]=0,f[10]=1,f}function Q(o,f){const c=f??new e(12);if(c===o){let d;return d=o[1],o[1]=o[4],o[4]=d,d=o[2],o[2]=o[8],o[8]=d,d=o[6],o[6]=o[9],o[9]=d,c}const g=o[0],T=o[1],M=o[2],z=o[4],a=o[5],m=o[6],l=o[8],h=o[9],u=o[10];return c[0]=g,c[1]=z,c[2]=l,c[4]=T,c[5]=a,c[6]=h,c[8]=M,c[9]=m,c[10]=u,c}function re(o,f){const c=f??new e(12),g=o[0],T=o[1],M=o[2],z=o[4],a=o[5],m=o[6],l=o[8],h=o[9],u=o[10],d=u*a-m*h,b=-u*z+m*l,w=h*z-a*l,I=1/(g*d+T*b+M*w);return c[0]=d*I,c[1]=(-u*T+M*h)*I,c[2]=(m*T-M*a)*I,c[4]=b*I,c[5]=(u*g-M*l)*I,c[6]=(-m*g+M*z)*I,c[8]=w*I,c[9]=(-h*g+T*l)*I,c[10]=(a*g-T*z)*I,c}function Me(o){const f=o[0],c=o[1],g=o[2],T=o[4],M=o[5],z=o[6],a=o[8],m=o[9],l=o[10];return f*(M*l-m*z)-T*(c*l-m*g)+a*(c*z-M*g)}const oe=re;function be(o,f,c){const g=c??new e(12),T=o[0],M=o[1],z=o[2],a=o[4],m=o[5],l=o[6],h=o[8],u=o[9],d=o[10],b=f[0],w=f[1],I=f[2],V=f[4],D=f[5],X=f[6],Y=f[8],C=f[9],te=f[10];return g[0]=T*b+a*w+h*I,g[1]=M*b+m*w+u*I,g[2]=z*b+l*w+d*I,g[4]=T*V+a*D+h*X,g[5]=M*V+m*D+u*X,g[6]=z*V+l*D+d*X,g[8]=T*Y+a*C+h*te,g[9]=M*Y+m*C+u*te,g[10]=z*Y+l*C+d*te,g}const ze=be;function Se(o,f,c){const g=c??Z();return o!==g&&(g[0]=o[0],g[1]=o[1],g[2]=o[2],g[4]=o[4],g[5]=o[5],g[6]=o[6]),g[8]=f[0],g[9]=f[1],g[10]=1,g}function Pe(o,f){const c=f??t.create();return c[0]=o[8],c[1]=o[9],c}function yt(o,f,c){const g=c??t.create(),T=f*4;return g[0]=o[T+0],g[1]=o[T+1],g}function ht(o,f,c,g){const T=g===o?o:U(o,g),M=c*4;return T[M+0]=f[0],T[M+1]=f[1],T}function it(o,f){const c=f??t.create(),g=o[0],T=o[1],M=o[4],z=o[5];return c[0]=Math.sqrt(g*g+T*T),c[1]=Math.sqrt(M*M+z*z),c}function Yt(o,f){const c=f??n.create(),g=o[0],T=o[1],M=o[2],z=o[4],a=o[5],m=o[6],l=o[8],h=o[9],u=o[10];return c[0]=Math.sqrt(g*g+T*T+M*M),c[1]=Math.sqrt(z*z+a*a+m*m),c[2]=Math.sqrt(l*l+h*h+u*u),c}function Tt(o,f){const c=f??new e(12);return c[0]=1,c[1]=0,c[2]=0,c[4]=0,c[5]=1,c[6]=0,c[8]=o[0],c[9]=o[1],c[10]=1,c}function Jt(o,f,c){const g=c??new e(12),T=f[0],M=f[1],z=o[0],a=o[1],m=o[2],l=o[4],h=o[5],u=o[6],d=o[8],b=o[9],w=o[10];return o!==g&&(g[0]=z,g[1]=a,g[2]=m,g[4]=l,g[5]=h,g[6]=u),g[8]=z*T+l*M+d,g[9]=a*T+h*M+b,g[10]=m*T+u*M+w,g}function gt(o,f){const c=f??new e(12),g=Math.cos(o),T=Math.sin(o);return c[0]=g,c[1]=T,c[2]=0,c[4]=-T,c[5]=g,c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function Ee(o,f,c){const g=c??new e(12),T=o[0],M=o[1],z=o[2],a=o[4],m=o[5],l=o[6],h=Math.cos(f),u=Math.sin(f);return g[0]=h*T+u*a,g[1]=h*M+u*m,g[2]=h*z+u*l,g[4]=h*a-u*T,g[5]=h*m-u*M,g[6]=h*l-u*z,o!==g&&(g[8]=o[8],g[9]=o[9],g[10]=o[10]),g}function Te(o,f){const c=f??new e(12),g=Math.cos(o),T=Math.sin(o);return c[0]=1,c[1]=0,c[2]=0,c[4]=0,c[5]=g,c[6]=T,c[8]=0,c[9]=-T,c[10]=g,c}function ge(o,f,c){const g=c??new e(12),T=o[4],M=o[5],z=o[6],a=o[8],m=o[9],l=o[10],h=Math.cos(f),u=Math.sin(f);return g[4]=h*T+u*a,g[5]=h*M+u*m,g[6]=h*z+u*l,g[8]=h*a-u*T,g[9]=h*m-u*M,g[10]=h*l-u*z,o!==g&&(g[0]=o[0],g[1]=o[1],g[2]=o[2]),g}function _t(o,f){const c=f??new e(12),g=Math.cos(o),T=Math.sin(o);return c[0]=g,c[1]=0,c[2]=-T,c[4]=0,c[5]=1,c[6]=0,c[8]=T,c[9]=0,c[10]=g,c}function Zt(o,f,c){const g=c??new e(12),T=o[0],M=o[1],z=o[2],a=o[8],m=o[9],l=o[10],h=Math.cos(f),u=Math.sin(f);return g[0]=h*T-u*a,g[1]=h*M-u*m,g[2]=h*z-u*l,g[8]=h*a+u*T,g[9]=h*m+u*M,g[10]=h*l+u*z,o!==g&&(g[4]=o[4],g[5]=o[5],g[6]=o[6]),g}const Le=gt,bn=Ee;function Ct(o,f){const c=f??new e(12);return c[0]=o[0],c[1]=0,c[2]=0,c[4]=0,c[5]=o[1],c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function Tn(o,f,c){const g=c??new e(12),T=f[0],M=f[1];return g[0]=T*o[0],g[1]=T*o[1],g[2]=T*o[2],g[4]=M*o[4],g[5]=M*o[5],g[6]=M*o[6],o!==g&&(g[8]=o[8],g[9]=o[9],g[10]=o[10]),g}function qt(o,f){const c=f??new e(12);return c[0]=o[0],c[1]=0,c[2]=0,c[4]=0,c[5]=o[1],c[6]=0,c[8]=0,c[9]=0,c[10]=o[2],c}function un(o,f,c){const g=c??new e(12),T=f[0],M=f[1],z=f[2];return g[0]=T*o[0],g[1]=T*o[1],g[2]=T*o[2],g[4]=M*o[4],g[5]=M*o[5],g[6]=M*o[6],g[8]=z*o[8],g[9]=z*o[9],g[10]=z*o[10],g}function ln(o,f){const c=f??new e(12);return c[0]=o,c[1]=0,c[2]=0,c[4]=0,c[5]=o,c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function A(o,f,c){const g=c??new e(12);return g[0]=f*o[0],g[1]=f*o[1],g[2]=f*o[2],g[4]=f*o[4],g[5]=f*o[5],g[6]=f*o[6],o!==g&&(g[8]=o[8],g[9]=o[9],g[10]=o[10]),g}function N(o,f){const c=f??new e(12);return c[0]=o,c[1]=0,c[2]=0,c[4]=0,c[5]=o,c[6]=0,c[8]=0,c[9]=0,c[10]=o,c}function x(o,f,c){const g=c??new e(12);return g[0]=f*o[0],g[1]=f*o[1],g[2]=f*o[2],g[4]=f*o[4],g[5]=f*o[5],g[6]=f*o[6],g[8]=f*o[8],g[9]=f*o[9],g[10]=f*o[10],g}return{add:P,clone:R,copy:U,create:r,determinant:Me,equals:L,equalsApproximately:j,fromMat4:i,fromQuat:p,get3DScaling:Yt,getAxis:yt,getScaling:it,getTranslation:Pe,identity:Z,inverse:re,invert:oe,mul:ze,mulScalar:_,multiply:be,multiplyScalar:v,negate:y,rotate:Ee,rotateX:ge,rotateY:Zt,rotateZ:bn,rotation:gt,rotationX:Te,rotationY:_t,rotationZ:Le,scale:Tn,scale3D:un,scaling:Ct,scaling3D:qt,set:s,setAxis:ht,setTranslation:Se,translate:Jt,translation:Tt,transpose:Q,uniformScale:A,uniformScale3D:x,uniformScaling:ln,uniformScaling3D:N}}const tl=new Map;function Kx(e){let t=tl.get(e);return t||(t=Qx(e),tl.set(e,t)),t}function e2(e){const t=ha(e);function n(a,m,l,h,u,d,b,w,I,V,D,X,Y,C,te,le){const ne=new e(16);return a!==void 0&&(ne[0]=a,m!==void 0&&(ne[1]=m,l!==void 0&&(ne[2]=l,h!==void 0&&(ne[3]=h,u!==void 0&&(ne[4]=u,d!==void 0&&(ne[5]=d,b!==void 0&&(ne[6]=b,w!==void 0&&(ne[7]=w,I!==void 0&&(ne[8]=I,V!==void 0&&(ne[9]=V,D!==void 0&&(ne[10]=D,X!==void 0&&(ne[11]=X,Y!==void 0&&(ne[12]=Y,C!==void 0&&(ne[13]=C,te!==void 0&&(ne[14]=te,le!==void 0&&(ne[15]=le)))))))))))))))),ne}function r(a,m,l,h,u,d,b,w,I,V,D,X,Y,C,te,le,ne){const se=ne??new e(16);return se[0]=a,se[1]=m,se[2]=l,se[3]=h,se[4]=u,se[5]=d,se[6]=b,se[7]=w,se[8]=I,se[9]=V,se[10]=D,se[11]=X,se[12]=Y,se[13]=C,se[14]=te,se[15]=le,se}function s(a,m){const l=m??new e(16);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=0,l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=0,l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function i(a,m){const l=m??new e(16),h=a[0],u=a[1],d=a[2],b=a[3],w=h+h,I=u+u,V=d+d,D=h*w,X=u*w,Y=u*I,C=d*w,te=d*I,le=d*V,ne=b*w,se=b*I,De=b*V;return l[0]=1-Y-le,l[1]=X+De,l[2]=C-se,l[3]=0,l[4]=X-De,l[5]=1-D-le,l[6]=te+ne,l[7]=0,l[8]=C+se,l[9]=te-ne,l[10]=1-D-Y,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function p(a,m){const l=m??new e(16);return l[0]=-a[0],l[1]=-a[1],l[2]=-a[2],l[3]=-a[3],l[4]=-a[4],l[5]=-a[5],l[6]=-a[6],l[7]=-a[7],l[8]=-a[8],l[9]=-a[9],l[10]=-a[10],l[11]=-a[11],l[12]=-a[12],l[13]=-a[13],l[14]=-a[14],l[15]=-a[15],l}function y(a,m,l){const h=l??new e(16);return h[0]=a[0]+m[0],h[1]=a[1]+m[1],h[2]=a[2]+m[2],h[3]=a[3]+m[3],h[4]=a[4]+m[4],h[5]=a[5]+m[5],h[6]=a[6]+m[6],h[7]=a[7]+m[7],h[8]=a[8]+m[8],h[9]=a[9]+m[9],h[10]=a[10]+m[10],h[11]=a[11]+m[11],h[12]=a[12]+m[12],h[13]=a[13]+m[13],h[14]=a[14]+m[14],h[15]=a[15]+m[15],h}function v(a,m,l){const h=l??new e(16);return h[0]=a[0]*m,h[1]=a[1]*m,h[2]=a[2]*m,h[3]=a[3]*m,h[4]=a[4]*m,h[5]=a[5]*m,h[6]=a[6]*m,h[7]=a[7]*m,h[8]=a[8]*m,h[9]=a[9]*m,h[10]=a[10]*m,h[11]=a[11]*m,h[12]=a[12]*m,h[13]=a[13]*m,h[14]=a[14]*m,h[15]=a[15]*m,h}const _=v;function P(a,m){const l=m??new e(16);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=a[3],l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=a[7],l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=a[11],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15],l}const U=P;function R(a,m){return Math.abs(a[0]-m[0])<de&&Math.abs(a[1]-m[1])<de&&Math.abs(a[2]-m[2])<de&&Math.abs(a[3]-m[3])<de&&Math.abs(a[4]-m[4])<de&&Math.abs(a[5]-m[5])<de&&Math.abs(a[6]-m[6])<de&&Math.abs(a[7]-m[7])<de&&Math.abs(a[8]-m[8])<de&&Math.abs(a[9]-m[9])<de&&Math.abs(a[10]-m[10])<de&&Math.abs(a[11]-m[11])<de&&Math.abs(a[12]-m[12])<de&&Math.abs(a[13]-m[13])<de&&Math.abs(a[14]-m[14])<de&&Math.abs(a[15]-m[15])<de}function j(a,m){return a[0]===m[0]&&a[1]===m[1]&&a[2]===m[2]&&a[3]===m[3]&&a[4]===m[4]&&a[5]===m[5]&&a[6]===m[6]&&a[7]===m[7]&&a[8]===m[8]&&a[9]===m[9]&&a[10]===m[10]&&a[11]===m[11]&&a[12]===m[12]&&a[13]===m[13]&&a[14]===m[14]&&a[15]===m[15]}function L(a){const m=a??new e(16);return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function Z(a,m){const l=m??new e(16);if(l===a){let Ae;return Ae=a[1],a[1]=a[4],a[4]=Ae,Ae=a[2],a[2]=a[8],a[8]=Ae,Ae=a[3],a[3]=a[12],a[12]=Ae,Ae=a[6],a[6]=a[9],a[9]=Ae,Ae=a[7],a[7]=a[13],a[13]=Ae,Ae=a[11],a[11]=a[14],a[14]=Ae,l}const h=a[0],u=a[1],d=a[2],b=a[3],w=a[4],I=a[5],V=a[6],D=a[7],X=a[8],Y=a[9],C=a[10],te=a[11],le=a[12],ne=a[13],se=a[14],De=a[15];return l[0]=h,l[1]=w,l[2]=X,l[3]=le,l[4]=u,l[5]=I,l[6]=Y,l[7]=ne,l[8]=d,l[9]=V,l[10]=C,l[11]=se,l[12]=b,l[13]=D,l[14]=te,l[15]=De,l}function Q(a,m){const l=m??new e(16),h=a[0],u=a[1],d=a[2],b=a[3],w=a[4],I=a[5],V=a[6],D=a[7],X=a[8],Y=a[9],C=a[10],te=a[11],le=a[12],ne=a[13],se=a[14],De=a[15],Ae=C*De,pt=se*te,dt=V*De,ft=se*D,$t=V*te,Et=C*D,St=d*De,Pt=se*b,Ut=d*te,At=C*b,Ot=d*D,Vt=V*b,Gt=X*ne,Dt=le*Y,Ht=w*ne,Qt=le*I,Kt=w*Y,ii=X*I,ai=h*ne,oi=le*u,ui=h*Y,li=X*u,ci=h*I,hi=w*u,Zo=Ae*I+ft*Y+$t*ne-(pt*I+dt*Y+Et*ne),Ho=pt*u+St*Y+At*ne-(Ae*u+Pt*Y+Ut*ne),Qo=dt*u+Pt*I+Ot*ne-(ft*u+St*I+Vt*ne),Ko=Et*u+Ut*I+Vt*Y-($t*u+At*I+Ot*Y),It=1/(h*Zo+w*Ho+X*Qo+le*Ko);return l[0]=It*Zo,l[1]=It*Ho,l[2]=It*Qo,l[3]=It*Ko,l[4]=It*(pt*w+dt*X+Et*le-(Ae*w+ft*X+$t*le)),l[5]=It*(Ae*h+Pt*X+Ut*le-(pt*h+St*X+At*le)),l[6]=It*(ft*h+St*w+Vt*le-(dt*h+Pt*w+Ot*le)),l[7]=It*($t*h+At*w+Ot*X-(Et*h+Ut*w+Vt*X)),l[8]=It*(Gt*D+Qt*te+Kt*De-(Dt*D+Ht*te+ii*De)),l[9]=It*(Dt*b+ai*te+li*De-(Gt*b+oi*te+ui*De)),l[10]=It*(Ht*b+oi*D+ci*De-(Qt*b+ai*D+hi*De)),l[11]=It*(ii*b+ui*D+hi*te-(Kt*b+li*D+ci*te)),l[12]=It*(Ht*C+ii*se+Dt*V-(Kt*se+Gt*V+Qt*C)),l[13]=It*(ui*se+Gt*d+oi*C-(ai*C+li*se+Dt*d)),l[14]=It*(ai*V+hi*se+Qt*d-(ci*se+Ht*d+oi*V)),l[15]=It*(ci*C+Kt*d+li*V-(ui*V+hi*C+ii*d)),l}function re(a){const m=a[0],l=a[1],h=a[2],u=a[3],d=a[4],b=a[5],w=a[6],I=a[7],V=a[8],D=a[9],X=a[10],Y=a[11],C=a[12],te=a[13],le=a[14],ne=a[15],se=X*ne,De=le*Y,Ae=w*ne,pt=le*I,dt=w*Y,ft=X*I,$t=h*ne,Et=le*u,St=h*Y,Pt=X*u,Ut=h*I,At=w*u,Ot=se*b+pt*D+dt*te-(De*b+Ae*D+ft*te),Vt=De*l+$t*D+Pt*te-(se*l+Et*D+St*te),Gt=Ae*l+Et*b+Ut*te-(pt*l+$t*b+At*te),Dt=ft*l+St*b+At*D-(dt*l+Pt*b+Ut*D);return m*Ot+d*Vt+V*Gt+C*Dt}const Me=Q;function oe(a,m,l){const h=l??new e(16),u=a[0],d=a[1],b=a[2],w=a[3],I=a[4],V=a[5],D=a[6],X=a[7],Y=a[8],C=a[9],te=a[10],le=a[11],ne=a[12],se=a[13],De=a[14],Ae=a[15],pt=m[0],dt=m[1],ft=m[2],$t=m[3],Et=m[4],St=m[5],Pt=m[6],Ut=m[7],At=m[8],Ot=m[9],Vt=m[10],Gt=m[11],Dt=m[12],Ht=m[13],Qt=m[14],Kt=m[15];return h[0]=u*pt+I*dt+Y*ft+ne*$t,h[1]=d*pt+V*dt+C*ft+se*$t,h[2]=b*pt+D*dt+te*ft+De*$t,h[3]=w*pt+X*dt+le*ft+Ae*$t,h[4]=u*Et+I*St+Y*Pt+ne*Ut,h[5]=d*Et+V*St+C*Pt+se*Ut,h[6]=b*Et+D*St+te*Pt+De*Ut,h[7]=w*Et+X*St+le*Pt+Ae*Ut,h[8]=u*At+I*Ot+Y*Vt+ne*Gt,h[9]=d*At+V*Ot+C*Vt+se*Gt,h[10]=b*At+D*Ot+te*Vt+De*Gt,h[11]=w*At+X*Ot+le*Vt+Ae*Gt,h[12]=u*Dt+I*Ht+Y*Qt+ne*Kt,h[13]=d*Dt+V*Ht+C*Qt+se*Kt,h[14]=b*Dt+D*Ht+te*Qt+De*Kt,h[15]=w*Dt+X*Ht+le*Qt+Ae*Kt,h}const be=oe;function ze(a,m,l){const h=l??L();return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11]),h[12]=m[0],h[13]=m[1],h[14]=m[2],h[15]=1,h}function Se(a,m){const l=m??t.create();return l[0]=a[12],l[1]=a[13],l[2]=a[14],l}function Pe(a,m,l){const h=l??t.create(),u=m*4;return h[0]=a[u+0],h[1]=a[u+1],h[2]=a[u+2],h}function yt(a,m,l,h){const u=h===a?h:P(a,h),d=l*4;return u[d+0]=m[0],u[d+1]=m[1],u[d+2]=m[2],u}function ht(a,m){const l=m??t.create(),h=a[0],u=a[1],d=a[2],b=a[4],w=a[5],I=a[6],V=a[8],D=a[9],X=a[10];return l[0]=Math.sqrt(h*h+u*u+d*d),l[1]=Math.sqrt(b*b+w*w+I*I),l[2]=Math.sqrt(V*V+D*D+X*X),l}function it(a,m,l,h,u){const d=u??new e(16),b=Math.tan(Math.PI*.5-.5*a);if(d[0]=b/m,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=b,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,Number.isFinite(h)){const w=1/(l-h);d[10]=h*w,d[14]=h*l*w}else d[10]=-1,d[14]=-l;return d}function Yt(a,m,l,h=1/0,u){const d=u??new e(16),b=1/Math.tan(a*.5);if(d[0]=b/m,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=b,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,h===1/0)d[10]=0,d[14]=l;else{const w=1/(h-l);d[10]=l*w,d[14]=h*l*w}return d}function Tt(a,m,l,h,u,d,b){const w=b??new e(16);return w[0]=2/(m-a),w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2/(h-l),w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1/(u-d),w[11]=0,w[12]=(m+a)/(a-m),w[13]=(h+l)/(l-h),w[14]=u/(u-d),w[15]=1,w}function Jt(a,m,l,h,u,d,b){const w=b??new e(16),I=m-a,V=h-l,D=u-d;return w[0]=2*u/I,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2*u/V,w[6]=0,w[7]=0,w[8]=(a+m)/I,w[9]=(h+l)/V,w[10]=d/D,w[11]=-1,w[12]=0,w[13]=0,w[14]=u*d/D,w[15]=0,w}function gt(a,m,l,h,u,d=1/0,b){const w=b??new e(16),I=m-a,V=h-l;if(w[0]=2*u/I,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2*u/V,w[6]=0,w[7]=0,w[8]=(a+m)/I,w[9]=(h+l)/V,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,d===1/0)w[10]=0,w[14]=u;else{const D=1/(d-u);w[10]=u*D,w[14]=d*u*D}return w}const Ee=t.create(),Te=t.create(),ge=t.create();function _t(a,m,l,h){const u=h??new e(16);return t.normalize(t.subtract(m,a,ge),ge),t.normalize(t.cross(l,ge,Ee),Ee),t.normalize(t.cross(ge,Ee,Te),Te),u[0]=Ee[0],u[1]=Ee[1],u[2]=Ee[2],u[3]=0,u[4]=Te[0],u[5]=Te[1],u[6]=Te[2],u[7]=0,u[8]=ge[0],u[9]=ge[1],u[10]=ge[2],u[11]=0,u[12]=a[0],u[13]=a[1],u[14]=a[2],u[15]=1,u}function Zt(a,m,l,h){const u=h??new e(16);return t.normalize(t.subtract(a,m,ge),ge),t.normalize(t.cross(l,ge,Ee),Ee),t.normalize(t.cross(ge,Ee,Te),Te),u[0]=Ee[0],u[1]=Ee[1],u[2]=Ee[2],u[3]=0,u[4]=Te[0],u[5]=Te[1],u[6]=Te[2],u[7]=0,u[8]=ge[0],u[9]=ge[1],u[10]=ge[2],u[11]=0,u[12]=a[0],u[13]=a[1],u[14]=a[2],u[15]=1,u}function Le(a,m,l,h){const u=h??new e(16);return t.normalize(t.subtract(a,m,ge),ge),t.normalize(t.cross(l,ge,Ee),Ee),t.normalize(t.cross(ge,Ee,Te),Te),u[0]=Ee[0],u[1]=Te[0],u[2]=ge[0],u[3]=0,u[4]=Ee[1],u[5]=Te[1],u[6]=ge[1],u[7]=0,u[8]=Ee[2],u[9]=Te[2],u[10]=ge[2],u[11]=0,u[12]=-(Ee[0]*a[0]+Ee[1]*a[1]+Ee[2]*a[2]),u[13]=-(Te[0]*a[0]+Te[1]*a[1]+Te[2]*a[2]),u[14]=-(ge[0]*a[0]+ge[1]*a[1]+ge[2]*a[2]),u[15]=1,u}function bn(a,m){const l=m??new e(16);return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=a[0],l[13]=a[1],l[14]=a[2],l[15]=1,l}function Ct(a,m,l){const h=l??new e(16),u=m[0],d=m[1],b=m[2],w=a[0],I=a[1],V=a[2],D=a[3],X=a[4],Y=a[5],C=a[6],te=a[7],le=a[8],ne=a[9],se=a[10],De=a[11],Ae=a[12],pt=a[13],dt=a[14],ft=a[15];return a!==h&&(h[0]=w,h[1]=I,h[2]=V,h[3]=D,h[4]=X,h[5]=Y,h[6]=C,h[7]=te,h[8]=le,h[9]=ne,h[10]=se,h[11]=De),h[12]=w*u+X*d+le*b+Ae,h[13]=I*u+Y*d+ne*b+pt,h[14]=V*u+C*d+se*b+dt,h[15]=D*u+te*d+De*b+ft,h}function Tn(a,m){const l=m??new e(16),h=Math.cos(a),u=Math.sin(a);return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=h,l[6]=u,l[7]=0,l[8]=0,l[9]=-u,l[10]=h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function qt(a,m,l){const h=l??new e(16),u=a[4],d=a[5],b=a[6],w=a[7],I=a[8],V=a[9],D=a[10],X=a[11],Y=Math.cos(m),C=Math.sin(m);return h[4]=Y*u+C*I,h[5]=Y*d+C*V,h[6]=Y*b+C*D,h[7]=Y*w+C*X,h[8]=Y*I-C*u,h[9]=Y*V-C*d,h[10]=Y*D-C*b,h[11]=Y*X-C*w,a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}function un(a,m){const l=m??new e(16),h=Math.cos(a),u=Math.sin(a);return l[0]=h,l[1]=0,l[2]=-u,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=u,l[9]=0,l[10]=h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ln(a,m,l){const h=l??new e(16),u=a[0],d=a[1],b=a[2],w=a[3],I=a[8],V=a[9],D=a[10],X=a[11],Y=Math.cos(m),C=Math.sin(m);return h[0]=Y*u-C*I,h[1]=Y*d-C*V,h[2]=Y*b-C*D,h[3]=Y*w-C*X,h[8]=Y*I+C*u,h[9]=Y*V+C*d,h[10]=Y*D+C*b,h[11]=Y*X+C*w,a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}function A(a,m){const l=m??new e(16),h=Math.cos(a),u=Math.sin(a);return l[0]=h,l[1]=u,l[2]=0,l[3]=0,l[4]=-u,l[5]=h,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function N(a,m,l){const h=l??new e(16),u=a[0],d=a[1],b=a[2],w=a[3],I=a[4],V=a[5],D=a[6],X=a[7],Y=Math.cos(m),C=Math.sin(m);return h[0]=Y*u+C*I,h[1]=Y*d+C*V,h[2]=Y*b+C*D,h[3]=Y*w+C*X,h[4]=Y*I-C*u,h[5]=Y*V-C*d,h[6]=Y*D-C*b,h[7]=Y*X-C*w,a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}function x(a,m,l){const h=l??new e(16);let u=a[0],d=a[1],b=a[2];const w=Math.sqrt(u*u+d*d+b*b);u/=w,d/=w,b/=w;const I=u*u,V=d*d,D=b*b,X=Math.cos(m),Y=Math.sin(m),C=1-X;return h[0]=I+(1-I)*X,h[1]=u*d*C+b*Y,h[2]=u*b*C-d*Y,h[3]=0,h[4]=u*d*C-b*Y,h[5]=V+(1-V)*X,h[6]=d*b*C+u*Y,h[7]=0,h[8]=u*b*C+d*Y,h[9]=d*b*C-u*Y,h[10]=D+(1-D)*X,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}const o=x;function f(a,m,l,h){const u=h??new e(16);let d=m[0],b=m[1],w=m[2];const I=Math.sqrt(d*d+b*b+w*w);d/=I,b/=I,w/=I;const V=d*d,D=b*b,X=w*w,Y=Math.cos(l),C=Math.sin(l),te=1-Y,le=V+(1-V)*Y,ne=d*b*te+w*C,se=d*w*te-b*C,De=d*b*te-w*C,Ae=D+(1-D)*Y,pt=b*w*te+d*C,dt=d*w*te+b*C,ft=b*w*te-d*C,$t=X+(1-X)*Y,Et=a[0],St=a[1],Pt=a[2],Ut=a[3],At=a[4],Ot=a[5],Vt=a[6],Gt=a[7],Dt=a[8],Ht=a[9],Qt=a[10],Kt=a[11];return u[0]=le*Et+ne*At+se*Dt,u[1]=le*St+ne*Ot+se*Ht,u[2]=le*Pt+ne*Vt+se*Qt,u[3]=le*Ut+ne*Gt+se*Kt,u[4]=De*Et+Ae*At+pt*Dt,u[5]=De*St+Ae*Ot+pt*Ht,u[6]=De*Pt+Ae*Vt+pt*Qt,u[7]=De*Ut+Ae*Gt+pt*Kt,u[8]=dt*Et+ft*At+$t*Dt,u[9]=dt*St+ft*Ot+$t*Ht,u[10]=dt*Pt+ft*Vt+$t*Qt,u[11]=dt*Ut+ft*Gt+$t*Kt,a!==u&&(u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u}const c=f;function g(a,m){const l=m??new e(16);return l[0]=a[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=a[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=a[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function T(a,m,l){const h=l??new e(16),u=m[0],d=m[1],b=m[2];return h[0]=u*a[0],h[1]=u*a[1],h[2]=u*a[2],h[3]=u*a[3],h[4]=d*a[4],h[5]=d*a[5],h[6]=d*a[6],h[7]=d*a[7],h[8]=b*a[8],h[9]=b*a[9],h[10]=b*a[10],h[11]=b*a[11],a!==h&&(h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}function M(a,m){const l=m??new e(16);return l[0]=a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=a,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=a,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function z(a,m,l){const h=l??new e(16);return h[0]=m*a[0],h[1]=m*a[1],h[2]=m*a[2],h[3]=m*a[3],h[4]=m*a[4],h[5]=m*a[5],h[6]=m*a[6],h[7]=m*a[7],h[8]=m*a[8],h[9]=m*a[9],h[10]=m*a[10],h[11]=m*a[11],a!==h&&(h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h}return{add:y,aim:_t,axisRotate:f,axisRotation:x,cameraAim:Zt,clone:U,copy:P,create:n,determinant:re,equals:j,equalsApproximately:R,fromMat3:s,fromQuat:i,frustum:Jt,frustumReverseZ:gt,getAxis:Pe,getScaling:ht,getTranslation:Se,identity:L,inverse:Q,invert:Me,lookAt:Le,mul:be,mulScalar:_,multiply:oe,multiplyScalar:v,negate:p,ortho:Tt,perspective:it,perspectiveReverseZ:Yt,rotate:c,rotateX:qt,rotateY:ln,rotateZ:N,rotation:o,rotationX:Tn,rotationY:un,rotationZ:A,scale:T,scaling:g,set:r,setAxis:yt,setTranslation:ze,translate:Ct,translation:bn,transpose:Z,uniformScale:z,uniformScaling:M}}const nl=new Map;function t2(e){let t=nl.get(e);return t||(t=e2(e),nl.set(e,t)),t}function n2(e){const t=ha(e);function n(A,N,x,o){const f=new e(4);return A!==void 0&&(f[0]=A,N!==void 0&&(f[1]=N,x!==void 0&&(f[2]=x,o!==void 0&&(f[3]=o)))),f}const r=n;function s(A,N,x,o,f){const c=f??new e(4);return c[0]=A,c[1]=N,c[2]=x,c[3]=o,c}function i(A,N,x){const o=x??new e(4),f=N*.5,c=Math.sin(f);return o[0]=c*A[0],o[1]=c*A[1],o[2]=c*A[2],o[3]=Math.cos(f),o}function p(A,N){const x=N??t.create(3),o=Math.acos(A[3])*2,f=Math.sin(o*.5);return f>de?(x[0]=A[0]/f,x[1]=A[1]/f,x[2]=A[2]/f):(x[0]=1,x[1]=0,x[2]=0),{angle:o,axis:x}}function y(A,N){const x=it(A,N);return Math.acos(2*x*x-1)}function v(A,N,x){const o=x??new e(4),f=A[0],c=A[1],g=A[2],T=A[3],M=N[0],z=N[1],a=N[2],m=N[3];return o[0]=f*m+T*M+c*a-g*z,o[1]=c*m+T*z+g*M-f*a,o[2]=g*m+T*a+f*z-c*M,o[3]=T*m-f*M-c*z-g*a,o}const _=v;function P(A,N,x){const o=x??new e(4),f=N*.5,c=A[0],g=A[1],T=A[2],M=A[3],z=Math.sin(f),a=Math.cos(f);return o[0]=c*a+M*z,o[1]=g*a+T*z,o[2]=T*a-g*z,o[3]=M*a-c*z,o}function U(A,N,x){const o=x??new e(4),f=N*.5,c=A[0],g=A[1],T=A[2],M=A[3],z=Math.sin(f),a=Math.cos(f);return o[0]=c*a-T*z,o[1]=g*a+M*z,o[2]=T*a+c*z,o[3]=M*a-g*z,o}function R(A,N,x){const o=x??new e(4),f=N*.5,c=A[0],g=A[1],T=A[2],M=A[3],z=Math.sin(f),a=Math.cos(f);return o[0]=c*a+g*z,o[1]=g*a-c*z,o[2]=T*a+M*z,o[3]=M*a-T*z,o}function j(A,N,x,o){const f=o??new e(4),c=A[0],g=A[1],T=A[2],M=A[3];let z=N[0],a=N[1],m=N[2],l=N[3],h=c*z+g*a+T*m+M*l;h<0&&(h=-h,z=-z,a=-a,m=-m,l=-l);let u,d;if(1-h>de){const b=Math.acos(h),w=Math.sin(b);u=Math.sin((1-x)*b)/w,d=Math.sin(x*b)/w}else u=1-x,d=x;return f[0]=u*c+d*z,f[1]=u*g+d*a,f[2]=u*T+d*m,f[3]=u*M+d*l,f}function L(A,N){const x=N??new e(4),o=A[0],f=A[1],c=A[2],g=A[3],T=o*o+f*f+c*c+g*g,M=T?1/T:0;return x[0]=-o*M,x[1]=-f*M,x[2]=-c*M,x[3]=g*M,x}function Z(A,N){const x=N??new e(4);return x[0]=-A[0],x[1]=-A[1],x[2]=-A[2],x[3]=A[3],x}function Q(A,N){const x=N??new e(4),o=A[0]+A[5]+A[10];if(o>0){const f=Math.sqrt(o+1);x[3]=.5*f;const c=.5/f;x[0]=(A[6]-A[9])*c,x[1]=(A[8]-A[2])*c,x[2]=(A[1]-A[4])*c}else{let f=0;A[5]>A[0]&&(f=1),A[10]>A[f*4+f]&&(f=2);const c=(f+1)%3,g=(f+2)%3,T=Math.sqrt(A[f*4+f]-A[c*4+c]-A[g*4+g]+1);x[f]=.5*T;const M=.5/T;x[3]=(A[c*4+g]-A[g*4+c])*M,x[c]=(A[c*4+f]+A[f*4+c])*M,x[g]=(A[g*4+f]+A[f*4+g])*M}return x}function re(A,N,x,o,f){const c=f??new e(4),g=A*.5,T=N*.5,M=x*.5,z=Math.sin(g),a=Math.cos(g),m=Math.sin(T),l=Math.cos(T),h=Math.sin(M),u=Math.cos(M);switch(o){case"xyz":c[0]=z*l*u+a*m*h,c[1]=a*m*u-z*l*h,c[2]=a*l*h+z*m*u,c[3]=a*l*u-z*m*h;break;case"xzy":c[0]=z*l*u-a*m*h,c[1]=a*m*u-z*l*h,c[2]=a*l*h+z*m*u,c[3]=a*l*u+z*m*h;break;case"yxz":c[0]=z*l*u+a*m*h,c[1]=a*m*u-z*l*h,c[2]=a*l*h-z*m*u,c[3]=a*l*u+z*m*h;break;case"yzx":c[0]=z*l*u+a*m*h,c[1]=a*m*u+z*l*h,c[2]=a*l*h-z*m*u,c[3]=a*l*u-z*m*h;break;case"zxy":c[0]=z*l*u-a*m*h,c[1]=a*m*u+z*l*h,c[2]=a*l*h+z*m*u,c[3]=a*l*u-z*m*h;break;case"zyx":c[0]=z*l*u-a*m*h,c[1]=a*m*u+z*l*h,c[2]=a*l*h-z*m*u,c[3]=a*l*u+z*m*h;break;default:throw new Error(`Unknown rotation order: ${o}`)}return c}function Me(A,N){const x=N??new e(4);return x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x}const oe=Me;function be(A,N,x){const o=x??new e(4);return o[0]=A[0]+N[0],o[1]=A[1]+N[1],o[2]=A[2]+N[2],o[3]=A[3]+N[3],o}function ze(A,N,x){const o=x??new e(4);return o[0]=A[0]-N[0],o[1]=A[1]-N[1],o[2]=A[2]-N[2],o[3]=A[3]-N[3],o}const Se=ze;function Pe(A,N,x){const o=x??new e(4);return o[0]=A[0]*N,o[1]=A[1]*N,o[2]=A[2]*N,o[3]=A[3]*N,o}const yt=Pe;function ht(A,N,x){const o=x??new e(4);return o[0]=A[0]/N,o[1]=A[1]/N,o[2]=A[2]/N,o[3]=A[3]/N,o}function it(A,N){return A[0]*N[0]+A[1]*N[1]+A[2]*N[2]+A[3]*N[3]}function Yt(A,N,x,o){const f=o??new e(4);return f[0]=A[0]+x*(N[0]-A[0]),f[1]=A[1]+x*(N[1]-A[1]),f[2]=A[2]+x*(N[2]-A[2]),f[3]=A[3]+x*(N[3]-A[3]),f}function Tt(A){const N=A[0],x=A[1],o=A[2],f=A[3];return Math.sqrt(N*N+x*x+o*o+f*f)}const Jt=Tt;function gt(A){const N=A[0],x=A[1],o=A[2],f=A[3];return N*N+x*x+o*o+f*f}const Ee=gt;function Te(A,N){const x=N??new e(4),o=A[0],f=A[1],c=A[2],g=A[3],T=Math.sqrt(o*o+f*f+c*c+g*g);return T>1e-5?(x[0]=o/T,x[1]=f/T,x[2]=c/T,x[3]=g/T):(x[0]=0,x[1]=0,x[2]=0,x[3]=1),x}function ge(A,N){return Math.abs(A[0]-N[0])<de&&Math.abs(A[1]-N[1])<de&&Math.abs(A[2]-N[2])<de&&Math.abs(A[3]-N[3])<de}function _t(A,N){return A[0]===N[0]&&A[1]===N[1]&&A[2]===N[2]&&A[3]===N[3]}function Zt(A){const N=A??new e(4);return N[0]=0,N[1]=0,N[2]=0,N[3]=1,N}const Le=t.create(),bn=t.create(),Ct=t.create();function Tn(A,N,x){const o=x??new e(4),f=t.dot(A,N);return f<-.999999?(t.cross(bn,A,Le),t.len(Le)<1e-6&&t.cross(Ct,A,Le),t.normalize(Le,Le),i(Le,Math.PI,o),o):f>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(t.cross(A,N,Le),o[0]=Le[0],o[1]=Le[1],o[2]=Le[2],o[3]=1+f,Te(o,o))}const qt=new e(4),un=new e(4);function ln(A,N,x,o,f,c){const g=c??new e(4);return j(A,o,f,qt),j(N,x,f,un),j(qt,un,2*f*(1-f),g),g}return{create:n,fromValues:r,set:s,fromAxisAngle:i,toAxisAngle:p,angle:y,multiply:v,mul:_,rotateX:P,rotateY:U,rotateZ:R,slerp:j,inverse:L,conjugate:Z,fromMat:Q,fromEuler:re,copy:Me,clone:oe,add:be,subtract:ze,sub:Se,mulScalar:Pe,scale:yt,divScalar:ht,dot:it,lerp:Yt,length:Tt,len:Jt,lengthSq:gt,lenSq:Ee,normalize:Te,equalsApproximately:ge,equals:_t,identity:Zt,rotationTo:Tn,sqlerp:ln}}const rl=new Map;function r2(e){let t=rl.get(e);return t||(t=n2(e),rl.set(e,t)),t}function s2(e){function t(x,o,f,c){const g=new e(4);return x!==void 0&&(g[0]=x,o!==void 0&&(g[1]=o,f!==void 0&&(g[2]=f,c!==void 0&&(g[3]=c)))),g}const n=t;function r(x,o,f,c,g){const T=g??new e(4);return T[0]=x,T[1]=o,T[2]=f,T[3]=c,T}function s(x,o){const f=o??new e(4);return f[0]=Math.ceil(x[0]),f[1]=Math.ceil(x[1]),f[2]=Math.ceil(x[2]),f[3]=Math.ceil(x[3]),f}function i(x,o){const f=o??new e(4);return f[0]=Math.floor(x[0]),f[1]=Math.floor(x[1]),f[2]=Math.floor(x[2]),f[3]=Math.floor(x[3]),f}function p(x,o){const f=o??new e(4);return f[0]=Math.round(x[0]),f[1]=Math.round(x[1]),f[2]=Math.round(x[2]),f[3]=Math.round(x[3]),f}function y(x,o=0,f=1,c){const g=c??new e(4);return g[0]=Math.min(f,Math.max(o,x[0])),g[1]=Math.min(f,Math.max(o,x[1])),g[2]=Math.min(f,Math.max(o,x[2])),g[3]=Math.min(f,Math.max(o,x[3])),g}function v(x,o,f){const c=f??new e(4);return c[0]=x[0]+o[0],c[1]=x[1]+o[1],c[2]=x[2]+o[2],c[3]=x[3]+o[3],c}function _(x,o,f,c){const g=c??new e(4);return g[0]=x[0]+o[0]*f,g[1]=x[1]+o[1]*f,g[2]=x[2]+o[2]*f,g[3]=x[3]+o[3]*f,g}function P(x,o,f){const c=f??new e(4);return c[0]=x[0]-o[0],c[1]=x[1]-o[1],c[2]=x[2]-o[2],c[3]=x[3]-o[3],c}const U=P;function R(x,o){return Math.abs(x[0]-o[0])<de&&Math.abs(x[1]-o[1])<de&&Math.abs(x[2]-o[2])<de&&Math.abs(x[3]-o[3])<de}function j(x,o){return x[0]===o[0]&&x[1]===o[1]&&x[2]===o[2]&&x[3]===o[3]}function L(x,o,f,c){const g=c??new e(4);return g[0]=x[0]+f*(o[0]-x[0]),g[1]=x[1]+f*(o[1]-x[1]),g[2]=x[2]+f*(o[2]-x[2]),g[3]=x[3]+f*(o[3]-x[3]),g}function Z(x,o,f,c){const g=c??new e(4);return g[0]=x[0]+f[0]*(o[0]-x[0]),g[1]=x[1]+f[1]*(o[1]-x[1]),g[2]=x[2]+f[2]*(o[2]-x[2]),g[3]=x[3]+f[3]*(o[3]-x[3]),g}function Q(x,o,f){const c=f??new e(4);return c[0]=Math.max(x[0],o[0]),c[1]=Math.max(x[1],o[1]),c[2]=Math.max(x[2],o[2]),c[3]=Math.max(x[3],o[3]),c}function re(x,o,f){const c=f??new e(4);return c[0]=Math.min(x[0],o[0]),c[1]=Math.min(x[1],o[1]),c[2]=Math.min(x[2],o[2]),c[3]=Math.min(x[3],o[3]),c}function Me(x,o,f){const c=f??new e(4);return c[0]=x[0]*o,c[1]=x[1]*o,c[2]=x[2]*o,c[3]=x[3]*o,c}const oe=Me;function be(x,o,f){const c=f??new e(4);return c[0]=x[0]/o,c[1]=x[1]/o,c[2]=x[2]/o,c[3]=x[3]/o,c}function ze(x,o){const f=o??new e(4);return f[0]=1/x[0],f[1]=1/x[1],f[2]=1/x[2],f[3]=1/x[3],f}const Se=ze;function Pe(x,o){return x[0]*o[0]+x[1]*o[1]+x[2]*o[2]+x[3]*o[3]}function yt(x){const o=x[0],f=x[1],c=x[2],g=x[3];return Math.sqrt(o*o+f*f+c*c+g*g)}const ht=yt;function it(x){const o=x[0],f=x[1],c=x[2],g=x[3];return o*o+f*f+c*c+g*g}const Yt=it;function Tt(x,o){const f=x[0]-o[0],c=x[1]-o[1],g=x[2]-o[2],T=x[3]-o[3];return Math.sqrt(f*f+c*c+g*g+T*T)}const Jt=Tt;function gt(x,o){const f=x[0]-o[0],c=x[1]-o[1],g=x[2]-o[2],T=x[3]-o[3];return f*f+c*c+g*g+T*T}const Ee=gt;function Te(x,o){const f=o??new e(4),c=x[0],g=x[1],T=x[2],M=x[3],z=Math.sqrt(c*c+g*g+T*T+M*M);return z>1e-5?(f[0]=c/z,f[1]=g/z,f[2]=T/z,f[3]=M/z):(f[0]=0,f[1]=0,f[2]=0,f[3]=0),f}function ge(x,o){const f=o??new e(4);return f[0]=-x[0],f[1]=-x[1],f[2]=-x[2],f[3]=-x[3],f}function _t(x,o){const f=o??new e(4);return f[0]=x[0],f[1]=x[1],f[2]=x[2],f[3]=x[3],f}const Zt=_t;function Le(x,o,f){const c=f??new e(4);return c[0]=x[0]*o[0],c[1]=x[1]*o[1],c[2]=x[2]*o[2],c[3]=x[3]*o[3],c}const bn=Le;function Ct(x,o,f){const c=f??new e(4);return c[0]=x[0]/o[0],c[1]=x[1]/o[1],c[2]=x[2]/o[2],c[3]=x[3]/o[3],c}const Tn=Ct;function qt(x){const o=x??new e(4);return o[0]=0,o[1]=0,o[2]=0,o[3]=0,o}function un(x,o,f){const c=f??new e(4),g=x[0],T=x[1],M=x[2],z=x[3];return c[0]=o[0]*g+o[4]*T+o[8]*M+o[12]*z,c[1]=o[1]*g+o[5]*T+o[9]*M+o[13]*z,c[2]=o[2]*g+o[6]*T+o[10]*M+o[14]*z,c[3]=o[3]*g+o[7]*T+o[11]*M+o[15]*z,c}function ln(x,o,f){const c=f??new e(4);return Te(x,c),Me(c,o,c)}function A(x,o,f){const c=f??new e(4);return yt(x)>o?ln(x,o,c):_t(x,c)}function N(x,o,f){const c=f??new e(4);return L(x,o,.5,c)}return{create:t,fromValues:n,set:r,ceil:s,floor:i,round:p,clamp:y,add:v,addScaled:_,subtract:P,sub:U,equalsApproximately:R,equals:j,lerp:L,lerpV:Z,max:Q,min:re,mulScalar:Me,scale:oe,divScalar:be,inverse:ze,invert:Se,dot:Pe,length:yt,len:ht,lengthSq:it,lenSq:Yt,distance:Tt,dist:Jt,distanceSq:gt,distSq:Ee,normalize:Te,negate:ge,copy:_t,clone:Zt,multiply:Le,mul:bn,divide:Ct,div:Tn,zero:qt,transformMat4:un,setLength:ln,truncate:A,midpoint:N}}const sl=new Map;function i2(e){let t=sl.get(e);return t||(t=s2(e),sl.set(e,t)),t}function qo(e,t,n,r,s,i){return{mat3:Kx(e),mat4:t2(t),quat:r2(n),vec2:op(r),vec3:ha(s),vec4:i2(i)}}const{mat4:_n}=qo(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);qo(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);qo(Jx,Array,Array,Array,Array,Array);const a2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Cn({view:we,proj:we,viewInv:we,projInv:we}),"Camera");function o2(e,t){let n=0,r=1/t,s=e;for(;s>0;)n+=r*(s%t),s=Math.floor(s/t),r=r/t;return n}function*il(e){let t=1;for(;;)yield o2(t,e),t++}class u2{#e;#t;#n;#r;#s;#i;#a;#o;#u;#l;#c;constructor(t,n,r,s,i,p,y,v=.1,_=10){this.#l=p,this.#c=y,this.#t=_n.lookAt(n,r,s,we()),this.#i=_n.perspective(i,p/y,v,_,we()),this.#n=this.#i,this.#r=_n.invert(this.#t,we()),this.#a=_n.invert(this.#i,we()),this.#s=this.#a,this.#e=t.createUniform(a2,{view:this.#t,proj:this.#n,viewInv:this.#r,projInv:this.#s}),this.#o=il(2),this.#u=il(3)}jitter(){const[t,n]=[this.#o.next().value,this.#u.next().value],r=(t-.5)*2/this.#l,s=(n-.5)*2/this.#c,i=_n.identity(we());i[12]=r,i[13]=s;const p=_n.mul(i,this.#i,we()),y=_n.invert(p,we());this.#e.writePartial({proj:p,projInv:y})}updateView(t,n,r){this.#t=_n.lookAt(t,n,r,we()),this.#r=_n.invert(this.#t,we()),this.#e.writePartial({view:this.#t,viewInv:this.#r})}updateProjection(t,n,r,s=.1,i=100){this.#l=n,this.#c=r,this.#i=_n.perspective(t,n/r,s,i,we()),this.#a=_n.invert(this.#i,we()),this.#e.writePartial({proj:this.#i,projInv:this.#a})}get cameraUniform(){return this.#e}}const al=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=yr((n-r)/(n+r),2);return s+(1-s)*yr(1-t,5)}),{v:1,name:"fresnelSchlick",ast:{params:[{type:"i",name:"cosTheta"},{type:"i",name:"ior1"},{type:"i",name:"ior2"}],body:[0,[[13,"r0",[6,[7,"std","pow"],[[1,[1,"ior1","-","ior2"],"/",[1,"ior1","+","ior2"]],[5,"2"]]]],[10,[1,"r0","+",[1,[1,[5,"1"],"-","r0"],"*",[6,[7,"std","pow"],[[1,[5,"1"],"-","cosTheta"],[5,"5"]]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({}),ol=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";return kc(xe(t,-n))}),{v:1,name:"beerLambert",ast:{params:[{type:"i",name:"sigma"},{type:"i",name:"dist"}],body:[0,[[10,[6,[7,"std","exp"],[[6,[7,"std","mul"],["sigma",[4,"-","dist"]]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({}),ul=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=O(1).div(n),i=K(r.min,t).mul(s),p=K(r.max,t).mul(s),y=Ie(i,p),v=ie(i,p),_=ie(ie(y.x,y.y),y.z),P=Ie(Ie(v.x,v.y),v.z),U=Zu();return U.hit=P>=_&&P>=0,U.tMin=_,U.tMax=P,U}),{v:1,name:"intersectBox",ast:{params:[{type:"i",name:"rayOrigin"},{type:"i",name:"rayDirection"},{type:"i",name:"box"}],body:[0,[[13,"invDir",[6,[7,[6,[7,"d","vec3f"],[[5,"1"]]],"div"],["rayDirection"]]],[13,"t1",[6,[7,[6,[7,"std","sub"],[[7,"box","min"],"rayOrigin"]],"mul"],["invDir"]]],[13,"t2",[6,[7,[6,[7,"std","sub"],[[7,"box","max"],"rayOrigin"]],"mul"],["invDir"]]],[13,"tMinVec",[6,[7,"std","min"],["t1","t2"]]],[13,"tMaxVec",[6,[7,"std","max"],["t1","t2"]]],[13,"tMin",[6,[7,"std","max"],[[6,[7,"std","max"],[[7,"tMinVec","x"],[7,"tMinVec","y"]]],[7,"tMinVec","z"]]]],[13,"tMax",[6,[7,"std","min"],[[6,[7,"std","min"],[[7,"tMaxVec","x"],[7,"tMaxVec","y"]]],[7,"tMaxVec","z"]]]],[13,"result",[6,"BoxIntersection",[]]],[2,[7,"result","hit"],"=",[3,[1,"tMax",">=","tMin"],"&&",[1,"tMax",">=",[5,"0"]]]],[2,[7,"result","tMin"],"=","tMin"],[2,[7,"result","tMax"],"=","tMax"],[10,"result"]]],externalNames:["d","std","BoxIntersection"]},get externals(){return{d:ve,std:We,BoxIntersection:Zu}}})&&e.f)({});function up(e,t,n){return[0,1].map(()=>{const r=(globalThis.__TYPEGPU_AUTONAME__??(s=>s))(e["~unstable"].createTexture({size:[t,n],format:"rgba8unorm"}).$usage("storage","sampled","render"),"texture");return{write:r.createView(ti("rgba8unorm")),sampled:r.createView()}})}function lp(e,t,n){return{sampled:(globalThis.__TYPEGPU_AUTONAME__??(s=>s))(e["~unstable"].createTexture({size:[t,n],format:"rgba16float"}).$usage("sampled","render"),"texture").createView()}}const l2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H["~unstable"].computeFn({workgroupSize:[16,16],in:{gid:Rs.globalInvocationId}})((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(({gid:t})=>{const n=Ui(zr.$.currentTexture,xt(t.xy),0),r=Ui(zr.$.historyTexture,xt(t.xy),0);let s=O(9999),i=O(-9999);const p=Hh(zr.$.currentTexture);for(let P=-1;P<=1;P++)for(let U=-1;U<=1;U++){const R=Be(t.xy).add(Be(P,U)),j=Br(R,Be(0,0),Be(p.xy).sub(Be(1))),L=Ui(zr.$.currentTexture,j,0);s=Ie(s,L.xyz),i=ie(i,L.xyz)}const y=Br(r.xyz,s,i),v=$(.9),_=k(tn(n.xyz,y,v),1);Zh(zr.$.outputTexture,xt(t.x,t.y),_)}),{v:1,name:void 0,ast:{params:[{type:"d",props:[{name:"gid",alias:"gid"}]}],body:[0,[[13,"currentColor",[6,[7,"std","textureLoad"],[[7,[7,"taaResolveLayout","$"],"currentTexture"],[6,[7,"d","vec2u"],[[7,"gid","xy"]]],[5,"0"]]]],[13,"historyColor",[6,[7,"std","textureLoad"],[[7,[7,"taaResolveLayout","$"],"historyTexture"],[6,[7,"d","vec2u"],[[7,"gid","xy"]]],[5,"0"]]]],[12,"minColor",[6,[7,"d","vec3f"],[[5,"9999"]]]],[12,"maxColor",[6,[7,"d","vec3f"],[[4,"-",[5,"9999"]]]]],[13,"dimensions",[6,[7,"std","textureDimensions"],[[7,[7,"taaResolveLayout","$"],"currentTexture"]]]],[14,[12,"x",[4,"-",[5,"1"]]],[1,"x","<=",[5,"1"]],[102,"++","x"],[0,[[14,[12,"y",[4,"-",[5,"1"]]],[1,"y","<=",[5,"1"]],[102,"++","y"],[0,[[13,"sampleCoord",[6,[7,[6,[7,"d","vec2i"],[[7,"gid","xy"]]],"add"],[[6,[7,"d","vec2i"],["x","y"]]]]],[13,"clampedCoord",[6,[7,"std","clamp"],["sampleCoord",[6,[7,"d","vec2i"],[[5,"0"],[5,"0"]]],[6,[7,[6,[7,"d","vec2i"],[[7,"dimensions","xy"]]],"sub"],[[6,[7,"d","vec2i"],[[5,"1"]]]]]]]],[13,"neighborColor",[6,[7,"std","textureLoad"],[[7,[7,"taaResolveLayout","$"],"currentTexture"],"clampedCoord",[5,"0"]]]],[2,"minColor","=",[6,[7,"std","min"],["minColor",[7,"neighborColor","xyz"]]]],[2,"maxColor","=",[6,[7,"std","max"],["maxColor",[7,"neighborColor","xyz"]]]]]]]]]],[13,"historyColorClamped",[6,[7,"std","clamp"],[[7,"historyColor","xyz"],"minColor","maxColor"]]],[13,"blendFactor",[6,[7,"d","f32"],[[5,"0.9"]]]],[13,"resolvedColor",[6,[7,"d","vec4f"],[[6,[7,"std","mix"],[[7,"currentColor","xyz"],"historyColorClamped","blendFactor"]],[5,"1"]]]],[6,[7,"std","textureStore"],[[7,[7,"taaResolveLayout","$"],"outputTexture"],[6,[7,"d","vec2u"],[[7,"gid","x"],[7,"gid","y"]]],"resolvedColor"]]]],externalNames:["std","taaResolveLayout","d"]},get externals(){return{std:We,taaResolveLayout:zr,d:ve}}})&&e.f)({})),"taaResolveFn");function ll(e,t,n){return[0,1].map(()=>{const r=(globalThis.__TYPEGPU_AUTONAME__??(s=>s))(e["~unstable"].createTexture({size:[t,n],format:"rgba8unorm"}).$usage("storage","sampled"),"texture");return{write:r.createView(ti("rgba8unorm")),sampled:r.createView()}})}class c2{#e;#t;#n;#r;#s;constructor(t,n,r){this.#n=t,this.#r=n,this.#s=r,this.#e=t["~unstable"].withCompute(l2).createPipeline(),this.#t=ll(t,n,r)}resolve(t,n,r){const s=1-r;return this.#e.with(this.#n.createBindGroup(zr,{currentTexture:t,historyTexture:n===1?t:this.#t[s].sampled,outputTexture:this.#t[r].write})).dispatchWorkgroups(Math.ceil(this.#r/16),Math.ceil(this.#s/16)),this.#t[r].sampled}resize(t,n){this.#r=t,this.#s=n,this.#t=ll(this.#n,t,n)}getResolvedTexture(t){return this.#t[t].sampled}}const cp=navigator.gpu.getPreferredCanvasFormat(),xn=document.querySelector("canvas"),hp=xn.getContext("webgpu"),Ze=await H.init({device:{optionalFeatures:["timestamp-query"]}}),h2=Ze.enabledFeatures.has("timestamp-query");hp.configure({device:Ze.device,format:cp,alphaMode:"premultiplied"});const on=new Wx(Ze);await on.init();let hs=.5,[Zn,Hn]=[xn.width*hs,xn.height*hs],so=up(Ze,Zn,Hn),Wo=lp(Ze,Zn,Hn);const cl=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze["~unstable"].createSampler({magFilter:"linear",minFilter:"linear"}),"filteringSampler"),Xo=new u2(Ze,Fx,O(0,0,0),O(0,1,0),Math.PI/4,Zn,Hn),_a=Xo.cameraUniform,Ur=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze.createUniform(Cx,{direction:rn(O(.19,-.24,.75)),color:O(1,1,1)}),"lightUniform"),qs=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze.createUniform(k,k(1,.45,.075,1)),"jellyColorUniform"),Ws=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze.createUniform(J),"darkModeUniform"),io=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze.createUniform(F),"randomUniform"),hl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=k(t.x,t.y,-1,1),r=_a.$.viewInv,i=_a.$.projInv.mul(n),p=k(i.xyz.div(i.w),1),y=r.mul(p),v=r.columns[3].xyz,_=rn(y.xyz.sub(v));return Hu({origin:v,direction:_})}),{v:1,name:"getRay",ast:{params:[{type:"i",name:"ndc"}],body:[0,[[13,"clipPos",[6,[7,"d","vec4f"],[[7,"ndc","x"],[7,"ndc","y"],[4,"-",[5,"1"]],[5,"1"]]]],[13,"invView",[7,[7,"cameraUniform","$"],"viewInv"]],[13,"invProj",[7,[7,"cameraUniform","$"],"projInv"]],[13,"viewPos",[6,[7,"invProj","mul"],["clipPos"]]],[13,"viewPosNormalized",[6,[7,"d","vec4f"],[[6,[7,[7,"viewPos","xyz"],"div"],[[7,"viewPos","w"]]],[5,"1"]]]],[13,"worldPos",[6,[7,"invView","mul"],["viewPosNormalized"]]],[13,"rayOrigin",[7,[8,[7,"invView","columns"],[5,"3"]],"xyz"]],[13,"rayDir",[6,[7,"std","normalize"],[[6,[7,[7,"worldPos","xyz"],"sub"],["rayOrigin"]]]]],[10,[6,"Ray",[[104,{origin:"rayOrigin",direction:"rayDir"}]]]]]],externalNames:["d","cameraUniform","std","Ray"]},get externals(){return{d:ve,cameraUniform:_a,std:We,Ray:Hu}}})&&e.f)({}),pl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(()=>{"use gpu";return Qu({min:O(-1,-1,-1),max:O(1,1,1)})}),{v:1,name:"getJellyBounds",ast:{params:[],body:[0,[[10,[6,"BoundingBox",[[104,{min:[6,[7,"d","vec3f"],[[4,"-",[5,"1"]],[4,"-",[5,"1"]],[4,"-",[5,"1"]]]],max:[6,[7,"d","vec3f"],[[5,"1"],[5,"1"],[5,"1"]]]}]]]]]],externalNames:["BoundingBox","d"]},get externals(){return{BoundingBox:Qu,d:ve}}})&&e.f)({}),pr={groundThickness:.03,groundRadius:.4,groundRoundness:.02},qi=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=pr.groundRoundness,r=pr.groundRadius;return $e(t)-(r+n)}),{v:1,name:"circleCutoutDist",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"groundRoundness",[7,"GroundParams","groundRoundness"]],[13,"groundRadius",[7,"GroundParams","groundRadius"]],[10,[1,[6,[7,"std","length"],["position"]],"-",[1,"groundRadius","+","groundRoundness"]]]]],externalNames:["GroundParams","std"]},get externals(){return{GroundParams:pr,std:We}}})&&e.f)({}),wr=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=pr.groundThickness,r=pr.groundRoundness;return Kh(tp(t,O(0,1,0),.06),Qh(t,-qi(t.xz),n-r)-r)}),{v:1,name:"getMainSceneDist",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"groundThickness",[7,"GroundParams","groundThickness"]],[13,"groundRoundness",[7,"GroundParams","groundRoundness"]],[10,[6,[7,"sdf","opUnion"],[[6,[7,"sdf","sdPlane"],["position",[6,[7,"d","vec3f"],[[5,"0"],[5,"1"],[5,"0"]]],[5,"0.06"]]],[1,[6,[7,"sdf","opExtrudeY"],["position",[4,"-",[6,"circleCutoutDist",[[7,"position","xz"]]]],[1,"groundThickness","-","groundRoundness"]]],"-","groundRoundness"]]]]]],externalNames:["GroundParams","sdf","d","circleCutoutDist"]},get externals(){return{GroundParams:pr,sdf:np,d:ve,circleCutoutDist:qi}}})&&e.f)({}),dl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";const r=Nt(n*t.x),s=an(n*t.x),i=wn(r,-s,s,r);return O(i.mul(t.xy),t.z)}),{v:1,name:"opCheapBend",ast:{params:[{type:"i",name:"p"},{type:"i",name:"k"}],body:[0,[[13,"c",[6,[7,"std","cos"],[[1,"k","*",[7,"p","x"]]]]],[13,"s",[6,[7,"std","sin"],[[1,"k","*",[7,"p","x"]]]]],[13,"m",[6,[7,"d","mat2x2f"],["c",[4,"-","s"],"s","c"]]],[10,[6,[7,"d","vec3f"],[[6,[7,"m","mul"],[[7,"p","xy"]]],[7,"p","z"]]]]]],externalNames:["std","d"]},get externals(){return{std:We,d:ve}}})&&e.f)({}),fl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";return ue(tn(n.mul(ae(t,n)),t,Nt(r)),Bc(t,n).mul(an(r)))}),{v:1,name:"opRotateAxisAngle",ast:{params:[{type:"i",name:"p"},{type:"i",name:"axis"},{type:"i",name:"angle"}],body:[0,[[10,[6,[7,"std","add"],[[6,[7,"std","mix"],[[6,[7,"axis","mul"],[[6,[7,"std","dot"],["p","axis"]]]],"p",[6,[7,"std","cos"],["angle"]]]],[6,[7,[6,[7,"std","cross"],["p","axis"]],"mul"],[[6,[7,"std","sin"],["angle"]]]]]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({}),Wi=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=on.stateUniform.$,r=O(0,.3,0),s=t.sub(r),i=Lt((s.y+us.y)/(us.y*2)),p=O(n.posX*i/15,n.posY*i/-18,n.posZ*i/15),y=s.sub(p),v=O(1,1,1/(1-n.squashZ*.5+.001)),_=y.mul(v),P=fl(_,O(0,0,1),n.wiggleX);return ep(dl(P,.2),us.sub(.1),.1)}),{v:1,name:"getJellyDist",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"state",[7,[7,"buttonBehavior","stateUniform"],"$"]],[13,"baseCenter",[6,[7,"d","vec3f"],[[5,"0"],[5,"0.3"],[5,"0"]]]],[13,"localToBase",[6,[7,"position","sub"],["baseCenter"]]],[13,"heightFactor",[6,[7,"std","saturate"],[[1,[1,[7,"localToBase","y"],"+",[7,"JELLY_HALFSIZE","y"]],"/",[1,[7,"JELLY_HALFSIZE","y"],"*",[5,"2"]]]]]],[13,"displacement",[6,[7,"d","vec3f"],[[1,[1,[7,"state","posX"],"*","heightFactor"],"/",[5,"15"]],[1,[1,[7,"state","posY"],"*","heightFactor"],"/",[4,"-",[5,"18"]]],[1,[1,[7,"state","posZ"],"*","heightFactor"],"/",[5,"15"]]]]],[13,"displacedPos",[6,[7,"localToBase","sub"],["displacement"]]],[13,"jellyInvScale",[6,[7,"d","vec3f"],[[5,"1"],[5,"1"],[1,[5,"1"],"/",[1,[1,[5,"1"],"-",[1,[7,"state","squashZ"],"*",[5,"0.5"]]],"+",[5,"0.001"]]]]]],[13,"scaledPos",[6,[7,"displacedPos","mul"],["jellyInvScale"]]],[13,"localPos",[6,"opRotateAxisAngle",["scaledPos",[6,[7,"d","vec3f"],[[5,"0"],[5,"0"],[5,"1"]]],[7,"state","wiggleX"]]]],[10,[6,[7,"sdf","sdRoundedBox3d"],[[6,"opCheapBend",["localPos",[5,"0.2"]]],[6,[7,"JELLY_HALFSIZE","sub"],[[5,"0.1"]]],[5,"0.1"]]]]]],externalNames:["buttonBehavior","d","std","JELLY_HALFSIZE","opRotateAxisAngle","sdf","opCheapBend"]},get externals(){return{buttonBehavior:on,d:ve,std:We,JELLY_HALFSIZE:us,opRotateAxisAngle:fl,sdf:np,opCheapBend:dl}}})&&e.f)({}),Sr=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=wr(t),r=Wi(t),s=Ju();return r<n?(s.distance=r,s.objectType=Gs.SLIDER):(s.distance=n,s.objectType=Gs.BACKGROUND),s}),{v:1,name:"getSceneDist",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"mainScene",[6,"getMainSceneDist",["position"]]],[13,"jelly",[6,"getJellyDist",["position"]]],[13,"hitInfo",[6,"HitInfo",[]]],[11,[1,"jelly","<","mainScene"],[0,[[2,[7,"hitInfo","distance"],"=","jelly"],[2,[7,"hitInfo","objectType"],"=",[7,"ObjectType","SLIDER"]]]],[0,[[2,[7,"hitInfo","distance"],"=","mainScene"],[2,[7,"hitInfo","objectType"],"=",[7,"ObjectType","BACKGROUND"]]]]],[10,"hitInfo"]]],externalNames:["getMainSceneDist","getJellyDist","HitInfo","ObjectType"]},get externals(){return{getMainSceneDist:wr,getJellyDist:Wi,HitInfo:Ju,ObjectType:Gs}}})&&e.f)({}),ml=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";const n=wr(t),r=Wi(t);return Ie(n,r)}),{v:1,name:"getSceneDistForAO",ast:{params:[{type:"i",name:"position"}],body:[0,[[13,"mainScene",[6,"getMainSceneDist",["position"]]],[13,"jelly",[6,"getJellyDist",["position"]]],[10,[6,[7,"std","min"],["mainScene","jelly"]]]]],externalNames:["getMainSceneDist","getJellyDist","std"]},get externals(){return{getMainSceneDist:wr,getJellyDist:Wi,std:We}}})&&e.f)({}),yl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";const r=Sr(t).distance,s=O(Sr(ue(t,O(n,0,0))).distance-r,Sr(ue(t,O(0,n,0))).distance-r,Sr(ue(t,O(0,0,n))).distance-r);return rn(s)}),{v:1,name:"getApproxNormal",ast:{params:[{type:"i",name:"p"},{type:"i",name:"e"}],body:[0,[[13,"dist",[7,[6,"getSceneDist",["p"]],"distance"]],[13,"n",[6,[7,"d","vec3f"],[[1,[7,[6,"getSceneDist",[[6,[7,"std","add"],["p",[6,[7,"d","vec3f"],["e",[5,"0"],[5,"0"]]]]]]],"distance"],"-","dist"],[1,[7,[6,"getSceneDist",[[6,[7,"std","add"],["p",[6,[7,"d","vec3f"],[[5,"0"],"e",[5,"0"]]]]]]],"distance"],"-","dist"],[1,[7,[6,"getSceneDist",[[6,[7,"std","add"],["p",[6,[7,"d","vec3f"],[[5,"0"],[5,"0"],"e"]]]]]],"distance"],"-","dist"]]]],[10,[6,[7,"std","normalize"],["n"]]]]],externalNames:["getSceneDist","d","std"]},get externals(){return{getSceneDist:Sr,d:ve,std:We}}})&&e.f)({}),Xi=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";return He(t.z)>.5||He(t.x)>.6?O(0,1,0):yl(t,1e-4)}),{v:1,name:"getNormal",ast:{params:[{type:"i",name:"position"}],body:[0,[[11,[3,[1,[6,[7,"std","abs"],[[7,"position","z"]]],">",[5,"0.5"]],"||",[1,[6,[7,"std","abs"],[[7,"position","x"]]],">",[5,"0.6"]]],[0,[[10,[6,[7,"d","vec3f"],[[5,"0"],[5,"1"],[5,"0"]]]]]]],[10,[6,"getApproxNormal",["position",[5,"0.0001"]]]]]],externalNames:["std","d","getApproxNormal"]},get externals(){return{std:We,d:ve,getApproxNormal:yl}}})&&e.f)({}),gl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>{"use gpu";return ae(t,t)}),{v:1,name:"sqLength",ast:{params:[{type:"i",name:"a"}],body:[0,[[10,[6,[7,"std","dot"],["a","a"]]]]],externalNames:["std"]},get externals(){return{std:We}}})&&e.f)({}),wl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";if(t.y<-pr.groundThickness){const i=qi(t.xz)+.02,p=Lt(1-i*30),y=Lt(-t.z*4*n.z+1);return O(1).mul(p).mul(y*.5)}return O(1)}),{v:1,name:"getFakeShadow",ast:{params:[{type:"i",name:"position"},{type:"i",name:"lightDir"}],body:[0,[[11,[1,[7,"position","y"],"<",[4,"-",[7,"GroundParams","groundThickness"]]],[0,[[13,"fadeSharpness",[5,"30"]],[13,"inset",[5,"0.02"]],[13,"cutout",[1,[6,"circleCutoutDist",[[7,"position","xz"]]],"+","inset"]],[13,"edgeDarkening",[6,[7,"std","saturate"],[[1,[5,"1"],"-",[1,"cutout","*","fadeSharpness"]]]]],[13,"lightGradient",[6,[7,"std","saturate"],[[1,[1,[1,[4,"-",[7,"position","z"]],"*",[5,"4"]],"*",[7,"lightDir","z"]],"+",[5,"1"]]]]],[10,[6,[7,[6,[7,[6,[7,"d","vec3f"],[[5,"1"]]],"mul"],["edgeDarkening"]],"mul"],[[1,"lightGradient","*",[5,"0.5"]]]]]]]],[10,[6,[7,"d","vec3f"],[[5,"1"]]]]]],externalNames:["GroundParams","circleCutoutDist","std","d"]},get externals(){return{GroundParams:pr,circleCutoutDist:qi,std:We,d:ve}}})&&e.f)({}),xl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";let r=$(0),s=$(1);const i=Ti/va;for(let y=1;y<=va;y++){const v=i*$(y),_=t.add(n.mul(v)),P=ml(_)-Xu,U=ie(0,v-P);if(r+=U*s,s*=.5,r>Ti/ba)break}const p=1-ba*r/Ti;return Lt(p)}),{v:1,name:"calculateAO",ast:{params:[{type:"i",name:"position"},{type:"i",name:"normal"}],body:[0,[[12,"totalOcclusion",[6,[7,"d","f32"],[[5,"0"]]]],[12,"sampleWeight",[6,[7,"d","f32"],[[5,"1"]]]],[13,"stepDistance",[1,"AO_RADIUS","/","AO_STEPS"]],[14,[12,"i",[5,"1"]],[1,"i","<=","AO_STEPS"],[102,"++","i"],[0,[[13,"sampleHeight",[1,"stepDistance","*",[6,[7,"d","f32"],["i"]]]],[13,"samplePosition",[6,[7,"position","add"],[[6,[7,"normal","mul"],["sampleHeight"]]]]],[13,"distanceToSurface",[1,[6,"getSceneDistForAO",["samplePosition"]],"-","AO_BIAS"]],[13,"occlusionContribution",[6,[7,"std","max"],[[5,"0"],[1,"sampleHeight","-","distanceToSurface"]]]],[2,"totalOcclusion","+=",[1,"occlusionContribution","*","sampleWeight"]],[2,"sampleWeight","*=",[5,"0.5"]],[11,[1,"totalOcclusion",">",[1,"AO_RADIUS","/","AO_INTENSITY"]],[0,[[17]]]]]]],[13,"rawAO",[1,[5,"1"],"-",[1,[1,"AO_INTENSITY","*","totalOcclusion"],"/","AO_RADIUS"]]],[10,[6,[7,"std","saturate"],["rawAO"]]]]],externalNames:["d","AO_RADIUS","AO_STEPS","getSceneDistForAO","AO_BIAS","std","AO_INTENSITY"]},get externals(){return{d:ve,AO_RADIUS:Ti,AO_STEPS:va,getSceneDistForAO:ml,AO_BIAS:Xu,std:We,AO_INTENSITY:ba}}})&&e.f)({}),vl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=Fs(Ur.$.direction),i=wl(t,s),p=ie(ae(n,s),0),y=rn(r.sub(t)),v=Oc(Fs(s),n),_=ie(ae(y,v),0)**Cu,P=Ur.$.color.mul(_*qu),U=O(.9),R=U.mul(Ur.$.color).mul(p).mul(i),j=U.mul(ju).mul(Yu),L=P.mul(i);return Lt(R.add(j).add(L))}),{v:1,name:"calculateLighting",ast:{params:[{type:"i",name:"hitPosition"},{type:"i",name:"normal"},{type:"i",name:"rayOrigin"}],body:[0,[[13,"lightDir",[6,[7,"std","neg"],[[7,[7,"lightUniform","$"],"direction"]]]],[13,"fakeShadow",[6,"getFakeShadow",["hitPosition","lightDir"]]],[13,"diffuse",[6,[7,"std","max"],[[6,[7,"std","dot"],["normal","lightDir"]],[5,"0"]]]],[13,"viewDir",[6,[7,"std","normalize"],[[6,[7,"rayOrigin","sub"],["hitPosition"]]]]],[13,"reflectDir",[6,[7,"std","reflect"],[[6,[7,"std","neg"],["lightDir"]],"normal"]]],[13,"specularFactor",[1,[6,[7,"std","max"],[[6,[7,"std","dot"],["viewDir","reflectDir"]],[5,"0"]]],"**","SPECULAR_POWER"]],[13,"specular",[6,[7,[7,[7,"lightUniform","$"],"color"],"mul"],[[1,"specularFactor","*","SPECULAR_INTENSITY"]]]],[13,"baseColor",[6,[7,"d","vec3f"],[[5,"0.9"]]]],[13,"directionalLight",[6,[7,[6,[7,[6,[7,"baseColor","mul"],[[7,[7,"lightUniform","$"],"color"]]],"mul"],["diffuse"]],"mul"],["fakeShadow"]]],[13,"ambientLight",[6,[7,[6,[7,"baseColor","mul"],["AMBIENT_COLOR"]],"mul"],["AMBIENT_INTENSITY"]]],[13,"finalSpecular",[6,[7,"specular","mul"],["fakeShadow"]]],[10,[6,[7,"std","saturate"],[[6,[7,[6,[7,"directionalLight","add"],["ambientLight"]],"add"],["finalSpecular"]]]]]]],externalNames:["std","lightUniform","getFakeShadow","SPECULAR_POWER","SPECULAR_INTENSITY","d","AMBIENT_COLOR","AMBIENT_INTENSITY"]},get externals(){return{std:We,lightUniform:Ur,getFakeShadow:wl,SPECULAR_POWER:Cu,SPECULAR_INTENSITY:qu,d:ve,AMBIENT_COLOR:ju,AMBIENT_INTENSITY:Yu}}})&&e.f)({}),bl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=xl(n,r),i=t.mul(s);return k(i,1)}),{v:1,name:"applyAO",ast:{params:[{type:"i",name:"litColor"},{type:"i",name:"hitPosition"},{type:"i",name:"normal"}],body:[0,[[13,"ao",[6,"calculateAO",["hitPosition","normal"]]],[13,"finalColor",[6,[7,"litColor","mul"],["ao"]]],[10,[6,[7,"d","vec4f"],["finalColor",[5,"1"]]]]]],externalNames:["calculateAO","d"]},get externals(){return{calculateAO:xl,d:ve}}})&&e.f)({}),Tl=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n)=>{"use gpu";let r=$(),s=$();for(let i=0;i<6;i++){const p=t.add(n.mul(r));if(s=wr(p),r+=s,r>wa||s<ur*10)break}return r<wa?Ji(t,n,r).xyz:O()}),{v:1,name:"rayMarchNoJelly",ast:{params:[{type:"i",name:"rayOrigin"},{type:"i",name:"rayDirection"}],body:[0,[[12,"distanceFromOrigin",[6,[7,"d","f32"],[]]],[12,"hit",[6,[7,"d","f32"],[]]],[14,[12,"i",[5,"0"]],[1,"i","<",[5,"6"]],[102,"++","i"],[0,[[13,"p",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["distanceFromOrigin"]]]]],[2,"hit","=",[6,"getMainSceneDist",["p"]]],[2,"distanceFromOrigin","+=","hit"],[11,[3,[1,"distanceFromOrigin",">","MAX_DIST"],"||",[1,"hit","<",[1,"SURF_DIST","*",[5,"10"]]]],[0,[[17]]]]]]],[11,[1,"distanceFromOrigin","<","MAX_DIST"],[0,[[10,[7,[6,"renderBackground",["rayOrigin","rayDirection","distanceFromOrigin"]],"xyz"]]]]],[10,[6,[7,"d","vec3f"],[]]]]],externalNames:["d","getMainSceneDist","MAX_DIST","SURF_DIST","renderBackground"]},get externals(){return{d:ve,getMainSceneDist:wr,MAX_DIST:wa,SURF_DIST:ur,renderBackground:Ji}}})&&e.f)({}),Ji=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";const s=on.stateUniform.$,i=t.add(n.mul(r)),p=Xi(i),y=qs.$,v=gl(i.sub(O(0,0,0))),_=y.xyz.mul(1/(v*15+1)*.4),P=y.xyz.mul(1/(v*40+1)*.3).mul(He(p.z)),U=Vc(.7,1,s.posY)*2+0,R=vl(i,p,t),j=bl(js(Fu,Lu,Ws.$===1).mul(R),i,p).add(k(_.mul(U),0)).add(k(P.mul(U),0));return k(j.xyz,1)}),{v:1,name:"renderBackground",ast:{params:[{type:"i",name:"rayOrigin"},{type:"i",name:"rayDirection"},{type:"i",name:"backgroundHitDist"}],body:[0,[[13,"state",[7,[7,"buttonBehavior","stateUniform"],"$"]],[13,"hitPosition",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["backgroundHitDist"]]]]],[13,"newNormal",[6,"getNormal",["hitPosition"]]],[13,"jellyColor",[7,"jellyColorUniform","$"]],[13,"sqDist",[6,"sqLength",[[6,[7,"hitPosition","sub"],[[6,[7,"d","vec3f"],[[5,"0"],[5,"0"],[5,"0"]]]]]]]],[13,"bounceLight",[6,[7,[7,"jellyColor","xyz"],"mul"],[[1,[1,[5,"1"],"/",[1,[1,"sqDist","*",[5,"15"]],"+",[5,"1"]]],"*",[5,"0.4"]]]]],[13,"sideBounceLight",[6,[7,[6,[7,[7,"jellyColor","xyz"],"mul"],[[1,[1,[5,"1"],"/",[1,[1,"sqDist","*",[5,"40"]],"+",[5,"1"]]],"*",[5,"0.3"]]]],"mul"],[[6,[7,"std","abs"],[[7,"newNormal","z"]]]]]],[13,"emission",[1,[1,[6,[7,"std","smoothstep"],[[5,"0.7"],[5,"1"],[7,"state","posY"]]],"*",[5,"2"]],"+",[5,"0"]]],[13,"litColor",[6,"calculateLighting",["hitPosition","newNormal","rayOrigin"]]],[13,"backgroundColor",[6,[7,[6,[7,[6,"applyAO",[[6,[7,[6,[7,"std","select"],["LIGHT_GROUND_ALBEDO","DARK_GROUND_ALBEDO",[1,[7,"darkModeUniform","$"],"==",[5,"1"]]]],"mul"],["litColor"]],"hitPosition","newNormal"]],"add"],[[6,[7,"d","vec4f"],[[6,[7,"bounceLight","mul"],["emission"]],[5,"0"]]]]],"add"],[[6,[7,"d","vec4f"],[[6,[7,"sideBounceLight","mul"],["emission"]],[5,"0"]]]]]],[10,[6,[7,"d","vec4f"],[[7,"backgroundColor","xyz"],[5,"1"]]]]]],externalNames:["buttonBehavior","getNormal","jellyColorUniform","sqLength","d","std","calculateLighting","applyAO","LIGHT_GROUND_ALBEDO","DARK_GROUND_ALBEDO","darkModeUniform"]},get externals(){return{buttonBehavior:on,getNormal:Xi,jellyColorUniform:qs,sqLength:gl,d:ve,std:We,calculateLighting:vl,applyAO:bl,LIGHT_GROUND_ALBEDO:Fu,DARK_GROUND_ALBEDO:Lu,darkModeUniform:Ws}}})&&e.f)({}),_l=(e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=((t,n,r)=>{"use gpu";let s=J(),i=$();for(let P=0;P<bi;P++){const U=t.add(n.mul(i)),R=wr(U);if(i+=R,R<ur)break}const p=Ji(t,n,i),y=pl(),v=ul(t,n,y);if(!v.hit)return p;let _=ie($(0),v.tMin);for(let P=0;P<bi&&!(s>=bi);P++){const U=t.add(n.mul(_)),R=Sr(U);if(_+=R.distance,s++,R.distance<ur){const j=t.add(n.mul(_));if(R.objectType!==Gs.SLIDER)break;const L=Xi(j),Z=n,Q=Ie(1,ie(0,ae(Fs(Z),L))),re=al(Q,$(1),$(xa)),Me=Lt(O(j.y+.2)),oe=1/xa,be=1-oe*oe*(1-Q*Q);let ze=O();if(be>0){const Pe=rn(ue(Z.mul(oe),L.mul(oe*Q-yn(be)))),ht=j.add(Pe.mul(ur*2)).add(Pe.mul(ur*2)),it=Tl(ht,Pe),Yt=qs.$,Tt=Yt.xyz.mul(1.5),Jt=$(20),gt=O(1).sub(Yt.xyz).mul(Jt),Ee=on.stateUniform.$,Te=Lt(tn(1,.6,j.y*(1/(us.y*2))+.25))*(1-Ee.posY*.5),ge=ol(gt.mul(Te**2),.08),_t=Fs(Ur.$.direction),Zt=ie(0,ae(_t,Pe)),Le=Tt.mul(Wu*Zt*Te**3);ze=it.mul(ge).add(Le)}const Se=ue(Me.mul(re),ze.mul(1-re));return k(Se,1)}if(_>i)break}return p}),{v:1,name:"rayMarch",ast:{params:[{type:"i",name:"rayOrigin"},{type:"i",name:"rayDirection"},{type:"i",name:"_uv"}],body:[0,[[12,"totalSteps",[6,[7,"d","u32"],[]]],[12,"backgroundDist",[6,[7,"d","f32"],[]]],[14,[12,"i",[5,"0"]],[1,"i","<","MAX_STEPS"],[102,"++","i"],[0,[[13,"p",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["backgroundDist"]]]]],[13,"hit",[6,"getMainSceneDist",["p"]]],[2,"backgroundDist","+=","hit"],[11,[1,"hit","<","SURF_DIST"],[0,[[17]]]]]]],[13,"background",[6,"renderBackground",["rayOrigin","rayDirection","backgroundDist"]]],[13,"bbox",[6,"getJellyBounds",[]]],[13,"intersection",[6,"intersectBox",["rayOrigin","rayDirection","bbox"]]],[11,[4,"!",[7,"intersection","hit"]],[0,[[10,"background"]]]],[12,"distanceFromOrigin",[6,[7,"std","max"],[[6,[7,"d","f32"],[[5,"0"]]],[7,"intersection","tMin"]]]],[14,[12,"i",[5,"0"]],[1,"i","<","MAX_STEPS"],[102,"++","i"],[0,[[11,[1,"totalSteps",">=","MAX_STEPS"],[0,[[17]]]],[13,"currentPosition",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["distanceFromOrigin"]]]]],[13,"hitInfo",[6,"getSceneDist",["currentPosition"]]],[2,"distanceFromOrigin","+=",[7,"hitInfo","distance"]],[102,"++","totalSteps"],[11,[1,[7,"hitInfo","distance"],"<","SURF_DIST"],[0,[[13,"hitPosition",[6,[7,"rayOrigin","add"],[[6,[7,"rayDirection","mul"],["distanceFromOrigin"]]]]],[11,[4,"!",[1,[7,"hitInfo","objectType"],"==",[7,"ObjectType","SLIDER"]]],[0,[[17]]]],[13,"N",[6,"getNormal",["hitPosition"]]],[13,"I","rayDirection"],[13,"cosi",[6,[7,"std","min"],[[5,"1"],[6,[7,"std","max"],[[5,"0"],[6,[7,"std","dot"],[[6,[7,"std","neg"],["I"]],"N"]]]]]]],[13,"F",[6,"fresnelSchlick",["cosi",[6,[7,"d","f32"],[[5,"1"]]],[6,[7,"d","f32"],["JELLY_IOR"]]]]],[13,"reflection",[6,[7,"std","saturate"],[[6,[7,"d","vec3f"],[[1,[7,"hitPosition","y"],"+",[5,"0.2"]]]]]]],[13,"eta",[1,[5,"1"],"/","JELLY_IOR"]],[13,"k",[1,[5,"1"],"-",[1,[1,"eta","*","eta"],"*",[1,[5,"1"],"-",[1,"cosi","*","cosi"]]]]],[12,"refractedColor",[6,[7,"d","vec3f"],[]]],[11,[1,"k",">",[5,"0"]],[0,[[13,"refrDir",[6,[7,"std","normalize"],[[6,[7,"std","add"],[[6,[7,"I","mul"],["eta"]],[6,[7,"N","mul"],[[1,[1,"eta","*","cosi"],"-",[6,[7,"std","sqrt"],["k"]]]]]]]]]],[13,"p",[6,[7,"hitPosition","add"],[[6,[7,"refrDir","mul"],[[1,"SURF_DIST","*",[5,"2"]]]]]]],[13,"exitPos",[6,[7,"p","add"],[[6,[7,"refrDir","mul"],[[1,"SURF_DIST","*",[5,"2"]]]]]]],[13,"env",[6,"rayMarchNoJelly",["exitPos","refrDir"]]],[13,"jellyColor",[7,"jellyColorUniform","$"]],[13,"scatterTint",[6,[7,[7,"jellyColor","xyz"],"mul"],[[5,"1.5"]]]],[13,"density",[6,[7,"d","f32"],[[5,"20"]]]],[13,"absorb",[6,[7,[6,[7,[6,[7,"d","vec3f"],[[5,"1"]]],"sub"],[[7,"jellyColor","xyz"]]],"mul"],["density"]]],[13,"state",[7,[7,"buttonBehavior","stateUniform"],"$"]],[13,"progress",[1,[6,[7,"std","saturate"],[[6,[7,"std","mix"],[[5,"1"],[5,"0.6"],[1,[1,[7,"hitPosition","y"],"*",[1,[5,"1"],"/",[1,[7,"JELLY_HALFSIZE","y"],"*",[5,"2"]]]],"+",[5,"0.25"]]]]]],"*",[1,[5,"1"],"-",[1,[7,"state","posY"],"*",[5,"0.5"]]]]],[13,"T",[6,"beerLambert",[[6,[7,"absorb","mul"],[[1,"progress","**",[5,"2"]]]],[5,"0.08"]]]],[13,"lightDir",[6,[7,"std","neg"],[[7,[7,"lightUniform","$"],"direction"]]]],[13,"forward",[6,[7,"std","max"],[[5,"0"],[6,[7,"std","dot"],["lightDir","refrDir"]]]]],[13,"scatter",[6,[7,"scatterTint","mul"],[[1,[1,"JELLY_SCATTER_STRENGTH","*","forward"],"*",[1,"progress","**",[5,"3"]]]]]],[2,"refractedColor","=",[6,[7,[6,[7,"env","mul"],["T"]],"add"],["scatter"]]]]]],[13,"jelly",[6,[7,"std","add"],[[6,[7,"reflection","mul"],["F"]],[6,[7,"refractedColor","mul"],[[1,[5,"1"],"-","F"]]]]]],[10,[6,[7,"d","vec4f"],["jelly",[5,"1"]]]]]]],[11,[1,"distanceFromOrigin",">","backgroundDist"],[0,[[17]]]]]]],[10,"background"]]],externalNames:["d","MAX_STEPS","getMainSceneDist","SURF_DIST","renderBackground","getJellyBounds","intersectBox","std","getSceneDist","ObjectType","getNormal","fresnelSchlick","JELLY_IOR","rayMarchNoJelly","jellyColorUniform","buttonBehavior","JELLY_HALFSIZE","beerLambert","lightUniform","JELLY_SCATTER_STRENGTH"]},get externals(){return{d:ve,MAX_STEPS:bi,getMainSceneDist:wr,SURF_DIST:ur,renderBackground:Ji,getJellyBounds:pl,intersectBox:ul,std:We,getSceneDist:Sr,ObjectType:Gs,getNormal:Xi,fresnelSchlick:al,JELLY_IOR:xa,rayMarchNoJelly:Tl,jellyColorUniform:qs,buttonBehavior:on,JELLY_HALFSIZE:us,beerLambert:ol,lightUniform:Ur,JELLY_SCATTER_STRENGTH:Wu}}})&&e.f)({}),p2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H["~unstable"].fragmentFn({in:{uv:F},out:k})((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(({uv:t})=>{Nu.seed2(io.$.mul(t));const n=F(t.x*2-1,-(t.y*2-1)),r=hl(n),s=_l(r.origin,r.direction,t),i=js(1.5,2,Ws.$===1);return k(Gc(s.xyz.mul(i)),1)}),{v:1,name:void 0,ast:{params:[{type:"d",props:[{name:"uv",alias:"uv"}]}],body:[0,[[6,[7,"randf","seed2"],[[6,[7,[7,"randomUniform","$"],"mul"],["uv"]]]],[13,"ndc",[6,[7,"d","vec2f"],[[1,[1,[7,"uv","x"],"*",[5,"2"]],"-",[5,"1"]],[4,"-",[1,[1,[7,"uv","y"],"*",[5,"2"]],"-",[5,"1"]]]]]],[13,"ray",[6,"getRay",["ndc"]]],[13,"color",[6,"rayMarch",[[7,"ray","origin"],[7,"ray","direction"],"uv"]]],[13,"exposure",[6,[7,"std","select"],[[5,"1.5"],[5,"2"],[1,[7,"darkModeUniform","$"],"==",[5,"1"]]]]],[10,[6,[7,"d","vec4f"],[[6,[7,"std","tanh"],[[6,[7,[7,"color","xyz"],"mul"],["exposure"]]]],[5,"1"]]]]]],externalNames:["randf","randomUniform","d","getRay","rayMarch","std","darkModeUniform"]},get externals(){return{randf:Nu,randomUniform:io,d:ve,getRay:hl,rayMarch:_l,std:We,darkModeUniform:Ws}}})&&e.f)({})),"raymarchFn"),d2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(H["~unstable"].fragmentFn({in:{uv:F},out:k})((e=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(e.f=(t=>Jh(ro.$.currentTexture,cl.$,t.uv)),{v:1,name:void 0,ast:{params:[{type:"i",name:"input"}],body:[0,[[10,[6,[7,"std","textureSample"],[[7,[7,"sampleLayout","$"],"currentTexture"],[7,"filteringSampler","$"],[7,"input","uv"]]]]]],externalNames:["std","sampleLayout","filteringSampler"]},get externals(){return{std:We,sampleLayout:ro,filteringSampler:cl}}})&&e.f)({})),"fragmentMain"),pp=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze["~unstable"].withVertex(rp,{}).withFragment(p2,{format:"rgba8unorm"}).createPipeline(),"rayMarchPipeline"),f2=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(Ze["~unstable"].withVertex(rp,{}).withFragment(d2,{format:cp}).createPipeline(),"renderPipeline");let $l=performance.now(),Ai=0;const Jo=new c2(Ze,Zn,Hn);function dp(){return{rayMarch:Ze.createBindGroup(ap,{backgroundTexture:Wo.sampled}),render:[0,1].map(e=>Ze.createBindGroup(ro,{currentTexture:Jo.getResolvedTexture(e)}))}}let fp=dp();function mp(e){Ai++,Xo.jitter();const t=Math.min((e-$l)*.001,.1);$l=e,io.write(F((Math.random()-.5)*2,(Math.random()-.5)*2)),on.update(t);const n=Ai%2;pp.withColorAttachment({view:Ze.unwrap(so[n].sampled),loadOp:"clear",storeOp:"store"}).draw(3),Jo.resolve(so[n].sampled,Ai,n),f2.withColorAttachment({view:hp.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}).with(fp.render[n]).draw(3),requestAnimationFrame(mp)}function ao(){[Zn,Hn]=[xn.width*hs,xn.height*hs],Xo.updateProjection(Math.PI/4,Zn,Hn),so=up(Ze,Zn,Hn),Wo=lp(Ze,Zn,Hn),Jo.resize(Zn,Hn),Ai=0,fp=dp()}const yp=new ResizeObserver(()=>{ao()});yp.observe(xn);requestAnimationFrame(mp);xn.addEventListener("touchstart",e=>{on.pressed=!0,e.preventDefault()});xn.addEventListener("touchend",e=>{on.pressed=!1});xn.addEventListener("mousedown",e=>{on.pressed=!0,e.preventDefault()});xn.addEventListener("mouseup",e=>{on.pressed=!1,e.stopPropagation()});window.addEventListener("mouseup",e=>{on.pressed=!1});async function m2(){if(!h2)return .5;const e=5,t=2;let n=.3,r=0;const s=pp.withPerformanceCallback((i,p)=>{r=Number(p-i)/1e6});for(let i=0;i<8;i++){const p=(globalThis.__TYPEGPU_AUTONAME__??(v=>v))(Ze["~unstable"].createTexture({size:[xn.width*n,xn.height*n],format:"rgba8unorm"}).$usage("render"),"testTexture");if(s.withColorAttachment({view:Ze.unwrap(p).createView(),loadOp:"clear",storeOp:"store"}).with(Ze.createBindGroup(ap,{backgroundTexture:Wo.sampled})).draw(3),await Ze.device.queue.onSubmittedWorkDone(),p.destroy(),Math.abs(r-e)<t)break;const y=r>e?-.1:.1;n=Math.max(.3,Math.min(1,n+y))}return console.log(`Auto-selected quality scale: ${n.toFixed(2)}`),n}const hv={Quality:{initial:"Auto",options:["Auto","Very Low","Low","Medium","High","Ultra"],onSelectChange:e=>{if(e==="Auto"){m2().then(n=>{hs=n,ao()});return}hs={"Very Low":.3,Low:.5,Medium:.7,High:.85,Ultra:1}[e]||.5,ao()}},"Light dir":{initial:0,min:0,max:1,step:.01,onSliderChange:e=>{const t=rn(O(.18,-.3,.64)),n=rn(O(-.5,-.14,-.8)),r=rn(tn(t,n,e));Ur.writePartial({direction:r})}},"Jelly Color":{initial:[.08,.5,1],onColorChange:e=>{qs.write(k(...e,1))}},"Dark Mode":{initial:!1,onToggleChange:e=>{Ws.write(J(e))}}};function pv(){yp.disconnect(),Ze.destroy()}export{hv as controls,pv as onCleanup};
